{"inframe":true,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\nprotocol = (protocol == \"HTTP/1.1\" ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\nrequest.setAttribute(\"appIP\",url);","head":"<style type=\"text/css\">    \n.x-hidebar .x-toolbar{display:none !important;}\n<\/style>","itemId":"xip.podemo"},"events":{"initialize":"Wb.apply(app, {\n  xipMainNav: null,\n  init: function(mainNav) {\n    if (mainNav) {\n      app.xipMainNav = mainNav;\n    }\n  }\n});"},"children":[{"configs":{"file":"m?xwl=xip/touch/demo/po","itemId":"po"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"itemId":"store"},"children":[{"configs":{"storeName":"poLineStore","itemId":"poLineStore","url":"m?xwl=xip/wf/wfDemo/DATA/poListStore"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"folder"},{"configs":{"normalName":"poViewport","itemId":"poViewport"},"children":[{"configs":{"title":"testsasdfasdfas","layout":"fit","itemId":"poMainContainer"},"events":{"painted":"app.poStore.load();"},"children":[{"configs":{"docked":"top","itemId":"toolbar1"},"children":[{"configs":{"placeHolder":"订单编号/说明/供应商","xtype":"searchfield","itemId":"poSearch"},"events":{"action":"app.poStore.load();"},"children":[],"expanded":false,"type":"ttext"}],"expanded":true,"type":"ttoolbar"},{"configs":{"cls":"x-hidebar","selectedCls":"x-item-selected","plugins":"{\n  xclass: 'Ext.plugin.ListPaging', \n  autoPaging: true\n}","scrollToTopOnRefresh":"true","useSimpleItems":"true","rowNumber":"true","itemId":"poList","editable":"false"},"children":[{"configs":{"storeName":"poStore","normalName":"poStore","autoLoad":"false","itemId":"store","url":"m?xwl=xip/touch/demo/data/getPoList"},"events":{"beforeload":"if (app.poSearch) {\n  store.getProxy().setExtraParams({\n    \"filterStr\": app.poSearch.getValue()\n  });\n} else {\n  store.getProxy().setExtraParams({\n    \"filterStr\": ''\n  });\n}"},"children":[],"expanded":false,"type":"tstore"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"30","xtype":"checkcolumn","itemId":"rowNo"},"children":[],"expanded":false,"type":"tcolumn"},{"configs":{"text":"订单编号","width":"100","dataIndex":"PO_NO","itemId":"poNo"},"children":[],"expanded":false,"type":"tcolumn"},{"configs":{"text":"订单说明","width":"150","dataIndex":"PO_DESC","itemId":"poDesc"},"children":[],"expanded":false,"type":"tcolumn"},{"configs":{"text":"供应商","width":"150","dataIndex":"VENDOR","itemId":"vendor"},"children":[],"expanded":false,"type":"tcolumn"},{"configs":{"text":"状态","width":"80","dataIndex":"STATUS","itemId":"status"},"children":[],"expanded":false,"type":"tcolumn"}],"expanded":true,"type":"array"}],"expanded":true,"type":"tgrid"},{"configs":{"docked":"bottom","itemId":"toolbar2"},"children":[{"configs":{"ui":"plain","text":"新建","itemId":"tb_new"},"events":{"tap":"app.po.init(app.xipMainNav);\napp.po.selPo={data:{'PO_ID':Wb.getId(),'OP_TYPE':'I','PO_DATE':new Date()}};\napp.xipMainNav.push(app.po._poDtl);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"编辑","itemId":"tb_edit"},"events":{"tap":"app.po.init(app.xipMainNav);\nvar items = app.poList.getSelection();\nif(items.length===0){\n  Ext.Msg.alert(\"请先选择一条采购订单\");\n}else{\n  var item =items[0];\n  app.po.selPo=item;\n  app.xipMainNav.push(app.po._poDtl);\n}"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"删除","itemId":"tb_del"},"events":{"tap":"var items = app.poList.getSelection();\nif (items.length === 0) {\n  Ext.Msg.alert(\"请先选择一条要删除的采购订单\");\n} else {\n  var item = items[0];\n  var rec = item.data;\n  if (rec.ATTRIBUTE10 === null || rec.ATTRIBUTE10 === \"A\" || rec.ATTRIBUTE10 === \"R\" || rec.ATTRIBUTE10 === \"D\" || rec.ATTRIBUTE10 === \"\") {\n    Wb.confirm(\"确定要删除此条采购订单吗？\", function() {\n      var poId = item.data.PO_ID;\n      Ext.Ajax.request({\n        url: 'm?xwl=xip/touch/demo/data/delPoLines',\n        params: {\n          PO_ID: poId\n        },\n        method: 'POST',\n        async: true,\n        success: function(response, options) {\n          //删除订单头\n          Ext.Ajax.request({\n            url: 'm?xwl=xip/wf/wfDemo/DATA/deleteList',\n            params: {\n              destroy: [{\n                PO_ID: poId\n              }]\n            },\n            method: 'POST',\n            async: true,\n            success: function(response, options) {\n              app.poStore.load({\n                params: {\n                  \"filterStr\": app.poSearch.getValue()\n                }\n              });\n            },\n            failure: function(response, options) {}\n          });\n        },\n        failure: function(response, options) {}\n      });\n    });\n  } else {\n    Ext.Msg.alert(\"审批中或已审批订单不可删除！\");\n  }\n}"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"提交","itemId":"tb_start"},"events":{"tap":"var items = app.poList.getSelection();\nvar cnt = items.length;\nif (cnt === 0) {\n  Ext.Msg.alert(\"提示\", \"请先选择一条订单再启动流程。\");\n  return;\n}\nvar item = items[0];\nvar rec = item.data;\nif (rec.ATTRIBUTE10 === null || rec.ATTRIBUTE10 === \"A\" || rec.ATTRIBUTE10 === \"R\" || rec.ATTRIBUTE10 === \"D\" || rec.ATTRIBUTE10 === \"\") {\n  var instCode = rec.INST_CODE;\n  var json = {\n    AMT: rec.AMT,\n    PO_DESC: rec.PO_DESC,\n    PO_NO: rec.PO_NO,\n    e_org: rec.ORG_ID,\n    e_dept: rec.DEPT_ID,\n    e_business_id: rec.PO_ID,\n    APP_IP: '{#appIP#}'\n  };\n  if (instCode === null || instCode === '') {\n\n    XipWf.startAndSubmitByEntity(app.xipMainNav, \"XIP_DEMO\", json, function(obj) {\n      if (obj.flag === 0) {\n        Ext.Ajax.request({\n          url: 'm?xwl=xip/wf/wfDemo/DATA/saveInstanceCode',\n          params: {\n            array: [{\n              PO_ID: rec.PO_ID,\n              INST_CODE: obj.instanceCode\n            }]\n          },\n          method: 'POST',\n          async: false,\n          success: function(response, options) {\n            app.poStore.load({\n              params: {\n                \"filterStr\": app.poSearch.getValue()\n              }\n            });\n            Ext.Msg.alert(\"提示\", \"启动流程成功\");\n          },\n          failure: function(reponse, options) {\n            Ext.Msg.alert(\"提示\", \"回写订单流程实例编码请求发送失败。\");\n          }\n        });\n      } else {\n        Ext.Msg.alert(\"提示\", obj.msg);\n      }\n    });\n  } else {\n    if (rec.ATTRIBUTE10 === \"D\") {\n      XipWf.submitInstance(app.poMainNav, instCode, json, function(obj) {\n        if (obj.flag === 0) {\n          app.poStore.load({\n            params: {\n              \"filterStr\": app.poSearch.getValue()\n            }\n          });\n          Ext.Msg.alert(\"提示\", \"启动流程成功\");\n        } else {\n          Ext.Msg.alert(\"提示\", obj.msg);\n        }\n      });\n    } else {\n      XipWf.restartAndSubmitByProcess(app.poMainNav, instCode, '', json, function(obj) {\n        if (obj.flag === 0) {\n          app.poStore.load({\n            params: {\n              \"filterStr\": app.poSearch.getValue()\n            }\n          });\n          Ext.Msg.alert(\"提示\", \"启动流程成功\");\n        } else {\n          Ext.Msg.alert(\"提示\", obj.msg);\n        }\n      });\n    }\n  }\n\n} else {\n  Ext.Msg.alert(\"提示\", \"对于审批结束和审批中的订单不能启动流程\");\n  return;\n}"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"撤回","itemId":"tb_cancle"},"events":{"tap":"var items = app.poList.getSelection();\nvar cnt = items.length;\nif (cnt === 0) {\n  Ext.Msg.alert(\"提示\", \"请先选择一条订单再启动流程。\");\n  return;\n}\nvar item = items[0];\nvar rec = item.data;\nXipWf.revokeByInstance(rec.INST_CODE, function(obj) {\n  app.poStore.load({\n    params: {\n      \"filterStr\": app.poSearch.getValue()\n    }\n  });\n  Ext.Msg.alert(obj.msg);\n});"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"监控","itemId":"tb_wfHistory"},"events":{"tap":"var items = app.poList.getSelection();\nvar cnt = items.length;\nif (cnt === 0) {\n  Ext.Msg.alert(\"提示\", \"请先选择一条订单再启动流程。\");\n  return;\n}\nvar item = items[0];\nvar rec = item.data;\nXipWf.showMonitorPage(app.xipMainNav,rec.INST_CODE);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"附件","itemId":"tb_att"},"events":{"tap":"var items = app.poList.getSelection();\nvar cnt = items.length;\nif (cnt === 0) {\n  Ext.Msg.alert(\"提示\", \"请先选择一条订单再启动流程。\");\n  return;\n}\nvar item = items[0];\nvar rec = item.data;\nXip.showAttachmentManagerTouch(app.xipMainNav, '{#XIP.userId#}', rec.PO_ID, rec.ORG_ID, 'Demo', rec.PO_NO, 'Y', 'Y', 'Y', function() {\n  alert('closeCallBack');\n}, '100');"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"ttoolbar"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}