{"inframe":true,"title":"移动主页","hidden":false,"roles":{"demo":1,"default":1,"dev":1,"basic":1},"children":[{"configs":{"title":"{#mainPageTitle#}","initScript":"var title = com.xzsoft.xip.platform.util.PlatformUtil.getAppName();\nrequest.setAttribute(\"mainPageTitle\",title);\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/touch/navigator/tnavigator\");","itemId":"xip.thome","head":"<style type=\"text/css\">    \n.x-hidebar .x-toolbar{display:none !important;}\n<\/style>\n<meta name=\"apple-mobile-web-app-title\" content=\"集成开发平台\">\n<link rel=\"apple-touch-icon\" href=\"xip/images/xip.png\"/>\n<link rel=\"shortcut icon\" href=\"xip/images/xip.png\"/>"},"events":{"finalize":"app.computeIconWidth();","initialize":"Wb.apply(app, {\n  viewCnt:0,\n  /**\n   * 添加系统返回前进按钮的历史记录。\n   * @param {Mixed} param 参数。如果参数类型为字符串则指定为url，否则指定为控件，并以其id作为url。\n   */\n  addHistory: function(param) {\n    if (param) {\n      app.history.add({\n        url: Ext.isString(param) ? param : param.getId()\n      }, true);\n    }\n  },\n  /**\n   * 按系统返回前进按钮时触发的事件。用户可以重载此方法以自定义系统返回前进按钮功能。\n   * @param {String} param 用户使用addHistory添加的参数或添加的控件itemId。\n   */\n  setHistory: function(param) {\n    if (Ext.getBody().down('div[class~=x-mask]:not([class~=x-item-hidden])')) {\n      //如果存在模态窗口禁止使用导航\n      app.disableSetHistory = true;\n      app.addHistory(app.container.getActiveItem());\n      return;\n    }\n    if (!param) {\n      if (app.container.getActiveItem() != app.appList)\n        app.container.setActiveItem(app.appList);\n      else\n        Wb.toast(Str.backToExit);\n      return;\n    }\n    var item = Ext.getCmp(param);\n    if (item)\n      app.container.setActiveItem(item);\n  },\n  computeIconWidth: function() {\n    var i, j, containerWidth = app.home.innerElement.getWidth() - 16,\n      minVal = containerWidth,\n      iconWidth = 80;\n    for (i = 80; i < 100; i++) {\n      j = containerWidth % i;\n      if (j < minVal) {\n        minVal = j;\n        iconWidth = i;\n      }\n    }\n    app.appIconWidth = iconWidth;\n  },\n  refreshApps: function() {\n    app.appList.store.load();\n  },\n  close: function() {\n    app.mainMenu.hide();\n    var item = app.container.getActiveItem();\n    //外部加载的模块\n    if (item.__url)\n      app.container.remove(item);\n  },\n  logout: function() {\n    Wb.request({\n      url: 'frameAction.do?method=logout',\n      success: function(resp) {\n        window.location.replace('./');\n      }\n    });\n  },\n  setTheme: function() {\n    var found, url = 'xip/touch/theme/theme.xwl';\n    Wb.run({\n      url: url,\n      success: function(scope) {\n        Wb.each(scope, function(k, v) {\n          if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n            var newCard = Ext.create('Ext.Container',{\n              xtype: 'container',\n              layout: 'fit',\n              title:'皮肤设置'\n            });\n            newCard.add(v);\n            newCard.__glyph = '&#xf0ce';\n            newCard.__image = '';\n            newCard.__title = '皮肤设置';\n            newCard.__url = url;\n            app.settingNav.push(newCard);\n            return false;\n          }\n        });\n      }\n    });\n  },\n  switchRole:function(){\n    app.settingNav.push(app._tcSwitchRole);\n  },\n  chgPwd: function() {\n    var found, url = 'xip/touch/chgPwd/chgPwd.xwl';\n    Wb.run({\n      url: url,\n      success: function(scope) {\n        Wb.each(scope, function(k, v) {\n          if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n            var newCard = Ext.create('Ext.Container',{\n              xtype: 'container',\n              layout: 'fit',\n              title:'修改密码'\n            });\n            newCard.add(v);\n            newCard.__glyph = '&#xf007';\n            newCard.__image = '';\n            newCard.__title = '修改密码';\n            newCard.__url = url;\n            app.settingNav.push(newCard);\n            return false;\n          }\n        });\n      }\n    });\n  }\n});\napp.history = new Ext.app.History({\n  listeners: {\n    change: function(url) {\n      if (app.disableSetHistory)\n        app.disableSetHistory = false;\n      else\n        app.setHistory(url);\n    }\n  }\n});"},"children":[{"configs":{"itemId":"busNavBar"},"children":[{"configs":{"ui":"plain","align":"right","glyph":"f015","itemId":"tb_close"},"events":{"tap":"var item = app.home.getActiveItem();\n//外部加载的模块\nif (item.__url)\n  app.home.remove(item);"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"array"},{"configs":{"itemId":"navBar"},"children":[{"configs":{"placeHolder":"{#task.title.placeholder#}","xtype":"searchfield","itemId":"taskSearchTitle"},"events":{"action":"app.taskList.getStore().load();"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"ui":"plain","align":"right","glyph":"f015","itemId":"tb_close"},"events":{"tap":"app.home.setActiveItem(app.appListFrame);"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"array"},{"configs":{"itemId":"settingBar"},"children":[{"configs":{"ui":"plain","align":"right","glyph":"f015","itemId":"tb_close"},"events":{"tap":"app.home.setActiveItem(app.appListFrame);"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"array"},{"configs":{"itemId":"noticeNavBar"},"children":[{"configs":{"width":"105","value":"open","clearIcon":"false","itemId":"noticeStaus","options":"[{\n  text: '{#notice.status.open#}',\n  value: 'open'\n}, {\n  text: '{#notice.status.close#}',\n  value: 'closed'\n}]"},"events":{"change":"app.noticeList.getStore().load();"},"children":[],"expanded":false,"type":"tselect"},{"configs":{"ui":"plain","align":"right","glyph":"f015","itemId":"tb_close"},"events":{"tap":"app.home.setActiveItem(app.appListFrame);"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"array"},{"configs":{"file":"m?xwl=xip/touch/wf/taskDtl","itemId":"task"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"file":"m?xwl=xip/touch/notice/noticeDtl","itemId":"noticeDtl"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"title":"切换角色","layout":"fit","itemId":"tcSwitchRole","createInstance":"false"},"events":{"activate":"var list = container.down('#tlRoles');\nlist.getStore().load({params:{userId:'{#XIP.userId#}'}});"},"children":[{"configs":{"itemTpl":"{ROLE_NAME}","normalName":"tlRoles","itemId":"tlRoles"},"events":{"itemtap":"Ext.Ajax.request({\n  url: 'frameAction.do?method=switchRole',\n  method: 'POST',\n  params: {\n    \"roleId\": record.data.ROLE_ID,\n    \"roleName\": record.data.ROLE_NAME,\n    \"roleCode\": record.data.ROLE_CODE\n  },\n  success: function(response, options) {\n    Ext.Msg.hide();\n    var temp = response.responseText;\n    var resp = Ext.JSON.decode(temp);\n    if (resp.flag == '1') {\n      window.location.replace('m?xwl=xip/touch/navigator/tnavigator');\n    } else {\n      Ext.Msg.alert('提示', resp.msg);\n    }\n  },\n  failure: function(response, options) {\n    Ext.Msg.alert(\"提示\", \"服务器端没有响应,切换角色失败\");\n  }\n});"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xip/touch/navigator/data/getRole"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"},{"configs":{"appGlyph":"f015","layout":"fit","itemId":"viewport"},"children":[{"configs":{"title":"{#mainPageTitle#}","layout":"card","normalName":"home","itemId":"home"},"children":[{"configs":{"title":"{#mainPageTitle#}","layout":"fit","itemId":"appListFrame"},"children":[{"configs":{"cls":"dataview-inline","style":"background-color:white;","itemTpl":"<table width='{[app.appIconWidth]}px' style='table-layout:fixed;color:#737373;'>\n  <tr><td align='center' valign='middle' style='height:60px;'><div class='wb_glyph4 x-dv-item-pad' style='width:48px;height:48px;background-size:cover;background-image:url({image});'>{glyph}<\/div><\/td><\/tr>\n  <tr><td align='center' valign='top' style='height:30px;'><div style='font-size:13px;'>{title}<\/div><\/td><\/tr>  \n<\/table>","inline":"true","padding":"8","itemId":"appList","draggable":"true"},"events":{"itemtap":"var found, url = record.get('url');\napp.home.items.each(function(item) {\n  if (item.__url == url) {\n    found = true;\n    app.home.setActiveItem(item);\n    return;\n  }\n});\nif (found)\n  return;\nWb.run({\n  url: url,\n  success: function(scope) {\n    Wb.each(scope, function(k, v) {\n      if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n        var newCard = Ext.create('Ext.NavigationView', {\n          fullscreen: true,\n          navigationBar: {items:app.busNavBar},\n          items: [{\n            title: record.get('title'),\n            layout: 'fit',\n            items: [v]\n          }]\n        });\n        if (scope.init) {\n          scope.init(newCard);\n        }\n        newCard.__url = url;\n        app.home.setActiveItem(newCard);\n        return false;\n      }\n    });\n  }\n});"},"children":[{"configs":{"maskBindObject":"true","autoLoad":"true","itemId":"store","url":"platformAction.do?method=loadTouchMenu","fields":"['title', 'image', 'glyph', 'url']"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tdataview"},{"configs":{"docked":"bottom","itemId":"mainNavBar"},"children":[{"configs":{"itemId":"spacer1"},"children":[],"expanded":false,"type":"tspacer"},{"configs":{"ui":"plain","text":"{#btn.home.text#}","glyph":"f015","itemId":"btnHome"},"events":{"tap":"app.home.setActiveItem(app.appListFrame);\napp.refreshApps();"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"{#btn.task.text#}","glyph":"f00b","itemId":"btnTask"},"events":{"tap":"app.home.setActiveItem(app.taskNav);\napp.taskStore.load();"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"{#btn.notice.text#}","glyph":"f003","itemId":"btnNotice"},"events":{"tap":"app.home.setActiveItem(app.noticeNav);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"ui":"plain","text":"{#btn.setting.text#}","glyph":"f013","itemId":"btnSetting"},"events":{"tap":"app.home.setActiveItem(app.settingNav);"},"children":[],"expanded":true,"type":"tbutton"},{"configs":{"itemId":"spacer2"},"children":[],"expanded":false,"type":"tspacer"}],"expanded":true,"type":"ttoolbar"}],"expanded":true,"type":"tcontainer"},{"configs":{"itemId":"taskNav","navigationBar":"{items:app.navBar}","createInstance":"true"},"events":{"back":"app.taskSearchTitle.show();\napp.taskList.getStore().load();","pop":"app.taskList.getStore().load();"},"children":[{"configs":{"itemTpl":"{TASKTITLE}","itemId":"taskList"},"events":{"activate":"if(app.taskSearchTitle){\n  app.taskSearchTitle.show();\n  app.taskStore.load();\n}","itemtap":"app.taskSearchTitle.hide();\nvar found, taskId = record.get('TASKID');\napp.taskNav.items.each(function(item) {\n  if (item.__taskId === taskId) {\n    found = true;\n    return;\n  }\n});\nif (found)\n  return;\napp.task.init(app.taskNav,record.data);\napp.task._taskDtl._taskId =taskId;\napp.taskNav.push(app.task._taskDtl);"},"children":[{"configs":{"storeName":"taskStore","itemId":"store","autoLoad":"true","normalName":"taskStore","url":"m?xwl=xip/touch/navigator/data/getTasks"},"events":{"load":"var cnt = records.length;\nif(cnt >0){\n  app.btnTask.setBadgeText(cnt);\n}else{\n  app.btnTask.setBadgeText('');\n}","beforeload":"if (app.taskSearchTitle) {\n  store.getProxy().setExtraParams({\n    \"searchText\": app.taskSearchTitle.getValue()\n  });\n} else {\n  store.getProxy().setExtraParams({\n    \"searchText\": ''\n  });\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tnavigate"},{"configs":{"itemId":"noticeNav","navigationBar":"{items:app.noticeNavBar}"},"events":{"pop":"app.noticeList.getStore().load();"},"children":[{"configs":{"layout":"fit","itemId":"notice","iconCls":"organize","createInstance":"false"},"events":{"painted":"app.noticeStaus.show();\napp.noticeList.getStore().load();"},"children":[{"configs":{"itemTpl":"{NOTICE_TITLE}","itemId":"noticeList"},"events":{"itemtap":"app.noticeStaus.hide();\napp.noticeDtl.init(app.noticeNav,record.data);\napp.noticeNav.push(app.noticeDtl._notice);","show":"list.store.load();"},"children":[{"configs":{"storeName":"noticeStore","clearOnPageLoad":"true","itemId":"store","autoLoad":"true","url":"m?xwl=xip/touch/navigator/data/getNotices","clearRemovedOnLoad":"true"},"events":{"load":"var cnt = records.length;\nif(cnt >0){\n  app.btnNotice.setBadgeText(cnt);\n}else{\n  app.btnNotice.setBadgeText('');\n}","beforeload":"if (app.noticeStaus) {\n  store.getProxy().setExtraParams({\n    \"status\": app.noticeStaus.getValue()\n  });\n} else {\n  store.getProxy().setExtraParams({\n    \"status\": 'open'\n  });\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tnavigate"},{"configs":{"itemId":"settingNav","navigationBar":"{items:app.settingBar}"},"children":[{"configs":{"title":"{#setting.title#}","layout":"fit","itemId":"setting","iconCls":"settings"},"children":[{"configs":{"itemTpl":"<div style='height:40px'><span class='wb_glyph'>&#x{glyph};<\/span>&nbsp;{text}<\/div>","scrollable":"false","itemId":"dataview1","padding":"8"},"events":{"itemtap":"record.get('handler')();"},"children":[{"configs":{"data":" [{\n   text: '{#setting.logout#}',\n   glyph: 'f011',\n   handler: app.logout\n }, {\n   text: '{#setting.theme#}',\n   glyph: 'f0ce',\n   handler: app.setTheme\n }, {\n   text: '{#setting.changepwd#}',\n   glyph: 'f007',\n   handler: app.chgPwd\n }]","itemId":"store","fields":"['text', 'glyph', 'handler']"},"events":{"load":"if('{#XIP.AUTH_MODAL#}'==='ROLE')\nstore.add({\n   text: '{#setting.switchRole#}',\n   glyph: 'f0c0',\n   handler: app.switchRole\n });"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tdataview"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tnavigate"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}