{"inframe":true,"title":"附件控件","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","initScript":"var protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\nprotocol = (protocol == \"HTTP/1.1\" ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\nrequest.setAttribute(\"appIP\",url);\n\n\nrequest.setAttribute(\"contextPath\",ctxPath);\n","itemId":"module"},"events":{"initialize":"Wb.apply(app, {\n  View: null,\n  attxwl: null,\n  srcid: null,\n  attcat: null,\n  orgid: null,\n  busno: null,\n  canup: null,\n  candown: null,\n  candel: null,\n  userid: null,\n  closeCallback:null,\n  fileSizeLimit: null,\n  init: function(navigateView, userId, src_id, org_id, att_cat, bus_no, canUp, canDown, canDel, closeCallback, fileSizeLimit) {\n    app.View = navigateView;\n    app.srcid = src_id;\n    app.attcat = att_cat;\n    app.orgid = org_id;\n    app.busno = bus_no;\n    app.userid = userId;\n    app.canup = canUp;\n    app.candown = canDown;\n    app.candel = canDel;\n    app.fileSizeLimit = fileSizeLimit;\n    app.closeCallback = closeCallback;\n    app.tlAttachment.store.load({\n      params: {\n        srcid: src_id\n      }\n    });\n\n  },\n  refresh: function() {\n    app.tlAttachment.store.load({\n      params: {\n        srcid: app.srcid\n      }\n    });\n  }\n});"},"children":[{"configs":{"layout":"fit","itemId":"attMainContainer"},"events":{"destroy":"if(app.closeCallback){\n app.closeCallback();\n}","painted":"if ('Y' === app.canup) {\n  app.uploadFile.show();\n} else {\n  app.uploadFile.hide();\n}\nif ('Y' === app.candown) {\n  app.tb_download.show();\n} else {\n  app.tb_download.hide();\n}\nif ('Y' === app.candel) {\n  app.tb_del.show();\n} else {\n  app.tb_del.hide();\n}"},"children":[{"configs":{"itemTpl":"<div>\n{ATT_FILE_NAME}\n\n  <div style=\"display:none;\">  {ATT_ID}<\/div>\n<\/div>","scrollToTopOnRefresh":"true","itemId":"tlAttachment","normalName":"tlAttachment"},"children":[{"configs":{"normalName":"attStore","itemId":"store","autoLoad":"false","url":"m?xwl=xip/touch/att/data/getAttrs"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"},{"configs":{"height":"47","docked":"top","style":"background:0","layout":"fit","border":"0","itemId":"container1"},"children":[{"configs":{"itemId":"attForm"},"children":[{"configs":{"hidden":"true","itemId":"uploadResult"},"children":[],"expanded":false,"type":"tlabel"},{"configs":{"style":"background:0","layout":"hbox","border":"0","itemId":"panel1"},"children":[{"configs":{"itemId":"uploadFile"},"events":{"change":"if (newValue !== null && newValue !== undefined && newValue !== '') {\n  var url = 'xipAttMrgAction.do?method=upload&src_id=' + app.srcid + '&attCatCode=' + app.attcat + '&org_id=' + app.orgid + '&bus_no=' + encodeURI(app.busno) + '&userId=' + app.userid + '&fileSizeLimit=' + app.fileSizeLimit;\n  Wb.upload({\n    form: app.attForm,\n    showProgress:true,\n    url: url,\n    success: function() {\n      file.setValue(\"\");\n      app.attForm.reset();\n      app.uploadResult.setHtml('上传'+newValue+'成功！');\n      app.refresh();\n    },\n    failure:function(){\n      file.setValue(\"\");\n      app.attForm.reset();\n      app.uploadResult.setHtml('上传'+newValue+'失败！');\n    }\n  });\n}"},"children":[],"expanded":false,"type":"tfile"},{"configs":{"height":"47","docked":"right","style":"background:0","layout":"hbox","border":"0","itemId":"panel1"},"children":[{"configs":{"text":"下载","height":"30","itemId":"tb_download"},"events":{"tap":"var items = app.tlAttachment.getSelection();\nif(items.length===0){\n  Ext.Msg.alert(\"请先选择一条信息\");\n}else{\n  var item =items[0];\n  var id=item.data.ATT_ID;\n  window.location.href= '{#contextPath#}'+\"/xipAttMrgAction.do?method=down&selectedIds=\"+id;\t\n}"},"children":[],"expanded":true,"type":"tbutton"},{"configs":{"text":"删除","height":"30","itemId":"tb_del"},"events":{"tap":"var items = app.tlAttachment.getSelection();\nif (items.length === 0) {\n  Ext.Msg.alert(\"请先选择一条信息\");\n} else {\n  var item = items[0];\n\n  Wb.confirm(\"确定要删除此附件吗？\", function() {\n    var id = item.data.ATT_ID;\n    Ext.Ajax.request({\n      url: '{#contextPath#}' + '/xipAttMrgAction.do?method=del',\n      method: 'POST',\n      timeout: 6000000,\n      params: {\n        ids: id\n      },\n      success: function(response, options) {\n        var json = Ext.JSON.decode(response.responseText);\n        Ext.Msg.alert('提示', json.msg, function() {\n          app.tlAttachment.store.load({\n            params: {\n              srcid: app.srcid\n            }\n          });\n        });\n      },\n      failure: function(response, options) {\n        Ext.Msg.alert('提示', '发送请求失败，服务器没有响应');\n      }\n    });\n  });\n\n}"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"tpanel"}],"expanded":true,"type":"tpanel"}],"expanded":true,"type":"tform"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}