{"inframe":false,"title":"假期规则","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"// TODO: 获取当前模块语言对应的.json文件，放到request中\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/wf/holiday/json/wf_holiday\");\n\n// TODO: 验证用户功能授权\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nrequest.setAttribute(\"userId\",userId);\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);\n\n// TODO: 判断用户类型\nvar jsonStr = com.xzsoft.xip.wf.common.util.WFWBUtil.getCurrentUser(userId) ;\nvar r = Wb.decode(jsonStr) ;\nrequest.setAttribute(\"userType\", r.userType) ;\n\n// TODO: \nrequest.setAttribute(\"ctxPath\", request.getContextPath()) ;","itemId":"module"},"events":{"initialize":"var flag;"},"children":[{"configs":{"title":"新增假期规则","layout":"fit","width":"450","closeAction":"hide","buttonAlign":"right","itemId":"winAdd","dialog":"true","modal":"true"},"events":{"ok":"// TODO: 数据校验\nvar masterUserId = app.MASTER_USER_ID.getValue() ;\nvar proxyUserId = app.PROXY_USER_ID.getValue() ;\nvar beginDate = app.BEGIN_DATE.getValue() ;\nvar endDate = app.END_DATE.getValue() ;\nif(Wb.isEmpty(masterUserId)){\n  Wb.toast('请选择当前用户') ;\n  return false ;\n}\nif(Wb.isEmpty(proxyUserId)){\n  Wb.toast('请选择代理用户') ;\n  return false ;\n}\nif(masterUserId == proxyUserId){\n  Wb.toast(\"当前用户和代理用户不能相同\") ;\n  return false ;\n}\nif(Wb.isEmpty(beginDate)){\n  Wb.toast('请录入开始时间') ;\n  return false ;\n}\nif(Wb.isEmpty(endDate)){\n  Wb.toast('请录入结束时间') ;\n  return false ;\n}\nvar dd = new Date() ;\nif(beginDate < dd){\n  Wb.toast('开始时间不能早于当前时间');\n  return false ;\n}\nif(endDate < dd){\n  Wb.toast('结束时间不能早于当前时间');\n  return false ;\n}\nif(beginDate > endDate){\n  Wb.toast('开始时间不能晚于结束时间') ;\n  return false ;\n}\n\nvar params = Wb.getValue(app.frmMain) ;\n\n// TODO: 执行保存处理\nWb.request({\n  url: '{#ctxPath#}'+'/userHolidayAction.do?method=saveUserHoliday',\n  params: {\n    'params' : Wb.encode(params) \n  },\n  success: function(resp) {\n    var response = Wb.decode(resp.responseText)  ;\n    if(response.flag == \"0\"){\n      app.btnQuery.fireEvent('click') ;\n      app.winAdd.hide() ;\n      Wb.toast(response.msg) ;\n      \n    }else{\n      Wb.info(response.msg) ;\n    }\n  }\n});"},"children":[{"configs":{"layout":"form","itemId":"frmMain","bodyPadding":"10","border":"false"},"children":[{"configs":{"itemId":"MASTER_USER_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"tagConfigs":"columnWidth:0.4","labelWidth":"80","allowBlank":"false","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"MASTER_USER_NAME","fieldLabel":"当前用户"},"children":[{"configs":{"tagConfigs":"minWidth:550","height":"350","itemId":"pickComp","normalName":"masterPickComp"},"events":{"itemclick":"app.MASTER_USER_ID.setValue(record.get('USER_ID')) ;\napp.MASTER_USER_NAME.setValue(record.get('EMP_NAME')) ;\n\napp.masterPickComp.hide() ;"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/wf/holiday/data/select-all-users"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.tfSeekMaster.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"250","itemId":"tfSeekMaster"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnSeekMaster.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnSeekMaster","iconCls":"seek_icon"},"events":{"click":"app.masterPickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"btnCancelMaster","iconCls":"cancel_icon"},"events":{"click":"app.tfSeekMaster.setValue() ;\napp.MASTER_USER_ID.setValue() ;\napp.btnSeekMaster.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","width":"55","itemId":"orderby"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"COL_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"COL_EMP_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","itemId":"COL_ORG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名","dataIndex":"USER_NAME","itemId":"COL_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","dataIndex":"EMP_CODE","itemId":"COL_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","dataIndex":"EMP_NAME","itemId":"COL_EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织","dataIndex":"ORG_NAME","itemId":"COL_ORG_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"},{"configs":{"itemId":"PROXY_USER_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"tagConfigs":"columnWidth:0.4","labelWidth":"80","allowBlank":"false","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"PROXY_USER_NAME","fieldLabel":"代理用户"},"children":[{"configs":{"tagConfigs":"minWidth:550","height":"350","itemId":"pickComp","normalName":"proxyPickComp"},"events":{"itemclick":"app.PROXY_USER_ID.setValue(record.get('USER_ID')) ;\napp.PROXY_USER_NAME.setValue(record.get('EMP_NAME')) ;\n\napp.proxyPickComp.hide() ;\n"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/wf/holiday/data/select-all-users"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.tfSeekProxy.getValue() ;\n// TODO: 如果当前用户为非系统用户, 则需要在选择代理用户时排除此用户\nif('{#userType#}' != 'S'){\n  store.proxy.extraParams.exUserId = '{#userId#}' ;\n}\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"250","itemId":"tfSeekProxy"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnSeekProxy.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnSeekProxy","iconCls":"seek_icon"},"events":{"click":"app.proxyPickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"btnCancelProxy","iconCls":"cancel_icon"},"events":{"click":"app.tfSeekProxy.setValue() ;\napp.PROXY_USER_ID.setValue() ;\napp.btnSeekProxy.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","width":"55","itemId":"orderby"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"COL_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"COL_EMP_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","itemId":"COL_ORG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名","dataIndex":"USER_NAME","itemId":"COL_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","dataIndex":"EMP_CODE","itemId":"COL_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","dataIndex":"EMP_NAME","itemId":"COL_EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织","dataIndex":"ORG_NAME","itemId":"COL_ORG_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"},{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BEGIN_DATE","fieldLabel":"开始时间"},"children":[],"expanded":false,"type":"datetime"},{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"END_DATE","fieldLabel":"结束时间"},"children":[],"expanded":false,"type":"datetime"},{"configs":{"labelWidth":"80","allowBlank":"false","queryMode":"local","hidden":"true","value":"Y","labelAlign":"right","pickList":"[['Y','启用'],['N','停用']]","itemId":"ENABLE_FLAG","fieldLabel":"是否启用","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"column","bodyPadding":"10","border":"false","itemId":"frmQuery"},"children":[{"configs":{"itemId":"QRY_MASTER_USER_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"tagConfigs":"columnWidth:0.35","labelWidth":"80","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"QRY_MASTER_USER_NAME","fieldLabel":"当前用户"},"children":[{"configs":{"tagConfigs":"minWidth:550","height":"350","itemId":"pickComp","normalName":"qryMasterPickComp","forceFit":"true"},"events":{"itemclick":"app.QRY_MASTER_USER_ID.setValue(record.get('USER_ID')) ;\napp.QRY_MASTER_USER_NAME.setValue(record.get('EMP_NAME')) ;\n\napp.qryMasterPickComp.hide() ;\napp.btnQuery.fireEvent('click') ;"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/wf/holiday/data/select-all-users"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.tfMasterCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"250","itemId":"tfMasterCodeOrName"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnFindMaster.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnFindMaster","iconCls":"seek_icon"},"events":{"click":"app.qryMasterPickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"btnCancelMaster","iconCls":"cancel_icon"},"events":{"click":"app.QRY_MASTER_USER_ID.setValue() ;\napp.QRY_MASTER_USER_NAME.setValue() ;\napp.tfMasterCodeOrName.setValue() ;\napp.btnFindMaster.fireEvent('click') ;\napp.btnQuery.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","width":"55","align":"center","itemId":"orderby"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"COL_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"COL_EMP_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","itemId":"COL_ORG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名","dataIndex":"USER_NAME","itemId":"COL_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","dataIndex":"EMP_CODE","itemId":"COL_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","dataIndex":"EMP_NAME","itemId":"COL_EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织","dataIndex":"ORG_NAME","itemId":"COL_ORG_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"},{"configs":{"itemId":"QRY_PROXY_USER_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"tagConfigs":"columnWidth:0.35","labelWidth":"80","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"QRY_PROXY_USER_NAME","fieldLabel":"代理用户"},"children":[{"configs":{"tagConfigs":"minWidth:550","height":"350","itemId":"pickComp","normalName":"qryProxyPickComp"},"events":{"itemclick":"app.QRY_PROXY_USER_ID.setValue(record.get('USER_ID')) ;\napp.QRY_PROXY_USER_NAME.setValue(record.get('EMP_NAME')) ;\n\napp.qryProxyPickComp.hide() ;\napp.btnQuery.fireEvent('click') ;"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/wf/holiday/data/select-all-users"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.tfProxyCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"250","itemId":"tfProxyCodeOrName"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnFindProxy.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnFindProxy","iconCls":"seek_icon"},"events":{"click":"app.qryProxyPickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"btnCancelProxy","iconCls":"cancel_icon"},"events":{"click":"app.QRY_PROXY_USER_ID.setValue() ;\napp.QRY_PROXY_USER_NAME.setValue() ;\napp.tfProxyCodeOrName.setValue() ;\napp.btnFindProxy.fireEvent('click') ;\napp.btnQuery.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","width":"55","align":"center","itemId":"orderby"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"COL_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"COL_EMP_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","itemId":"COL_ORG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名","dataIndex":"USER_NAME","itemId":"COL_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","dataIndex":"EMP_CODE","itemId":"COL_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","dataIndex":"EMP_NAME","itemId":"COL_EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织","dataIndex":"ORG_NAME","itemId":"COL_ORG_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"},{"configs":{"text":"查询","margin":"0 0 0 10","itemId":"btnQuery","iconCls":"seek_icon"},"events":{"click":"app.grdHoliday.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"重置","margin":"0 0 0 5","itemId":"btnReset","iconCls":"refresh_icon"},"events":{"click":"Wb.reset(app.frmQuery) ;\napp.grdHoliday.getStore().load() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grdHoliday","simpleSelect":"true"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/wf/holiday/data/select-all-user-holiday"},"events":{"beforeload":"store.proxy.extraParams.masterUserId = app.QRY_MASTER_USER_ID.getValue() ;\nstore.proxy.extraParams.proxyUserId = app.QRY_PROXY_USER_ID.getValue() ;\n\n// TODO: 用户类型\nvar userType = '{#userType#}' ;\n// 如果不是系统用户\nif(userType != 'S'){\n  store.proxy.url = 'm?xwl=xip/wf/holiday/data/select-user-holiday' ;\n}\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"新增","itemId":"btnNew","iconCls":"record_add_icon"},"events":{"click":"Wb.reset(app.frmMain) ;\n// 非系统用户\nvar userType = '{#userType#}' ;\nif(userType == \"U\"){\n  app.MASTER_USER_ID.setValue('{#userId#}') ;\n  app.MASTER_USER_NAME.setValue('{#XIP.empName#}') ;\n  app.MASTER_USER_NAME.hide() ;\n}\napp.winAdd.show() ;\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"停用","itemId":"btnStop","iconCls":"stop_icon"},"events":{"click":"var records = app.grdHoliday.getSelection() ;\nif(records.length === 0){\n  Wb.toast('请选择假期规则') ;\n  return false ;\n}\n\nWb.confirm('请确定要停用所选假期规则吗?', function(){\n  // 权限ID\n  var arr = [] ;\n  Wb.each(records, function(r){\n    var json = {'ID' : r.data.PRIVILEGE_ID} ;\n    arr.push(json) ;\n  }) ;\n\n  // TODO: 执行停用处理\n  Wb.request({\n    url: '{#ctxPath#}'+'/userHolidayAction.do?method=stopUserHoliday',\n    params: {\n      'paramJson' : Wb.encode(arr) \n    },\n    success: function(resp) {\n      var response = Wb.decode(resp.responseText)  ;\n      if(response.flag == \"0\"){\n        app.btnQuery.fireEvent('click') ;\n        Wb.toast(response.msg) ;\n\n      }else{\n        Wb.info(response.msg) ;\n      }\n    }\n  });\n}) ;\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","align":"center","xtype":"rownumberer","width":"55","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"权限ID","hidden":"true","dataIndex":"PRIVILEGE_ID","titleAlign":"center","itemId":"COL_PRIVILEGE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"授权人ID","hidden":"true","dataIndex":"MASTER_USER_ID","titleAlign":"center","itemId":"COL_MASTER_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"被授权人ID","hidden":"true","dataIndex":"PROXY_USER_ID","titleAlign":"center","itemId":"COL_PROXY_USER_ID"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"当前用户","align":"center","width":"80","dataIndex":"MASTER_USER_NAME","titleAlign":"center","itemId":"COL_MASTER_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"代理用户","align":"center","width":"80","dataIndex":"PROXY_USER_NAME","titleAlign":"center","itemId":"COL_PROXY_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"开始时间","align":"center","width":"120","dataIndex":"BEGIN_DATE","titleAlign":"center","itemId":"COL_BEGIN_DATE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"结束时间","align":"center","width":"120","dataIndex":"END_DATE","titleAlign":"center","itemId":"COL_END_DATE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"是否启用","align":"center","width":"100","dataIndex":"ENABLE_FLAG","titleAlign":"center","itemId":"COL_ENABLE_FLAG","renderer":"if(value == 'Y'){\n  return '{#wf_holiday_Y#}' ;\n  \n}else if(value == 'N'){\n  return '<font color=\\'red\\'>{#wf_holiday_N#}<\/font>';\n  \n}else{\n  return value ;\n}"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"settings1_icon"}