{"inframe":false,"title":"流程监控","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nvar ctxPath = request.getContextPath() ;\n\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"contextPath\",ctxPath);\n\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);\n","loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/wf/monitor/json/wf_monitor\");","itemId":"module"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"false","bodyPadding":"5","itemId":"queryForm"},"children":[{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr_1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"APP_NAME","valueField":"APP_ID","labelAlign":"right","itemId":"cbxAppl","fieldLabel":"{#wf_monitor_cbxAppl#}"},"events":{"select":"app.cbxEntities.setValue();\napp.cbxEntities.enable();\napp.cbxEntities.store.load();\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/data/getApps"},"events":{"beforeload":"store.getProxy().extraParams.userId = '{#userId#}';"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".2","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","valueField":"ID","labelAlign":"right","itemId":"cbxEntities","fieldLabel":"{#wf_monitor_cbxEntities#}","disabled":"true"},"events":{"select":"app.cbxProcesses.enable();\napp.cbxProcesses.setValue('');\napp.cbxProcesses.store.removeAll();\n\napp.cbxProcesses.store.load();\napp.instanGrid.store.load();\n\n"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/wf/monitor/DATA/db_select_entities"},"events":{"beforeload":"store.getProxy().extraParams.cbxAppl = app.cbxAppl.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".2","border":"false","itemId":"td2"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","valueField":"ID","labelAlign":"right","itemId":"cbxProcesses","fieldLabel":"{#wf_monitor_cbxProcesses#}","disabled":"true"},"events":{"select":"app.cbxProVer.enable();\n\napp.cbxProVer.store.load();\napp.instanGrid.store.load();"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/wf/monitor/DATA/db_select_pro"},"events":{"beforeload":"store.getProxy().extraParams.cbxEntities = app.cbxEntities.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".2","border":"false","itemId":"td3"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","valueField":"CODE","labelAlign":"right","itemId":"cbxProVer","fieldLabel":"{#wf_monitor_cbxProVer#}","disabled":"true"},"events":{"select":"app.cbxInsActs.enable();\n\napp.cbxInsActs.store.load();\n\napp.instanGrid.store.load();"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/wf/monitor/DATA/db_select_proVer"},"events":{"beforeload":"store.getProxy().extraParams.cbxProcesses = app.cbxProcesses.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr_2"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","valueField":"ID","labelAlign":"right","itemId":"cbxInsActs","fieldLabel":"{#wf_monitor_cbxInsActs#}","disabled":"true"},"events":{"select":"app.cbxInsActStatus.enable();\n\napp.instanGrid.store.load();"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/wf/monitor/DATA/db_select_acts"},"events":{"beforeload":"store.getProxy().extraParams.cbxProcesses = app.cbxProcesses.getValue();\nstore.getProxy().extraParams.cbxProVer = app.cbxProVer.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".2","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"80","displayField":"NAME","queryMode":"local","valueField":"CODE","pickList":"[['started','{#wf_monitor_started#}'],['running','{#wf_monitor_running#}'],['completed','{#wf_monitor_completed#}'],['canceled','{#wf_monitor_canceled#}'],['terminate','{#wf_monitor_terminate#}']]","labelAlign":"right","itemId":"cbxInsActStatus","fieldLabel":"{#wf_monitor_cbxInsActStatus#}","disabled":"true"},"events":{"select":"app.instanGrid.store.load();"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".2","border":"false","itemId":"td2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"txtInsCode","fieldLabel":"{#wf_monitor_txtInsCode#}"},"events":{"specialkey":"app.instanGrid.store.load();"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".2","border":"false","itemId":"td3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"txtBiz","fieldLabel":"{#wf_monitor_txtBiz#}"},"events":{"specialkey":"app.instanGrid.store.load();"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".15","border":"false","itemId":"td4"},"children":[{"configs":{"text":"{#wf_monitor_queryBtn#}","margin":"0 0 0 15","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.instanGrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#wf_monitor_resetBtn#}","margin":"0 0 0 5","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"Wb.reset(app.queryForm);\napp.instanGrid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"instanGrid"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/wf/monitor/DATA/db_select_instanGrid","fields":"[{name:'processId'},{name:'processCode'},{name:'processVersion'},{name:'instanceId'},{name:'instanceCode'},{name:'instanceTitle'},{name:'instanceState'},{name:'businessId'},{name:'businessCode'},{name:'businessName'}]"},"events":{"beforeload":"store.getProxy().extraParams.cbxAppl = app.cbxAppl.getValue(); \nstore.getProxy().extraParams.cbxEntities = app.cbxEntities.getValue(); \nstore.getProxy().extraParams.cbxProcesses = app.cbxProcesses.getValue(); \nstore.getProxy().extraParams.cbxProVer = app.cbxProVer.getValue(); \nstore.getProxy().extraParams.cbxInsActs = app.cbxInsActs.getValue(); \nstore.getProxy().extraParams.cbxInsActStatus = app.cbxInsActStatus.getValue(); \nstore.getProxy().extraParams.txtInsCode = app.txtInsCode.getValue(); \nstore.getProxy().extraParams.txtBiz = app.txtBiz.getValue(); "},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#wf_monitor_btnExecMonitor#}","itemId":"btnExecMonitor","iconCls":"computer_icon"},"events":{"click":"var rows = app.instanGrid.getSelectionModel().getSelection();\n\nif(rows.length===0){\n//   Ext.Msg.alert('提示','请选择流程实例信息!');\n  Ext.Msg.alert(\"{#wf_monitor_prompt#}\",\"{#wf_monitor_qxzlcslxx#}\") ;\n  return false ;\n}else if(rows.length > 1){\n//   Ext.Msg.alert('提示','请选择一个流程实例信息!');\n  Ext.Msg.alert(\"{#wf_monitor_prompt#}\",\"{#wf_monitor_qxzyglcslxx#}\") ;\n  return false ;  \n}else{\n  var insCode = rows[0].data.instanceCode ;\n  var proId = rows[0].data.processId ;\n  \n  window.open('{#contextPath#}' + \"/workflow/task/RunningMonitor.jsp?varId=\"+insCode+\"&processId=\"+proId+\"&varType=ins\",\"_blank\");\n  \n  //window.open('{#contextPath#}' + \"/main?xwl=23VMPVCRPO51&varId=\"+insCode+ \"&varType=ins\",\"_blank\");\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#wf_monitor_btnStopProcess#}","itemId":"btnStopProcess","iconCls":"stop_icon"},"events":{"click":"var rows = app.instanGrid.getSelectionModel().getSelection();\n\nif(rows.length===0){\n//   Ext.Msg.alert('提示','请选择流程实例信息!');\n  Ext.Msg.alert(\"{#wf_monitor_prompt#}\",\"{#wf_monitor_qxzlcslxx#}\") ;\n  return false ;\n}else{\n//   Ext.Msg.confirm('提示','您确定要终止所选的流程实例吗？',function(a){\n  Ext.Msg.confirm('{#wf_monitor_prompt#}','{#wf_monitor_nqdyzzsxdlcslm#}',function(a){\n    if(a=='yes'){\n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n      \tvar insId = r.data.instanceId ;\n        if(idList === \"\"){\n          idList = insId ;\n        }else{\n          idList = idList+\",\"+insId ;\n        }\n      });\n      var json = {'ids' : idList} ;\n      Wb.request({\n        url:'m?xwl=xip/wf/monitor/DATA/db_ajax_stop',\n        params:{'ids' : idList},\n        timeout:3600000,\n        success:function(response){\n          app.instanGrid.store.load();\n          var resp = Ext.JSON.decode(response.responseText) ;\n          if(resp.flag === '0'){\n           app.instanGrid.store.load();\n          }\n          Wb.info(resp.msg);  \n        },\n        failure:function(){\n//          Wb.error('流程实例终止失败!');  \n         Wb.error('{#wf_monitor_lcslzzsb#}');  \n        }\n      });\n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#wf_monitor_order#}","width":"55","align":"center","xtype":"rownumberer","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#wf_monitor_processId#}","hidden":"true","dataIndex":"processId","itemId":"processId_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#wf_monitor_processVersion#}","width":"100","dataIndex":"processVersion","titleAlign":"center","itemId":"processVersion_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#wf_monitor_instanceId#}","hidden":"true","dataIndex":"instanceId","itemId":"instanceId_col"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#wf_monitor_instanceCode#}","width":"300","dataIndex":"instanceCode","titleAlign":"center","itemId":"instanceCode_col"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#wf_monitor_instanceTitle#}","width":"250","dataIndex":"instanceTitle","titleAlign":"center","itemId":"instanceTitle_col"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#wf_monitor_instanceState#}","align":"center","width":"100","dataIndex":"instanceState","titleAlign":"center","itemId":"instanceState_col","renderer":"var insState = record.get('instanceState');\n\nif(insState == 'running'){\n  return '{#wf_monitor_running01#}' ;\n}else if(insState == 'started'){\n  return '<font color=\\\"blue\">{#wf_monitor_started01#}<\/font>' ;\n}else{\n  return insState ;\n}"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#wf_monitor_businessId#}","hidden":"true","dataIndex":"businessId","itemId":"businessId_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#wf_monitor_businessCode#}","width":"150","dataIndex":"businessCode","titleAlign":"center","itemId":"businessCode_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#wf_monitor_businessName#}","width":"200","dataIndex":"businessName","titleAlign":"center","itemId":"businessName_col"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}