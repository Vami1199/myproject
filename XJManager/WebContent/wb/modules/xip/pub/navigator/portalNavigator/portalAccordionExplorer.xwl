{"inframe":false,"title":"定制化抽屉式导航","hidden":false,"roles":{"default":1},"children":[{"configs":{"importModules":"[\"m?xwl=xip/pub/navigator/navigatorCommonModule\"]","title":"{#mainPageTitle#}","cssLinks":"[\"xip/css/default.css\",\"xip/css/font.css\",\"xip/portalNavigator/portal/extmvc/resources/css/portal.css\",\"xip/feed-viewer/Feed-Viewer.css\"]","initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nvar userName = request.getSession().getAttribute(\"XzSessionVars\").get('userName');\n\nvar authModel = request.getSession().getAttribute(\"XzSessionVars\").get('AUTH_MODAL');\nvar roleIdSeesion = request.getSession().getAttribute(\"XzSessionVars\").get('roleId');\nvar roleId = com.xzsoft.xip.platform.util.PlatformUtil.getUserRole(userId) ;\nvar roleName = request.getSession().getAttribute(\"XzSessionVars\").get('roleName');\nvar roleCode = request.getSession().getAttribute(\"XzSessionVars\").get('roleCode');\n\nrequest.setAttribute(\"roleIdSeesion\",roleIdSeesion);\nrequest.setAttribute(\"sessionId\",request.getSession().getId());\n\nvar ctxPath = request.getContextPath() ;\n\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"userName\",userName);\n\nrequest.setAttribute(\"authModel\",authModel);\nrequest.setAttribute(\"roleId\",roleId);\nrequest.setAttribute(\"roleName\",roleName);\nrequest.setAttribute(\"roleCode\",roleCode);\nrequest.setAttribute(\"contextPath\",ctxPath);\nvar pwdLenLimit= com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"PW_LEN_LIMIT\");\nvar pwdIncludeChar =  com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"PW_INCLUDE_CHAR\");\nvar homePage =  com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"HOME_PAGE\");\nvar title = com.xzsoft.xip.platform.util.PlatformUtil.getAppName();\nrequest.setAttribute(\"mainPageTitle\",title);\nrequest.setAttribute(\"PW_LEN_LIMIT\",pwdLenLimit);\nrequest.setAttribute(\"PW_INCLUDE_CHAR\",pwdIncludeChar);\nrequest.setAttribute(\"HOME_PAGE\",homePage);\n\nvar isShowBanner = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"SHOW_TOP_BANNER\");\nrequest.setAttribute(\"isShowBanner\",isShowBanner);\n\nvar topBannerHeight = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"TOP_BANNER_HEIGHT\");\n\nif(topBannerHeight==null || \"\".equals(topBannerHeight)){\n  topBannerHeight = 120;\n}\n\nrequest.setAttribute(\"topBannerHeight\",topBannerHeight);\n\nvar session = request.getSession().getAttribute(\"XzSessionVars\");\nif(session!==null){\n  var language = request.getSession().getAttribute(\"XzSessionVars\").get('language');\n  request.setAttribute('language',language);\n}else{\n  var lang = com.xzsoft.xip.platform.util.PlatformUtil.getParamVal(\"XIP_DEFAULT_LANG\", \"P\", \"P\");\n  if(lang===null||lang===\"\"){\n    lang = \"zh\";\n  }\n  request.setAttribute('language',lang);\n}\n\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/pub/navigator/portalNavigator/portalAccordionExplorer\");","loginRequired":"false","jsLinks":"[\"xip/js/TabCloseMenu4wb7.js\",\"xip/feed-viewer/viewer/FeedPanel.js\"]","head":"<script>\n  var baseUrl='{#contextPath#}/xip/portalNavigator/portal/';\n  var contentPath = '{#contextPath#}';\n  var portalAuthModel ='{#XIP.AUTH_MODAL#}';\n<\/script>\n\n<style type=\"text/css\">\n.x-menu-item img.preview-right, .preview-right {\n    background-image: url(images/preview-right.gif);\n}\n.x-menu-item img.preview-bottom, .preview-bottom {\n    background-image: url(images/preview-bottom.gif);\n}\n.x-menu-item img.preview-hide, .preview-hide {\n    background-image: url(images/preview-hide.gif);\n}\n\n#reading-menu .x-menu-item-checked {\n    border: 1px dotted #a3bae9 !important;\n    background: #DFE8F6;\n    padding: 0;\n    margin: 0;\n}\n<\/style>","itemId":"module"},"events":{"finalize":"//Ext.Msg.wait('正在加载导航，请稍后...');\n/*Ext.Ajax.request({\n  url : '{#contextPath#}' + '/frameAction.do?method=loadAccordionNavigator',\n  method: 'POST',\n  async: true, //发送同步请求\n  success: function(response,options){\n    //Ext.Msg.hide();\n    var accordions = Ext.JSON.decode(response.responseText);\n\n    if(!Ext.isEmpty(accordions)){\n      for(var i=0; i<accordions.length; i++){\n        var accordion = accordions[i];\n        var accordionName = accordion.accordionName;\n        var accordionFuncs = [];\n        \n        if(!Ext.isEmpty(accordion.accordionFuncs)){\n          for(var j=0; j<accordion.accordionFuncs.length; j++){\n            accordionFuncs.push({\n              'text'      :  accordion.accordionFuncs[j].text,\n              'fun_id'    :  accordion.accordionFuncs[j].fun_id,\n              'url'       :  accordion.accordionFuncs[j].funUrl,\n              'app_id'    :  accordion.accordionFuncs[j].app_id,\n              'fun_code'  :  accordion.accordionFuncs[j].fun_code,\n              'app_code'  :  accordion.accordionFuncs[j].app_code,\n              'in_xip'    :  accordion.accordionFuncs[j].in_xip,\n              'show_style':  accordion.accordionFuncs[j].show_style,\n              'icon'      :  accordion.accordionFuncs[j].icon\n            });\n          }\n        }\n        \n        if(accordionFuncs.length > 0){\n          var feedPanel = Ext.create('widget.feedpanel', {\n            title: accordion.accordionName,\n            autoScroll:true,\n            width: 220,\n            minWidth: 175,\n            feeds: accordionFuncs,\n            listeners: {\n              feedselect: function(feed, record){\n                funcMenuClick4Page(record.data, app.funTabPanel);\n              }\n            }\n          });\n          app.westPanel.add(feedPanel);\n        }else{\n          var feedPanel = Ext.create('widget.feedpanel', {\n            title: accordion.accordionName,\n            autoScroll:true,\n            width: 220,\n            minWidth: 175,\n            listeners: {\n              feedselect: function(feed, record){\n                funcMenuClick4Page(record.data, app.funTabPanel);\n              }\n            }\n          });\n          app.westPanel.add(feedPanel);\n        }\n        \n      }\n    }\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Ext.Msg.alert(\"提示\",\"导航加载失败\");\n  }\n});*/","initialize":"var beforeSelectRole = '';\nExt.QuickTips.init();"},"children":[{"configs":{"headerHtml":"<script type=\"text/javascript\">\n  /*Wb.addLink(\"xip/feed-viewer/viewer/FeedDetail.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/FeedGrid.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/FeedInfo.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/FeedPanel.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/FeedPost.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/FeedViewer.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/FeedWindow.js\");\n  Wb.addLink(\"xip/feed-viewer/viewer/Sim.js\");*/\n  document.onkeydown = function(){\n    var oEvent = window.event;\n    if (oEvent.keyCode == 75 && oEvent.ctrlKey && oEvent.shiftKey) {\n      mouseOverEvent(Ext.getCmp(\"search\"));\n    }\n  }\n  \n  //退出登录\n  function logout(){\n    Ext.MessageBox.minWidth = 200 ;\n    Ext.MessageBox.confirm('', '{#quitTips#}', function (opt) {\n      if (opt == 'yes') {\n        var msg = Ext.MessageBox.show({\n          title \t : \t'',\n          msg \t : \t'{#waitingMsg#}',\n          width \t : \t240,\n          wait\t : \ttrue,\n          progress : \ttrue,\n          closable : \tfalse\n        });\t\n\n        Ext.Ajax.request({\n          url : '{#contextPath#}' +'/frameAction.do?method=logout',\n          method: 'POST',\n          success: function(response,options){\n            msg.hide();\n            var temp = response.responseText;\n            var response = Ext.JSON.decode(temp);\n            if(response.flag=='1'){\n              // window.location.href=\"http://219.141.183.220:9092/cas-server-webapp-3.5.2/logout\";\n\n              // modified by linp 20141106\n              var logoutUrl = response.logoutUrl ;\n              var callbackUrl = response.callbackUrl ;\n              window.location.href = logoutUrl + callbackUrl ;\n\n            }else{\n              Ext.Msg.alert(\"\",response.msg);\n            }\n          },\n          failure: function(response,options){\n            msg.hide();\n            Ext.Msg.alert(\"\",'{#failureMsg#}');\n          }\n        });\n      }\n    });\n  }\n  \n  var feedPanels;\n  \n  //切换角色\n  function switchRole(accordion){\n    Ext.Ajax.request({\n      url : '{#contextPath#}' +'/frameAction.do?method=switchRole',\n      method: 'POST',\n      params:{\"roleId\":accordion.accordionId, \"roleCode\":accordion.accordionCode, \"roleName\":accordion.accordionName, type:\"accordion\"},\n      success: function(response,options){\n        //关闭tab页签所有的功能\n        var removeItems = [];\n        for(var i=0; i<app.funTabPanel.items.items.length; i++){\n          var item = app.funTabPanel.items.items[i];\n          if(item.id != 'indexPanel'){\n            removeItems.push(item);\n          }\n        }\n\n        for(var i=0; i<removeItems.length; i++){\n          app.funTabPanel.remove(removeItems[i]);\n        }\n\n        //重置搜索下拉框值\n        Ext.Ajax.request({\n          url : '{#contextPath#}' + '/frameAction.do?method=loadMenuTreeData',\n          method: 'POST',\n          success: function(response,options){\n            var menuData = Ext.JSON.decode(response.responseText);\n\n            var searchFunComboStore = Ext.getCmp('searchFunCombo').getStore();\n            searchFunComboStore.removeAll();\n            for(var m=0; m<menuData.length; m++){\n              searchFunComboStore.insert(m, menuData[m]);\n            }\n\n            searchFunComboStore.commitChanges();\n\n          }\n        });\n      },\n      failure: function(response,options){\n      }\n    })\n  }\n  \n  function loadAccordion(accName, opType){\n    feedPanels = new Array();\n    Ext.Msg.wait('{#waitingMsg#}');\n    Ext.Ajax.request({\n      url : '{#contextPath#}' + '/frameAction.do?method=loadAccordionNavigator',\n      method: 'POST',\n      async: false, //发送同步请求\n      success: function(response,options){\n        Ext.Msg.hide();\n        var accordions = Ext.JSON.decode(response.responseText);\n        \n        // 角色授权时 是否存在session中的角色\n        var isExtistSessionRole = false;\n        \n        //关闭tab页签所有的功能\n        if('{#authModel#}'=='ROLE' && opType=='query'){\n          var removeItems = [];\n          for(var i=0; i<app.funTabPanel.items.items.length; i++){\n            var item = app.funTabPanel.items.items[i];\n            if(item.id != 'indexPanel'){\n              removeItems.push(item);\n            }\n          }\n\n          for(var i=0; i<removeItems.length; i++){\n            app.funTabPanel.remove(removeItems[i]);\n          }\n        }\n\n        if(!Ext.isEmpty(accordions)){\n          for(var i=0; i<accordions.length; i++){\n            var accordion = accordions[i];\n            var accordionName = accordion.accordionName;\n            \n            if(!Ext.isEmpty(accName)){\n              if(accordionName.indexOf(accName) == -1){\n                continue;\n              }\n            }\n            \n            var accordionFuncs = [];\n\n            //收缩状态\n            var collapsed = true;\n            if('{#authModel#}'=='ROLE'){\n              if(accordion.accordionId == '{#roleId#}'){\n                isExtistSessionRole = true;\n                collapsed = false;\n              }\n            }else{\n              if(i==0){\n                collapsed = false;\n              }\n            }\n\n            if(!Ext.isEmpty(accordion.accordionFuncs)){\n              for(var j=0; j<accordion.accordionFuncs.length; j++){\n                accordionFuncs.push({\n                  'text'      :  accordion.accordionFuncs[j].text,\n                  'fun_id'    :  accordion.accordionFuncs[j].fun_id,\n                  'url'       :  accordion.accordionFuncs[j].funUrl,\n                  'app_id'    :  accordion.accordionFuncs[j].app_id,\n                  'fun_code'  :  accordion.accordionFuncs[j].fun_code,\n                  'app_code'  :  accordion.accordionFuncs[j].app_code,\n                  'in_xip'    :  accordion.accordionFuncs[j].in_xip,\n                  'show_style':  accordion.accordionFuncs[j].show_style,\n                  'icon'      :  accordion.accordionFuncs[j].icon\n                });\n              }\n            }\n\n            if(accordionFuncs.length > 0){\n              var feedPanel = Ext.create('widget.feedpanel', {\n                title: accordion.accordionName,\n                autoScroll:true,\n                collapsed:collapsed,\n                width: 220,\n                minWidth: 175,\n                accordionId:accordion.accordionId,\n                accordionCode:accordion.accordionCode,\n                accordionName:accordion.accordionName,\n                feeds: accordionFuncs,\n                listeners: {\n                  feedselect: function(feed, record){\n                    funcMenuClick4Page(record.data, app.funTabPanel);\n                  },\n                  expand: function(panel){\n                    if(accordion.accordionType=='R'){\n                      switchRole(panel);\n                    }\n                  }\n                }\n              });\n              feedPanels.push(feedPanel);\n              //app.westPanel.add(feedPanel);\n            }else{\n              var feedPanel = Ext.create('widget.feedpanel', {\n                title: accordion.accordionName,\n                autoScroll:true,\n                collapsed:collapsed,\n                width: 220,\n                minWidth: 175,\n                accordionId:accordion.accordionId,\n                accordionCode:accordion.accordionCode,\n                accordionName:accordion.accordionName,\n                listeners: {\n                  feedselect: function(feed, record){\n                    funcMenuClick4Page(record.data, app.funTabPanel);\n                  },\n                  expand: function(panel){\n                    if(accordion.accordionType=='R'){\n                      switchRole(panel);\n                    }\n                  }\n                }\n              });\n              feedPanels.push(feedPanel);\n              //app.westPanel.add(feedPanel);\n            }\n          }\n          \n          // 角色授权时 不存在session中的角色， 切换成第一个角色\n          if('{#authModel#}'=='ROLE' && feedPanels.length>0){\n            if(isExtistSessionRole == false){\n              switchRole(feedPanels[0]);\n            }\n          }\n          \n        }\n        \n        if(opType == 'query'){\n          app.westPanel.removeAll();\n          app.westPanel.add(feedPanels);\n        }\n        \n      },\n      failure: function(response,options){\n        Ext.Msg.hide();\n        Ext.Msg.alert(\"\",'{#failureMsg#}');\n      }\n    });\n  }\n  \n  loadAccordion('', 'init');\n  \n  var temp = new Array();\n  \n  function searchAcc(){\n    var searchText = Ext.getCmp('searchAccordionText').getValue();\n    \n    loadAccordion(searchText, 'query');\n\n    /**var accordionPanels = app.westPanel.items.items;\n\n    if(Ext.isEmpty(searchText)){\n      for(var i=0; i<accordionPanels.length; i++){\n        accordionPanels[i].show();\n      }\n      return;\n    }\n\n    for(var i=0; i<accordionPanels.length; i++){\n      if(accordionPanels[i].title.indexOf(searchText) == -1){\n        accordionPanels[i].hide();\n      }else{\n        accordionPanels[i].show();\n      }\n    }**/\n  }\n  \n  temp.push({\n    id:'searchAccordionText',\n    xtype:'textfield',\n    width:250,\n    emptyText:'{#portal_accord_query_condition#}',\n    listeners:{\n      'specialkey':function(text, e, options){\n        if(e.getKey() == 13){\n          searchAcc();\n        }\n      }\n    }\n  });\n  \n  /**temp.push({\n    id:'searchBtn',\n    xtype:'button',\n    width:50,\n    text:'查询',\n    iconcls:'',\n    listeners:{\n      'click':function(){\n        searchAcc();\n      }\n    }\n  });**/\n  \n  temp.push({xtype:'tbfill'});\n  //--------------------搜索功能--------------------\n  Ext.Ajax.request({\n    url : '{#contextPath#}' + '/frameAction.do?method=loadMenuTreeData',\n    method: 'POST',\n    async: false, //发送同步请求\n    success: function(response,options){\n      var menuData = response.responseText;\n\n      //temp.push('-');\n      temp.push({\n        text:\"\",\n        id:\"search\",\n        iconCls:'seek_icon',\n        listeners:{\n          'mouseover':mouseOverEvent\n        },\n        menu:{\n          xtype:\"menu\",\n          style:\"border-width:0px\",\n          items: [{\n            xtype:\"combo\",\n            displayField: \"text\",\n            style:\"margin-left:0px\",\n            height:25,\n            queryMode: \"local\",\n            itemId: \"dataCombo\",\n            valueField: \"funUrl\",\n            id:'searchFunCombo',\n            listeners:{\n              select:function(combo,records,options){\n                var funObj = this;\n                funObj.url = combo.getValue();\n                funObj.show_style = records[0].data.show_style;\n                funObj.in_xip = records[0].data.in_xip;\n                funObj.text = combo.getRawValue();\n                funcMenuClick4Page(funObj, app.funTabPanel);  \n              }\n            },\n            store:{\n              data: Ext.JSON.decode(menuData),\n              fields: ['funUrl', 'text','show_style','in_xip'],\n              id:'searchFunComboStore',\n              itemId: \"store\"\n            }\n          }]\n\n        }\n      });\n    }\n  });\n\n  //temp.push(\"<p style=';font-family:verdana'>当前用户: \"+\"<b><i>{#userName#}<\/i><\/b><\/p>\");\n\n  Ext.Ajax.request({\n    url : 'm?xwl=xip/pub/navigator/data/getLinks',\n    async: false, //发送同步请求\n    method: 'POST',\n    success: function(response,options){\n      var linkResp = Ext.JSON.decode(response.responseText);\n\n      if(linkResp.rows.length==0){\n        return;\n      }\n\n      var linkItems = new Array();\n\n      for(var i=0; i<linkResp.rows.length; i++){\n        var linkItem = linkResp.rows[i];\n        linkItems.push({\n          id:linkItem.CODE,\n          text:linkItem.NAME,\n          url:linkItem.URL,\n          listeners:{\n            'click':function(){\n              window.open(this.url);\n            }\n          }\n        });\n      }\n\n      temp.push('-');\n      temp.push({\n        id:\"links\",\n        text:\"\",\n        iconCls:'web_icon',\n        listeners:{\n          'mouseover':mouseOverEvent\n        },\n        menu:{\n          xtype:\"menu\",\n          items:linkItems\n        }\n      });\n\n    },\n    failure: function(response,options){\n      Ext.Msg.alert(\"\",\"\");\n    }\n  });\n\n  temp.push('-');\n\n  temp.push({\n    text:\"\",\n    iconCls:'user_icon',\n    listeners:{\n      'mouseover':mouseOverEvent\n    },\n    menu:{\n      xtype:\"menu\",\n      items:[\n        {\n          text:'{#userName#}'\n        },\n        {\n          text:'{#modifiedPwd#}',\n          listeners:{\n            'click':function(){\n              //通过W7的方式打开修改密码窗口\n              Wb.run({\n                url: 'm?xwl=xip/pub/navigator/modifyPassword', \n                success: function(app) {\n                  app.initWin({\n                    title:'{#modifiedPwd#}'\n                  });\n                }\n              });\n            }\n          }\n        },{\n          text:'{#personalSet#}',\n          listeners:{\n            'click':function(){\n              //通过W7的方式打开\n              Wb.run({\n                url: 'm?xwl=xip/pub/navigator/personalSet', \n                success: function(app) {\n                  app.initWin();\n                }\n              });\n            }\n          }\n        }\n      ]\n    }\n  });\n  temp.push('-'); \t\t\t\t\n  // 退出\n  temp.push({\n    text\t:\t'',\n    iconCls\t:\t'logout_icon',\n    tooltip :\t'{#logout#}',\n    handler\t:\tlogout\n  });\n  temp.push('-');\n\n<\/script>","itemId":"topBarScript"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"itemId":"topBar"},"events":{"afterrender":"app.topBar.add(temp);"},"children":[],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"store"},"children":[{"configs":{"autoLoad":"true","itemId":"protalHomeStore","url":"m?xwl=xip/pub/navigator/portalNavigator/data/getPortalHome"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport"},"events":{"afterrender":"Ext.Loader.setConfig({\n\t\tenabled : true,\n\t\tpaths : {\n          'com.fb' : '{#contextPath#}/xip/portalNavigator/portal/extmvc/com/fb'}\n  });\n//如果当前语言是en 则引入LayoutContainer_en.js\nvar portal=Ext.create(\"com.fb.portal.LayoutContainer\");\nif('{#HOME_PAGE#}'!==null && '{#HOME_PAGE#}'!==\"\"){\n   var com = Ext.create('Ext.Component', {\n      html: \"<iframe src =\"+'{#contextPath#}'+'{#HOME_PAGE#}'+\" height='100%' width='100%'><\/frame>\",\n      renderTo: Ext.getBody()\n  });\n   app.indexPanel.add(com);\n  \n}else{\n  \n  app.indexPanel.add(portal);\n}"},"children":[{"configs":{"bodyStyle":"background-repeat:no-repeat","region":"north","height":"({#topBannerHeight#}>120 ) ? 120: {#topBannerHeight#}","hidden":"'{#isShowBanner#}'=='Y' ? false: true","split":"true","html":"<img height='100%' width='100%' src='{#contextPath#}/xip/images/top.png'>","itemId":"topPanel"},"children":[],"expanded":false,"type":"panel"},{"configs":{"region":"center","tbar":"app.topBar","layout":"border","itemId":"mainPanel"},"children":[{"configs":{"region":"west","tagConfigs":"items:feedPanels","collapsible":"true","layout":"accordion","width":"250","split":"true","itemId":"westPanel"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"center","tagConfigs":"id:'funTabPanel'","plugins":"{ptype:'tabclosemenu'}","split":"true","itemId":"funTabPanel"},"events":{"afterrender":"tab.mon(tab.tabBar,'dblclick',function(sender, newCard) {\n    var b = tab.getActiveTab();\n    if (Ext.String.endsWith(b.bindFile, \".xwl\")) {\n      window.open(\"m?xwl=\" + b.bindFile.slice(0, -4));\n    } else {\n      window.open(b.bindFile);\n    }\n},tab);"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border',\nid:'indexPanel'","title":"{#homePage#}","height":"'100%'","layout":"fit","itemId":"indexPanel","border":"false"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"ordered_list_icon"}