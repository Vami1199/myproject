{"inframe":false,"title":"定制化树形导航","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"{#mainPageTitle#}","importModules":"[\"m?xwl=xip/pub/navigator/navigatorCommonModule\"]","cssLinks":"[\"xip/css/default.css\",\"xip/css/font.css\",\"xip/portalNavigator/portal/extmvc/resources/css/portal.css\"]","loginRequired":"false","initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nvar userName = request.getSession().getAttribute(\"XzSessionVars\").get('userName');\n\nvar authModel = request.getSession().getAttribute(\"XzSessionVars\").get('AUTH_MODAL');\n//var roleId = request.getSession().getAttribute(\"XzSessionVars\").get('roleId');\nvar roleId = com.xzsoft.xip.platform.util.PlatformUtil.getUserRole(userId) ;\nvar roleName = request.getSession().getAttribute(\"XzSessionVars\").get('roleName');\nvar roleCode = request.getSession().getAttribute(\"XzSessionVars\").get('roleCode');\n\n\nvar ctxPath = request.getContextPath() ;\n\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"userName\",userName);\n\nrequest.setAttribute(\"authModel\",authModel);\nrequest.setAttribute(\"roleId\",roleId);\nrequest.setAttribute(\"roleName\",roleName);\nrequest.setAttribute(\"roleCode\",roleCode);\nrequest.setAttribute(\"contextPath\",ctxPath);\nvar pwdLenLimit= com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"PW_LEN_LIMIT\");\nvar pwdIncludeChar =  com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"PW_INCLUDE_CHAR\");\nvar homePage =  com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"HOME_PAGE\");\nvar title = com.xzsoft.xip.platform.util.PlatformUtil.getAppName();\nrequest.setAttribute(\"mainPageTitle\",title);\nrequest.setAttribute(\"PW_LEN_LIMIT\",pwdLenLimit);\nrequest.setAttribute(\"PW_INCLUDE_CHAR\",pwdIncludeChar);\nrequest.setAttribute(\"HOME_PAGE\",homePage);\n\nvar isShowBanner = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"SHOW_TOP_BANNER\");\nrequest.setAttribute(\"isShowBanner\",isShowBanner);\n\nvar topBannerHeight = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"TOP_BANNER_HEIGHT\");\n\nif(topBannerHeight==null || \"\".equals(topBannerHeight)){\n  topBannerHeight = 120;\n}\n\nrequest.setAttribute(\"topBannerHeight\",topBannerHeight);\n\nvar session = request.getSession().getAttribute(\"XzSessionVars\");\nif(session!==null){\n  var language = request.getSession().getAttribute(\"XzSessionVars\").get('language');\n  request.setAttribute('language',language);\n}else{\n  var lang = com.xzsoft.xip.platform.util.PlatformUtil.getParamVal(\"XIP_DEFAULT_LANG\", \"P\", \"P\");\n  if(lang===null||lang===\"\"){\n    lang = \"zh\";\n  }\n  request.setAttribute('language',lang);\n}\n\n\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/pub/navigator/portalNavigator/portalTreeExplorer\");","jsLinks":"[\"xip/js/TabCloseMenu4wb7.js\"]","itemId":"module","head":"<script>\n  var baseUrl='{#contextPath#}/xip/portalNavigator/portal/';\n  var contentPath = '{#contextPath#}';\n  var portalAuthModel ='{#XIP.AUTH_MODAL#}';\n<\/script>"},"events":{"initialize":"var beforeSelectRole = '';\nExt.QuickTips.init();"},"children":[{"configs":{"headerHtml":"<script>\ndocument.onkeydown = function()\n{\n\n   var oEvent = window.event;\n   if (oEvent.keyCode == 75 && oEvent.ctrlKey && oEvent.shiftKey) {\n     mouseOverEvent(Ext.getCmp(\"search\"));\n   }\n}\n<\/script>\n<script type=\"text/javascript\">\n  //退出登录\n  function logout(){\n    Ext.MessageBox.minWidth = 200 ;\n    Ext.MessageBox.confirm('{#portal_explorer_notice#}', '{#quitTips#}', function (opt) {\n      if (opt == 'yes') {\n        var msg = Ext.MessageBox.show({\n          title \t : \t'{#portal_explorer_notice#}',\n          msg \t : \t'{#waitingMsg#}',\n          width \t : \t240,\n          wait\t : \ttrue,\n          progress : \ttrue,\n          closable : \tfalse\n        });\t\n\n        Ext.Ajax.request({\n          url : '{#contextPath#}' +'/frameAction.do?method=logout',\n          method: 'POST',\n          success: function(response,options){\n            msg.hide();\n            var temp = response.responseText;\n            var response = Ext.JSON.decode(temp);\n            if(response.flag=='1'){\n              // window.location.href=\"http://219.141.183.220:9092/cas-server-webapp-3.5.2/logout\";\n\n              // modified by linp 20141106\n              var logoutUrl = response.logoutUrl ;\n              var callbackUrl = response.callbackUrl ;\n              window.location.href = logoutUrl + callbackUrl ;\n\n            }else{\n              Ext.Msg.alert('{#portal_explorer_notice#}',response.msg);\n            }\n          },\n          failure: function(response,options){\n            msg.hide();\n            Ext.Msg.alert('{#portal_explorer_notice#}','{#failureMsg#}');\n          }\n        });\n      }\n    });\n  }\n  \n  var temp = new Array();\n   \n  \n  if('{#authModel#}'=='ROLE'){\n    temp.push({\n      id:\"roleCombo\",\n      displayField:\"roleName\",\n      valueField:\"roleId\",\n      fieldLabel:'{#role#}',\n      labelWidth:60,\n      width:230,\n      labelAlign:'right',\n      xtype:\"combobox\",\n      minChars:0,\n      store:new Ext.data.Store({\n        autoLoad:true,\n        proxy:{\n          url:'{#contextPath#}' + '/frameAction.do?method=getRolesByUserId&userId=' + '{#userId#}',\n          async: false, //发送同步请求\n          type:\"ajax\",\n          reader:{\n            type:\"json\",\n            root:\"rows\",\n            rootProperty:\"rows\",\n            totalProperty:\"total\"\n          }\n        },\n        fields:[{name:'roleId'},{name:'roleCode'},{name:'roleName'}],\n        listeners:{\n          beforeload:function(store,operation,options){\n          },\n          load:function(store,records,successful,operation,options){\n            Ext.getCmp('roleCombo').setValue('{#roleId#}');\n            \n            Ext.Ajax.request({\n              url : '{#contextPath#}' +'/frameAction.do?method=afterSetRole',\n              method: 'POST',\n              success: function(response,options){\n              },\n              failure: function(response,options){\n              }\n            });\n          }\n        }\n      }),\n      //forceList:false,\n      forceSelection:true,\n      //editable:false,\n      listeners:{\n        select:function(comboBox,records,options){\n          var roleId = this.getValue();\n          if(roleId === '{#roleId#}'){\n            return ;\n          }\n          var roleCode = '';\n          var roleName = '';\n          var index = comboBox.getStore().find('roleId',roleId);\n          var roleRecord = comboBox.getStore().getAt(index);\n          if(roleRecord){\n            roleCode = roleRecord.get('roleCode');\n            roleName = roleRecord.get('roleName');\n          }\n\n          Ext.Msg.wait(\"{#portal_explorer_notice#}\",'{#portal_explorer_switch#}');\n          Ext.Ajax.request({\n            url : '{#contextPath#}' +'/frameAction.do?method=switchRole',\n            method: 'POST',\n            params:{\"roleId\":roleId,\"roleName\":roleName,\"roleCode\":roleCode},\n            success: function(response,options){\n              Ext.Msg.hide();\n              var temp = response.responseText;\n              var resp = Ext.JSON.decode(temp);\n              if(resp.flag=='1'){\n                window.location.href = '{#contextPath#}'+'/frame/navigator.jsp'; \n              }else{\n                Ext.Msg.alert('{#portal_explorer_notice#}',resp.msg);\n              }\n            },\n            failure: function(response,options){\n              msg.hide();\n              Ext.Msg.alert('{#portal_explorer_notice#}','{#failureMsg#}');\n            }\n          });\n\n        }\n      }\n    });\n  }\n  \n  temp.push({xtype:'tbfill'});\n  //--------------------搜索功能--------------------\n       Ext.Ajax.request({\n          url : '{#contextPath#}' + '/frameAction.do?method=loadMenuTreeData',\n          method: 'POST',\n          async: false, //发送同步请求\n          success: function(response,options){\n            var menuData = response.responseText;\n            \n            //temp.push('-');\n            temp.push({\n              text:\"\",\n              id:\"search\",\n              iconCls:'seek_icon',\n              listeners:{\n                'mouseover':mouseOverEvent\n              },\n              menu:{\n                xtype:\"menu\",\n                style:\"border-width:0px\",\n                items: [{\n                  xtype:\"combo\",\n                  displayField: \"text\",\n                  style:\"margin-left:0px\",\n                  height:25,\n                  queryMode: \"local\",\n                  itemId: \"dataCombo\",\n                  valueField: \"funUrl\",\n                  listeners:{\n                    select:function(combo,records,options){\n                      var funObj = this;\n                      funObj.url = combo.getValue();\n                      funObj.show_style = records[0].data.show_style;\n                      funObj.in_xip = records[0].data.in_xip;\n                      funObj.text = combo.getRawValue();\n                      funcMenuClick4Page(funObj, app.funTabPanel);  \n                    }\n                  },\n                  store:{\n                    data: Ext.JSON.decode(menuData),\n                    fields: ['funUrl', 'text','show_style','in_xip'],\n                    itemId: \"store\"\n                  }\n                }]\n\n              }\n            });\n          }\n       });\n\n  //temp.push(\"<p style=';font-family:verdana'>当前用户: \"+\"<b><i>{#userName#}<\/i><\/b><\/p>\");\n\n  Ext.Ajax.request({\n    url : 'm?xwl=xip/pub/navigator/data/getLinks',\n    async: false, //发送同步请求\n    method: 'POST',\n    success: function(response,options){\n      var linkResp = Ext.JSON.decode(response.responseText);\n\n      if(linkResp.rows.length==0){\n        return;\n      }\n\n      var linkItems = new Array();\n\n      for(var i=0; i<linkResp.rows.length; i++){\n        var linkItem = linkResp.rows[i];\n        linkItems.push({\n          id:linkItem.CODE,\n          text:linkItem.NAME,\n          url:linkItem.URL,\n          listeners:{\n            'click':function(){\n              window.open(this.url);\n            }\n          }\n        });\n      }\n\n      temp.push('-');\n      temp.push({\n        id:\"links\",\n        text:\"\",\n        iconCls:'web_icon',\n        listeners:{\n          'mouseover':mouseOverEvent\n        },\n        menu:{\n          xtype:\"menu\",\n          items:linkItems\n        }\n      });\n\n    },\n    failure: function(response,options){\n    }\n  });\n\n  temp.push('-');\n\n  temp.push({\n    text:\"\",\n    iconCls:'user_icon',\n    listeners:{\n      'mouseover':mouseOverEvent\n    },\n    menu:{\n      xtype:\"menu\",\n      items:[\n        {\n          text:'{#userName#}'\n        },\n        {\n          text:'{#modifiedPwd#}',\n          listeners:{\n            'click':function(){\n              //通过W7的方式打开修改密码窗口\n              Wb.run({\n                url: 'm?xwl=xip/pub/navigator/modifyPassword', \n                success: function(app) {\n                  app.initWin({\n                    title:'{#modifiedPwd#}'\n                  });\n                }\n              });\n            }\n          }\n        },{\n          text:'{#personalSet#}',\n          listeners:{\n            'click':function(){\n              //通过W7的方式打开\n              Wb.run({\n                url: 'm?xwl=xip/pub/navigator/personalSet', \n                success: function(app) {\n                  app.initWin();\n                }\n              });\n            }\n          }\n        }\n      ]\n    }\n  });\n  temp.push('-'); \t\t\t\t\n  // 退出\n  temp.push({\n    text\t:\t'',\n    iconCls\t:\t'logout_icon',\n    tooltip :\t'{#logout#}',\n    handler\t:\tlogout\n  });\n  temp.push('-');\n\n  /*var personalToolBar = new Ext.toolbar.Toolbar({\n    id:\"personalToolBar\",\n    height:40,\n    items:temp\n  });*/\n\n<\/script>","itemId":"topBarScript"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"itemId":"topBar"},"events":{"afterrender":"app.topBar.add(temp);"},"children":[],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"store"},"children":[{"configs":{"itemId":"protalHomeStore","autoLoad":"true","url":"m?xwl=xip/pub/navigator/portalNavigator/data/getPortalHome"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport"},"events":{"afterrender":"Ext.Loader.setConfig({\n\t\tenabled : true,\n\t\tpaths : {\n          'com.fb' : '{#contextPath#}/xip/portalNavigator/portal/extmvc/com/fb'}\n  });\n//如果当前语言是en 则引入LayoutContainer_en.js\nvar portal=Ext.create(\"com.fb.portal.LayoutContainer\");\nif('{#HOME_PAGE#}'!==null && '{#HOME_PAGE#}'!==\"\"){\n   var com = Ext.create('Ext.Component', {\n      html: \"<iframe src =\"+'{#contextPath#}'+'{#HOME_PAGE#}'+\" height='100%' width='100%'><\/frame>\",\n      renderTo: Ext.getBody()\n  });\n   app.indexPanel.add(com);\n  \n}else{\n  \n  app.indexPanel.add(portal);\n}\n"},"children":[{"configs":{"region":"north","bodyStyle":"background-repeat:no-repeat","height":"({#topBannerHeight#}>120 ) ? 120: {#topBannerHeight#}","hidden":"'{#isShowBanner#}'=='Y' ? false: true","html":"<img height='100%' width='100%' src='{#contextPath#}/xip/images/top.png'>","split":"true","itemId":"topPanel"},"children":[],"expanded":false,"type":"panel"},{"configs":{"tbar":"app.topBar","region":"center","layout":"border","itemId":"mainPanel"},"children":[{"configs":{"rootVisible":"false","region":"west","title":"{#functionMenu#}","animate":"true","scroll":"both","collapsible":"true","root":"{text:Str.all,itemId:-1,expanded:true}","width":"document.body.clientWidth*(.18)","split":"true","itemId":"treePanel"},"events":{"itemclick":"var isleaf = record.data.leaf ;\nif(isleaf){\n  funcMenuClick4Page(record.data, app.funTabPanel);\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"{#contextPath#}/frameAction.do?method=loadNavigatorTree","fields":"[{name:'text'},{name:'fun_id'},{name:'url'},{name:'app_id'},{name:'fun_code'},{name:'app_code'},{name:'in_xip'},{name:'show_style'}]"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","tagConfigs":"id:'funTabPanel'","plugins":"{ptype:'tabclosemenu'}","split":"true","itemId":"funTabPanel"},"events":{"afterrender":"tab.mon(tab.tabBar,'dblclick',function(sender, newCard) {\n    var b = tab.getActiveTab();\n    if (Ext.String.endsWith(b.bindFile, \".xwl\")) {\n      window.open(\"m?xwl=\" + b.bindFile.slice(0, -4));\n    } else {\n      window.open(b.bindFile);\n    }\n},tab);"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","title":"{#homePage#}","height":"'100%'","layout":"fit","border":"false","itemId":"indexPanel"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"tree_icon"}