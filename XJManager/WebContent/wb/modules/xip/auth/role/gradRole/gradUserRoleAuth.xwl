{"inframe":false,"title":"分级用户角色授权","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"request.setAttribute(\"contextPath\",request.getContextPath());\nrequest.setAttribute(\"delImageSrc\",request.getContextPath()+\"/xip/images/cut.gif\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nrequest.setAttribute(\"userId\",userId);\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/auth/role/gradRole/gradUserRoleAuth\");\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","loginRequired":"false","itemId":"module"},"events":{"initialize":"var statusR;\nvar statusU;\napp.copyText = function ()\n{ \n app.selectedUserWin.setTitle('<center>{#xip_auth_role_gradRole_selectedUser#}<\/center>');\n app.selectedUserWin.show();\n\n};\napp.copyRole  = function ()\n{ \n  app.selectedRoleWin.setTitle('<center>{#xip_auth_role_gradRole_selectedRole#}<\/center>');\n  app.selectedRoleWin.show();\n};\n\napp.deleteRole = function(){\n    var record = app.roleGrid.getSelectionModel().getSelection();\n    for(var i=0;i<app.roleGrid.store.getCount();i++){\n      if(record[0].get('ROLE_ID')== app.roleGrid.store.getAt(i).get('ROLE_ID')){\n        app.roleGrid.store.removeAt(i);\n      }\n    }\n    //点击删除 去掉勾选的对号\n    var rid = record[0].data.ROLE_ID;\n    for(var j=0;j<app.westGrid.store.getCount();j++){\n      var r_id = app.westGrid.store.getAt(j).get('ROLE_ID');\n      if(rid===r_id){\n        app.westGrid.getSelectionModel().deselect(app.westGrid.store.getAt(j));\n        break;\n      }\n    }\n  };\n  \n  //除全部已选的角色\n  app.deleteAllRoles = function(){\n    Ext.Msg.confirm('{#xip_auth_role_gradRole_alert#}','{#xip_auth_role_gradRole_delyxjs#}',function(btn){\n      if(btn == 'yes'){\n        app.roleGrid.store.removeAll();\n        app.westGrid.getSelectionModel().deselectAll();\n        //allcount2();\n      }\n    });\n  };\n\napp.deleteUser = function (){\n    var record = app.userGrid.getSelectionModel().getSelection();\n    app.userGrid.store.remove(record);\n    //点击删除 去掉勾选的对号\n    var uid = record[0].get('USER_ID');\n    var bl;\n    for(var j=0;j<app.eastGrid.store.getCount();j++){\n      var u_id = app.eastGrid.store.getAt(j).get('USER_ID');\n      if(uid === u_id){\n        app.eastGrid.getSelectionModel().deselect(app.eastGrid.store.getAt(j));\n        bl=1;\n        break;\n      }\n    }\n    //执行JS中的方法\n    allcount2();\n  };\n  \n  //删除全部已选的用户\n  app.deleteAllUsers = function (){\n    Ext.Msg.confirm('{#xip_auth_role_gradRole_alert#}','{#xip_auth_role_gradRole_delyxyh#}',function(btn){\n      if(btn == 'yes'){\n        app.userGrid.store.removeAll();\n        app.eastGrid.getSelectionModel().deselectAll();\n        allcount2();\n      }\n    });\n  };\n\n"},"children":[{"configs":{"footerScript":"function allcount31()\n{ \n    document.getElementById(\"role\").innerHTML = \"{#xip_auth_role_gradRole_selectedRole#}(0)\"; \n}\nfunction allcount3()\n{ \n    document.getElementById(\"user\").innerHTML = \"{#xip_auth_role_gradRole_selectedUser#}(0)\"; \n}\nfunction allcount2()\n{ \n  var row = app.eastGrid.getSelection();\n  var count = row.length;\n  var c = app.userGrid.store.getModifiedRecords().length;\n  if(count===0){\n   if(statusU===false){\n    \n     if(c===0){\n       document.getElementById(\"user\").innerHTML = \"{#xip_auth_role_gradRole_selectedUser#}(0)\"; \n     }\n     else{\n       document.getElementById(\"user\").innerHTML = \"{#xip_auth_role_gradRole_selectedUser#}(\"+c+\")\"; \n     }\n     \n    }\n   else{\n     document.getElementById(\"user\").innerHTML =  \"{#xip_auth_role_gradRole_selectedUser#}(\"+c+\")\";\n   }\n    \n }else{\n    document.getElementById(\"user\").innerHTML = \"{#xip_auth_role_gradRole_selectedUser#}(\"+c+\")\"; \n  }\n}\n\n\n\n\nfunction allcount()\n{ \n  var row = app.westGrid.getSelection();\n  var count = row.length;\n  var c = app.roleGrid.store.getModifiedRecords().length;\n if(count===0){\n   if(statusR === false){\n     if(c===0){\n       document.getElementById(\"role\").innerHTML = \"{#xip_auth_role_gradRole_selectedRole#}(0)\"; \n     }\n     else{\n       document.getElementById(\"role\").innerHTML = \"{#xip_auth_role_gradRole_selectedRole#}(\"+c+\")\"; \n     }\n    }\n   else{\n\n     document.getElementById(\"role\").innerHTML =  \"{#xip_auth_role_gradRole_selectedRole#}(\"+c+\")\";\n   }\n    \n }else{\n\n    document.getElementById(\"role\").innerHTML = \"{#xip_auth_role_gradRole_selectedRole#}(\"+c+\")\"; \n  }\n \n}\n\n ","itemId":"clientscript1"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"itemId":"authorizeWinBtn"},"children":[{"configs":{"text":"{#xip_auth_role_gradRole_auth#}","itemId":"authorizebtn","iconCls":"insert_icon"},"events":{"click":"if(app.roleGrid.store.getCount()===0 || app.userGrid.store.getCount()===0){\n    Wb.warn('{#xip_auth_role_gradRole_authObj#}');\n    return;\n}\n//===========对要授权的数据进行校验================\nvar _matchArray = [];\nvar _existArray = [];\nvar _finalArray = [];\nvar _roleIds = '';\nvar _userIds = '';\nvar _tmpStr = '';\nvar _existGrant = '';\n//===========获取已选择的角色和用户信息=============\napp.roleGrid.store.each(function(item){\n  _roleIds +='\\''+item.data.ROLE_ID+'\\',';\n});\napp.userGrid.store.each(function(a){\n  _userIds +='\\''+a.data.USER_ID+'\\',';\n});\n//===========获取已选择的角色和用户的组合信息(将已授权的记录从数组中去除)========\napp.roleGrid.store.each(function(tmpRole){\n  app.userGrid.store.each(function(tmpUser){\n    _tmpStr = tmpRole.data.ROLE_ID+','+tmpUser.data.USER_ID;\n    _matchArray.push(_tmpStr);\n  });\n});\n_roleIds = _roleIds.substring(0,_roleIds.length-1);\n_userIds = _userIds.substring(0,_userIds.length-1);\napp.noneGrid.store.load({params:{roleIds:_roleIds,userIds:_userIds},callback:function(){\n  app.noneGrid.store.each(function(c){\n    _existGrant = c.data.ROLE_ID+','+c.data.USER_ID;\n    if(Ext.Array.contains(_matchArray,_existGrant)){\n      Ext.Array.remove(_matchArray,_existGrant); \n    }\n  });\n if(_matchArray.length === 0){\n   Wb.warn('{#xip_auth_role_gradRole_authHasCom#}');\n   return false;\n }\n//=============构造参数==========================\n var arrayGrantIds = [];\n var _tmpSplit = [];\n var _tmpJson;\n Ext.each(_matchArray,function(tmpItem){\n     _tmpSplit = tmpItem.split(',');\n     _tmpJson= {USER_ROLE_ID:'',ROLE_ID:_tmpSplit[0],USER_ID:_tmpSplit[1]};\n     arrayGrantIds.push(_tmpJson);\n   }); \n//==================执行授权操作===================\nWb.request({\n  url :'m?xwl=xip/auth/role/DATA/insertList',\n  params : Wb.apply({array:Ext.JSON.encode(arrayGrantIds)}),\n  success : function(response){\n     Ext.Msg.alert('{#xip_auth_role_gradRole_alert#}','{#xip_auth_role_gradRole_authSuccess#}');\n     app.grid1.store.load();\n  }\n});\n}});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_role_gradRole_revoke#}","itemId":"revokebtn","iconCls":"remove_icon"},"events":{"click":"if(app.roleGrid.store.getCount()===0&&app.userGrid.store.getCount()===0){\n  Wb.warn('{#xip_auth_role_gradRole_revokeObj#}');\n  return;\n}\n// if(app.roleGrid.store.getCount()===0&&app.userGrid.store.getCount()!==0){\n//   Wb.warn('请选择角色!');\n//   return;\n// }\n// if(app.roleGrid.store.getCount()!==0&&app.userGrid.store.getCount()===0){\n//   Wb.warn('请选择用户!');\n//   return;\n// } \n//删除所选择的授权\nvar delArrayVar = [];\nvar delJson ;\napp.roleGrid.store.each(function(a){\n  app.userGrid.store.each(function(b){\n    delJson = {USER_ID:b.data.USER_ID,ROLE_ID:a.data.ROLE_ID};\n    delArrayVar.push(delJson);\n  });  \n});\nWb.request({\n  url :'m?xwl=xip/auth/role/DATA/deleteUserRoleSec',\n  params:Wb.apply({array:Ext.JSON.encode(delArrayVar)}),\n  success:function(response){\n    Ext.Msg.alert('{#xip_auth_role_gradRole_alert#}','{#xip_auth_role_gradRole_revokeSuccess#}');\n    app.grid1.store.load();\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_role_gradRole_close#}","itemId":"closebtn","iconCls":"cancel_icon"},"events":{"click":"app.authorizeWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"title":"{#xip_auth_role_gradRole_selectedRole#}","height":"360","frame":"true","layout":"border","width":"480","closeAction":"hide","border":"false","itemId":"selectedRoleWin","modal":"true"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","height":"340","width":"480","itemId":"roleGrid","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/DATA/selectedRoleGrid"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleName#}","width":"100","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleDesc#}","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"itemId":"Rdelete","renderer":"var str = \"<a href=\\\"javascript:app.deleteRole();\\\"> {#xip_auth_role_gradRole_delete#} <\/a>\";\nreturn str;"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_role_gradRole_selectedUser#}","height":"360","frame":"true","layout":"border","width":"480","closeAction":"hide","border":"false","itemId":"selectedUserWin","modal":"true"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","height":"340","width":"480","itemId":"userGrid","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/DATA/selectedUserGrid"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_userName#}","width":"100","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"itemId":"Rdelete1","renderer":"var str = \"<a href=\\\"javascript:app.deleteUser();\\\"> {#xip_auth_role_gradRole_delete#} <\/a>\";\nreturn str;"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_role_gradRole_userRoleAuth#}","height":"550","layout":"border","width":"980","closeAction":"destroy","buttonAlign":"center","buttons":"app.authorizeWinBtn","dialog":"false","itemId":"authorizeWin","modal":"true","maximizable":"true"},"events":{"close":"app.roleGrid.store.removeAll();\napp.userGrid.store.removeAll();"},"children":[{"configs":{"region":"center","style":"border-width:0px","layout":"border","border":"false","itemId":"center"},"children":[{"configs":{"region":"center","frame":"true","height":"550","style":"border-width:0px","width":"30","border":"false","itemId":"blankPanel"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"region":"west","frame":"true","layout":"border","width":"'49%'","border":"false","itemId":"west"},"children":[{"configs":{"region":"north","height":"40","frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"westFormN"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"roleN","fieldLabel":"{#xip_auth_role_gradRole_roleNameCode#}"},"events":{"specialkey":"app.westGrid.store.load({params:{roleN:app.roleN.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_role_gradRole_query#}","itemId":"roleQueryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"app.westGrid.store.load({params:{roleN:app.roleN.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"FLAG"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ROLEID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"westGrid","simpleSelect":"true"},"events":{"selectionchange":"var flag = app.FLAG.getValue();\nvar row = app.westGrid.getSelection();\nvar sm = app.westGrid.getSelectionModel();\nvar records = sm.getSelection();\nif(flag===null||flag===''){\n  \n}\nelse{\n  if(row.length<flag && statusR ===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.ROLEID.getValue().split(',');\n    for(var i=0;i<arrayid.length;i++){\n        var aid = arrayid[i];\n        for(var v=0;v<row.length;v++){\n          var idN = records[v].get('ROLE_ID');\n          if(aid===idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n            \n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k<app.roleGrid.store.getCount();k++){\n                  var  role_id3= app.roleGrid.store.getAt(k).get('ROLE_ID');\n                  if(aid===role_id3){\n                  app.roleGrid.store.removeAt(k);\n               \n                  }\n              }\n        }\n    }\n   \n   }\n  \n}\nallcount();","tagEvents":"select:function(record, index, eOpts){\n  var row = app.westGrid.getSelection();\n  var sm = app.westGrid.getSelectionModel();\n  var records = sm.getSelection();\n  var len = app.roleGrid.store.getModifiedRecords().length;\n  var record = app.roleGrid.store.getModifiedRecords();\n  //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n  var arrid='';\n  for(var v=0;v<row.length;v++){\n    var idNu = records[v].get('ROLE_ID');\n    arrid = arrid+','+idNu;\n  }\n  app.ROLEID.setValue(arrid.substring(1,arrid.length));\n  //给selectedRoleWin中的STORE添加数据\n  if(row.length===1){\n    var bl;\n    for(var i=0;i<len;i++){\n    var role_id = record[i].data.ROLE_ID;\n    if(records[0].get('ROLE_ID')===role_id){\n        bl=1;\n        break;\n      }\n      else{\n        bl=0;\n      }\n    }\n    if(bl!==1){\n           var json={ROLE_ID:records[0].get('ROLE_ID'),ROLE_NAME:records[0].get('ROLE_NAME'),DESCRIPTION:records[0].get('DESCRIPTION')};\n           app.roleGrid.store.add(json);\n\n    }\n\n  }else{\n    var bl;\n    for(var i=0;i<len;i++){\n      var role_id = app.roleGrid.store.getAt(i).get('ROLE_ID');\n      if(records[row.length-1].get('ROLE_ID')===role_id){\n        bl=1;\n        break;\n      }\n      else{\n        bl=0;\n      }\n    }\n    if(bl!==1){\n         var json={ROLE_ID:records[row.length-1].get('ROLE_ID'),ROLE_NAME:records[row.length-1].get('ROLE_NAME'),DESCRIPTION:records[row.length-1].get('DESCRIPTION')};\n         app.roleGrid.store.add(json);\n    }\n\n  }\n  app.FLAG.setValue(row.length);\n  allcount();\n\n}"},"children":[{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/gradRole/DATA/selectRole"},"events":{"load":"var arr=[];\nfor(var i=0;i<app.roleGrid.store.getCount();i++){\n  var rid = app.roleGrid.store.getAt(i).get('ROLE_ID');\n  for(var j=0;j<app.westGrid.store.getCount();j++){\n    if(rid===app.westGrid.store.getAt(j).get('ROLE_ID')){\n      arr.push(app.westGrid.store.getAt(j));\n       break;\n    }  \n  }\n}\napp.westGrid.getSelectionModel().select(arr);\nstatusR = false;","beforeload":"statusR = true;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleCode#}","width":"100","dataIndex":"ROLE_CODE","itemId":"ROLE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleName#}","width":"100","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleDesc#}","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","frame":"true","height":"40","style":"border-width:0px","layout":"border","border":"false","itemId":"westFormS"},"children":[{"configs":{"region":"west","frame":"true","style":"border-width:0px","width":"'40%'","border":"false","itemId":"panel_west"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","width":"50","border":"false","itemId":"panel_center"},"children":[{"configs":{"style":"border-width:0px","html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick =\"app.copyRole();\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"role\">{#xip_auth_role_gradRole_selectedRole#}(0)<\/a>\n<\/body>\n<\/html>\n\t","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","frame":"true","style":"border-width:0px","width":"25","border":"false","itemId":"panel_east"},"children":[{"configs":{"style":"border-width:0px","html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick = \"app.deleteAllRoles();\" title=\"{#xip_auth_role_gradRole_delallrole#}\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"fun\" ><image src=\"{#delImageSrc#}\"><\/image><\/a>\n  <\/body>\n<\/html>\n\t","itemId":"deleteAllRolesLabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","frame":"true","layout":"border","width":"'49%'","border":"false","itemId":"east"},"children":[{"configs":{"region":"north","height":"110","frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"eastFormN"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"orgPanel"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","width":"345","valueField":"CODE","emptyText":"---- {#xip_auth_role_gradRole_selectOrg#} ----","labelAlign":"right","itemId":"orgcomboBox","fieldLabel":"{#xip_auth_role_gradRole_org#}","editable":"true"},"events":{"select":"app.orgcomboBox.focus();\nvar dept_id = app.depcomboBox.getValue();\nif(dept_id===null||dept_id===''){\n \n  var ORG_ID = app.orgcomboBox.getValue();\n  \n  app.depcomboBox.store.load({params:{ORG_ID:ORG_ID}});\n}else{\n  \n  var ORG_ID = app.orgcomboBox.getValue();\n \n  app.depcomboBox.store.load({params:{ORG_ID:ORG_ID}});\n  app.depcomboBox.clearValue();\n}\nvar ORG_ID = app.orgcomboBox.getValue();\napp.eastGrid.store.load();"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/DATA/selectOrg"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"deptPanel"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"DEPT_NAME","width":"345","valueField":"DEPT_ID","emptyText":"---- {#xip_auth_role_gradRole_selectDept#}----","labelAlign":"right","itemId":"depcomboBox","fieldLabel":"{#xip_auth_role_gradRole_dept#}"},"events":{"select":"var DEPT_ID = app.depcomboBox.getValue();\napp.eastGrid.store.load();\n","focus":"var DEPT_ID = app.depcomboBox.getValue();\nif(DEPT_ID===null || DEPT_ID===''){\n  if(app.orgcomboBox.getValue()===null){\n    app.depcomboBox.store.removeAll();\n  }\n}\n"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/auth/role/DATA/selectDept"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"userN","fieldLabel":"{#xip_auth_role_gradRole_userName#}"},"events":{"specialkey":"app.eastGrid.store.load({params:{userN:app.userN.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_role_gradRole_query#}","itemId":"userQueryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"app.eastGrid.store.load({params:{userN:app.userN.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_role_gradRole_reset#}","itemId":"userResetBtn","iconCls":"refresh_icon","x":"25"},"events":{"click":"app.orgcomboBox.clearValue();\napp.depcomboBox.clearValue();\napp.userN.setValue('');\napp.eastGrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"FLAG1"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"USERID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"eastGrid","simpleSelect":"true"},"events":{"selectionchange":"var flag = app.FLAG1.getValue();\nvar row = app.eastGrid.getSelection();\nvar sm = app.eastGrid.getSelectionModel();\nvar records = sm.getSelection();\n\nif(flag===null||flag===''){\n  \n}\nelse{\n  if(row.length<flag && statusU===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.USERID.getValue().split(',');\n    for(var i=0;i<arrayid.length;i++){\n        var aid = arrayid[i];\n        for(var v=0;v<row.length;v++){\n          var idN = records[v].get('USER_ID');\n          if(aid===idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n            \n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k<app.userGrid.store.getCount();k++){\n                  var  user_id3 = app.userGrid.store.getAt(k).get('USER_ID');\n                  if(aid===user_id3){\n                  app.userGrid.store.removeAt(k);\n               \n                  }\n              }\n          \n        \n        }\n    }\n   \n   }\n}\nallcount2();\n","tagEvents":"select:function(record, index, eOpts){\n    var row = app.eastGrid.getSelection();\n    var sm = app.eastGrid.getSelectionModel();\n    var records = sm.getSelection();\n    //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n    var arrid = '';\n    for(var v=0 ;v<row.length; v++){\n      var idNu = records[v].get('USER_ID');\n      arrid = arrid+','+idNu;\n    }\n    app.USERID.setValue(arrid.substring(1,arrid.length));\n    if(row.length===1){\n          //不在userStore中才添加\n          var blll;\n          for(var j=0;j<app.userGrid.store.getCount();j++){\n             var uuid = app.userGrid.store.getAt(j).get('USER_ID');\n             if(records[0].get('USER_ID')===uuid){\n              blll=1;\n              break;\n\n            }\n\n          }\n          if(blll!==1){\n           var json={USER_ID:records[0].get('USER_ID'),USER_NAME:records[0].get('USER_NAME'),EMP_NAME:records[0].get('EMP_NAME')};\n           app.userGrid.store.add(json);\n\n          }\n\n\n\n    }else{\n      //不在userStore中才添加\n      var bl;\n      for(var i=0;i<app.userGrid.store.getCount();i++){\n        var user_id=app.userGrid.store.getAt(i).get('USER_ID');\n        if(records[row.length-1].get('USER_ID')===user_id){\n          bl=1;\n          break;\n        }\n        else{\n          bl=0;\n        }\n      }\n      if(bl!==1){\n          var json={USER_ID:records[row.length-1].get('USER_ID'),USER_NAME:records[row.length-1].get('USER_NAME'),EMP_NAME:records[row.length-1].get('EMP_NAME')};\n          app.userGrid.store.add(json);\n        }\n\n    }\n\n    app.FLAG1.setValue(row.length);\n    allcount2();\n\n}"},"children":[{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/DATA/noOrgDeptUser"},"events":{"load":"var arr=[];\nfor(var i=0;i<app.userGrid.store.getCount();i++){\n  var uid = app.userGrid.store.getAt(i).get('USER_ID');\n  for(var j=0;j<app.eastGrid.store.getCount();j++){\n    if(uid===app.eastGrid.store.getAt(j).get('USER_ID')){\n      arr.push(app.eastGrid.store.getAt(j));\n      break;\n    }  \n  }\n}\napp.eastGrid.getSelectionModel().select(arr);\nstatusU = false;","beforeload":"var whereSql= ' AND 1=1';\nif(Ext.isEmpty(app.orgcomboBox.getValue()) && Ext.isEmpty(app.depcomboBox.getValue())){\n  store.getProxy().url='m?xwl=xip/auth/role/DATA/noOrgDeptUser';  //noOrgDeptUser\n}else{\n  store.getProxy().url='m?xwl=xip/auth/role/DATA/selectOrgDeptUser';  //selectOrgDeptUser\n}\nif(!Ext.isEmpty(app.orgcomboBox.getValue())){ \n  whereSql +=' AND b.ORG_ID =\\''+app.orgcomboBox.getValue()+'\\'';\n}\nif(!Ext.isEmpty(app.depcomboBox.getValue())){\n  whereSql +=' AND b.DEPT_ID =\\''+app.depcomboBox.getValue()+'\\'';\n}\nstore.getProxy().extraParams.WHERESQL = whereSql;\nstatusU = true;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_userName#}","width":"150","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","frame":"true","height":"40","style":"border-width:0px","layout":"border","border":"false","itemId":"eastFormS"},"children":[{"configs":{"region":"west","frame":"true","style":"border-width:0px","width":"'40%'","border":"false","itemId":"panel_west"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","width":"50","border":"false","itemId":"panel_center"},"children":[{"configs":{"html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick =\"app.copyText();\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"user\" >{#xip_auth_role_gradRole_selectedUser#}(0)<\/a>\n<\/body>\n<\/html>\n\t","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","frame":"true","style":"border-width:0px","width":"25","border":"false","itemId":"panel_east"},"children":[{"configs":{"html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick = \"app.deleteAllUsers();\" title=\"{#xip_auth_role_gradRole_delalluser#}\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"fun\" ><image src=\"{#delImageSrc#}\"><\/image><\/a>\n  <\/body>\n<\/html>\n\t","itemId":"deleteAllUsersLabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"window"},{"configs":{"height":"260","width":"380","layout":"border","itemId":"noneWin"},"children":[{"configs":{"region":"center","height":"260","width":"380","itemId":"noneGrid"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xip/auth/role/DATA/selectList_noPage"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_role_gradRole_number#}","width":"50","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_userName#}","width":"250","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_empName#}","width":"250","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleName#}","width":"250","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ROLE_ID","hidden":"true","dataIndex":"USER_ROLE_ID","itemId":"USER_ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_isDefault#}","dataIndex":"ISDEFAUT","itemId":"ISDEFAUT_COL","renderer":"if(value === \"Y\"){\n  return \"{#xip_auth_role_gradRole_yes#}\";\n}else{\n  return \"{#xip_auth_role_gradRole_no#}\";\n}","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#xip_auth_role_gradRole_queryCondition#}","frame":"true","style":"padding-top:8px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"userName","fieldLabel":"{#xip_auth_role_gradRole_userName#}"},"events":{"specialkey":"var userName = app.userName.getValue().toUpperCase();\nvar empName = app.empName.getValue();\nvar roleName = app.roleName.getValue();\napp.grid1.store.load({params:{\n         userName : userName,\n         empName  : empName ,\n         roleName : roleName\n}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"empName","fieldLabel":"{#xip_auth_role_gradRole_empName#}"},"events":{"specialkey":"var userName = app.userName.getValue().toUpperCase();\nvar empName = app.empName.getValue();\nvar roleName = app.roleName.getValue();\napp.grid1.store.load({params:{\n         userName : userName,\n         empName  : empName ,\n         roleName : roleName\n}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"roleName","fieldLabel":"{#xip_auth_role_gradRole_roleName#}"},"events":{"specialkey":"var userName = app.userName.getValue().toUpperCase();\nvar empName = app.empName.getValue();\nvar roleName = app.roleName.getValue();\napp.grid1.store.load({params:{\n         userName : userName,\n         empName  : empName ,\n         roleName : roleName\n}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_role_gradRole_query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"var userName = app.userName.getValue().toUpperCase();\nvar empName = app.empName.getValue();\nvar roleName = app.roleName.getValue();\napp.grid1.store.load({params:{\n         userName : userName,\n         empName  : empName ,\n         roleName : roleName\n}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_role_gradRole_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"25"},"events":{"click":"app.userName.setValue('');\napp.empName.setValue('');\napp.roleName.setValue('');\napp.grid1.store.load({params:{\n         userName : app.userName.getValue(),\n         empName  : app.empName.getValue(),\n         roleName : app.roleName.getValue()\n}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","simpleSelect":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_role_gradRole_userRoleAuth#}","itemId":"user_role_authorizebtn","iconCls":"user_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._authorizeWin);\nwin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_role_gradRole_delete#}","itemId":"deletebtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(Ext.isEmpty(rows)){\n  Ext.MessageBox.alert('{#xip_auth_role_gradRole_alert#}','{#xip_auth_role_gradRole_selRecord#}');\n}\nelse{\n   Ext.Msg.confirm('{#xip_auth_role_gradRole_alert#}','{#xip_auth_role_gradRole_confirm#}',function(a){\n    if(a=='yes'){\n      Wb.request({\n         url : 'm?xwl=xip/auth/role/DATA/deleteUserRole',\n         params : Wb.apply({destory: Wb.getData(rows)}),\n         success :function(response){\n            Wb.remove(app.grid1,rows);\n         }\n      });\n    }\n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_role_gradRole_setDefault#}","itemId":"defaultbtn","iconCls":"rename_icon"},"events":{"click":"var rows = app.grid1.getSelection();\n/*----------可以同时设置多个用户为默认角色，但是同一个用户只能有一个默认角色----*/\nif(rows.length === 0){\n  Wb.warn('{#xip_auth_role_gradRole_selRecord#}');\n  return false;\n}\nif(rows.length !==1){\n  Wb.warn('{#xip_auth_role_gradRole_selRecordSingle#}');\n  return false;\n}\nif(rows[0].data.ISDEFAUT === 'Y'){\n  Wb.warn('{#xip_auth_role_gradRole_alreadyDefault#}');\n  return false;\n}\nWb.request({\n     url : 'm?xwl=xip/auth/role/DATA/setDefault',\n     params: {USER_ID:rows[0].data.USER_ID,USER_ROLE_ID:rows[0].data.USER_ROLE_ID},\n     success:function(response){\n       app.grid1.store.reload();\n     }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/gradRole/DATA/selectList"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_userName#}","width":"250","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_empName#}","width":"250","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_roleName#}","width":"250","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ROLE_ID","hidden":"true","dataIndex":"USER_ROLE_ID","itemId":"USER_ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_role_gradRole_isDefault#}","dataIndex":"ISDEFAUT","itemId":"ISDEFAUT_COL","renderer":"if(value === \"Y\"){\n  return \"{#xip_auth_role_gradRole_yes#}\";\n}else{\n  return \"{#xip_auth_role_gradRole_no#}\";\n}","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}