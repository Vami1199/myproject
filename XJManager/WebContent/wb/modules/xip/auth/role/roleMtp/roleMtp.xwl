{"inframe":false,"title":"分级授权角色管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nvar userName = request.getSession().getAttribute(\"XzSessionVars\").get('userName');\nvar empName = request.getSession().getAttribute(\"XzSessionVars\").get('empName');\n\nvar authModel = request.getSession().getAttribute(\"XzSessionVars\").get('AUTH_MODAL');\nvar roleId = request.getSession().getAttribute(\"XzSessionVars\").get('roleId');\nvar roleName = request.getSession().getAttribute(\"XzSessionVars\").get('roleName');\nvar roleCode = request.getSession().getAttribute(\"XzSessionVars\").get('roleCode');\n\nvar ctxPath = request.getContextPath() ;\n\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"userName\",userName);\nrequest.setAttribute(\"empName\",empName);\n\nrequest.setAttribute(\"authModel\",authModel);\nrequest.setAttribute(\"roleId\",roleId);\nrequest.setAttribute(\"roleName\",roleName);\nrequest.setAttribute(\"roleCode\",roleCode);\n\n\nvar lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\n\nrequest.setAttribute(\"language\",lang);\n\nrequest.setAttribute(\"contextPath\",ctxPath);\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/auth/role/roleMtp/roleMtp\");\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","itemId":"module"},"events":{"finalize":"app.alertMsg = function(){\n  //mesAlert=true;\n  Wb.setCookie(\"roleMtpAlert\",'Y');\n};\nvar expStatus = false;\nvar mesAlert = false;\nif(app.roleWin.height==520){\n  app.sepPanel.setHeight(\"400\");\n  app.sepPanel.doLayout();\n}else{\n}","initialize":"var localFlag;\n/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\nfunction treeNodeQuery(text,by,treeId) { \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = treeId;\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n}\n"},"children":[{"configs":{"itemId":"singleRoleStore","url":"m?xwl=xip/auth/role/roleMtp/DATA/getRoleById"},"events":{"load":"if(app.singleRoleStore.getAt(0)) {\n  var record = app.singleRoleStore.getAt(0);\n  //app.roleForm.loadRecord(record);\n  app.MNU_GROUP_ID.setValue(record.get('MNU_GROUP_ID'));\n  app.ROLE_ID.setValue(record.get('ROLE_ID'));\n  app.ROLE_CODE.setValue(record.get('ROLE_CODE'));\n  app.DESCRIPTION.setValue(record.get('DESCRIPTION'));\n  app.ROLE_NAME.setValue(record.get('ROLE_NAME'));\n  \n  \n  var enableFlag = record.get('ENABLE_FLAG');\n  \n  if(enableFlag=='Y'){\n    app.ENABLE_FLAG.setValue(true);\n  }else if(enableFlag=='N'){\n    app.ENABLE_FLAG.setValue(false);\n  }\n  \n  app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n  app.menuFunctionTree.store.getProxy().extraParams.menuGroupId = app.MNU_GROUP_ID.getValue();\n  app.menuFunctionTree.store.getProxy().extraParams.roleId = '{#roleId#}';\n  app.menuFunctionTree.store.load();\n  //app.menuFunctionTree.expandAll();\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"mnuStore","url":"m?xwl=xip/auth/role/roleMtp/DATA/getMnuId"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"winBtns"},"children":[{"configs":{"itemId":"roleWinBtns"},"children":[{"configs":{"text":"->","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_save#}","itemId":"btn_confirm_rolewin","iconCls":"save_icon"},"events":{"click":"if(app.roleForm.getForm().isValid()===false){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n  return;\n}\nvar operatorType = app.type.getValue();\n\nvar saveJson = {\n  roleId : app.ROLE_ID.getValue(),\n  roleCode : app.ROLE_CODE.getValue(),\n  roleName : app.ROLE_NAME.getValue(),\n  description : app.DESCRIPTION.getValue(),\n  enableFlag : app.ENABLE_FLAG.getValue()===true?'Y':'N',\n  menuGroupId : app.MNU_GROUP_ID.getValue()\n};\n\nif(operatorType == '_added'){\n  Wb.request({\n    url :'m?xwl=xip/auth/role/roleMtp/DATA/insertRole',\n    params:saveJson,\n    success:function(){\n//       var temp = response.responseText;\n//       var resultJson = Ext.JSON.decode(temp);\n      app.type.setValue('_modified');\n      Wb.toast('{#xip_auth_roleMtp_saveSuc#}');\n      //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_saveSuc#}');\n      app.grid1.store.load();\n    }\n  });\n}else if(operatorType == '_modified'){\n  Wb.request({\n    url :'m?xwl=xip/auth/role/roleMtp/DATA/updateRole',\n    params:saveJson,\n    success:function(response){\n//       var temp = response.responseText;\n//       var resultJson = Ext.JSON.decode(temp);\n      Wb.toast('{#xip_auth_roleMtp_saveSuc#}');\n      //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_saveSuc#}');\n      app.grid1.store.load();\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_roleMtp_close#}","itemId":"btn_cancel_rolewin","iconCls":"cancel_icon"},"events":{"click":"app.roleWin.close();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"TEST","hidden":"true","itemId":"TEST"},"events":{"click":"new Ext.ux.window.Notification({\n  title: '提示',\n  position: 'lc', //left-center\n  iconCls: '',\n  html: '从左边拖动文件夹(菜单)或功能到右边进行角色功能菜单的维护，'+'<br>'+\n         '鼠标右键单击右边的功能树或其他的节点进行功能操作，'+'<br>'+\n         '拖动右边的文件夹（菜单）或功能可以改变上下级和顺序.',\n  bodyPadding: 15,\n  bodyStyle: 'line-height:20px;',\n  autoCloseDelay: 5000,\n  slideBackDuration: 300,\n  slideInAnimation: 'bounceOut',\n  slideBackAnimation: 'easeIn'\n}).show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"->","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_demo#}","hidden":"true","itemId":"demo ","iconCls":"video_icon"},"events":{"click":"app.window_demo.show();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"copyWinBtns"},"children":[{"configs":{"text":"{#xip_auth_roleMtp_ok#}","itemId":"btn_confirm_copywin","iconCls":"ok_icon"},"events":{"click":"if(app.copyRoleForm.getForm().isValid()==false){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n  return;\n}\n\nvar isExistFlag = false;\nExt.Ajax.request({\n  url : 'm?xwl=xip/auth/role/roleMtp/DATA/getRolesByCode',\n  method: 'POST',\n  async: false, //发送同步请求\n  params:{roleCode:app.copyRoleCode.getValue()},\n  success: function(response,options){\n    var json = Ext.JSON.decode(response.responseText);\n    isExistFlag = json.total;\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n    /*alert('发送请求失败，服务器没有响应');*/\n  }\n});\n\nif(isExistFlag !== 0){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_codeIsExist#}');\n  return;\n}\n\nvar saveJson = {\n  newRoleCode : app.copyRoleCode.getValue(),\n  newRoleName : app.copyRoleName.getValue(),\n  newRoleDesc : app.copyRoleDesc.getValue(),\n  newRoleEnable : app.copyRoleEnableFlag.getValue()==true?'Y':'N',\n  menuGroupId : app.roleCombox.getValue()\n};\n\nExt.Msg.wait('{#xip_auth_roleMtp_isCoping#}');\nExt.Ajax.request({\n  url : '{#contextPath#}' +'/menuGroupEgisAction.do?method=copyMenuGroup',\n  params:saveJson,\n  method: 'POST',\n  success: function(response,options){\n    Ext.Msg.hide();\n    var temp = response.responseText;\n    var obj = Ext.JSON.decode(temp);\n\n    app.copyRoleWin.hide();\n    Wb.toast('{#xip_auth_roleMtp_copySuc#}');\n    //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_copySuc#}');\n    \n    app.grid1.store.load();\n  },\n  failure: function(response,options){\n    Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n    /*Ext.Msg.alert('错误','失败，服务器没有响应');*/\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_roleMtp_cancle#}","itemId":"btn_cancel_copywin","iconCls":"cancel_icon"},"events":{"click":"app.copyRoleWin.hide();\napp.grid1.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"rightClickWinBtns"},"children":[{"configs":{"text":"{#xip_auth_roleMtp_ok#}","itemId":"btn_confirm_rightcilckwin","iconCls":"ok_icon"},"events":{"click":"if(app.rightClickForm.getForm().isValid()===false){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_menuInfoInc#}');\n  return;\n}\n\nvar operateType = app.type.getValue();\nif(operateType=='_added'){\n  var isExistFlag = false;\n  Ext.Ajax.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getRolesByCode',\n    method: 'POST',\n    async: false, //发送同步请求\n    params:{roleCode:app.ROLE_CODE.getValue()},\n    success: function(response,options){\n      var json = Ext.JSON.decode(response.responseText);\n      isExistFlag = json.total;\n    },\n    failure: function(response,options){\n      //Ext.Msg.hide();\n      /*Ext.Msg.alert('','发送请求失败，服务器没有响应');*/\n      Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n    }\n  });\n\n  if(isExistFlag != 0){\n    Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_codeIsExist#}');\n    return false;\n  }\n\n  var saveJson = {\n    roleId : app.ROLE_ID.getValue(),\n    roleCode : app.ROLE_CODE.getValue(),\n    roleName : app.ROLE_NAME.getValue(),\n    description : app.DESCRIPTION.getValue(),\n    enableFlag : app.ENABLE_FLAG.getValue()===true?'Y':'N',\n    menuGroupId : app.MNU_GROUP_ID.getValue()\n  };\n  \n  Ext.Ajax.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/insertRole',\n    method: 'POST',\n    params:saveJson,\n    async: false, //发送同步请求\n    success: function(response,options){\n      //var json = Ext.JSON.decode(response.responseText);\n      //isExistFlag = json.total;\n      app.type.setValue('_modified');\n      \n      var operatorType = app.rightType.getValue();\n\n      if(operatorType == '_after'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          upId : app.rightUpId.getValue(),\n          operateType :'_after'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/insertMenu',\n          params:saveJson,\n          success:function(response){\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              var operateType = resultJson.operateType;\n              var n = app.menuGroupTree.getSelection()[0];\n              n.expand();\n              var nodeOrder = 0;\n              if(n.lastChild){\n                if(n.lastChild.previousSibling){\n                  if(n.lastChild.previousSibling.get('idx')){\n                    nodeOrder = n.lastChild.previousSibling.get('idx');\n                  } \n                } \n              }\n              nodeOrder = nodeOrder + 1;\n              n.appendChild({text:saveJson.menuName, ID:saveJson.menuId, parent_id:saveJson.upId, NODE_TYPE:'M', NODE_ORDER:nodeOrder,children:[]});\n              n.commit();\n              Wb.toast('{#xip_auth_roleMtp_success#}');\n               //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n//               app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n          }\n        });\n      }else if(operatorType == '_append'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          upId : app.rightUpId.getValue(),\n          operateType :'_append'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/insertMenu',\n          params:saveJson,\n          success:function(response){\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              var operateType = resultJson.operateType;\n              var n = app.menuGroupTree.getSelection()[0];\n              n.expand();\n              var nodeOrder = 0;\n              if(n.lastChild){\n                if(n.lastChild.previousSibling){\n                  if(n.lastChild.previousSibling.get('idx')){\n                    nodeOrder = n.lastChild.previousSibling.get('idx');\n                  } \n                } \n              }\n              nodeOrder = nodeOrder + 1;\n              n.appendChild({text:saveJson.menuName, ID:saveJson.menuId, parent_id:saveJson.upId, NODE_TYPE:'M', NODE_ORDER:nodeOrder,children:[]});\n              n.commit();\n               Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n//               app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n\n          }\n        });\n      }else if(operatorType == '_reName'){\n       var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          operateType :'_reName'\n        };\n         Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/updateMenu',\n          params:saveJson,\n          success:function(response){\n              Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n              app.rightClickWin.hide();\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              //var n = Wb.getSelNode(app.menuGroupTree);\n              var n = app.menuGroupTree.getSelectionModel().getSelection()[0];\n              //app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              n.set('name',saveJson.menuName);\n              n.set('text',saveJson.menuName);\n              n.commit();\n           }\n        });\n      }\n      \n    },\n    failure: function(response,options){\n      /*Ext.Msg.alert('','保存角色是失败：发送请求失败，服务器没有响应');*/\n      Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n    }\n  });\n\n}else if(operateType=='_modified'){\n  if(app.roleForm.getForm().isDirty()===true){\n    var isExistFlag = false;\n    Ext.Ajax.request({\n      url : 'm?xwl=xip/auth/role/role/DATA/getRoleByIdAndCode',\n      method: 'POST',\n      async: false, //发送同步请求\n      params:{roleCode:app.ROLE_CODE.getValue(),roleId:app.ROLE_ID.getValue()},\n      success: function(response,options){\n        var json = Ext.JSON.decode(response.responseText);\n        isExistFlag = json.total;\n      },\n      failure: function(response,options){\n        //Ext.Msg.hide();\n        /*Ext.Msg.alert('','发送请求失败，服务器没有响应');*/\n        Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n      }\n    });\n\n    if(isExistFlag !== 0){\n      Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_codeIsExist#}');\n      return false;\n    }\n\n    var saveJson = {\n      roleId : app.ROLE_ID.getValue(),\n      roleCode : app.ROLE_CODE.getValue(),\n      roleName : app.ROLE_NAME.getValue(),\n      description : app.DESCRIPTION.getValue(),\n      enableFlag : app.ENABLE_FLAG.getValue()===true?'Y':'N',\n      menuGroupId : app.MNU_GROUP_ID.getValue()\n    };\n\n    Ext.Ajax.request({\n      url : 'm?xwl=xip/auth/role/role/DATA/updateRole',\n      method: 'POST',\n      params:saveJson,\n      async: false, //发送同步请求\n      success: function(response,options){\n        //var json = Ext.JSON.decode(response.responseText);\n        //isExistFlag = json.total;\n        \n      var operatorType = app.rightType.getValue();\n      if(operatorType == '_after'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          upId : app.rightUpId.getValue(),\n          operateType :'_after'\n        };\n         Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/insertMenu',\n          params:saveJson,\n          success:function(response){\n              \n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              var operateType = resultJson.operateType;\n              var n = app.menuGroupTree.getSelection()[0].parentNode;\n              n.expand();\n              var nodeOrder = 0;\n              if(n.lastChild){\n                if(n.lastChild.previousSibling){\n                  if(n.lastChild.previousSibling.get('idx')){\n                    nodeOrder = n.lastChild.previousSibling.get('idx');\n                  } \n                } \n              }\n              nodeOrder = nodeOrder + 1;\n              n.appendChild({text:saveJson.menuName, ID:saveJson.menuId, parent_id:saveJson.upId, NODE_TYPE:'M', NODE_ORDER:nodeOrder, children:[]});\n              n.commit();\n               Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n//               app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n\n          }\n        });\n      }else if(operatorType == '_append'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          upId : app.rightUpId.getValue(),\n          operateType :'_append'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/insertMenu',\n          params:saveJson,\n          success:function(response){\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              var operateType = resultJson.operateType;\n              var n = app.menuGroupTree.getSelection()[0];\n              n.expand();\n              var nodeOrder = 0;\n              if(n.lastChild){\n                if(n.lastChild.previousSibling){\n                  if(n.lastChild.previousSibling.get('IDX')){\n                    nodeOrder = n.lastChild.previousSibling.get('IDX');\n                  } \n                } \n              }\n              nodeOrder = nodeOrder + 1;\n              n.appendChild({text:saveJson.menuName, ID:saveJson.menuId, parent_id:saveJson.upId, NODE_TYPE:'M', NODE_ORDER:nodeOrder, children:[]});\n              n.commit();\n              Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n              //app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n\n          }\n        });\n      }else if(operatorType == '_reName'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          operateType :'_reName'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/updateMenu',\n          params:saveJson,\n          success:function(response){\n              Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              //var n = Wb.getSelNode(app.menuGroupTree);\n              var n = app.menuGroupTree.getSelectionModel().getSelection()[0];\n              //app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n              n.set('name',saveJson.menuName);\n              n.set('text',saveJson.menuName);\n              n.commit();\n          }\n        });\n      }\n        \n      },\n      failure: function(response,options){\n        //Ext.Msg.hide();\n        /*Ext.Msg.alert('','保存角色是失败：发送请求失败，服务器没有响应');*/\n        Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n      }\n    });\n\n    //updateRole.request(saveJson);\n  }else{\n  \n      var operatorType = app.rightType.getValue();\n\n      if(operatorType == '_after'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          upId : app.rightUpId.getValue(),\n          operateType :'_after'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/insertMenu',\n          params:saveJson,\n          success:function(response){\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              var operateType = resultJson.operateType;\n              var n = app.menuGroupTree.getSelection()[0].parentNode;\n              n.expand();\n              var nodeOrder = 0;\n              if(n.lastChild){\n                if(n.lastChild.previousSibling){\n                  if(n.lastChild.previousSibling.get('idx')){\n                    nodeOrder = n.lastChild.previousSibling.get('idx');\n                  } \n                } \n              }\n              nodeOrder = nodeOrder + 1;\n              n.appendChild({text:saveJson.menuName, ID:saveJson.menuId, parent_id:saveJson.upId, NODE_TYPE:'M', NODE_ORDER:nodeOrder, children:[]});\n              n.commit();\n              Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n//               app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n\n          }\n        });\n      }else if(operatorType == '_append'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          upId : app.rightUpId.getValue(),\n          operateType :'_append'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/insertMenu',\n          params:saveJson,\n          success:function(response){\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              var operateType = resultJson.operateType;\n              var n = app.menuGroupTree.getSelection()[0];\n              n.expand();\n              var nodeOrder = 0;\n              if(n.lastChild){\n                if(n.lastChild.previousSibling){\n                  if(n.lastChild.previousSibling.get('idx')){\n                    nodeOrder = n.lastChild.previousSibling.get('idx');\n                  } \n                } \n              }\n              nodeOrder = nodeOrder + 1;\n              n.appendChild({text:saveJson.menuName, ID:saveJson.menuId, parent_id:saveJson.upId, NODE_TYPE:'M', NODE_ORDER:nodeOrder, children:[]});\n              n.commit();\n              Wb.toast('{#xip_auth_roleMtp_success#}');\n              //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n//               app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n          }\n        });\n      }else if(operatorType == '_reName'){\n        var saveJson = {\n          menuId : app.rightMenuId.getValue(),\n          menuName : app.rightMenuName.getValue(),\n          menuGroupId : app.MNU_GROUP_ID.getValue(),\n          menuCode : app.rightMenuCode.getValue(),\n          operateType :'_reName'\n        };\n        Wb.request({\n          url :'m?xwl=xip/auth/role/role/DATA/updateMenu',\n          params:saveJson,\n          success:function(response){\n               Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n              //app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n              app.rightClickWin.hide();\n              var temp = response.responseText;\n              var resultJson = Ext.JSON.decode(temp);\n              \n              //var n = Wb.getSelNode(app.menuGroupTree);\n              var n = app.menuGroupTree.getSelectionModel().getSelection()[0];\n              n.set('name',saveJson.menuName);\n              n.set('text',saveJson.menuName);\n              n.commit();\n          }\n        });\n      }\n  \n  }\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_roleMtp_cancle#}","itemId":"btn_cancel_rightcilckwin","iconCls":"cancel_icon"},"events":{"click":"app.rightClickWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"syncWinBtns"},"children":[{"configs":{"text":"{#xip_auth_roleMtp_sync#}","itemId":"btn_confirm_syncWin","iconCls":"ajax_icon"},"events":{"click":"var rows = app.syncRoleGrid.getSelectionModel().getSelection();\n\nif(rows.length==0){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_selectSynRole#}');\n  return;\n}\n\nvar roleIds = \"\";\nvar roleName = \"\";\n\nfor(var i=0; i<rows.length; i++){\n  roleIds = roleIds + rows[i].get('ROLE_ID');\n  if(i != rows.length-1){\n    roleIds = roleIds + ',';\n  }\n  \n  roleName = roleName + rows[i].get('ROLE_NAME');\n  if(i != rows.length-1){\n    roleName = roleName + ',';\n  }\n}\n\n\nvar confirmMsg = '{#xip_auth_roleMtp_synInfoConf#}【'+roleName+'】{#xip_auth_roleMtp_synInfoCon#}';\n\nExt.Msg.confirm('{#xip_auth_roleMtp_alert#}',confirmMsg,function(a){\n  if(a=='yes'){\n    \n    Ext.Msg.wait('{#xip_auth_roleMtp_Synchronization#}');\n    Ext.Ajax.request({\n      url : '{#contextPath#}' +'/menuGroupEgisAction.do?method=syncRole',\n      params:{sourceRole:app.sourceRoleId.getValue(),syncRole:roleIds},\n      method: 'POST',\n      success: function(response,options){\n        Ext.Msg.hide();\n        var temp = response.responseText;\n        var obj = Ext.JSON.decode(temp);\n\n        app.syncWin.hide();\n        app.grid1.store.load();\n        Wb.toast(obj.msg);\n        \n        //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}',obj.msg);\n      },\n      failure: function(response,options){\n        var temp = response.responseText;\n        var obj = Ext.JSON.decode(temp);\n        /*Ext.Msg.alert('错误','同步失败,'+obj.msg);*/\n        Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n      }\n    });\n    \n  }\n}); "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_roleMtp_cancle#}","itemId":"btn_cancel_syncWin","iconCls":"cancel_icon"},"events":{"click":"app.syncWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"wins"},"children":[{"configs":{"tagConfigs":"tools:[{\n    type:'refresh',\n    tooltip: 'Refresh form Data',\n    hidden:true,\n    handler: function(event, toolEl, panelHeader) {\n        // refresh logic\n    }\n},\n{\n    type:'help',\n    tooltip: '<font color=\"red\" style=\"font-weight:bold\">{#xip_auth_roleMtp_alert#}<\/font><br>'+'{#xip_auth_roleMtp_alertInfoma#}'+'<\/br><a href=\"#\" onclick=\"app.alertMsg();\" style=\"text-decoration:none;color:red;padding-left:150px\">',\n    callback: function(panel, tool, event) {\n      app.window_demo.show();\n    }\n}]","height":"500","width":"650","layout":"fit","closeAction":"hide","buttons":"app.roleWinBtns","buttonAlign":"center","dialog":"false","itemId":"roleWin","modal":"true","maximizable":"true"},"events":{"show":"setTimeout(function(){\n//   var info = new Ext.ux.window.Notification({\n//   title: '提示',\n//   position: 'lc', //left-center\n//   iconCls: '',\n//   html: '从左边拖动文件夹(菜单)或功能到右边进行角色功能菜单的维护，'+'<br>'+\n//          '鼠标右键单击右边的功能树或其他的节点进行功能操作，'+'<br>'+\n//          '拖动右边的文件夹（菜单）或功能可以改变上下级和顺序.',\n//   bodyPadding: 15,\n//   bodyStyle: 'line-height:20px;',\n//   autoCloseDelay: 3000,\n//   slideBackDuration: 300,\n//   slideInAnimation: 'bounceOut',\n//   slideBackAnimation: 'easeIn'\n// });\n// info.show();\n   if(Wb.getCookie(\"roleMtpAlert\")!=='Y'){\n     Wb.toast('<font color=\"red\" style=\"font-weight:bold\">{#xip_auth_roleMtp_alert#}<\/font><br>'+'{#xip_auth_roleMtp_alertInfoma#}'+'<\/br><a href=\"#\" onclick=\"app.alertMsg();\" style=\"text-decoration:none;color:red;padding-left:150px\">'+'{#xip_auth_roleMtp_neverAlert#}'+'<\/a>');\n     //mesAlert=true;\n    }\n\n},100);\n\n","resize":"app.fieldset3.setHeight(app.roleForm.getHeight() - app.fieldset2.getHeight() );\napp.fieldset3.doLayout();\nif(app.roleWin.getHeight()==520||app.roleWin.getHeight()==500){\n  app.menuFunctionTree.setHeight(300);\n  app.menuGroupTree.setHeight(300);\n}else{\n  app.menuFunctionTree.setHeight(app.roleWin.getHeight() - app.fieldset2.getHeight()-140);\n  app.menuGroupTree.setHeight(app.roleWin.getHeight() - app.fieldset2.getHeight()-140);\n}\n//app.panel4.setHeight(app.roleForm.getHeight() - app.fieldset2.getHeight() );\n// app.treePanel.setWidth(app.roleForm.getWidth() - app.fieldset2.getWidth());\n// app.treePanel.doLayout();\n// app.panel4.doLayout();\n","close":"app.menGroupQuery.setValue(\"\");\napp.menFunQuery.setValue(\"\");\napp.grid1.store.load();"},"children":[{"configs":{"bodyStyle":"padding: 10px 10px 0px","region":"center","frame":"true","style":"border-width:0px","layout":"anchor","itemId":"roleForm"},"events":{"afterrender":"app.roleForm.getForm().trackResetOnLoad = true;"},"children":[{"configs":{"hidden":"true","itemId":"type"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ROLE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MNU_GROUP_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"anchor:'100%'","title":"{#xip_auth_roleMtp_roleinfo#}","layout":"column","itemId":"fieldset2"},"children":[{"configs":{"frame":"true","style":"border-width:0px","columnWidth":".5","border":"false","itemId":"panel1"},"children":[{"configs":{"allowBlank":"false","width":"280","labelAlign":"right","itemId":"ROLE_CODE","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_roleMtp_roleCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"width":"280","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#xip_auth_roleMtp_desc#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","columnWidth":".5","border":"false","itemId":"panel2"},"children":[{"configs":{"allowBlank":"false","width":"280","labelAlign":"right","itemId":"ROLE_NAME","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_roleMtp_roleName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"width":"280","labelAlign":"right","itemId":"ENABLE_FLAG","checked":"true","fieldLabel":"{#xip_auth_roleMtp_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"fieldset"},{"configs":{"tagConfigs":"anchor:'100%'","title":"{#xip_auth_roleMtp_menugroupinfo#}","layout":"column","itemId":"fieldset3"},"children":[{"configs":{"region":"west","style":"border-width:0px;","layout":"fit","columnWidth":".5","border":"false","itemId":"treePanel"},"children":[{"configs":{"rootVisible":"false","region":"center","animate":"false","store":"app.store","root":"{id:'rootNode',text:'{#xip_auth_roleMtp_funcMenu#}',expanded:true}","itemId":"menuFunctionTree","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: function(node,data,overModel,dropPosition,dropFunction,options){\n      return false;\n    },\n    drop: function(node,data,overModel,dropPosition,options){\n      return false;\n    }\n  }\n}"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"{#contextPath#}/userAuthoriseTreeCreateAction.do?method=getUserRoleTreeById","fields":"[{name:'text'},{name:'id'},{name:'parent_id'},{name:'node_type'},{name:'idx'},{name:'node_order'},{name:'childcount'}]"},"events":{"beforeload":"// operation.params.parentID = operation.node.get('ID');\n// operation.params.language = '{#language#}';\n// operation.params.roleId = '{#roleId#}';\noperation.params.menuGroupId = app.MNU_GROUP_ID.getValue();\noperation.params.language = '{#language#}';\noperation.params.userId='{#userId#}';"},"children":[],"expanded":false,"type":"treestore"},{"configs":{"height":"40","border":"false","itemId":"tbar"},"children":[{"configs":{"hidden":"true","glyph":"f103","itemId":"menuExpBtn"},"events":{"click":"app.menuFunctionTree.expandAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","glyph":"f102","itemId":"menuColBtn"},"events":{"click":"app.menuFunctionTree.collapseAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"menFunQuery"},"events":{"change":"app.menuFunctionTree.expandAll();","specialkey":"treeNodeQuery(text.value,'text',app.menuFunctionTree);\napp.menFunQueryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_roleMtp_query#}","itemId":"menFunQueryBtn","iconCls":"seek_icon"},"events":{"click":"treeNodeQuery(app.menFunQuery.getValue(),'text',app.menuFunctionTree);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"tree"}],"expanded":true,"type":"panel"},{"configs":{"height":"400","frame":"true","style":"border-width:0px","layout":"fit","width":"20","border":"false","itemId":"sepPanel"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"east","style":"border-width:0px","layout":"fit","columnWidth":".5","border":"false","itemId":"panel4"},"children":[{"configs":{"region":"center","multiSelect":"true","height":"300","animate":"false","store":"app.store","root":"{id:'groupRootNode',text:'{#xip_auth_roleMtp_menuGroup#}',expanded:true}","itemId":"menuGroupTree","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug1',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: function(node,data,overModel,dropPosition,dropFunction,options){\n        if(data.records.length>1){\n          Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_oneNode#}');\n          return false;\n        }\n       //判断角色是否是新增的角色 如果是则先进行保存\n        var operateType = app.type.getValue();\n        \n        if(!app.roleForm.getForm().isValid()){\n          Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n          return false;\n        }\n        \n        if(operateType=='_added'){\n          var isExistFlag = false;\n          Ext.Ajax.request({\n            url : 'm?xwl=xip/auth/role/role/DATA/getRolesByCode',\n            method: 'POST',\n            async: false, //发送同步请求\n            params:{roleCode:app.ROLE_CODE.getValue()},\n            success: function(response,options){\n              var json = Ext.JSON.decode(response.responseText);\n              isExistFlag = json.total;\n            },\n            failure: function(response,options){\n              //Ext.Msg.hide();\n              /*Ext.Msg.alert('','发送请求失败，服务器没有响应');*/\n              Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n            }\n          });\n\n          if(isExistFlag != 0){\n            Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_codeIsExist#}');\n            return false;\n          }\n          \n          var saveJson = {\n            roleId : app.ROLE_ID.getValue(),\n            roleCode : app.ROLE_CODE.getValue(),\n            roleName : app.ROLE_NAME.getValue(),\n            description : app.DESCRIPTION.getValue(),\n            enableFlag : app.ENABLE_FLAG.getValue()==true?'Y':'N',\n            menuGroupId : app.MNU_GROUP_ID.getValue()\n          };\n          \n          Ext.Ajax.request({\n            url : 'm?xwl=xip/auth/role/role/DATA/insertRole',\n            method: 'POST',\n            params:saveJson,\n            success: function(response,options){\n              //var json = Ext.JSON.decode(response.responseText);\n              //isExistFlag = json.total;\n              app.type.setValue('_modified');\n            },\n            failure: function(response,options){\n              //Ext.Msg.hide();\n              /*Ext.Msg.alert('','保存角色是失败：发送请求失败，服务器没有响应');*/\n              Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n            }\n          });\n          \n          //insertRole.request(saveJson); \n        }else if(operateType=='_modified'){\n          if(app.roleForm.getForm().isDirty()==true){\n            var isExistFlag = false;\n            Ext.Ajax.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getRoleByIdAndCode',\n              method: 'POST',\n              async: false, //发送同步请求\n              params:{roleCode:app.ROLE_CODE.getValue(),roleId:app.ROLE_ID.getValue()},\n              success: function(response,options){\n                var json = Ext.JSON.decode(response.responseText);\n                isExistFlag = json.total;\n              },\n              failure: function(response,options){\n                //Ext.Msg.hide();\n                /*Ext.Msg.alert('','发送请求失败，服务器没有响应');*/\n                Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n              }\n            });\n\n            if(isExistFlag != 0){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_codeIsExist#}');\n              return false;\n            }\n          \n            var saveJson = {\n              roleId : app.ROLE_ID.getValue(),\n              roleCode : app.ROLE_CODE.getValue(),\n              roleName : app.ROLE_NAME.getValue(),\n              description : app.DESCRIPTION.getValue(),\n              enableFlag : app.ENABLE_FLAG.getValue()==true?'Y':'N',\n              menuGroupId : app.MNU_GROUP_ID.getValue()\n            };\n            \n            Ext.Ajax.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/updateRole',\n              method: 'POST',\n              params:saveJson,\n              success: function(response,options){\n                //var json = Ext.JSON.decode(response.responseText);\n                //isExistFlag = json.total;\n              },\n              failure: function(response,options){\n                //Ext.Msg.hide();\n                /*Ext.Msg.alert('','保存角色是失败：发送请求失败，服务器没有响应');*/\n                Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n              }\n            });\n          \n            //updateRole.request(saveJson);\n          } \n        }\n    \n    \n      //Wb.saveNodePos(Wb.getNode(data.item));\n      \n      //判断拖拽来的节点的来源\n      var pNode = data.records[0].parentNode;\n      while(true){\n        if(pNode.parentNode!=null){\n          pNode = pNode.parentNode;\n        }else{\n          sourceRootNodeId = pNode.data.id;\n          break;\n        }\n      }\n       //---------如果左边树选中的节点没有子节点不能右拖---------\n      if(data.records[0].get('MNU_GROUP_ID')==undefined){\n        var nodeFlag = false;\n        if(data.records[0].get('childcount')>0){\n        }else{\n          if(data.records[0].get('node_type')==='M'){\n            return false;\n          }else{\n            return true;\n          }\n        }\n      }\n      return true;\n    },\n    drop: function(node,data,overModel,dropPosition,options){\n      Wb.mask(app.menuGroupTree);\n      \n      //overModel.expand(false,function(){\n        Wb.unmask(app.menuGroupTree);\n        \n        var parentId = ''; \n        var srcId = data.records[0].get('id');\n        var menuGroupId = app.MNU_GROUP_ID.getValue();\n        var orderIndex = '';\n        var overModelId = '';\n\n        if(overModel.get('id')=='groupRootNode'){\n           parentId = '-1';\n           orderIndex = data.records[0].previousSibling ? data.records[0].previousSibling.get('IDX')+1 : 0;\n           if(data.records[0].previousSibling!=null){\n               if(data.records[0].previousSibling.get('IDX')==undefined){\n                 orderIndex = data.records[0].previousSibling ? data.records[0].previousSibling.get('idx')+1 : 0;\n               }\n            }\n        }else{\n          if(dropPosition=='append'){//overModel\n            parentId = overModel.get('ID');\n            orderIndex = data.records[0].previousSibling ? data.records[0].previousSibling.get('IDX')+1 : 0;\n            if(data.records[0].previousSibling!=null){\n               if(data.records[0].previousSibling.get('IDX')==undefined){\n                 orderIndex = data.records[0].previousSibling ? data.records[0].previousSibling.get('idx')+1 : 0;\n               }\n            }\n          }else{//before或者after:添加到overModel节点前或者后\n            if(overModel.parentNode.get('id')=='groupRootNode'){\n              parentId = '-1';\n            }else{\n              parentId = overModel.parentNode.get('id');\n            }\n            if(dropPosition=='before'){\n              orderIndex = overModel.get(\"IDX\");\n            }else if(dropPosition=='after'){\n              orderIndex = overModel.get(\"IDX\")+1;\n            }\n          }\n        }\n\n        //判断角色是否是新增的角色 如果是则先进行保存\n        var operateType = app.type.getValue();\n        /*if(operateType=='_added'){\n          if(!roleForm.getForm().isValid()){\n            Ext.Msg.alert('提示','角色信息不完整，请确认!');\n            return false;\n          }\n\n          var isExistFlag = false;\n          Ext.Ajax.request({\n            url : 'main?xwl=23WEKSCAZCZX',\n            method: 'POST',\n            async: false, //发送同步请求\n            params:{roleCode:Ext.getCmp('ROLE_CODE').getValue()},\n            success: function(response,options){\n              var json = Ext.JSON.decode(response.responseText);\n              isExistFlag = json.total;\n            },\n            failure: function(response,options){\n              Ext.Msg.hide();\n              Ext.Msg.alert('','发送请求失败，服务器没有响应');\n            }\n          });\n\n          if(isExistFlag != 0){\n            Ext.Msg.alert('提示','角色编码已存在!');\n            return;\n          }\n        }*/\n\n        var parentId = ''; \n       if(data.records[0].get('MNU_GROUP_ID')==undefined){\n        var srcId = data.records[0].get('id');\n       }else{\n         var srcId = data.records[0].get('ID');\n       }\n        \n        var menuGroupId = app.MNU_GROUP_ID.getValue();\n        var index = '';\n        \n        if(overModel.get('id')=='groupRootNode'){\n           parentId = '-1';\n        }else{\n          if(dropPosition=='append'){//overModel\n               parentId = overModel.get('ID');\n        \n          }else{//before或者after:添加到overModel节点前或者后\n            \n            if(overModel.parentNode.get('id')=='groupRootNode'){\n              parentId = '-1';\n            }else{\n              if(data.records[0].get('MNU_GROUP_ID')==undefined){\n                parentId = overModel.parentNode.get('id');\n               }else{\n                 parentId = overModel.parentNode.get('ID');\n               }\n        \n              \n            }\n          }\n        }\n        if(sourceRootNodeId=='rootNode'){//来源为左面的树\n          //alert(data.records[0].hasChildNodes());\n          Ext.Ajax.request({\n            url : '{#contextPath#}' +'/menuGroupEgisAction.do?method=saveMenuGroup',\n            params:{\n              parentId:parentId,\n              srcId:srcId,\n              menuGroupId:menuGroupId,\n              dropPosition:dropPosition,\n              orderIndex:orderIndex,\n              flag :'Y',\n              userId:'{#userId#}'\n            },\n            method: 'POST',\n            success: function(response,options){\n              app.menGroupQuery.setValue(\"\");\n              app.menFunQuery.setValue(\"\");\n\n              app.mnuStore.load({params:{mnu_group_id:app.MNU_GROUP_ID.getValue(),fun_tree_id:data.records[0].get('id')},callback:function(){\n                  data.records[0].set('parent_id',parentId);\n                  data.records[0].set('NODE_TYPE',data.records[0].get('node_type'));\n                  //data.records[0].set('checked',false);\n                  data.records[0].set('ID',app.mnuStore.getAt(0).get('MNU_ID'));\n                  data.records[0].set('id',app.mnuStore.getAt(0).get('MNU_ID'));\n                  var content = app.menuGroupTree.store.getNodeById(app.mnuStore.getAt(0).get('MNU_ID'));//获取要刷新的节点\n                  var opions = {node:content};//进行封装                                \n                  app.menuGroupTree.store.load(opions);//局部加载\n              }});\n             // app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()},callback:function(){\n                \n             // }});\n             // app.menuFunctionTree.store.load({params:{menuGroupId:app.MNU_GROUP_ID.getValue()},callback:function(){\n                \n             // }});\n\n            },\n            failure: function(response,options){\n              /*Ext.Msg.alert('错误','失败，服务器没有响应!');*/\n              Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n            }\n          }); \n        }else if(sourceRootNodeId=='groupRootNode'){//来源于本课树\n          Ext.Ajax.request({\n            url : 'm?xwl=xip/auth/role/role/DATA/updategroupFuncMenu',\n            params:{\n              upId:parentId,\n              menuId:srcId,\n              orderIndex:orderIndex\n            },\n            method: 'POST',\n            success: function(response,options){\n              //var temp = response.responseText;\n              //var obj = Ext.JSON.decode(temp);\n              data.records[0].set('parent_id',parentId);\n              data.records[0].set('IDX',orderIndex);\n              data.records[0].commit();\n              overModel.eachChild(function(x) {\n               var i = x.get('idx');\n               if (i >= orderIndex) {\n                  x.set('idx', i + 1);\n                 x.commit();\n               }\n              });\n            },\n            failure: function(response,options){\n              /*Ext.Msg.alert('错误','失败，服务器没有响应!!');*/\n              Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n            }\n          }); \n        }\n        \n     // });\n      \n    }\n  }\n}"},"events":{"checkchange":"node.cascadeBy(function(n){\n    n.set('checked', checked); \n});\n    checkParent(node);\nfunction checkParent(node){\n  node = node.parentNode;\n  if(!node) return;\n  var checkP=false;\n  node.cascadeBy(function (n)\n  {\n  if (n != node) {\n  if (n.get('checked') == true) {\n  checkP = true;\n  }\n  }\n  });\n  node.set('checked', checkP);\n  checkParent(node);\n}","tagEvents":"itemcontextmenu:function(view,record,item,index,e,options){\n  e.preventDefault();\n  e.stopEvent();\n  var id = record.get('id');\n  var nodeType = record.get('node_type');\n  if(record.get('node_type')==undefined){\n    nodeType = record.get('NODE_TYPE');\n  }\n  var parentId = record.get('parent_id');\n  var nodeId = record.get('ID');\n  var nodemenu;\n\n  if(id == 'groupRootNode'){//跟节点\n    nodemenu = new Ext.menu.Menu({\n      items:[\n        {text: '{#xip_auth_roleMtp_addMenu#}',handler:function(){\n\n          if(!app.roleForm.getForm().isValid()){\n            Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n            return false;\n          }\n\n\n          //Wb.getSelNode(app.menuGroupTree).expand();\n          app.menuGroupTree.expand();\n          app.rightClickWin.show();\n          app.rightType.setValue('_append');\n          app.rightUpId.setValue(-1);\n          Wb.request({\n            url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n            success:function(response){\n              var temp = response.responseText;\n              var resultJson = Wb.decode(temp);\n              app.rightMenuId.setValue(resultJson.uuid);\n            }\n          });\n          app.rightMenuCode.setValue('addMenu'+new Date().getTime());\n        }}\n      ]\n    });\n  }else{\n    if(nodeType == 'M'){//菜单\n      nodemenu = new Ext.menu.Menu({\n        items:[\n          {text: '{#xip_auth_roleMtp_addSameMenu#}',handler:function(){\n            if(!app.roleForm.getForm().isValid()){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n              return false;\n            }\n            //rightMenuCode.show();\n            //rightClickWin.setHeight(125);\n            app.rightClickWin.show();\n            app.rightType.setValue('_after');\n            app.rightUpId.setValue(parentId);   \n            Wb.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n              success:function(response){\n                var temp = response.responseText;\n                var resultJson = Wb.decode(temp);\n                app.rightMenuId.setValue(resultJson.uuid);\n              }\n            });\n           \n            app.rightMenuCode.setValue('addMenu'+new Date().getTime());\n          }},\n          {text: '{#xip_auth_roleMtp_addMenu#}',handler:function(){\n            if(!app.roleForm.getForm().isValid()){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n              return false;\n            }\n\n            //rightMenuCode.show();\n            //rightClickWin.setHeight(125);\n            \n            //Wb.getSelNode(app.menuGroupTree).expand();\n            app.menuGroupTree.getSelection()[0].expand();\n            app.rightClickWin.show();\n            app.rightType.setValue('_append');\n            app.rightUpId.setValue(nodeId);   \n            Wb.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n              success:function(response){\n                var temp = response.responseText;\n                var resultJson = Wb.decode(temp);\n                app.rightMenuId.setValue(resultJson.uuid);\n              }\n            });\n            app.rightMenuCode.setValue('addMenu'+new Date().getTime());\n          }},\n          {text: '{#xip_auth_roleMtp_rename#}',handler:function(){\n            if(!app.roleForm.getForm().isValid()){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n              return false;\n            }\n             //-----------------只能选择一个菜单-------------\n            var selectLength = app.menuGroupTree.getSelection().length;\n            if(selectLength>1){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_mnuOper#}');\n              return;\n            }else{\n            }\n\n            //rightMenuCode.hide();\n            //rightClickWin.setHeight(100);\n\n            app.rightClickWin.show();\n            app.rightType.setValue('_reName');\n            app.rightUpId.setValue(parentId);   \n            app.rightMenuId.setValue(nodeId); \n          }},\n          {text: '{#xip_auth_roleMtp_deleteMenu#}',handler:function(){\n            if(!app.roleForm.getForm().isValid()){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n              return false;\n            }\n             //-----------------只能选择一个菜单-------------\n            var selectLength = app.menuGroupTree.getSelection().length;\n            if(selectLength>1){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_mnuOper#}');\n              return;\n            }else{\n            }\n            Ext.Msg.confirm('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_confirm#}',function(a){\n              if(a=='yes'){\n                Ext.Ajax.request({\n                  url : '{#contextPath#}' +'/menuGroupEgisAction.do?method=deleteMenuFuncById',\n                  params:{\n                    menuFuncId:nodeId\n                  },\n                  method: 'POST',\n                  success: function(response,options){\n                    Wb.toast('{#xip_auth_roleMtp_success#}');\n                    //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n                    app.menGroupQuery.setValue(\"\");\n                    app.menFunQuery.setValue(\"\");\n                    var node = app.menuGroupTree.getSelectionModel().getSelection()[0];\n                    var parentNode = node.parentNode;\n                    parentNode.removeChild(node);\n                    parentNode.commit();\n                    //app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n                    app.menuFunctionTree.store.load({params:{menuGroupId:app.MNU_GROUP_ID.getValue()}});\n                    //app.menuFunctionTree.expandAll();\n                  },\n                  failure: function(response,options){\n                    /*Ext.Msg.alert('错误','失败，服务器没有响应');*/\n                    Wb.toast('{#xip_auth_roleMtp_reqFailure#}');\n                  }\n                });\n              }\n            });\n          }}\n        ]\n      });\n    }else if(nodeType == 'F'){//功能\n      nodemenu = new Ext.menu.Menu({\n        items:[\n           {text: '{#xip_auth_roleMtp_rename#}',handler:function(){\n            if(!app.roleForm.getForm().isValid()){\n              /*Ext.Msg.alert('提示','角色信息不完整，请确认!');*/\n              Wb.toast('{#xip_auth_roleMtp_infoIncomp#}');\n              return false;\n            }\n             //-----------------只能选择一个功能-------------\n            var selectLength = app.menuGroupTree.getSelection().length;\n            if(selectLength>1){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_funOper#}');\n              return;\n            }else{\n            }\n            //rightMenuCode.hide();\n            //rightClickWin.setHeight(100);\n\n            app.rightClickWin.show();\n            app.rightType.setValue('_reName');\n            app.rightUpId.setValue(parentId);   \n            app.rightMenuId.setValue(nodeId); \n            app.MNU_GROUP_ID.setValue(record.get('MNU_GROUP_ID'));\n             app.rightMenuCode.setValue(record.get('MNU_TREE_CODE'));\n          }},\n          \n          {text: '{#xip_auth_roleMtp_deleteFunc#}',handler:function(){\n            if(!app.roleForm.getForm().isValid()){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_infoIncomp#}');\n              return false;\n            }\n            //var selectLength = app.menuGroupTree.getChecked().length;\n            var selectLength = app.menuGroupTree.getSelection().length;\n            if(selectLength==0){\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_selDelFunc#}');\n              return;\n            }\n            var funFlag = false;\n            for(var i=0; i<selectLength; i++){\n              //var n = app.menuGroupTree.getChecked()[i];\n              var n = app.menuGroupTree.getSelection()[i];\n              if(n.data.NODE_TYPE == 'F'){\n                 funFlag = true;\n              }\n            }\n            if(funFlag){}else{\n              Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_selDelFunc#}');\n              return;\n            }\n            Ext.Msg.confirm('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_confirm#}',function(a){\n              if(a=='yes'){\n                //删除功能\n                var delIds = \"\";\n\n                for(var i=0; i<selectLength; i++){\n                  //var n = app.menuGroupTree.getChecked()[i];\n                  var n = app.menuGroupTree.getSelection()[i];\n                  if(n.data.NODE_TYPE == 'F'){\n                    var id = \"'\" + n.data.ID + \"'\";\n                    if(delIds==''){\n                      delIds = id;\n                    }else{\n                      delIds = delIds + ',' + id;    \n                    }\n                  }\n                }\n                Wb.request({\n                  url : 'm?xwl=xip/auth/role/role/DATA/deleteFuns',\n                  params:{delIds:delIds},\n                  success:function(){\n                    \n                    //var selectLength = app.menuGroupTree.getChecked().length;\n                    var selectLength = app.menuGroupTree.getSelection().length;\n                    for(var i=selectLength-1; i>=0; i--){\n                      //var n = app.menuGroupTree.getChecked()[i];\n                      var n = app.menuGroupTree.getSelection()[i];\n                      if(n.data.NODE_TYPE == 'F'){\n                        var pNode = n.parentNode;\n                        if(pNode){\n                          pNode.removeChild(n);\n                          pNode.commit();\n                        }\n                      }\n                    }\n                    Wb.toast('{#xip_auth_roleMtp_success#}');\n                    //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_success#}');\n                    app.menGroupQuery.setValue(\"\");\n                    app.menFunQuery.setValue(\"\");\n                    //app.menuGroupTree.store.load({params:{menuGroupId2:app.MNU_GROUP_ID.getValue()}});\n                    app.menuFunctionTree.store.load({params:{menuGroupId:app.MNU_GROUP_ID.getValue()}});\n                    //app.menuFunctionTree.expandAll();\n                  }\n                });\n              }\n            });\n          }}\n        ]\n      });\n    }\n  }\n  nodemenu.showAt(e.getPoint());\n  \n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/auth/role/roleMtp/DATA/getMenuGroupTree"},"events":{"expand":"expStatus = true;","load":"app.menuGroupTree.getRootNode().expand();","beforeload":"operation.params.parentID=operation.node.get('ID');\noperation.params.menuGroupId2 = app.MNU_GROUP_ID.getValue();"},"children":[],"expanded":false,"type":"treestore"},{"configs":{"height":"40","border":"false","itemId":"tbar"},"children":[{"configs":{"hidden":"true","glyph":"f103","itemId":"groupExpBtn"},"events":{"click":"app.menuGroupTree.expandAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","glyph":"f102","itemId":"groupColBtn"},"events":{"click":"app.menuGroupTree.collapseAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"menGroupQuery"},"events":{"change":"app.menuGroupTree.expandAll();","focus":"// if(!Ext.isEmpty(app.menGroupQuery.getValue())){\n//    app.menuGroupTree.expandAll();\n// }","blur":"\n","specialkey":"treeNodeQuery(text.value,'text',app.menuGroupTree);\n"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_roleMtp_query#}","itemId":"menGroupQueryBtn","iconCls":"seek_icon"},"events":{"click":"treeNodeQuery(app.menGroupQuery.getValue(),'text',app.menuGroupTree);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"tree"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_roleMtp_rolecopy#}","height":"220","layout":"fit","width":"330","closeAction":"hide","buttons":"app.copyWinBtns","buttonAlign":"center","border":"false","dialog":"false","itemId":"copyRoleWin","modal":"true"},"children":[{"configs":{"bodyStyle":"padding: 10px 10px 0px","frame":"false","layout":"form","border":"false","itemId":"copyRoleForm"},"children":[{"configs":{"labelWidth":"120","allowBlank":"false","queryMode":"local","displayField":"ROLE_NAME","valueField":"MNU_GROUP_ID","labelAlign":"right","itemId":"roleCombox","fieldLabel":"<font style=\"color:red\">*<\/font>{#xip_auth_roleMtp_Sourcerole#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/roleMtp/DATA/getRolesCombox"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"copyRoleCode","fieldLabel":"<font style=\"color:red\">*<\/font>{#xip_auth_roleMtp_newroleCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"copyRoleName","fieldLabel":"<font style=\"color:red\">*<\/font>{#xip_auth_roleMtp_newroleName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"copyRoleDesc","fieldLabel":"{#xip_auth_roleMtp_newdesc#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"copyRoleEnableFlag","checked":"true","fieldLabel":"{#xip_auth_roleMtp_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"height":"100","layout":"fit","width":"380","closeAction":"hide","buttonAlign":"center","buttons":"app.rightClickWinBtns","dialog":"false","itemId":"rightClickWin","modal":"true"},"events":{"show":"app.rightMenuName.setValue('');"},"children":[{"configs":{"frame":"true","layout":"form","itemId":"rightClickForm"},"children":[{"configs":{"hidden":"true","itemId":"rightType"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"rightUpId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"rightMenuId"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"60","hidden":"true","labelAlign":"right","itemId":"rightMenuCode","fieldLabel":"{#xip_auth_roleMtp_menuCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"rightMenuName","fieldLabel":"{#xip_auth_roleMtp_menuName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_roleMtp_sync#}","height":"500","layout":"fit","width":"460","closeAction":"hide","buttons":"app.syncWinBtns","buttonAlign":"right","dialog":"false","itemId":"syncWin","modal":"true"},"events":{"close":"app.syncRoleName.setValue('');"},"children":[{"configs":{"hidden":"true","itemId":"sourceRoleId"},"children":[],"expanded":false,"type":"text"},{"configs":{"multiSelect":"true","selType":"checkboxmodel","itemId":"syncRoleGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/auth/role/roleMtp/DATA/getSyncRole"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"labelWidth":"40","labelAlign":"right","itemId":"syncRoleName"},"events":{"specialkey":"app.syncRoleGrid.store.load({params:{sourceRoleId:app.sourceRoleId.getValue(),syncRoleName:app.syncRoleName.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_query#}","itemId":"btn_query_syncgrid","iconCls":"seek_icon"},"events":{"click":"app.syncRoleGrid.store.load({params:{sourceRoleId:app.sourceRoleId.getValue(),syncRoleName:app.syncRoleName.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_reset#}","itemId":"btn_reset_syncgrid","iconCls":"refresh_icon"},"events":{"click":"app.syncRoleName.setValue('');\napp.syncRoleGrid.store.load({params:{sourceRoleId:app.sourceRoleId.getValue(),syncRoleName:app.syncRoleName.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","xtype":"rownumberer","align":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"id","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID_syncRoleGrid"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_roleMtp_roleCode#}","width":"150","dataIndex":"ROLE_CODE","itemId":"ROLE_CODE_syncRoleGrid"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_roleMtp_roleName#}","width":"150","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_syncRoleGrid"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_roleMtp_demo#}","height":"490","width":"650","closeAction":"hide","itemId":"window_demo","modal":"true"},"children":[{"configs":{"src":"xip/roleDemo.gif","itemId":"image1"},"children":[],"expanded":false,"type":"image"}],"expanded":false,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#xip_auth_roleMtp_conditionQuery#}","style":"padding-top:8px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"120","width":"250","labelAlign":"right","itemId":"roleCodeName","fieldLabel":"{#xip_auth_roleMtp_roleCodeName#}"},"events":{"specialkey":"app.grid1.store.load();"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"250","labelAlign":"right","itemId":"funCodeName","fieldLabel":"{#xip_auth_roleMtp_funCodeName#}"},"events":{"specialkey":"app.grid1.store.load();"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_roleMtp_query#}","itemId":"quertBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"app.grid1.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_roleMtp_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"20"},"events":{"click":"app.roleCodeName.setValue('');\napp.funCodeName.setValue('');\napp.grid1.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","multiSelect":"false","itemId":"grid1","simpleSelect":"false"},"events":{"itemdblclick":"app.btn_edit.fireEvent('click');"},"children":[{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/role/roleMtp/DATA/getRoles"},"events":{"beforeload":"store.getProxy().extraParams.funCodeName = app.funCodeName.getValue();\nstore.getProxy().extraParams.roleCodeName = app.roleCodeName.getValue();\nstore.getProxy().extraParams.userId = '{#userId#}';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"角色id","hidden":"true","width":"120","dataIndex":"ROLE_ID","itemId":"ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_roleMtp_roleCode#}","width":"180","dataIndex":"ROLE_CODE","itemId":"ROLE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_roleMtp_roleName#}","width":"180","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_roleMtp_desc#}","width":"300","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_roleMtp_enable#}","align":"center","width":"100","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG_COL","renderer":"if(value=='Y'){\n  return '{#xip_auth_roleMtp_Y#}';\n}else if(value=='N'){\n  return \"<font color='red'>{#xip_auth_roleMtp_N#}<\/font>\";\n}else{\n  return '';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"编码id","hidden":"true","dataIndex":"MNU_GROUP_ID","itemId":"MNU_GROUP_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_add#}","itemId":"btn_add","iconCls":"record_add_icon"},"events":{"click":"app.type.setValue('');\napp.ROLE_ID.setValue('');\napp.MNU_GROUP_ID.setValue('');\napp.ROLE_CODE.setValue('');\napp.DESCRIPTION.setValue('');\napp.ROLE_NAME.setValue('');\napp.ENABLE_FLAG.setValue(true);\n\nvar win = new Ext.window.Window(app._roleWin);\nwin.setTitle('{#xip_auth_roleMtp_addTitle#}');\nwin.show();\n//win.doLayout(function(){app.TEST.fireEvent('click');});\n\n\n\napp.type.setValue('_added');\nWb.request({\n  url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n  success:function(response){\n    var temp = response.responseText;\n    var resultJson = Wb.decode(temp);\n    app.ROLE_ID.setValue(resultJson.uuid);\n  }\n});\nWb.request({\n  url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n  success:function(response){\n    var temp = response.responseText;\n    var resultJson = Wb.decode(temp);\n    app.MNU_GROUP_ID.setValue(resultJson.uuid);\n  }\n});\n//app.ROLE_ID.setValue(Wb.getUuid());\n//app.MNU_GROUP_ID.setValue(Wb.getUuid());\n\napp.menuGroupTree.store.load({params:{menuGroupId2:'-1'}});\n//app.menuFunctionTree.expandAll();\n//app.menuFunctionTree.store.load();\n\n//Wb.toast('<font color=\"red\" style=\"font-weight:bold\">提示<\/font><br>'+'从左边拖动文件夹(菜单)或功能到右边进行角色功能菜单的维护，鼠标右键单击右边的功能树或其他的节点进行功能操作，拖动右边的文件夹（菜单）或功能可以改变上下级和顺序.');\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_edit#}","itemId":"btn_edit","iconCls":"record_edit_icon"},"events":{"click":"var rows = app.grid1.getSelectionModel().getSelection();\nif(rows.length===0 || rows.length>1){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_selRecord#}');\n}else{\n  var id = rows[0].data.ROLE_ID;\n  app.singleRoleStore.load({params:{roleId:id}});\n  //Wb.edit(app.grid1,app.roleWin);\n  app.roleWin.show();\n  app.roleWin.setTitle('{#xip_auth_roleMtp_editTitle#}');\n  app.ROLE_CODE.setReadOnly(true);\n  app.type.setValue('_modified');\n \n  //menuFunctionStore.load();\n  \n  \n}\n//Wb.toast('<font color=\"red\" style=\"font-weight:bold\">提示<\/font><br>'+'从左边拖动文件夹(菜单)或功能到右边进行角色功能菜单的维护，鼠标右键单击右边的功能树或其他的节点进行功能操作，拖动右边的文件夹（菜单）或功能可以改变上下级和顺序.');\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_delete#}","itemId":"btn_del","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.grid1.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_selRecord#}');\n}else{\n  Ext.Msg.confirm('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_confirm#}',function(a){\n    if(a=='yes'){\n      var id = rows[0].data.MNU_GROUP_ID;\n      var roleId = rows[0].data.ROLE_ID;\n      Wb.request({\n        url : 'm?xwl=xip/auth/role/roleMtp/DATA/deleteRole',\n        params:{roleId:roleId,menuGroupId:id},\n        success:function(response){\n          Wb.toast('{#xip_auth_roleMtp_deleteSuc#}');\n          //Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_deleteSuc#}');\n          app.grid1.store.reload();\n        }\n      });\n    }\n  }); \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_copy#}","itemId":"btn_copy","iconCls":"copy_icon"},"events":{"click":"var rows = app.grid1.getSelectionModel().getSelection();\nif(rows.length===0 || rows.length>1){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_selRecord#}');\n}else{\n  var win = new Ext.window.Window(app._copyRoleWin);\n  win.show();\n  app.roleCombox.store.load(function(){\n     app.roleCombox.setValue(rows[0].data.MNU_GROUP_ID);\n     app.roleCombox.setRawValue(rows[0].data.ROLE_NAME);\n  });\n  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_roleMtp_sync#}","itemId":"btn_sync","iconCls":"ajax_icon"},"events":{"click":"var rows = app.grid1.getSelectionModel().getSelection();\nif(rows.length===0 || rows.length>1){\n  Ext.Msg.alert('{#xip_auth_roleMtp_alert#}','{#xip_auth_roleMtp_Sourcerole#}');\n}else{\n  var id = rows[0].data.ROLE_ID;\n  \n  app.sourceRoleId.setValue(id);\n  \n  app.syncRoleGrid.store.load({params:{sourceRoleId:id}});\n  \n  app.syncWin.setTitle(' {#xip_auth_roleMtp_Sourcerole#}<font style=\"color:red\">【'+rows[0].data.ROLE_NAME+'】<\/font>,{#xip_auth_roleMtp_synRole#}');\n  \n  app.syncWin.show();\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item6"},"children":[],"expanded":false,"type":"item"}],"expanded":false,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}