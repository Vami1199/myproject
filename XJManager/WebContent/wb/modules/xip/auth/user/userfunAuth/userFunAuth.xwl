{"inframe":false,"title":"用户功能授权","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","initScript":"request.setAttribute(\"contextPath\",request.getContextPath());\nrequest.setAttribute(\"delImageSrc\",request.getContextPath()+\"/xip/images/cut.gif\");\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/auth/user/userfunAuth/userFunAuth\");","itemId":"module"},"events":{"finalize":"//选中父节点的下的所有子节点\n\nfunction childChecked(parentNode,checked){\n  parentNode.expand();\n  //选中自己\n  parentNode.set({checked:checked});\n\n  if(parentNode.data.NODE_TYPE === 'F' && checked === true){\n     var tempJson={FUN_TREE_ID:parentNode.get('ID'),FUN_TREE_CODE:parentNode.get('FUN_TREE_CODE'),FUN_TREE_NAME:parentNode.get('text')};      \n     app.Fungrid.store.add(tempJson);\n  }\n  if(parentNode.data.NODE_TYPE === 'F' && checked === false){\n    var record = app.Fungrid.store.findRecord('FUN_TREE_ID',parentNode.get('ID'));\n    app.Fungrid.store.remove(record);\n  }\n  //计算选择的数\n  allcount();\n  if(parentNode.hasChildNodes){\n    parentNode.eachChild(function(childNode){\n      childChecked(childNode,checked);\n    });\n  }\n}\n//选中子节点的时候，同时选中父节点\nfunction parentChecked(childNode,checked){\n  childNode.set({checked:checked});\n  var parentNode = childNode.parentNode;\n  if(parentNode){\n    var flag = false;\n    parentNode.eachChild(function(node){\n      if(node.data.checked === true){\n        flag = true;\n      }\n    });\n    //取消选中时\n    if(checked === false){\n      if(!flag){\n        parentChecked(parentNode,checked);\n      }  \n    }else{\n      if(flag){\n        parentChecked(parentNode,checked);\n      }\n    }  \n  }\n  \n}","initialize":"var statusR;\nvar statusU;\nvar statusD;\nvar statusP;\n\napp.copyFun = function ()\n{ \n\n  app.SelectFunWin.setTitle('<center>{#xip_auth_userfunauth_selectedFun#}<\/center>');  /*已选功能*/\n  app.SelectFunWin.show();\n\n};\napp.copyUDP = function ()\n{ \n\n  app.SelectUDPWin.setTitle('<center>{#xip_auth_userfunauth_selectedData#}<\/center>');/*已选数据*/\n  app.SelectUDPWin.show();\n\n};\n//删除右弹框数据\napp.deleteCopyAllFun= function (){ \n  var record=app.UDPgrid.getSelectionModel().getSelection();\n\n  var type = record[0].get('TYPE');\n\n  app.UDPgrid.store.remove(record);\n\n  //取出类型进行判断\n  //判断用户\n  var rid=record[0].data.TARGET_ID;\n  if(type=='U'){\n    //点击删除 去掉勾选的对号\n    for(var j=0;j<app.usergrid.store.getCount();j++){\n      var r_id=app.usergrid.store.getAt(j).get('USER_ID');\n      if(rid===r_id){\n\n        app.usergrid.getSelectionModel().deselect(app.usergrid.store.getAt(j));\n        break;\n      }\n\n    }\t\n  }\n\n  //判部门户\n  if(type=='D'){\n    for(var l=0;l<app.deptgrid.store.getCount();l++){\n      var r_id1=app.deptgrid.store.getAt(l).get('DEPT_ID');\n      if(rid===r_id1){\n\n        app.deptgrid.getSelectionModel().deselect(app.deptgrid.store.getAt(l));\n        break;\n      }\n\n    }\t\n  }\n\n  //判部岗位\n  if(type=='P'){\n    for(var k=0;k<app.postgrid.store.getCount();k++){\n      var r_id2=app.postgrid.store.getAt(k).get('POST_ID');\n      if(rid===r_id2){\n\n        app.postgrid.getSelectionModel().deselect(app.postgrid.store.getAt(k));\n        break;\n      }\n\n    }\t\n  }\n\n  allcount1();\n};\n\n//删除全部已选的用户、部门、岗位\napp.deleteAlludp =   function (){\n  Ext.Msg.confirm('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_qdscqbyxdyhbmgw#}',function(btn){/*'提示','确定删除全部已选的用户、部门、岗位?'*/\n    if(btn == 'yes'){\n      app.UDPgrid.store.removeAll();\n\n      app.usergrid.getSelectionModel().deselectAll();\n      app.deptgrid.getSelectionModel().deselectAll();\n      app. postgrid.getSelectionModel().deselectAll();\n\n      allcount1();\n    }\n  });\n};\n//删除左弹框数据\n app.deleteCopyFun=function (){ \n   \n    var record=app.Fungrid.getSelectionModel().getSelection();\n    app.Fungrid.store.remove(record);\n    //点击删除 去掉勾选的对号\n    var uid=record[0].get('FUN_TREE_ID');\n    var selectLength = app.menuFunctionTree.getChecked().length;\n\n    for(var j=0;j<selectLength;j++){     \n      var res=app.menuFunctionTree.getChecked();\n      var type=res[j].get('NODE_TYPE');\n      if(type=='F'){\n        if(uid===res[j].get('ID')){\n          res[j].set('checked',false);\n          res[j].commit();\n          app.menuFunctionTree.getView().refresh();\n          // menuFunctionTree.getStore().getNodeById(res[j].get('ID')).data.checked = false;\n          //menuFunctionTree.getChecked().deselect(menuFunctionStore.getAt(j));\n          break;\n        }\n      }\n    }\n    allcount();\n  };\n\n  //删除全部已选的功能\napp.deleteAllFuns=  function (){\n    Ext.Msg.confirm('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_qdscqbyxdgn#}',function(btn){/*'提示','确定删除全部已选的功能?'*/\n      if(btn == 'yes'){\n        app.Fungrid.store.removeAll();\n\n        var allCheckedNodes = app.menuFunctionTree.getChecked();\n        for(var i=0; i<allCheckedNodes.length; i++){\n          allCheckedNodes[i].set('checked',false);\n          allCheckedNodes[i].commit();\n        }\n\n        app.menuFunctionTree.getView().refresh();\n        \n        allcount();\n      }\n    });\n  };"},"children":[{"configs":{"footerScript":"  function deleteCopyAllFun(){ \n    var record=app.UDPgrid.getSelectionModel().getSelection();\n\n    var type = record[0].get('TYPE');\n\n    app.UDPgrid.store.remove(record);\n\n    //取出类型进行判断\n    //判断用户\n    var rid=record[0].data.TARGET_ID;\n    if(type=='U'){\n      //点击删除 去掉勾选的对号\n      for(var j=0;j<app.usergrid.store.getCount();j++){\n        var r_id=app.usergrid.store.getAt(j).get('USER_ID');\n        if(rid===r_id){\n\n          app.usergrid.getSelectionModel().deselect(app.usergrid.store.getAt(j));\n          break;\n        }\n\n      }\t\n    }\n    \n    //判部门户\n    if(type=='D'){\n      for(var j=0;j<app.deptgrid.store.getCount();j++){\n        var r_id=app.deptgrid.store.getAt(j).get('DEPT_ID');\n        if(rid===r_id){\n\n          app.deptgrid.getSelectionModel().deselect(app.deptgrid.store.getAt(j));\n          break;\n        }\n\n      }\t\n    }\n\n    //判部岗位\n    if(type=='P'){\n      for(var j=0;j<app.postgrid.store.getCount();j++){\n        var r_id=app.postgrid.store.getAt(j).get('POST_ID');\n        if(rid===r_id){\n\n          app.postgrid.getSelectionModel().deselect(app.postgrid.store.getAt(j));\n          break;\n        }\n\n      }\t\n    }\n\n    allcount1();\n  }\n  \n  //删除全部已选的用户、部门、岗位\n  function deleteAlludp(){\n    Ext.Msg.confirm('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_qdscqbyxdyhbmgw#}',function(btn){\n      if(btn == 'yes'){\n        app.UDPgrid.store.removeAll();\n\n        app.usergrid.getSelectionModel().deselectAll();\n        app.deptgrid.getSelectionModel().deselectAll();\n       app. postgrid.getSelectionModel().deselectAll();\n        \n        allcount1();\n      }\n    });\n  }\n","itemId":"deletejsforfun"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"footerScript":"\n  function deleteCopyFun(){ \n    var record=Fungrid.getSelectionModel().getSelection();\n    storecopytree.remove(record);\n    //点击删除 去掉勾选的对号\n    var uid=record[0].get('FUN_TREE_ID');\n    var selectLength = menuFunctionTree.getChecked().length;\n\n    for(var j=0;j<selectLength;j++){     \n      var res=menuFunctionTree.getChecked();\n      var type=res[j].get('NODE_TYPE');\n      if(type=='F'){\n        if(uid===res[j].get('ID')){\n          res[j].set('checked',false);\n          res[j].commit();\n          menuFunctionTree.getView().refresh();\n          // menuFunctionTree.getStore().getNodeById(res[j].get('ID')).data.checked = false;\n          //menuFunctionTree.getChecked().deselect(menuFunctionStore.getAt(j));\n          break;\n        }\n      }\n    }\n    allcount();\n  }\n\n  //删除全部已选的功能\n  function deleteAllFuns(){\n    Ext.Msg.confirm('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_qdscqbyxdgn#}',function(btn){\n      if(btn == 'yes'){\n        storecopytree.removeAll();\n\n        var allCheckedNodes = menuFunctionTree.getChecked();\n        for(var i=0; i<allCheckedNodes.length; i++){\n          allCheckedNodes[i].set('checked',false);\n          allCheckedNodes[i].commit();\n        }\n\n        menuFunctionTree.getView().refresh();\n        \n        allcount();\n      }\n    });\n  }\n","itemId":"deleteTreeFun"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"footerScript":"function allcount()\n{ \n  var count=app.Fungrid.store.getCount();\n // var count=row.length;\n\n       \n  \t\tif(count===0){\n   \t\t\t document.getElementById(\"fun\").innerHTML = \"{#xip_auth_userfunauth_selectedFun#}(\"+count+\")\"; \n  \t\t\t\t}else{\n    \t\t\t document.getElementById(\"fun\").innerHTML = \"{#xip_auth_userfunauth_selectedFun#}(\"+count+\")\"; \n  \t\t\t}\n \n\n \n\n}\n","itemId":"countleftfun"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"footerScript":"\nfunction allcount1()\n{ \n  var row=app.usergrid.getSelection();\n   var row1=app.deptgrid.getSelection();\n   var row2=app.postgrid.getSelection();\n  var count=row.length;\n  var count1=row1.length;\n   var count2=row2.length;\n   var s=app.UDPgrid.store.getModifiedRecords().length;\n \n//判断UDPgrid用户部门岗位的的个数\n\n   var a=0;\n  var b=0;\n  var c=0;\n                   for(var k=0;k<s;k++){\n    \t\t\t\t\tvar type=app.UDPgrid.store.getAt(k).get('TYPE');\n                   \n                     if(type==='U'){      \n                       a++;  \n                      \n                     }\t\n                       if(type==='D'){      \n                       b++;       \n                       \n                     }\t\n                       if(type==='P'){      \n                       c++;       \n                       \n                     }\t\n                   }\n  \n  \t\t\t\n   \n             \n  //alert(c);//用户个数\n  if(count===0){\n   if(statusU===false){\n    \n     if(a===0){\n        document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n     }\n     else{\n        document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n     }\n     \n    }\n   else{\n\n      document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n   }\n    \n    \n }else{\n\n    document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n  }\n  //部门个数\n  if(count1===0){\n   if(statusD===false){\n    \n     if(b===0){\n        document.getElementById(\"all\").innerHTML =  \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n     }\n     else{\n        document.getElementById(\"all\").innerHTML =  \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\";\n     }\n     \n    }\n   else{\n\n      document.getElementById(\"all\").innerHTML =  \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\";\n   }\n    \n    \n }else{\n\n    document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\";\n  } \n  //岗位个数\n   if(count2===0){\n   if(statusP===false){\n    \n     if(c===0){\n        document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n     }\n     else{\n        document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n     }\n     \n    }\n   else{\n\n      document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n   }\n    \n    \n }else{\n\n    document.getElementById(\"all\").innerHTML = \"{#xip_auth_userfunauth_selectedUser#}(\"+a+\"){#xip_auth_userfunauth_dept#}(\"+b+\"){#xip_auth_userfunauth_post#}(\"+c+\")\"; \n  } \n  \n  \n  \n  \n \n \n\n}\n\n","itemId":"countrightfun"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"footerScript":"/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\nfunction treeNodeQuery(text,by,treeId) { \n \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = treeId;\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      me = menuFunTree,\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n}\n","itemId":"querytreefun"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"itemId":"WinBtn"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_auth#}","itemId":"authorizebtn","iconCls":"insert_icon"},"events":{"click":"if(app.Fungrid.store.getCount()===0 || app.UDPgrid.store.getCount()===0){\n   Wb.warn('{#xip_auth_userfunauth_qxzysqddx#}');/*请选择要授权的对象！*/\n   return ;\n  }  \n\n//====================定义筛选变量====================\nvar _matchIdsAttay = [];\nvar _matchStr = '';\nvar _tmpFunId = '';\nvar _tmpTargetId = '';\napp.Fungrid.store.each(function(funRecord){\n  _tmpFunId +=\"'\"+funRecord.data.FUN_TREE_ID+\"',\";\n  app.UDPgrid.store.each(function(grantRecord){\n    _matchStr=funRecord.data.FUN_TREE_ID+','+grantRecord.data.TARGET_ID+','+grantRecord.data.TYPE;//组织,应用,类型   格式\n    _matchIdsAttay.push(_matchStr);    \n  });\n});\napp.UDPgrid.store.each(function(tmp){\n  _tmpTargetId +=\"'\"+tmp.data.TARGET_ID+\"',\";\n});\n//=============获取要授权的对象============================\n_tmpFunId = _tmpFunId.substring(0,_tmpFunId.length-1);\n_tmpTargetId = _tmpTargetId.substring(0,_tmpTargetId.length-1);\nvar _existGrant = '';\n//==============筛选已经授权的数据===========================\napp.gridAllFunhiden.store.load({params:{funIds:_tmpFunId,targetIds:_tmpTargetId},callback:function(){\n  app.gridAllFunhiden.store.each(function(a){\n    _existGrant = a.data.FUN_TREE_ID+','+a.data.TARGET_ID+','+a.data.TYPE;\n    if(Ext.Array.contains(_matchIdsAttay,_existGrant)){\n    Ext.Array.remove(_matchIdsAttay,_existGrant); \n    }\n  });\n//=================得到最终需要授权的记录====================\n if(_matchIdsAttay.length === 0){\n   Wb.warn('{#xip_auth_userfunauth_sxzddxyjsqwbqcxxz#}');/*所选择的对象已经授权完毕，请重新选择！*/\n   return false;\n }  \n   var tmpGrantAttayVar='';\n   var arrayGrantIds = [];\n   var jsonVar;\n   Ext.each(_matchIdsAttay,function(tmpItem){\n     tmpGrantAttayVar = tmpItem.split(',');\n     jsonVar= {USER_FUN_ID:'',FUN_TREE_ID:tmpGrantAttayVar[0],TARGET_ID:tmpGrantAttayVar[1],TYPE:tmpGrantAttayVar[2]};\n     arrayGrantIds.push(jsonVar);\n   });\n  //=====================执行授权操作=============================\n \n Wb.request({\n           url: 'm?xwl=xip/auth/user/userfunAuth/data/batchAddFunSec', \n           params: Wb.apply({\n                newArray:Ext.JSON.encode(arrayGrantIds)\n           }),\n           success: function() {\n               Ext.Msg.alert('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_sqcg#}');/*'提示','授权成功'*/\n               app.grid1.store.load();\n           }\n        }); \n}});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_userfunauth_revoke#}","itemId":"revokebtn","iconCls":"remove_icon"},"events":{"click":"if(app.Fungrid.store.getCount()===0 || app.UDPgrid.store.getCount()===0){\n  Wb.warn('{#xip_auth_userfunauth_qxzyqxsqddx#}');/*请选择要取消授权的对象*/\n  return;\n}\n\n//删除所选择的授权\nvar delArrayVar = [];\nvar delJson ;\napp.UDPgrid.store.each(function(a){\n  app.Fungrid.store.each(function(b){\n    delJson = {FUN_TREE_ID:b.data.FUN_TREE_ID,TARGET_ID:a.data.TARGET_ID};\n    delArrayVar.push(delJson);\n  });  \n});\nWb.request({\n  url :'m?xwl=xip/auth/user/userfunAuth/data/deleteUserRoleSec',\n  params:Wb.apply({array:Ext.JSON.encode(delArrayVar)}),\n  success:function(response){\n    Ext.Msg.alert('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_cxsqcg#}');/*'提示','撤销授权成功'*/\n    app.grid1.store.load();\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_userfunauth_close#}","itemId":"closebtn","iconCls":"cancel_icon"},"events":{"click":"app.window.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"title":"{#xip_auth_userfunauth_userFunAuth#}","height":"500","frame":"true","layout":"border","width":"950","closeAction":"destroy","buttonAlign":"center","buttons":"app.WinBtn","dialog":"false","itemId":"window","modal":"true","maximizable":"true"},"events":{"close":"app.UDPgrid.store.removeAll();\napp.Fungrid.store.removeAll();"},"children":[{"configs":{"region":"west","style":"border-width:0px","layout":"border","width":"'48%'","border":"false","itemId":"funpanel"},"children":[{"configs":{"region":"center","frame":"true","layout":"border","border":"false","itemId":"center"},"children":[{"configs":{"region":"north","height":"40","frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"form2"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"100","width":"240","labelAlign":"right","itemId":"treeName","fieldLabel":"{#xip_auth_userfunauth_funName#}"},"events":{"specialkey":"app.funquerybtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_userfunauth_query#}","itemId":"funquerybtn","iconCls":"seek_icon","x":"10"},"events":{"click":"treeNodeQuery(app.treeName.getValue(),'text', app.menuFunctionTree);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"rootVisible":"true","region":"center","animate":"false","root":"{id:'rootNode',text:'{#xip_auth_userfunauth_gncd#}',expanded:true,checked:false}/*功能菜单*/\n","itemId":"menuFunctionTree","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: function(node,data,overModel,dropPosition,dropFunction,options){\n      return false;\n    },\n    drop: function(node,data,overModel,dropPosition,options){\n      return false;\n    }\n  }\n}"},"events":{"checkchange":"//递归调用选中子节点与父节点（选中父节点，同时选中父节点下的所有子节点，选中子节点，同时选中父节点）\nchildChecked(node,checked);\nparentChecked(node,checked);\n"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/getMenuFunctionsTree"},"events":{"load":"app.menuFunctionTree.expandAll();","beforeload":"operation.params.parentID=operation.node.get('ID');"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"east","width":"'48%'","activeTab":"userpanel","itemId":"funtabPanel"},"children":[{"configs":{"title":"{#xip_auth_userfunauth_user#}","layout":"border","border":"false","itemId":"userpanel"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"userform"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"orgPanel"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","width":"345","valueField":"CODE","emptyText":"{#xip_auth_userfunauth_selOrg#}","labelAlign":"right","itemId":"orgcomboBox","fieldLabel":"{#xip_auth_userfunauth_org#}","editable":"true"},"events":{"select":"app.orgcomboBox.focus();\nvar dept_id = app.depcomboBox.getValue();\nif(dept_id===null||dept_id===''){\n  \n  var ORG_ID = app.orgcomboBox.getValue();\n \n  app.depcomboBox.store.load({params:{ORG_ID:ORG_ID}});\n}else{\n \n  var ORG_ID = app.orgcomboBox.getValue();\n  app.depcomboBox.store.load({params:{ORG_ID:ORG_ID}});\n  app.depcomboBox.clearValue();\n}\nvar ORG_ID = app.orgcomboBox.getValue();\napp.usergrid.store.load();"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectOrg"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"deptPanel"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"DEPT_NAME","width":"345","valueField":"DEPT_ID","emptyText":"{#xip_auth_userfunauth_selDept#}","labelAlign":"right","itemId":"depcomboBox","fieldLabel":"{#xip_auth_userfunauth_dept#}"},"events":{"select":"var DEPT_ID = app.depcomboBox.getValue();\napp.usergrid.store.load();\n","focus":"var DEPT_ID = app.depcomboBox.getValue();\nif(DEPT_ID===null || DEPT_ID===''){\n  if(app.orgcomboBox.getValue()===null){\n    app.depcomboBox.store.removeAll();\n  }\n}\n"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectDept"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"userN","fieldLabel":"{#xip_auth_userfunauth_username#}"},"events":{"specialkey":"app.usergrid.store.load({params:{userN:app.userN.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_userfunauth_query#}","itemId":"userQueryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"app.usergrid.store.load({params:{userN:app.userN.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_userfunauth_reset#}","itemId":"userResetBtn","iconCls":"refresh_icon","x":"25"},"events":{"click":"app.orgcomboBox.clearValue();\napp.depcomboBox.clearValue();\napp.userN.setValue('');\napp.usergrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"FLAG1"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ARRID1"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"usergrid","simpleSelect":"true"},"events":{"tagEvents":"select:function(record, index, eOpts){\n    var row = app.usergrid.getSelection();\n    var sm = app.usergrid.getSelectionModel();\n    var records = sm.getSelection();\n    //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n    var arrid = '';\n    for(var v=0 ;v<row.length; v++){\n      var idNu = records[v].get('USER_ID');\n      arrid = arrid+','+idNu;\n    }\n    app.ARRID1.setValue(arrid.substring(1,arrid.length));\n    if(row.length===1){\n          //不在userStore中才添加\n          var blll;\n          for(var j=0;j<app.UDPgrid.store.getCount();j++){\n             var uuid = app.UDPgrid.store.getAt(j).get('TARGET_ID');\n             if(records[0].get('USER_ID')===uuid){\n              blll=1;\n              break;\n\n            }\n\n          }\n          if(blll!==1){\n          \n           var json={TARGET_ID:records[0].get('USER_ID'),UNAME:records[0].get('USER_NAME'),ENAME:records[0].get('EMP_NAME'),TYPE:'U'};\n         \n            app.UDPgrid.store.add(json);\n\n          }\n\n\n\n    }else{\n      //不在userStore中才添加\n      var bl;\n      for(var i=0;i<app.UDPgrid.store.getCount();i++){\n        var user_id=app.UDPgrid.store.getAt(i).get('TARGET_ID');\n        if(records[row.length-1].get('USER_ID')===user_id){\n          bl=1;\n          break;\n        }\n        else{\n          bl=0;\n        }\n      }\n      if(bl!==1){\n          var json={TARGET_ID:records[row.length-1].get('USER_ID'),UNAME:records[row.length-1].get('USER_NAME'),ENAME:records[row.length-1].get('EMP_NAME'),TYPE:'U'};\n          app.UDPgrid.store.add(json);\n        }\n\n    }\n\n    app.FLAG1.setValue(row.length);\n   allcount1();\n\n}","selectionchange":"var flag = app.FLAG1.getValue();\nvar row = app.usergrid.getSelection();\nvar sm = app.usergrid.getSelectionModel();\nvar records = sm.getSelection();\nif(flag===null||flag===''){\n  \n}\nelse{\n  if(row.length<flag && statusU===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.ARRID1.getValue().split(',');\n    for(var i=0;i<arrayid.length;i++){\n        var aid = arrayid[i];\n        for(var v=0;v<row.length;v++){\n          var idN = records[v].get('USER_ID');\n          if(aid===idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n            \n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k<app.UDPgrid.store.getCount();k++){\n                  var  user_id3 = app.UDPgrid.store.getAt(k).get('TARGET_ID');\n                  if(aid===user_id3){\n                  app.UDPgrid.store.removeAt(k);\n               \n                  }\n              }\n          \n        \n        }\n    }\n   \n   }\n}\nallcount1();\n"},"children":[{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/noOrgDeptUser"},"events":{"load":"var arr=[];\nfor(var i=0;i<app.UDPgrid.store.getCount();i++){\n  var uid = app.UDPgrid.store.getAt(i).get('TARGET_ID');\n  for(var j=0;j<app.usergrid.store.getCount();j++){\n    if(uid===app.usergrid.store.getAt(j).get('USER_ID')){\n      arr.push(app.usergrid.store.getAt(j));\n      break;\n    }  \n  }\n}\napp.usergrid.getSelectionModel().select(arr);\nstatusU = false;","beforeload":"var whereSql= ' AND 1=1';\nif(Ext.isEmpty(app.orgcomboBox.getValue()) && Ext.isEmpty(app.depcomboBox.getValue())){\n  store.getProxy().url='m?xwl=xip/auth/user/userfunAuth/data/noOrgDeptUser';  //noOrgDeptUser\n}else{\n  store.getProxy().url='m?xwl=xip/auth/user/userfunAuth/data/selectOrgDeptUser';  //selectOrgDeptUser\n}\nif(!Ext.isEmpty(app.orgcomboBox.getValue())){ \n  whereSql +=' AND b.ORG_ID =\\''+app.orgcomboBox.getValue()+'\\'';\n}\nif(!Ext.isEmpty(app.depcomboBox.getValue())){\n  whereSql +=' AND b.DEPT_ID =\\''+app.depcomboBox.getValue()+'\\'';\n}\nstore.getProxy().extraParams.WHERESQL = whereSql;\nstatusU = true;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_serialNum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_username#}","width":"150","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_type#}","hidden":"true","dataIndex":"type","itemId":"type_col","renderer":"var str = \"U\";\nreturn str;"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"},{"configs":{"title":"{#xip_auth_userfunauth_dept#}","style":"border-width:0px","layout":"border","border":"false","itemId":"deptpanel"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"deptform"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"orgPanel1"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","width":"345","valueField":"CODE","emptyText":"{#xip_auth_userfunauth_selOrg#}","labelAlign":"right","itemId":"orgcomboBox1","fieldLabel":"{#xip_auth_userfunauth_org#}","editable":"true"},"events":{"select":"\n  var ORG_ID = app.orgcomboBox1.getValue();\n \n  app.deptgrid.store.load({params:{ORG_ID:ORG_ID}});\n\n"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectOrg"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"userN1","fieldLabel":"{#xip_auth_userfunauth_deptName1#}"},"events":{"specialkey":"app.userQueryBtn1.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_userfunauth_query#}","itemId":"userQueryBtn1","iconCls":"seek_icon","x":"10"},"events":{"click":"\n var ORG_ID = app.orgcomboBox1.getValue();\napp.deptgrid.store.load({params:{ORG_ID:ORG_ID,userN1:app.userN1.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_userfunauth_reset#}","itemId":"userResetBtn1","iconCls":"refresh_icon","x":"25"},"events":{"click":"app.orgcomboBox1.clearValue();\n\napp.userN1.setValue('');\napp.deptgrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"FLAG2"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ARRID2"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"deptgrid","simpleSelect":"true"},"events":{"selectionchange":"var flag = app.FLAG2.getValue();\nvar row = app.deptgrid.getSelection();\nvar sm = app.deptgrid.getSelectionModel();\nvar records = sm.getSelection();\n\nif(flag===null||flag===''){\n  \n}\nelse{\n  if(row.length<flag && statusD===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.ARRID2.getValue().split(',');\n    for(var i=0;i<arrayid.length;i++){\n        var aid = arrayid[i];\n        for(var v=0;v<row.length;v++){\n          var idN = records[v].get('DEPT_ID');\n          if(aid===idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n            \n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k<app.UDPgrid.store.getCount();k++){\n                  var  user_id3 = app.UDPgrid.store.getAt(k).get('TARGET_ID');\n                  if(aid===user_id3){\n                  app.UDPgrid.store.removeAt(k);\n               \n                  }\n              }\n          \n        \n        }\n    }\n   \n   }\n}\nallcount1();\n","tagEvents":"select:function(record, index, eOpts){\n    var row = app.deptgrid.getSelection();\n    var sm = app.deptgrid.getSelectionModel();\n    var records = sm.getSelection();\n    //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n    var arrid = '';\n    for(var v=0 ;v<row.length; v++){\n      var idNu = records[v].get('DEPT_ID');\n      arrid = arrid+','+idNu;\n    }\n    app.ARRID2.setValue(arrid.substring(1,arrid.length));\n    if(row.length===1){\n          //不在userStore中才添加\n          var blll;\n          for(var j=0;j<app.UDPgrid.store.getCount();j++){\n             var uuid = app.UDPgrid.store.getAt(j).get('TARGET_ID');\n             if(records[0].get('DEPT_ID')===uuid){\n              blll=1;\n              break;\n\n            }\n\n          }\n          if(blll!==1){\n          \n           var json={TARGET_ID:records[0].get('DEPT_ID'),UNAME:records[0].get('DEPT_NAME'),ENAME:records[0].get('ORG_NAME'),TYPE:'D'};\n         \n            app.UDPgrid.store.add(json);\n\n          }\n\n\n\n    }else{\n      //不在userStore中才添加\n      var bl;\n      for(var i=0;i<app.UDPgrid.store.getCount();i++){\n        var user_id=app.UDPgrid.store.getAt(i).get('TARGET_ID');\n        if(records[row.length-1].get('DEPT_ID')===user_id){\n          bl=1;\n          break;\n        }\n        else{\n          bl=0;\n        }\n      }\n      if(bl!==1){\n          var json={TARGET_ID:records[row.length-1].get('DEPT_ID'),UNAME:records[row.length-1].get('DEPT_NAME'),ENAME:records[row.length-1].get('ORG_NAME'),TYPE:'D'};\n          app.UDPgrid.store.add(json);\n        }\n\n    }\n\n    app.FLAG2.setValue(row.length);\n    allcount1();\n\n}"},"children":[{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectDept"},"events":{"load":"var arr=[];\nfor(var i=0;i<app.UDPgrid.store.getCount();i++){\n  var uid = app.UDPgrid.store.getAt(i).get('TARGET_ID');\n  for(var j=0;j<app.deptgrid.store.getCount();j++){\n    if(uid===app.deptgrid.store.getAt(j).get('DEPT_ID')){\n      arr.push(app.deptgrid.store.getAt(j));\n      break;\n    }  \n  }\n}\n\napp.deptgrid.getSelectionModel().select(arr);\nstatusD = false;","beforeload":"statusD = true;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_serialNum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DEPT_ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_deptCode#}","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_deptName2#}","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_orgName#}","dataIndex":"ORG_NAME","itemId":"ORG_NAME_COL1","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_type#}","hidden":"true","dataIndex":"type","itemId":"type_col","renderer":"var str = \"D\";\nreturn str;"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"},{"configs":{"title":"{#xip_auth_userfunauth_post#}","style":"border-width:0px","layout":"border","border":"false","itemId":"postpanel"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"postform"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"orgPanel"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"NAME","width":"345","valueField":"CODE","emptyText":"{#xip_auth_userfunauth_selOrg#}","labelAlign":"right","itemId":"orgcomboBox2","fieldLabel":"{#xip_auth_userfunauth_org#}","editable":"true"},"events":{"select":"\n  var ORG_ID = app.orgcomboBox2.getValue();\napp.deptpostcomboBox.clearValue();\n \napp.postgrid.store.load({params:{ORG_ID:ORG_ID}} );\napp.deptpostcomboBox.store.load({params:{ORG_ID:ORG_ID}});"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectOrg"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"deptPanel"},"children":[{"configs":{"labelWidth":"80","queryMode":"local","displayField":"DEPT_NAME","width":"345","valueField":"DEPT_ID","emptyText":"{#xip_auth_userfunauth_selDept#}","labelAlign":"right","itemId":"deptpostcomboBox","fieldLabel":"{#xip_auth_userfunauth_dept#}"},"events":{"select":"var ORG_ID=app.orgcomboBox2.getValue();\napp.postgrid.store.load({params:{ORG_ID:ORG_ID}});\n","focus":"\n"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/postDeptStore"},"events":{"beforeload":"var whereSql = ' and 1=1';\nif(!Ext.isEmpty(app.orgcomboBox2.getValue())){\n  whereSql = ' and t.ORG_ID = \\''+app.orgcomboBox2.getValue()+'\\'';\n}else{\n  whereSql = ' and t.ORG_ID =\\'\\'';\n}\nstore.getProxy().extraParams.WHERESQL = whereSql;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"userN2","fieldLabel":"{#xip_auth_userfunauth_postName1#}"},"events":{"specialkey":"app.userQueryBtn2.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_userfunauth_query#}","itemId":"userQueryBtn2","iconCls":"seek_icon","x":"10"},"events":{"click":" var ORG_ID = app.orgcomboBox2.getValue();\napp.postgrid.store.load({params:{ORG_ID:ORG_ID,userN2:app.userN2.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_userfunauth_reset#}","itemId":"userResetBtn2","iconCls":"refresh_icon","x":"25"},"events":{"click":"app.orgcomboBox2.clearValue();\napp.deptpostcomboBox.clearValue();\napp.userN2.setValue('');\napp.postgrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"FLAG3"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ARRID3"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"postgrid","simpleSelect":"true"},"events":{"tagEvents":"select:function(record, index, eOpts){\n    var row = app.postgrid.getSelection();\n    var sm = app.postgrid.getSelectionModel();\n    var records = sm.getSelection();\n    //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n    var arrid = '';\n    for(var v=0 ;v<row.length; v++){\n      var idNu = records[v].get('POST_ID');\n      arrid = arrid+','+idNu;\n    }\n    app.ARRID3.setValue(arrid.substring(1,arrid.length));\n    if(row.length===1){\n          //不在userStore中才添加\n          var blll;\n          for(var j=0;j<app.UDPgrid.store.getCount();j++){\n             var uuid = app.UDPgrid.store.getAt(j).get('TARGET_ID');\n             if(records[0].get('POST_ID')===uuid){\n              blll=1;\n              break;\n\n            }\n\n          }\n          if(blll!==1){\n          \n           var json={TARGET_ID:records[0].get('POST_ID'),UNAME:records[0].get('POST_NAME'),ENAME:records[0].get('DEPT_NAME'),TYPE:'P'};\n         \n            app.UDPgrid.store.add(json);\n\n          }\n\n\n\n    }else{\n      //不在userStore中才添加\n      var bl;\n      for(var i=0;i<app.UDPgrid.store.getCount();i++){\n        var user_id=app.UDPgrid.store.getAt(i).get('TARGET_ID');\n        if(records[row.length-1].get('POST_ID')===user_id){\n          bl=1;\n          break;\n        }\n        else{\n          bl=0;\n        }\n      }\n      if(bl!==1){\n          var json={TARGET_ID:records[row.length-1].get('POST_ID'),UNAME:records[row.length-1].get('POST_NAME'),ENAME:records[row.length-1].get('DEPT_NAME'),TYPE:'P'};\n          app.UDPgrid.store.add(json);\n        }\n\n    }\n\n    app.FLAG3.setValue(row.length);\n    allcount1();\n\n}","selectionchange":"var flag = app.FLAG3.getValue();\nvar row = app.postgrid.getSelection();\nvar sm = app.postgrid.getSelectionModel();\nvar records = sm.getSelection();\n\nif(flag===null||flag===''){\n  \n}\nelse{\n  if(row.length<flag && statusP===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.ARRID3.getValue().split(',');\n    for(var i=0;i<arrayid.length;i++){\n        var aid = arrayid[i];\n        for(var v=0;v<row.length;v++){\n          var idN = records[v].get('POST_ID');\n          if(aid===idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n            \n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k<app.UDPgrid.store.getCount();k++){\n                  var  user_id3 = app.UDPgrid.store.getAt(k).get('TARGET_ID');\n                  if(aid===user_id3){\n                  app.UDPgrid.store.removeAt(k);\n               \n                  }\n              }\n          \n        \n        }\n    }\n   \n   }\n}\nallcount1();\n"},"children":[{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectPost"},"events":{"load":"var arr=[];\nfor(var i=0;i<app.UDPgrid.store.getCount();i++){\n  var uid = app.UDPgrid.store.getAt(i).get('TARGET_ID');\n  for(var j=0;j<app.postgrid.store.getCount();j++){\n    if(uid===app.postgrid.store.getAt(j).get('POST_ID')){\n      arr.push(app.postgrid.store.getAt(j));\n      break;\n    }  \n  }\n}\napp.postgrid.getSelectionModel().select(arr);\nstatusP = false;","beforeload":"\nvar whereSql = ' and 1=1';\nif(!Ext.isEmpty(app.deptpostcomboBox.getValue())){\n  whereSql = ' and t.DEPT_ID = \\''+app.deptpostcomboBox.getValue()+'\\'';\n}\n\nstore.getProxy().extraParams.WHERESQL = whereSql;\nstatusP = true;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_serialNum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"POST_ID","hidden":"true","dataIndex":"POST_ID","itemId":"POST_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_postCode#}","dataIndex":"POST_CODE","itemId":"POST_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_postName2#}","dataIndex":"POST_NAME","itemId":"POST_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_deptName2#}","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL2","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_type#}","hidden":"true","dataIndex":"type","itemId":"type_col","renderer":"var str = \"P\";\nreturn str;"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"tab"},{"configs":{"region":"south","height":"'8%'","frame":"false","style":"border-width:0px","layout":"border","border":"false","itemId":"southpanel"},"children":[{"configs":{"region":"west","frame":"true","height":"30","style":"border-width:0px","width":"'48%'","layout":"border","border":"false","itemId":"westFormS"},"children":[{"configs":{"region":"west","frame":"true","style":"border-width:0px","width":"'40%'","columnWidth":".3","border":"false","itemId":"panel_west"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","width":"'45%'","columnWidth":".2","border":"false","itemId":"panel_center"},"children":[{"configs":{"html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick = \"app.copyFun()\"  style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"fun\" >{#xip_auth_userfunauth_yxgn0#}<\/a>\n<\/body>\n<\/html>\n<!-- 已选功能(0)\t -->","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","frame":"true","style":"border-width:0px","width":"30","columnWidth":".2","border":"false","itemId":"panel_east"},"children":[{"configs":{"html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick = \"app.deleteAllFuns();\" title=\"{#xip_auth_userfunauth_scqbyxgn#}\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"fun\" ><image src=\"{#delImageSrc#}\"><\/image><\/a>\n  <\/body>\n<\/html>\n<!-- 删除全部已选功能\t -->","itemId":"deleteAllRolesLabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"east","frame":"true","height":"30","style":"border-width:0px","width":"'48%'","layout":"border","border":"false","itemId":"eastFormS"},"children":[{"configs":{"region":"west","frame":"true","style":"border-width:0px","width":"'40%'","border":"false","itemId":"panel_west1"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"center","height":"30","frame":"true","style":"border-width:0px","width":"'45%'","border":"false","itemId":"panel_center1"},"children":[{"configs":{"html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick =\"app.copyUDP()\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"all\" >{#xip_auth_userfunauth_yxyh0bm0gw0#}<\/a>\n<\/body>\n<\/html>\n<!-- 已选用户(0)部门(0)岗位(0)\t -->","itemId":"label2"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","frame":"true","style":"border-width:0px","width":"30","border":"false","itemId":"panel_east1"},"children":[{"configs":{"html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick = \"app.deleteAlludp();\" title=\"{#xip_auth_userfunauth_scqbyxsj#}\" style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"fun\" ><image src=\"{#delImageSrc#}\"><\/image><\/a>\n  <\/body>\n<\/html>\n<!-- 删除全部已选数据\t -->","itemId":"deleteAllUsersLabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_userfunauth_selectedFun#}","height":"360","frame":"true","layout":"border","width":"480","closeAction":"hide","border":"false","itemId":"SelectFunWin","modal":"true"},"children":[{"configs":{"region":"center","selType":"rowmodel","height":"340","width":"480","itemId":"Fungrid","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selecttreecopy"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_serialNum#}","width":"45","align":"center","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"FUN_TREE_ID","hidden":"true","dataIndex":"FUN_TREE_ID","itemId":"FUN_TREE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_funCode#}","width":"160","dataIndex":"FUN_TREE_CODE","itemId":"FUN_TREE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_funName#}","dataIndex":"FUN_TREE_NAME","itemId":"FUN_TREE_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"width":"50","itemId":"Rdelete","renderer":"var str = \"<a href=\\\"javascript:app.deleteCopyFun();\\\"> 删除 <\/a>\";\nreturn str;"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_userfunauth_selectedData#}","height":"360","frame":"true","layout":"border","width":"480","closeAction":"hide","border":"false","itemId":"SelectUDPWin","modal":"true"},"children":[{"configs":{"region":"center","selType":"rowmodel","height":"340","width":"480","itemId":"UDPgrid","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectRightCopy"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"目标id","hidden":"true","dataIndex":"TARGET_ID","itemId":"TID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_authName#}","width":"120","dataIndex":"UNAME","itemId":"UNAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_authContent#}","width":"120","dataIndex":"ENAME","itemId":"ENAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_type#}","width":"50","dataIndex":"TYPE","itemId":"TYPE_COL","renderer":"if(value === \"U\"){\n  return \"{#xip_auth_userfunauth_user#}\";\n}else if(value === \"D\"){\n  return \"{#xip_auth_userfunauth_dept#}\";\n}else if(value === \"P\"){\n  return \"{#xip_auth_userfunauth_post#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"itemId":"Rdelete1","renderer":"var str = \"<a href=\\\"javascript:app.deleteCopyAllFun();\\\"> {#xip_auth_userfunauth_delete#} <\/a>\";\nreturn str;","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"height":"260","width":"380","layout":"border","itemId":"windowhiden"},"children":[{"configs":{"region":"center","height":"260","hidden":"true","width":"380","itemId":"gridAllFunhiden"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectFunAllHiden"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_serialNum#}","width":"45","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"功能id","hidden":"true","dataIndex":"FUN_TREE_ID","itemId":"FUN_TREE_ID_COLUMN"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户功能id","hidden":"true","dataIndex":"USER_FUN_ID","itemId":"USER_FUN_ID_COLUMN"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"目标id","hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID_COLUMN"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"TYPE","itemId":"TYPE_COLUMN"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#xip_auth_userfunauth_queryConditions#}","frame":"true","style":"padding-top:8px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"gnmc","fieldLabel":"{#xip_auth_userfunauth_funName#}"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"bmmc","fieldLabel":"{#xip_auth_userfunauth_authName#}"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","pickList":"[['U','{#xip_auth_userfunauth_user#}'],['D','{#xip_auth_userfunauth_dept#}'],['P','{#xip_auth_userfunauth_post#}']]\n\n/*[['U','用户'],['D','部门'],['P','岗位']]*/","labelAlign":"right","itemId":"comboBox1","fieldLabel":"{#xip_auth_userfunauth_authType#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"combo"},{"configs":{"text":"{#xip_auth_userfunauth_query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"var gnmc = app.gnmc.getValue();\nvar bmmc = app.bmmc.getValue();\nvar comboBox1 = app.comboBox1.getValue();\napp.grid1.store.load({params:{\n         gnmc : gnmc,\n         bmmc  : bmmc ,\n         comboBox1 : comboBox1\n}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_userfunauth_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"25"},"events":{"click":"app.form1.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","simpleSelect":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_userfunauth_userFunAuth#}","itemId":"userroot","iconCls":"key_icon"},"events":{"click":"var win = new Ext.window.Window(app._window);\nwin.show();\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_userfunauth_delete#}","itemId":"deletebtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(Ext.isEmpty(rows)){\n  Ext.MessageBox.alert('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_nmyxzrhsj#}');/*'提示','您没有选中任何数据！'*/\n}\nelse{\n   Ext.Msg.confirm('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_nqdysc#}',function(a){/*'提示','您确定要删除？'*/\n    if(a=='yes'){\n      Wb.request({\n         url : 'm?xwl=xip/auth/user/userfunAuth/data/deleteFun',\n         params : Wb.apply({destory: Wb.getData(rows)}),\n         success :function(response){\n           Ext.Msg.alert('{#xip_auth_userfunauth_prompt#}','{#xip_auth_userfunauth_sccg#}');/*'提示','删除成功'*/\n            Wb.remove(app.grid1,rows);\n           \n         }\n      });\n    }\n   });\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/auth/user/userfunAuth/data/selectFunAll"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_auth_userfunauth_serialNum#}","align":"center","xtype":"rownumberer","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"功能id","hidden":"true","dataIndex":"FUN_TREE_ID","itemId":"funid"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户功能id","hidden":"true","dataIndex":"USER_FUN_ID","itemId":"userfunid"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"目标id","hidden":"true","dataIndex":"TARGET_ID","itemId":"targetid"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_funName#}","width":"250","dataIndex":"FUN_TREE_NAME","itemId":"FUN_TREE_NAME_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_authName#}","width":"350","dataIndex":"TARGET","itemId":"TARGET_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_authType#}","width":"130","dataIndex":"TYPE","itemId":"qxlx","renderer":"if(value === \"U\"){\n   return \"{#xip_auth_userfunauth_user#}\";\n}else if(value === \"D\"){\n  return \"{#xip_auth_userfunauth_dept#}\";\n}else if(value === \"P\"){\n    return \"{#xip_auth_userfunauth_post#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_userfunauth_createTime#}","dataIndex":"CREATION_DATE","itemId":"createtime","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}