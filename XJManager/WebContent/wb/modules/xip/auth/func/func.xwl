{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"cssLinks":"[\"xip/css/default.css\",\"webbuilder/controls/codemirror/codemirror.css\",\"webbuilder/controls/codemirror/dialog.css\"]","loginRequired":"false","initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nvar userName = request.getSession().getAttribute(\"XzSessionVars\").get('userName');\nvar empName = request.getSession().getAttribute(\"XzSessionVars\").get('empName');\n\nvar authModel = request.getSession().getAttribute(\"XzSessionVars\").get('AUTH_MODAL');\nvar roleId = request.getSession().getAttribute(\"XzSessionVars\").get('roleId');\nvar roleName = request.getSession().getAttribute(\"XzSessionVars\").get('roleName');\nvar roleCode = request.getSession().getAttribute(\"XzSessionVars\").get('roleCode');\n\nvar ctxPath = request.getContextPath() ;\n\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"userName\",userName);\nrequest.setAttribute(\"empName\",empName);\n\nrequest.setAttribute(\"authModel\",authModel);\nrequest.setAttribute(\"roleId\",roleId);\nrequest.setAttribute(\"roleName\",roleName);\nrequest.setAttribute(\"roleCode\",roleCode);\nrequest.setAttribute(\"contextPath\",ctxPath);\nvar godMoadl = request.getSession().getAttribute(\"XzSessionVars\").get('godMode');\nrequest.setAttribute(\"godMoadl\",godMoadl);\nvar funCodeStr = request.getParameter(\"funCode\");\nrequest.setAttribute(\"tipCode\",funCodeStr);\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/auth/func/func\");\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","jsLinks":"[\"xip/js/messageTip.js\",\"webbuilder/controls/codemirror/mixed.js\"]","itemId":"module","head":"<style type=\"text/css\">\n#dataview .x-panel-body{\n    background: white;\n    font: 11px Arial, Helvetica, sans-serif;\n}\n#dataview .thumb{\n    background: #FFF;\n    text-align:center;\n    padding: 3px;\n    padding-bottom: 0;\n}\n\n.x-quirks #dataview1 .thumb {\n    padding-bottom: 3px;\n}\n\n#dataview .thumb img{\n    height: 35px;\n    width: 35px;\n}\n#dataview .thumb-wrap{\n    float: left;\n    margin: 4px;\n    margin-right: 0;\n    padding: 5px;\n}\n#dataview .thumb-wrap span {    \n    display: block;\n    overflow: hidden;\n    text-align: center;\n    width: 86px; /* for ie to ensure that the text is centered */\n}\n#dataview .x-item-selected{\n    // background: #eff5fb url(webbuilder/images/ok.gif) no-repeat right bottom;\n    border:1px solid #99bbe8;\n    padding: 4px;\n}\n#dataview .x-item-selected .thumb{\n    background:transparent;\n}\n\n.x-view-selector {\n    position:absolute;\n    left:0;\n    top:0;\n    width:0;\n    border:1px dotted;\n    opacity: .5;\n    -moz-opacity: .5;\n    filter:alpha(opacity=50);\n    zoom:1;\n    background-color:#c3daf9;\n    border-color:#3399bb;\n}.ext-strict .ext-ie .x-tree .x-panel-bwrap{\n    position:relative;\n    overflow:hidden;\n}\n<\/style>"},"events":{"finalize":"var selectRecord = null;","initialize":"function beforeDropType(node, data, om, dp) {\n  if(om===null){\n    return false;\n  }\n  //Wb.saveNodePos(Wb.getNode(data.item));\n  return true;\n}\nfunction dropType(node, data, om, dp) {\n  //var dst = node, src = data.item, orderIndex, srcId, parentId, pn;\n  \n  if(om.get('id')=='rootNode'){\n    orderIndex = om.lastChild.previousSibling ? (om.lastChild.previousSibling.get('IDX')+1) : 1;\n    parentId = '-1';\n    srcId = data.records[0].get('ID');\n    Wb.request({url : 'm?xwl=xip/auth/func/DATA/updateFunTreeIndex',mask:app.tree1,\n                params : {idx:orderIndex, funTreeId:srcId, parentId:parentId},\n                failure : function() {\n                  //Wb.revertNodePos(src);\n                },\n                success : function() {\n                  data.records[0].set('parent_id', parentId);\n                  data.records[0].set('IDX', orderIndex);\n                  data.records[0].commit();\n                }\n               });\n  }else{\n    Wb.mask(app.tree1);\n    //srcId = om.get('ID');\n    srcId = data.records[0].get('ID');\n    if(dp=='append'){\n      om.expand(false,function(){\n        Wb.unmask(app.tree1);\n        pn = om;\n        parentId = om.get('ID');\n        orderIndex = Wb.getNode(data.records[0]).lastChild.previousSibling ? Wb.getNode(data.records[0]).lastChild.previousSibling.get('IDX') + 1: 1;\n        \n        if(Ext.isEmpty(parentId)){\n          parentId = '-1';\n        }\n        \n        Wb.request({url : 'm?xwl=xip/auth/func/DATA/updateFunTreeIndex',mask:app.tree1,\n                params : {idx:orderIndex, funTreeId:srcId, parentId:parentId},\n                failure : function() {\n                  Wb.revertNodePos(src);\n                },\n                success : function() {\n                  pn.eachChild(function(x) {\n                    var i = x.get('IDX');\n                    if (i >= orderIndex) {\n                      x.set('IDX', i + 1);\n                      x.commit();\n                    }\n                  });\n                  data.records[0].set('parent_id', parentId);\n                  data.records[0].set('IDX', orderIndex);\n                  data.records[0].commit();\n                }\n               });\n        \n      });\n    } else {\n      Wb.unmask(app.tree1);\n      pn = data.records[0].parentNode;\n      parentId = pn.get('ID');\n      if (dp == 'before'){\n        orderIndex = om.get('IDX');\n      }else{\n        orderIndex = om.get('IDX') + 1;\n      }\n      \n      if(Ext.isEmpty(parentId)){\n        parentId = '-1';\n      } \n      \n      Wb.request({url : 'm?xwl=xip/auth/func/DATA/updateFunTreeIndex',mask:app.tree1,\n                params : {idx:orderIndex, funTreeId:srcId, parentId:parentId},\n                failure : function() {\n                  Wb.revertNodePos(src);\n                },\n                success : function() {\n                  pn.eachChild(function(x) {\n                    var i = x.get('IDX');\n                    if (i >= orderIndex) {\n                      x.set('IDX', i + 1);\n                      x.commit();\n                    }\n                  });\n                  data.records[0].set('parent_id', parentId);\n                  data.records[0].set('IDX', orderIndex);\n                  data.records[0].commit();\n                }\n               });\n    }\n      \n    \n    \n    \n    \n    /*dst.expand(false,function(){\n    Wb.unmask(treePanel1);\n    srcId=src.get('ID');\n    if(dp=='append'){\n      pn = dst;\n      parentId = dst.get('ID');\n      orderIndex = dst.lastChild.previousSibling ?\n        dst.lastChild.previousSibling.get('IDX') + 1: 1;\n    } else {\n      pn = src.parentNode;\n      parentId = pn.get('ID');\n      if (dp == 'before')\n        orderIndex = dst.get('IDX');\n      else\n        orderIndex = dst.get('IDX') + 1;\n    }\n      \n    if(Ext.isEmpty(parentId)){\n      parentId = '-1';\n    }  \n      \n    Wb.request({url : 'main?xwl=23W6AX1F7PIN',mask:treePanel1,\n                params : {idx:orderIndex, funTreeId:srcId, parentId:parentId},\n                failure : function() {\n                  Wb.revertNodePos(src);\n                },\n                success : function() {\n                  pn.eachChild(function(x) {\n                    var i = x.get('IDX');\n                    if (i >= orderIndex) {\n                      x.set('IDX', i + 1);\n                      x.commit();\n                    }\n                  });\n                  src.set('parent_id', parentId);\n                  src.set('IDX', orderIndex);\n                  src.commit();\n                }\n               });\n  });*/\n  }\n}\n/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\nfunction treeNodeQuery(text,by,treeId) { \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = treeId;\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n}\n"},"children":[{"configs":{"itemId":"funcMenuInfoStore","url":"m?xwl=xip/auth/func/DATA/getFuncMenuById"},"events":{"load":"if(app.funcMenuInfoStore.getAt(0)) {\n  var record = app.funcMenuInfoStore.getAt(0);\n  \n  var upId = record.get('UP_ID');\n  var nodeType = record.get('NODE_TYPE');\n  var enableFlag = record.get('FUNC_ENABLE')==null?'':record.get('FUNC_ENABLE');\n  var enableFlagDesc = '';\n  \n  if(nodeType=='M'){\n    //app.menuFormPanel.loadRecord(record);\n    \n    app.MENU_UP_ID.setValue(record.get('UP_ID'));\n    app.MENU_ID.setValue(record.get('FUNC_ID'));\n    app.MENU_CODE.setValue(record.get('FUNC_CODE'));\n    app.MENU_NAME.setValue(record.get('FUNC_NAME'));\n    app.MENU_DESC.setValue(record.get('FUNC_DESC'));\n    \n    if(enableFlag=='Y'){\n      app.MENU_ENABLE.setValue(true);\n    }else if(enableFlag=='N'){\n      app.MENU_ENABLE.setValue(false);\n    }\n   \n  }else if(nodeType=='F'){\n    //app.functionFormPanel.loadRecord(record);\n    \n    app.FUNC_CODE.setValue(record.get('FUNC_CODE'));\n    app.FUNC_DESC.setValue(record.get('FUNC_DESC'));\n    app.FUNC_NAME.setValue(record.get('FUNC_NAME'));\n    app.FUNC_URL.setValue(record.get('FUNC_URL'));\n    app.FUNC_ID.setValue(record.get('FUNC_ID'));\n    app.SMALL_ICON.setValue(record.get('SMALL_ICON'));\n    app.LARGE_ICON.setValue(record.get('LARGE_ICON'));\n    app.MOBILE_URL.setValue(record.get('MOBILE_URL'));\n    app.IS_SYS.setValue(record.get('IS_SYS'));\n    app.FUNC_UP_ID.setValue(upId);\n    app.SHOW_STYLE.setValue(record.get('SHOW_STYLE'));\n    app.APP_COMB.store.load({params:{USER_ID:'{#userId#}'},callback:function() {\n      app.APP_COMB.setValue(record.get('APP_ID'));\n      app.APP_COMB.setRawValue(record.get('APP_NAME'));\n      //app.APP_COMB.expand();\n    }});\n    \n    \n    \n    if(enableFlag=='Y'){\n      app.FUNC_ENABLE.setValue(true);\n    }else if(enableFlag=='N'){\n      app.FUNC_ENABLE.setValue(false);\n    }\n    app.btnGrid.store.load({params:{FUNC_ID:app.FUNC_ID.getValue()}});\n    //Wb.unmask();\n    \n    if('{#godMoadl#}' != 'Y'){\n      if(record.get('IS_SYS')=='S'){\n        app.btn_func_save.disable();\n        app.btn_add_win.disable();\n        app.btn_edit_win.disable();\n        app.btn_delete_win.disable();\n        app.APP_COMB.setReadOnly(true);\n      }else{\n        app.btn_func_save.enable();\n        app.btn_add_win.enable();\n        app.btn_edit_win.enable();\n        app.btn_delete_win.enable();\n        app.APP_COMB.setReadOnly(false);\n      }\n    }else{\n      app.btn_func_save.enable();\n      app.btn_add_win.enable();\n      app.btn_edit_win.enable();\n      app.btn_delete_win.enable();\n      app.APP_COMB.setReadOnly(false);\n      \n    }\n    \n  }\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"singleBtnStore","url":"m?xwl=xip/auth/func/DATA/getBtnById"},"events":{"load":"if(app.singleBtnStore.getAt(0)) {\n  var record = app.singleBtnStore.getAt(0);\n  //app.buttonForm.loadRecord(record);\n  app.BTN_CODE_WIN.setValue(record.get('BTN_CODE_WIN'));\n  app.BTN_NAME_WIN.setValue(record.get('BTN_NAME_WIN'));\n  app.BTN_ID_WIN.setValue(record.get('BTN_ID_WIN'));\n  var enableFlag = record.get('BTN_ENABLE_WIN')==null?'':record.get('BTN_ENABLE_WIN');\n  if(enableFlag=='Y'){\n    app.BTN_ENABLE_WIN.setValue(true);\n  }else if(enableFlag=='N'){\n    app.BTN_ENABLE_WIN.setValue(false);\n  }\n  var _funId = app.FUNC_ID.getValue();\n  var _btnId = app.BTN_ID_WIN.getValue();\n  //Wb.load(userSecStore,{FUNC_ID:_funId,BTN_ID:_btnId});\n  app.secUserGrid.store.load({params:{FUNC_ID:_funId,BTN_ID:_btnId}});\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"menuPanelbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_save#}","itemId":"btn_menu_save","iconCls":"save_icon"},"events":{"click":"if(!app.menuFormPanel.getForm().isValid()){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkMust#}');\n  return;\n}\n\nvar menuId = app.MENU_ID.getValue();\n\nvar json = {\n  funcTreeId:'',\n  funcTreeCode:app.MENU_CODE.getValue(),\n  funcTreeName:app.MENU_NAME.getValue(),\n  upId:Ext.isEmpty(app.MENU_UP_ID.getValue()) ? '-1' : app.MENU_UP_ID.getValue(),\n  nodeType:'M',\n  desc:app.MENU_DESC.getValue(),\n  url:'',\n  mobUrl:'',\n  smallIcon:'',\n  largeIcon:'',\n  appId:'',\n  enableFlag:app.MENU_ENABLE.getValue()===true?'Y':'N',\n  addType:''\n};\n\nif(menuId=='-1'){//insert\n  json.addType = 'inneradd';\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      json.funcTreeId = resultJson.uuid;\n      Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/insertFuncMenu',\n        params:json,\n        success:function(){\n          if(json.nodeType == 'M'){\n            //Ext.getCmp('MENU_ID').setValue(resultJson.funcTreeId);\n            if(json.addType=='popadd'){\n              app.menuPanel.show();\n              app.funcPanel.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n              app.menuWin.hide();\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand();\n              if(json.menuOpType=='_append'){//添加子菜单\n                n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                n.commit();\n              }else{//添加同级菜单\n                n.parentNode.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                n.commit();\n              }\n              \n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }else if(json.nodeType == 'F'){\n            //Ext.getCmp('FUNC_ID').setValue(resultJson.funcTreeId); \n            if(json.addType=='popadd'){ \n              app.menuPanel.hide();\n              app.funcPanel.show();\n              app.funcWin.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand(); \n              n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, leaf:true});\n              n.commit();\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }\n        }\n      });\n    }\n  });\n  \n  //funcMenuInsert.request(json);\n}else{//update\n  json.funcTreeId = menuId;\n  json.addType = 'innerupdate';\n   Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/updateFuncMenu',\n        params:json,\n        success:function(){\n          var treeSelectNode = app.tree1.getSelectionModel().getSelection()[0];\n          if(json.nodeType == 'M'){\n          }else if(json.nodeType == 'F'){\n          }\n          treeSelectNode.set('text',json.funcTreeName);\n          treeSelectNode.commit();\n          Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n        }\n   });\n  //functionMenuUpdate.request(json);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"funcPanelBar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_save#}","itemId":"btn_func_save","iconCls":"save_icon"},"events":{"click":"if(!app.functionFormPanel.getForm().isValid()){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkMust#}');\n  return;\n}\n\nvar funcId = app.FUNC_ID.getValue();\n\nvar json = {\n  funcTreeId:'',\n  funcTreeCode:app.FUNC_CODE.getValue(),\n  funcTreeName:app.FUNC_NAME.getValue(),\n  upId:Ext.isEmpty(app.FUNC_UP_ID.getValue()) ? '-1' : app.FUNC_UP_ID.getValue(),\n  nodeType:'F',\n  desc:app.FUNC_DESC.getValue(),\n  url:app.FUNC_URL.getValue(),\n  mobUrl:app.MOBILE_URL.getValue(),\n  smallIcon:app.SMALL_ICON.getValue(),\n  largeIcon:app.LARGE_ICON.getValue(),\n  appId:app.APP_COMB.getValue(),\n  enableFlag:app.FUNC_ENABLE.getValue()===true?'Y':'N',\n  addType:'',\n  showStyle:app.SHOW_STYLE.getValue()\n};\n\nif(funcId=='-1'){//insert\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      json.funcTreeId = resultJson.uuid;\n    }\n  });\n  \n  json.addType = 'inneradd';\n  Wb.request({\n    url:'m?xwl=xip/auth/func/DATA/insertFuncMenu',\n    params:json,\n    success:function(response){\n      \n      var temp = response.responseText;\n      var resultJson = Ext.JSON.decode(temp);\n      if(resultJson.nodeType == 'M'){\n        //Ext.getCmp('MENU_ID').setValue(resultJson.funcTreeId);\n        if(resultJson.addType=='popadd'){\n          app.menuPanel.show();\n          app.funcPanel.hide();\n          app.funcMenuInfoStore.load({params:{func_tree_id:resultJson.funcTreeId}});\n          app.menuWin.hide();\n\n          var n = app.tree1.getSelectionModel().getSelection();\n          n.expand();\n\n          if(resultJson.menuOpType=='_append'){//添加子菜单\n            n.appendChild({text:resultJson.funcTreeName, ID:resultJson.funcTreeId, parent_id:resultJson.upId, NODE_TYPE:resultJson.nodeType, children:[]});\n            n.commit();\n          }else{//添加同级菜单\n            n.parentNode.appendChild({text:resultJson.funcTreeName, ID:resultJson.funcTreeId, parent_id:resultJson.upId, NODE_TYPE:resultJson.nodeType, children:[]});\n            n.commit();\n          }\n\n          Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n        }\n      }else if(resultJson.nodeType == 'F'){\n        //Ext.getCmp('FUNC_ID').setValue(resultJson.funcTreeId); \n        if(resultJson.addType=='popadd'){ \n          app.menuPanel.hide();\n          app.funcPanel.show();\n          app.funcWin.hide();\n          app.funcMenuInfoStore.load({params:{func_tree_id:resultJson.funcTreeId}});\n\n          var n = app.tree1.getSelectionModel().getSelection();\n          n.expand(); \n\n          n.appendChild({text:resultJson.funcTreeName, ID:resultJson.funcTreeId, parent_id:resultJson.upId, NODE_TYPE:resultJson.nodeType, leaf:true});\n          n.commit();\n\n          Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n        }\n      }\n    }\n  });\n  //funcMenuInsert.request(json);\n}else{//update\n  json.funcTreeId = funcId;\n  json.addType = 'innerupdate';\n  \n  Wb.request({\n    url:'m?xwl=xip/auth/func/DATA/updateFuncMenu',\n    params:json,\n    success:function(response){\n//       var temp = response.responseText;\n//       var resultJson = Ext.JSON.decode(temp);\n//       if(resultJson.nodeType == 'M'){\n//       }else if(resultJson.nodeType == 'F'){\n//       }\n      var treeSelectNode = app.tree1.getSelectionModel().getSelection();\n      treeSelectNode[0].set('text',json.funcTreeName);\n      treeSelectNode[0].commit();\n      Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n     }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_funhelpset#}","itemId":"btn_func_instruction","iconCls":"help_icon"},"events":{"click":"if(app.FUNC_ID.getValue()==-1){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveFuncFirst#}');\n  return;\n}\n\nvar editorType = 'r';\nif('{#godMoadl#}' != 'Y'){\n  if(app.IS_SYS.getValue()=='S'){\n    editorType = 'r';\n  }else{\n    editorType = 'rw';\n  }\n}else{\n  editorType = 'rw';\n}\n\nvar path = \"{#contextPath#}\"+\"/xip/kindeditor4/editor.jsp?type=\"+editorType+\"&funTreeId=\"+app.FUNC_ID.getValue();\nvar functionDescWin = new Ext.Window({\n  id:'functionDescWin',\n  title : '{#xip_auth_func_funhelpset#}',\n  buttonAlign:'center',\n  width: 770,\n  resizable: false,\n  maximizable: false,\n  height:500, \n  style:'border-width:0px',\n  layout: 'fit',\n  modal : true,\n  /*tbar:new Ext.toolbar.Toolbar(['-',\n                        new Ext.Button({\n                          text:'保存',\n                          iconCls:'icon-save',\n                          handler:function(){\n                            var funcHelp = window.frames['functionDescPage'].getValueForEditor();\n                            \n                            funcHelpSave.request({funcTreeId:Ext.getCmp('FUNC_ID').getValue(),funcHelp:funcHelp});\n\n                          }\n                        }),'-'\n                       ]),*/\n  tbar:new Ext.toolbar.Toolbar({\n    items:[\n      '-',{\n        iconCls:\"save_icon\",\n        xtype:\"button\",\n        text:'{#xip_auth_func_save#}',\n        disabled:editorType=='r'?true:false,\n        listeners:{\n          click:function(button,event,options){\n            var funcHelp = window.frames['functionDescPage'].getValueForEditor();\n            var json = {funcTreeId:app.FUNC_ID.getValue(),funcHelp:funcHelp};\n            Wb.request({\n              url:'m?xwl=xip/auth/func/DATA/saveFuncHelp',\n              params:json,\n              success:function(){\n                Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n              }\n            });\n            //funcHelpSave.request({funcTreeId:app.FUNC_ID.getValue(),funcHelp:funcHelp});\n          }\n        }\n      },'-']}),\n  items:[\n    {  title: '{#xip_auth_func_funhelpset#}', \n     header:false, \n     html : '<iframe name=\"functionDescPage\",style=\"border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; width: 100%; height: 440px; border-right-width: 0px\" src=\"'+path+'\" frameborder=\"0\" width=\"100%\" scrolling=\"no\" height=\"440px\"><\/iframe>', \n     border:false \n    }\n  ],\n  listeners:{\n    'close':function(){}\n  }\n});\nfunctionDescWin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"功能帮助预览","hidden":"true","itemId":"btn_func_instruction_view"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"winBtn"},"children":[{"configs":{"itemId":"funcWinBtns"},"children":[{"configs":{"text":"{#xip_auth_func_ok#}","itemId":"funcWinOk","iconCls":"ok_icon"},"events":{"click":"if(!app.form2.getForm().isValid()){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkMust#}');\n  return;\n}\n\nvar json = {\n  funcTreeId:'',\n  funcTreeCode:app.FUNC_CODE1.getValue(),\n  funcTreeName:app.FUNC_NAME1.getValue(),\n  upId:Ext.isEmpty(app.FUNC_UP_ID1.getValue()) ? '-1' : app.FUNC_UP_ID1.getValue(),\n  nodeType:'F',\n  desc:'',\n  url:app.FUNC_URL1.getValue(),\n  mobUrl:'',\n  smallIcon:'',\n  largeIcon:'',\n  appId:app.APP_COMB1.getValue(),\n  enableFlag:app.FUNC_ENABLE1.getValue()==true?'Y':'N',\n  addType:'popadd',\n  showStyle:app.SHOW_STYLE1.getValue()\n};\n\nWb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      json.funcTreeId = resultJson.uuid;\n      Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/insertFuncMenu',\n        params:json,\n        success:function(){\n          if(json.nodeType == 'M'){\n            //Ext.getCmp('MENU_ID').setValue(resultJson.funcTreeId);\n            if(json.addType=='popadd'){\n              app.menuPanel.show();\n              app.funcPanel.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n              app.menuWin.hide();\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand();\n              if(json.menuOpType=='_append'){//添加子菜单\n                var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(c);\n                n.commit();\n              }else{//添加同级菜单\n                var cn = n.parentNode.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(cn);\n                n.commit();\n              }\n              \n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }else if(json.nodeType == 'F'){\n            //Ext.getCmp('FUNC_ID').setValue(resultJson.funcTreeId); \n            if(json.addType=='popadd'){ \n              app.menuPanel.hide();\n              app.funcPanel.show();\n              app.funcWin.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand(); \n              var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, leaf:true});\n              app.tree1.view.select(c);\n              n.commit();\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }\n        }\n      });\n    }\n  });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_func_cancel#}","itemId":"funcWinCancle","iconCls":"cancel_icon"},"events":{"click":"app.funcWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"selectIconWinBtns"},"children":[{"configs":{"text":"{#xip_auth_func_ok#}","itemId":"selectIconConfirmBtn","iconCls":"ok_icon"},"events":{"click":"if(selectRecord!=null){\n  var name = selectRecord.data.NAME;\n\n  var sType = app.selectType.getValue();\n\n  if(sType=='smallIcon'){\n    app.SMALL_ICON.setValue(name);\n  }else if(sType=='largeIcon'){\n    app.LARGE_ICON.setValue(name); \n  }\n}\napp.selectIconWin.hide();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_func_clear#}","itemId":"selectIconClearBtn","iconCls":"cancel_icon"},"events":{"click":"var sType = app.selectType.getValue();\n\nif(sType=='smallIcon'){\n  app.SMALL_ICON.setValue('');\n}else if(sType=='largeIcon'){\n  app.LARGE_ICON.setValue(''); \n}\n\napp.selectIconWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"btnWinBtns"},"children":[{"configs":{"text":"{#xip_auth_func_save#}","itemId":"btn_btnsave","iconCls":"save_icon"},"events":{"click":"//数据校验\nif(app.BTN_CODE_WIN.getValue()==''){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_btnCodeNotNull#}');\n  return;\n}\n\nif(app.BTN_NAME_WIN.getValue()==''){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_btnNameNotNull#}');\n  return;\n}\n\nvar json = {\n  'BTN_ID':app.BTN_ID_WIN.getValue(),\n  'BTN_CODE':app.BTN_CODE_WIN.getValue(),\n  'BTN_NAME':app.BTN_NAME_WIN.getValue(),\n  'BTN_ENABLE':app.BTN_ENABLE_WIN.getValue()===true?'Y':'N',\n  'FUNC_ID':app.FUNC_ID.getValue(),\n  'IS_ADD_NEXT':'N'\n};\n\n//数据保存\nvar opType = app.OP_FLAG.getValue();\n\nif(opType=='_added'){//新增\n  Wb.request({\n    url :'m?xwl=xip/auth/func/DATA/insertBtn_win',\n    params:json,\n    success:function(){\n        Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n\n        if(json.IS_ADD_NEXT == 'Y'){\n          Wb.reset(app.buttonFieldSet);\n          app.OP_FLAG.setValue('_added');\n          Wb.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n              success:function(response){\n                var temp = response.responseText;\n                var resultJson = Wb.decode(temp);\n                app.BTN_ID_WIN.setValue(resultJson.uuid);\n              }\n          });\n          //Wb.load(userSecStore,{FUNC_ID:'-1',BTN_ID:'-1'});\n          app.secUserGrid.store.load({params:{FUNC_ID:'-1',BTN_ID:'-1'}});\n\n          app.btnWin.setTitle('{#xip_auth_func_btnAdd#}');\n        }else{\n          app.OP_FLAG.setValue('_modified');\n          app.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n}\n    }\n  });\n}else{//编辑\n  Wb.request({\n    url:'m?xwl=xip/auth/func/DATA/updateBtn_win',\n    params:json,\n    success:function(){\n      Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n\n      if(json.IS_ADD_NEXT == 'Y'){\n        Wb.reset(app.buttonFieldSet);\n        app.OP_FLAG.setValue('_added');\n        Wb.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n              success:function(response){\n                var temp = response.responseText;\n                var resultJson = Wb.decode(temp);\n                app.BTN_ID_WIN.setValue(resultJson.uuid);\n              }\n          });\n        app.secUserGrid.store.load({params:{FUNC_ID:'-1',BTN_ID:'-1'}});\n\n        app.btnWin.setTitle('{#xip_auth_func_btnAdd#}');\n      }else{\n        app.OP_FLAG.setValue('_modified');\n        app.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n      }\n    }\n  });\n  //btnUpdate.request(json);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_func_saveNext#}","itemId":"btn_btnsave_next"},"events":{"click":"//数据校验\nif(app.BTN_CODE_WIN.getValue()==''){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_btnCodeNotNull#}');\n  return;\n}\n\nif(app.BTN_NAME_WIN.getValue()==''){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_btnNameNotNull#}');\n  return;\n}\n\nvar json = {\n  'BTN_ID':app.BTN_ID_WIN.getValue(),\n  'BTN_CODE':app.BTN_CODE_WIN.getValue(),\n  'BTN_NAME':app.BTN_NAME_WIN.getValue(),\n  'BTN_ENABLE':app.BTN_ENABLE_WIN.getValue()==true?'Y':'N',\n  'FUNC_ID':app.FUNC_ID.getValue(),\n  'IS_ADD_NEXT':'Y'\n};\n\n//数据保存\nvar opType = app.OP_FLAG.getValue();\n\nif(opType=='_added'){//新增\n  Wb.request({\n    url :'m?xwl=xip/auth/func/DATA/insertBtn_win',\n    params:json,\n    success:function(){\n        Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n\n        if(json.IS_ADD_NEXT == 'Y'){\n          Wb.reset(app.buttonFieldSet);\n          app.OP_FLAG.setValue('_added');\n          Wb.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n              success:function(response){\n                var temp = response.responseText;\n                var resultJson = Wb.decode(temp);\n                app.BTN_ID_WIN.setValue(resultJson.uuid);\n              }\n          });\n          //Wb.load(userSecStore,{FUNC_ID:'-1',BTN_ID:'-1'});\n          app.secUserGrid.store.load({params:{FUNC_ID:'-1',BTN_ID:'-1'}});\n\n          app.btnWin.setTitle('{#xip_auth_func_btnAdd#}');\n        }else{\n          app.OP_FLAG.setValue('_modified');\n          app.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n}\n    }\n  });\n}else{//编辑\n  Wb.request({\n    url:'m?xwl=xip/auth/func/DATA/updateBtn_win',\n    params:json,\n    success:function(){\n      Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n\n      if(json.IS_ADD_NEXT == 'Y'){\n        Wb.reset(app.buttonFieldSet);\n        app.OP_FLAG.setValue('_added');\n        Wb.request({\n              url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n              success:function(response){\n                var temp = response.responseText;\n                var resultJson = Wb.decode(temp);\n                app.BTN_ID_WIN.setValue(resultJson.uuid);\n              }\n          });\n        app.secUserGrid.store.load({params:{FUNC_ID:'-1',BTN_ID:'-1'}});\n\n        app.btnWin.setTitle('{#xip_auth_func_btnAdd#}');\n      }else{\n        app.OP_FLAG.setValue('_modified');\n        app.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n      }\n    }\n  });\n  //btnUpdate.request(json);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_func_close#}","itemId":"btn_btnclose","iconCls":"cancel_icon"},"events":{"click":"app.btnWin.hide();\napp.btnGrid.store.reload();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"menuWinBtns"},"children":[{"configs":{"text":"{#xip_auth_func_ok#}","itemId":"menuWinOk","iconCls":"ok_icon"},"events":{"click":"if(Ext.isEmpty(app.MENU_CODE1.getValue())||Ext.isEmpty(app.MENU_NAME1.getValue())){\n  Ext.MessageBox.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkMust#}');\n  return;\n}\n\nvar json = {\n  funcTreeId:'',\n  funcTreeCode:app.MENU_CODE1.getValue(),\n  funcTreeName:app.MENU_NAME1.getValue(),\n  upId:Ext.isEmpty(app.MENU_UP_ID1.getValue()) ? '-1' : app.MENU_UP_ID1.getValue(),\n  nodeType:'M',\n  desc:app.MENU_DESC1.getValue(),\n  url:'',\n  mobUrl:'',\n  smallIcon:'',\n  largeIcon:'',\n  appId:'',\n  enableFlag:app.MENU_ENABLE1.getValue()===true?'Y':'N',\n  addType:'popadd',\n  menuOpType:app.MENU_OP_TYPE.getValue()\n};\nWb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      json.funcTreeId = resultJson.uuid;\n      Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/insertFuncMenu',\n        params:json,\n        success:function(response){\n          if(json.nodeType == 'M'){\n            //Ext.getCmp('MENU_ID').setValue(resultJson.funcTreeId);\n            if(json.addType=='popadd'){\n              app.menuPanel.show();\n              app.funcPanel.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n              app.menuWin.hide();\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand();\n\n              if(json.menuOpType=='_append'){//添加子菜单\n                var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(c);\n                n.commit();\n              }else{//添加同级菜单\n                var cn = n.parentNode.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(cn);\n                n.commit();\n              }\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }else if(json.nodeType == 'F'){\n            //Ext.getCmp('FUNC_ID').setValue(resultJson.funcTreeId); \n            if(json.addType=='popadd'){ \n              app.menuPanel.hide();\n              app.funcPanel.show();\n              app.funcWin.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand(); \n\n              var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, leaf:true});\n              app.tree1.view.select(c);\n              n.commit();\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }\n        }\n      });\n    }\n  });\n//funcMenuInsert.request(json);\n  "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_func_cancel#}","itemId":"menuWinCancle","iconCls":"cancel_icon"},"events":{"click":"app.menuWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"win"},"children":[{"configs":{"height":"240","layout":"fit","width":"380","closeAction":"hide","resizable":"false","buttons":"app.funcWinBtns","buttonAlign":"center","itemId":"funcWin","dialog":"true","modal":"true"},"events":{"hide":"app.form2.getForm().reset();","ok":"if(!app.form2.getForm().isValid()){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkMust#}');\n  return;\n}\n\nvar json = {\n  funcTreeId:'',\n  funcTreeCode:app.FUNC_CODE1.getValue(),\n  funcTreeName:app.FUNC_NAME1.getValue(),\n  upId:Ext.isEmpty(app.FUNC_UP_ID1.getValue()) ? '-1' : app.FUNC_UP_ID1.getValue(),\n  nodeType:'F',\n  desc:'',\n  url:app.FUNC_URL1.getValue(),\n  mobUrl:'',\n  smallIcon:'',\n  largeIcon:'',\n  appId:app.APP_COMB1.getValue(),\n  enableFlag:app.FUNC_ENABLE1.getValue()==true?'Y':'N',\n  addType:'popadd',\n  showStyle:app.SHOW_STYLE1.getValue()\n};\n\nWb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      json.funcTreeId = resultJson.uuid;\n      Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/insertFuncMenu',\n        params:json,\n        success:function(){\n          if(json.nodeType == 'M'){\n            //Ext.getCmp('MENU_ID').setValue(resultJson.funcTreeId);\n            if(json.addType=='popadd'){\n              app.menuPanel.show();\n              app.funcPanel.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n              app.menuWin.hide();\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand();\n              if(json.menuOpType=='_append'){//添加子菜单\n                var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(c);\n                n.commit();\n              }else{//添加同级菜单\n                var cn = n.parentNode.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(cn);\n                n.commit();\n              }\n              \n              Ext.Msg.alert('{#xip_auth_func_tips#}{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }else if(json.nodeType == 'F'){\n            //Ext.getCmp('FUNC_ID').setValue(resultJson.funcTreeId); \n            if(json.addType=='popadd'){ \n              app.menuPanel.hide();\n              app.funcPanel.show();\n              app.funcWin.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand(); \n              var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, leaf:true});\n              app.tree1.view.select(c);\n              n.commit();\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }\n        }\n      });\n    }\n  });"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"fit","itemId":"form2","border":"false"},"children":[{"configs":{"bodyStyle":"padding: 10px 40px 0px","frame":"true","style":"border-width:0px","layout":"form","width":"300","columnWidth":".4","itemId":"panel1","border":"false"},"children":[{"configs":{"hidden":"true","itemId":"FUNC_UP_ID1"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"FUNC_ID1","fieldLabel":"功能id"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","displayField":"APP_NAME","width":"250","valueField":"APP_ID","labelAlign":"right","itemId":"APP_COMB1","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_func_app#}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/auth/func/DATA/getApps"},"events":{"beforeload":"store.getProxy().extraParams.USER_ID = '{#userId#}';"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"FUNC_CODE1","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_func_funCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"FUNC_NAME1","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_func_funName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"FUNC_URL1","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_func_funurl#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","value":"TAB","labelAlign":"right","pickList":"[['TAB','{#xip_auth_func_tab#}'],['WIN','{#xip_auth_func_win#}'],['BRO','{#xip_auth_func_bro#}']]","itemId":"SHOW_STYLE1","fieldLabel":"{#xip_auth_func_displayusage#}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"FUNC_ENABLE1","fieldLabel":"{#xip_auth_func_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"height":"200","layout":"fit","width":"350","closeAction":"hide","resizable":"false","buttonAlign":"center","buttons":"app.menuWinBtns","itemId":"menuWin","dialog":"true","modal":"true"},"events":{"hide":"app.form1.getForm().reset();","ok":"if(Ext.isEmpty(app.MENU_CODE1.getValue())||Ext.isEmpty(app.MENU_NAME1.getValue())){\n  Ext.MessageBox.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkMust#}');\n  return;\n}\n\nvar json = {\n  funcTreeId:'',\n  funcTreeCode:app.MENU_CODE1.getValue(),\n  funcTreeName:app.MENU_NAME1.getValue(),\n  upId:Ext.isEmpty(app.MENU_UP_ID1.getValue()) ? '-1' : app.MENU_UP_ID1.getValue(),\n  nodeType:'M',\n  desc:app.MENU_DESC1.getValue(),\n  url:'',\n  mobUrl:'',\n  smallIcon:'',\n  largeIcon:'',\n  appId:'',\n  enableFlag:app.MENU_ENABLE1.getValue()===true?'Y':'N',\n  addType:'popadd',\n  menuOpType:app.MENU_OP_TYPE.getValue()\n};\nWb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      json.funcTreeId = resultJson.uuid;\n      Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/insertFuncMenu',\n        params:json,\n        success:function(response){\n          if(json.nodeType == 'M'){\n            //Ext.getCmp('MENU_ID').setValue(resultJson.funcTreeId);\n            if(json.addType=='popadd'){\n              app.menuPanel.show();\n              app.funcPanel.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n              app.menuWin.hide();\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand();\n\n              if(json.menuOpType=='_append'){//添加子菜单\n                var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(c);\n                n.commit();\n              }else{//添加同级菜单\n                var cn = n.parentNode.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, children:[]});\n                app.tree1.view.select(cn);\n                n.commit();\n              }\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }else if(json.nodeType == 'F'){\n            //Ext.getCmp('FUNC_ID').setValue(resultJson.funcTreeId); \n            if(json.addType=='popadd'){ \n              app.menuPanel.hide();\n              app.funcPanel.show();\n              app.funcWin.hide();\n              app.funcMenuInfoStore.load({params:{func_tree_id:json.funcTreeId}});\n\n              var n = app.tree1.getSelectionModel().getSelection()[0];\n              n.expand(); \n\n              var c = n.appendChild({text:json.funcTreeName, ID:json.funcTreeId, parent_id:json.upId, NODE_TYPE:json.nodeType, leaf:true});\n              app.tree1.view.select(c);\n              n.commit();\n\n              Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_saveSuccess#}');\n            }\n          }\n        }\n      });\n    }\n  });\n//funcMenuInsert.request(json);\n  "},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"fit","itemId":"form1","border":"false"},"children":[{"configs":{"bodyStyle":"padding: 10px 40px 0px","frame":"true","style":"border-width:0px","layout":"form","columnWidth":".4","itemId":"panel1","border":"false"},"children":[{"configs":{"hidden":"true","itemId":"MENU_OP_TYPE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MENU_UP_ID1"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MENU_ID1","fieldLabel":"菜单id"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"MENU_CODE1","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_func_menuCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"MENU_NAME1","fieldLabel":"<font color='red'>*<\/font>{#xip_auth_func_menuName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"MENU_DESC1","fieldLabel":"{#xip_auth_func_menuDesc#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"MENU_ENABLE1","fieldLabel":"{#xip_auth_func_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"height":"500","width":"650","layout":"border","minimizable":"false","resizable":"false","closeAction":"hide","buttons":"app.btnWinBtns","buttonAlign":"center","itemId":"btnWin","modal":"true","maximizable":"false"},"events":{"close":"app.btnWin.hide();\napp.btnGrid.store.reload();"},"children":[{"configs":{"region":"north","frame":"true","height":"110","style":"border-width:0px","layout":"fit","itemId":"buttonForm","border":"false"},"children":[{"configs":{"title":"{#xip_auth_func_buttons_info#}","layout":"column","itemId":"buttonFieldSet"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".4","itemId":"panel1","border":"false"},"children":[{"configs":{"hidden":"true","labelAlign":"right","itemId":"OP_FLAG","fieldLabel":"操作标记（新增、编辑）"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"BTN_ID_WIN"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"BTN_CODE_WIN","fieldLabel":"{#xip_auth_func_buttonCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"BTN_ENABLE_WIN","fieldLabel":"{#xip_auth_func_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".4","itemId":"panel2","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"BTN_NAME_WIN","fieldLabel":"{#xip_auth_func_buttonName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"fit","itemId":"panel1","border":"false"},"children":[{"configs":{"title":"{#xip_auth_func_buttons_disable_auth#}","layout":"fit","itemId":"fieldset1"},"children":[{"configs":{"region":"south","multiSelect":"true","selType":"checkboxmodel","itemId":"secUserGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_addDisableUser#}","itemId":"btn_adduser","iconCls":"law_icon"},"events":{"click":"//数据校验\nif(app.BTN_CODE_WIN.getValue()==''){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_btnCodeNotNull#}');\n  return;\n}\n\nif(app.BTN_NAME_WIN.getValue()==''){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_btnNameNotNull#}');\n  return;\n}\n\nvar json = {\n  'BTN_ID':app.BTN_ID_WIN.getValue(),\n  'BTN_CODE':app.BTN_CODE_WIN.getValue(),\n  'BTN_NAME':app.BTN_NAME_WIN.getValue(),\n  'BTN_ENABLE':app.BTN_ENABLE_WIN.getValue()==true?'Y':'N',\n  'FUNC_ID':app.FUNC_ID.getValue()\n};\n\n//数据保存\nvar opType = app.OP_FLAG.getValue();\n\nExt.Msg.wait('{#xip_auth_func_waitSaving#}');\nif(opType=='_added'){//新增\n  Wb.request({\n      url : 'm?xwl=xip/auth/func/DATA/insertBtn_win',\n      method: 'POST',\n      params:json,\n      success: function(response){\n        Ext.Msg.hide();\n        //var returnJson = Ext.JSON.decode(response.responseText);\n        \n        //executorStore.getProxy().extraParams.actId = actId;\n\t\t//Wb.load(executorAuthStore);\n        \n        app.OP_FLAG.setValue('_modified');\n  \t\tapp.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n        \n        app.selectWinBtnId.setValue(app.BTN_ID_WIN.getValue());\n        app.selectWinFuncId.setValue(app.FUNC_ID.getValue());\n        \n        app.userSelectWin.show();\n        \n        app.userSelectGrid.store.load({params:{selectWinBtnId:app.selectWinBtnId.getValue(),selectWinFuncId:app.selectWinFuncId.getValue()}});\n      },\n      failure: function(response,options){\n        Ext.Msg.hide();\n        Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_requestFailure#}');\n      }\n    });\n}else{//编辑\n  Wb.request({\n      url : 'm?xwl=xip/auth/func/DATA/updateBtn_win',\n      params:json,\n      success: function(response){\n        Ext.Msg.hide();\n        //var returnJson = Ext.JSON.decode(response.responseText);\n        \n        //executorStore.getProxy().extraParams.actId = actId;\n\t\t//Wb.load(executorAuthStore);\n        \n        app.OP_FLAG.setValue('_modified');\n  \t\tapp.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n        \n        app.selectWinBtnId.setValue(app.BTN_ID_WIN.getValue());\n        app.selectWinFuncId.setValue(app.FUNC_ID.getValue());\n        app.userSelectWin.show();\n        \n        app.userSelectGrid.store.load({params:{selectWinBtnId:app.selectWinBtnId.getValue(),selectWinFuncId:app.selectWinFuncId.getValue()}});\n      }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_delDisableUser#}","itemId":"btn_deleteuser","iconCls":"settings2_icon"},"events":{"click":"var rows = app.secUserGrid.getSelectionModel().getSelection();\n\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_selectDelRecord#}');\n  return false ;\n}else{\n  Ext.Msg.confirm('{#xip_auth_func_tips#}','{#xip_auth_func_ensureDelete#}',function(a){\n    if(a=='yes'){\n      \n      var ids = \"\";\n      Ext.each(rows,function(item){\n        var id = \"'\"+item.data.USER_BTNS_ID+\"'\";\n        if(ids === \"\"){\n            ids = id ;\n          }else{\n            ids = ids+\",\"+id;\n          }\n\n      });  \n      var json = {ids:ids};\n      Wb.request({\n        url:'m?xwl=xip/auth/func/DATA/deleteBtnSec',\n        params:json,\n        success:function(){\n          Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_deleteSuccess#}');\n          app.singleBtnStore.load();\n        }\n      });\n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xip/auth/func/DATA/getSecUsers"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_username#}","dataIndex":"USER_NAME","itemId":"USER_NAME_SECGRID","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_SECGRID","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"USER_BTNS_ID","itemId":"USER_BTNS_ID_SECGRID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"TYPE","itemId":"TYPE_SECGRID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID_SECGRID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BTN_ID","itemId":"BTN_ID_SECGRID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CAN_USE","itemId":"CAN_USE_SECGRID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"FUN_TREE_ID","itemId":"FUN_TREE_ID_SECGRID"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_auth_func_addAuthUser#}","height":"380","width":"580","layout":"border","closeAction":"hide","itemId":"userSelectWin","dialog":"true","modal":"true"},"events":{"ok":"var rows = app.userSelectGrid.getSelectionModel().getSelection();\nif(rows.length==0){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_checkSelectRecord#}');\n}else{\n  var indertArray = [];\n  for(var i=0; i<rows.length; i++){\n    var target_id = rows[i].get('USER_ID');\n//      Wb.request({\n//               url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n//               success:function(response){\n//                 var temp = response.responseText;\n//                 var resultJson = Wb.decode(temp);\n//                 var _record = {\n//                       USER_BTNS_ID:resultJson.uuid,\n//                       TYPE:'U',\n//                       TARGET_ID:target_id,\n//                       BTN_ID:app.selectWinBtnId.getValue(),\n//                       CAN_USE:'N',\n//                       FUN_TREE_ID:app.selectWinFuncId.getValue()\n//                 };\n//                 indertArray.push(_record);\n//                 alert(indertArray.length);\n                \n//               }\n//      });\n                var _record = {\n                      USER_BTNS_ID:'',\n                      TYPE:'U',\n                      TARGET_ID:target_id,\n                      BTN_ID:app.selectWinBtnId.getValue(),\n                      CAN_USE:'N',\n                      FUN_TREE_ID:app.selectWinFuncId.getValue()\n                };\n                indertArray.push(_record);\n  }\n  Wb.request({\n    url :'m?xwl=xip/auth/func/DATA/insertBtnSec',\n    params: Wb.apply({\n                indertArray:Ext.JSON.encode(indertArray)\n           }),\n    success:function(){\n      app.userSelectWin.hide();\n      var _funId = app.FUNC_ID.getValue();\n      var _btnId = app.BTN_ID_WIN.getValue();\n      //Wb.load(userSecStore,{FUNC_ID:_funId, BTN_ID:_btnId});\n      app.secUserGrid.store.load({params:{FUNC_ID:_funId, BTN_ID:_btnId}});\n    }\n  });\n  \n}"},"children":[{"configs":{"region":"north","frame":"true","height":"65","style":"border-width:0px","layout":"fit","itemId":"userSelectForm"},"children":[{"configs":{"title":"{#xip_auth_func_queryCondition#}","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"hidden":"true","itemId":"selectWinBtnId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"selectWinFuncId"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"70","width":"180","labelAlign":"right","itemId":"userName","fieldLabel":"{#xip_auth_func_username#}"},"events":{"specialkey":"app.userSelectGrid.store.reload({params:{\n                                         userName:app.userName.getValue(),\n                                         empName:app.empName.getValue(),\n                                         selectWinBtnId:app.selectWinBtnId.getValue(),\n                                         selectWinFuncId:app.selectWinFuncId.getValue()}\n                                });"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"70","width":"180","labelAlign":"right","itemId":"empName","fieldLabel":"{#xip_auth_func_empName#}"},"events":{"specialkey":"app.userSelectGrid.store.reload({params:{\n                                         userName:app.userName.getValue(),\n                                         empName:app.empName.getValue(),\n                                         selectWinBtnId:app.selectWinBtnId.getValue(),\n                                         selectWinFuncId:app.selectWinFuncId.getValue()}\n                                });"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_auth_func_query#}","itemId":"quertBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.userSelectGrid.store.reload({params:{\n                                         userName:app.userName.getValue(),\n                                         empName:app.empName.getValue(),\n                                         selectWinBtnId:app.selectWinBtnId.getValue(),\n                                         selectWinFuncId:app.selectWinFuncId.getValue()}\n                                });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_auth_func_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"app.userName.setValue('');\napp.empName.setValue('');\napp.userSelectGrid.store.reload({params:{\n                                         userName:app.userName.getValue(),\n                                         empName:app.empName.getValue(),\n                                         selectWinBtnId:app.selectWinBtnId.getValue(),\n                                         selectWinFuncId:app.selectWinFuncId.getValue()}\n                                });"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"userSelectGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/auth/func/DATA/getUsers"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"用户id","hidden":"true","dataIndex":"USER_ID","itemId":"COLUMN_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_username#}","dataIndex":"USER_NAME","itemId":"COLUMN_USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_empCode#}","dataIndex":"EMP_CODE","itemId":"COLUMN_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_empName#}","dataIndex":"EMP_NAME","itemId":"COLUMN_EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_empType#}","dataIndex":"USER_TYPE","itemId":"COLUMN_USER_TYPE","renderer":"if(value=='S'){\n  return '{#xip_auth_func_sysUser#}';\n}else if(value=='U'){\n  return '{#xip_auth_func_personalUser#}';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_startTime#}","dataIndex":"START_DATE","itemId":"COLUMN_START_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xiP_auth_func_endTime#}","dataIndex":"END_DATE","itemId":"COLUMN_END_DATE"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"height":"400","layout":"fit","width":"650","closeAction":"hide","buttonAlign":"right","buttons":"app.selectIconWinBtns","itemId":"selectIconWin","modal":"true"},"children":[{"configs":{"region":"center","itemSelector":"div.thumb-wrap","tagConfigs":"id:'dataview'","autoScroll":"true","tpl":"<tpl for=\".\">\n  <div class=\"thumb-wrap\">\n    <div class=\"thumb\">\n      <img src=\"{URL}\" title=\"{NAME}\">\n    <\/div>\n  <\/div>\n<\/tpl>\n<div class=\"x-clear\"><\/div>","itemId":"dataview1","padding":"8"},"events":{"itemdblclick":"var name = record.data.NAME;\n\nvar sType = app.selectType.getValue();\n\nif(sType=='smallIcon'){\n  app.SMALL_ICON.setValue(name);\n}else if(sType=='largeIcon'){\n  app.LARGE_ICON.setValue(name); \n}\n\napp.selectIconWin.hide();\n","selectionchange":"if(selected.length>0){\n  selectRecord = selected[0];\n}else{\n  selectRecord = null;\n}\n  \n"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"{#contextPath#}/frameAction.do?method=getIcons"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"dataview"},{"configs":{"itemId":"selectType"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"window"}],"expanded":false,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"// var _tipCode = '{#tipCode#}';\n// var _orgTip = Wb.getCookie(_tipCode);\n// if(Ext.isEmpty(_orgTip)){\n//   MsgTip.msg('<font color=\"red\">提示<\/font>', '鼠标右键点击左边功能菜单或其下的节点进行操作,<br>拖动文件夹(菜单)或功能节点可以改变顺序和上下级.',null,null,_tipCode, true);  \n// }\nWb.toast('<font color=\"red\" style=\"font-weight:bold\">{#xip_auth_func_tips#}<\/font><br>'+'{#xip_auth_func_operateInfo#}');"},"children":[{"configs":{"region":"west","rootVisible":"true","animate":"false","root":"{id:'rootNode',text:'{#xip_auth_func_funmenu#}',expanded:true}","width":"300","split":"true","itemId":"tree1","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: beforeDropType,\n    drop: dropType\n  }\n}"},"events":{"itemclick":"// var _tmp = document.getElementById('_toolTipsClickHide');\n// if(_tmp){\n//   MsgTip.hide(_tmp);\n// }\nvar id = record.get(\"id\");\nif(id=='rootNode'){\n  return;\n}\n\nvar funcTreeId = record.get('ID');\nvar nodeType = record.get('NODE_TYPE');\n\nif(nodeType=='M'){\n  app.menuPanel.show();\n  app.funcPanel.hide();\n  \n  //app.MENU_CODE.setReadOnly(true);\n  \n}else if(nodeType=='F'){\n  app.menuPanel.hide();\n  app.funcPanel.show();\n}\n\napp.funcMenuInfoStore.load({params:{func_tree_id:funcTreeId}});","tagEvents":"itemcontextmenu:function(view,record,item,index,event,options){\n  event.preventDefault();\n  event.stopEvent();\n  record.expand();\n  var id = record.get('id');\n  var nodeType = record.get('NODE_TYPE');\n  var parentId = record.get('parent_id');\n  var nodeId = record.get('ID');\n  var nodemenu;\n\n  var disableDelBtn = false;\n  if('{#godMoadl#}' != 'Y'){\n    if(record.get('IS_SYS')=='S'){\n      app.disableDelBtn = true;\n    }else{\n      app.disableDelBtn = false;\n    }\n  }else{\n    app.disableDelBtn = false;\n  }\n\n  if(id == 'rootNode'){//跟节点\n    nodemenu = new Ext.menu.Menu({\n      items:[\n        {text: '{#xip_auth_func_addlowermenu#}',handler:function(){\n\n          app.menuWin.setTitle('{#xip_auth_func_addlowermenu#}'+'['+record.get('text')+']');\n          app.menuWin.show();\n          app.MENU_UP_ID1.setValue(-1);\n          app.MENU_ENABLE1.setValue(true);\n          app.MENU_OP_TYPE.setValue('_append');\n\n          app.MENU_ID1.setValue(-1);\n          app.MENU_CODE1.setValue('');\n          app.MENU_NAME1.setValue('');\n          app.MENU_DESC1.setValue('');\n\n        }}\n      ]\n    });\n  }else{\n    if(nodeType == 'M'){//菜单\n      nodemenu = new Ext.menu.Menu({\n        items:[\n          {text: '{#xip_auth_func_addSiblingmenu#}',handler:function(){\n\n            app.menuWin.setTitle('{#xip_auth_func_addSiblingmenu#}'+'['+record.get('text')+']');\n            app.menuWin.show();\n            app.MENU_UP_ID1.setValue(parentId);\n            app.MENU_ENABLE1.setValue(true);\n            app.MENU_OP_TYPE.setValue('_after');\n\n            app.MENU_ID1.setValue(-1);\n            app.MENU_CODE1.setValue('');\n            app.MENU_NAME1.setValue('');\n            app.MENU_DESC1.setValue('');\n\n          }},\n          {text: '{#xip_auth_func_addlowermenu#}',handler:function(){\n\n            app.menuWin.setTitle('{#xip_auth_func_addlowermenu#}'+'['+record.get('text')+']');\n            app.menuWin.show();\n            app.MENU_UP_ID1.setValue(nodeId);\n            app.MENU_ENABLE1.setValue(true);\n            app.MENU_OP_TYPE.setValue('_append');\n\n            app.MENU_ID1.setValue(-1);\n            app.MENU_CODE1.setValue('');\n            app.MENU_NAME1.setValue('');\n            app.MENU_DESC1.setValue('');\n\n          }},\n          {text: '{#xip_auth_func_addfun#}',handler:function(){\n\n            app.funcWin.setTitle('{#xip_auth_func_addfun#}'+'['+record.get('text')+']');\n            app.funcWin.show();\n            app.FUNC_UP_ID1.setValue(nodeId);\n            app.FUNC_ENABLE1.setValue(true);\n\n            app.FUNC_ID1.setValue(-1);\n            app.FUNC_CODE1.setValue('');\n            app.FUNC_NAME1.setValue('');\n            app.FUNC_URL1.setValue('');\n\n          }},\n          {text: '{#xip_auth_func_delmenu#}',handler:function(){\n\n            Ext.Msg.confirm('{#xip_auth_func_tips#}','{#xip_auth_func_ensureDeleteData#}',function(a){\n              if(a=='yes'){\n                 Wb.request({\n                   url : 'm?xwl=xip/auth/func/DATA/deleteMenu',\n                   params : {funTreeId:nodeId},\n                   success : function(){\n                      var n = app.tree1.getSelectionModel().getSelection()[0];\n                      var nParentNode = n.parentNode;\n                      nParentNode.removeChild(n);\n                      nParentNode.commit();\n                      Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_deleteSuccess#}');\n\n                      app.menuPanel.hide();\n                      app.funcPanel.hide();\n                   } \n                });\n              }\n            });\n          }}\n        ]\n      });\n    }else if(nodeType == 'F'){//功能\n      nodemenu = new Ext.menu.Menu({\n        items:[\n          {text: '{#xip_auth_func_delfun#}',disabled:disableDelBtn,handler:function(){\n            Ext.Msg.confirm('{#xip_auth_func_tips#}','{#xip_auth_func_ensureDeleteData#}',function(a){\n              if(a=='yes'){\n                //删除功能\t\n                Wb.request({\n                   url : 'm?xwl=xip/auth/func/DATA/deleteFunction',\n                   params : {funTreeId:nodeId},\n                   success : function(){\n                      var n = app.tree1.getSelectionModel().getSelection()[0];\n                      var nParentNode = n.parentNode;\n                      nParentNode.removeChild(n);\n                      nParentNode.commit();\n                      Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_deleteSuccess#}');\n\n                      app.menuPanel.hide();\n                      app.funcPanel.hide();\n                   } \n                });\n              }\n            });\n          }}\n        ]\n      });\n    }\n  }\n  nodemenu.showAt(event.getPoint());\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/auth/func/DATA/getTree"},"events":{"beforeload":"operation.params.parentID=operation.node.get('ID');"},"children":[],"expanded":false,"type":"treestore"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"150","itemId":"queryName"},"events":{"specialkey":"\nif(e.getKey() == 13){\n app.queryBtn2.fireEvent('click');\n}\n"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"queryBtn2","iconCls":"seek_icon"},"events":{"click":"treeNodeQuery(app.queryName.getValue(),'text',app.tree1);\ntreeNodeQuery(app.queryName.getValue(),'text',app.tree1);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"glyph":"f103","itemId":"button2"},"events":{"click":"app.tree1.expandAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"glyph":"f102","itemId":"button3"},"events":{"click":"app.tree1.collapseAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","layout":"fit","itemId":"panel1"},"children":[{"configs":{"tbar":"app.menuPanelbar","hidden":"true","layout":"fit","columnWidth":".5","itemId":"menuPanel"},"children":[{"configs":{"bodyStyle":"padding: 20px 20px 0px","frame":"true","style":"border-width:0px","layout":"column","itemId":"menuFormPanel","border":"false"},"children":[{"configs":{"frame":"true","style":"border-width:0px","columnWidth":".5","itemId":"panel2","border":"false"},"children":[{"configs":{"hidden":"true","itemId":"MENU_UP_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"60","hidden":"true","labelAlign":"right","itemId":"MENU_ID","fieldLabel":"菜单id"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"MENU_CODE","fieldLabel":"{#xip_auth_func_menuCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"MENU_NAME","fieldLabel":"{#xip_auth_func_menuName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"MENU_DESC","fieldLabel":"{#xip_auth_func_menuDesc#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"MENU_ENABLE","fieldLabel":"{#xip_auth_func_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"tbar":"app.funcPanelBar","hidden":"true","layout":"border","columnWidth":".5","itemId":"funcPanel"},"children":[{"configs":{"bodyStyle":"padding: 10px 0px 0px","region":"north","height":"200","frame":"true","style":"border-width:0px","itemId":"functionFormPanel"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","columnWidth":".5","itemId":"panel1","border":"false"},"children":[{"configs":{"hidden":"true","itemId":"IS_SYS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"FUNC_UP_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"FUNC_ID","fieldLabel":"功能id"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","displayField":"APP_NAME","width":"300","valueField":"APP_ID","labelAlign":"right","itemId":"APP_COMB","fieldLabel":"{#xip_auth_func_app#}"},"children":[{"configs":{"itemId":"store","autoLoad":"false","url":"m?xwl=xip/auth/func/DATA/getApps"},"events":{"beforeload":"store.getProxy().extraParams.USER_ID = '{#userId#}';"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"120","readOnly":"true","allowBlank":"false","width":"300","labelAlign":"right","itemId":"FUNC_CODE","fieldLabel":"{#xip_auth_func_funCode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","itemId":"panel2","border":"false"},"children":[{"configs":{"labelWidth":"120","width":"300","labelAlign":"right","itemId":"FUNC_NAME","fieldLabel":"{#xip_auth_func_funName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"300","labelAlign":"right","itemId":"FUNC_DESC","fieldLabel":"{#xip_auth_func_funDesc#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","itemId":"panel3","border":"false"},"children":[{"configs":{"labelWidth":"120","width":"300","labelAlign":"right","itemId":"SMALL_ICON","fieldLabel":"{#xip_auth_func_smallicon#}"},"events":{"focus":"app.selectIconWin.show();\napp.dataview1.store.load({params:{iconType:'smallIcon'}});\napp.selectType.setValue('smallIcon');"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"300","labelAlign":"right","itemId":"LARGE_ICON","fieldLabel":"{#xip_auth_func_largeicon#}"},"events":{"focus":"app.selectIconWin.show();\napp.dataview1.store.load({params:{iconType:'largeIcon'}});\napp.selectType.setValue('largeIcon');"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","itemId":"panel4","border":"false"},"children":[{"configs":{"labelWidth":"120","width":"600","labelAlign":"right","itemId":"FUNC_URL","fieldLabel":"{#xip_auth_func_funurl#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","itemId":"panel5","border":"false"},"children":[{"configs":{"labelWidth":"120","width":"600","labelAlign":"right","itemId":"MOBILE_URL","fieldLabel":"{#xip_auth_func_moveurl#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","itemId":"panel6","border":"false"},"children":[{"configs":{"labelWidth":"120","width":"300","value":"TAB","labelAlign":"right","pickList":"[['TAB','{#xip_auth_func_tab#}'],['WIN','{#xip_auth_func_win#}'],['BRO','{#xip_auth_func_bro#}']]","itemId":"SHOW_STYLE","fieldLabel":"{#xip_auth_func_displayusage#}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","width":"300","labelAlign":"right","itemId":"FUNC_ENABLE","fieldLabel":"{#xip_auth_func_enable#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"btnGrid"},"events":{"itemdblclick":"app.btn_edit_win.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/auth/func/DATA/getBtns"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"按钮id","hidden":"true","dataIndex":"BTN_ID","itemId":"BTN_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_buttonCode#}","dataIndex":"BTN_CODE","itemId":"BTN_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_buttonName#}","dataIndex":"BTN_NAME","itemId":"BTN_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_auth_func_enable#}","dataIndex":"BTN_ENABLE","itemId":"BTN_ENABLE_COL","renderer":"if(value=='Y'){\n  return '{#xip_auth_func_yes#}';\n}else if(value=='N'){\n  return '{#xip_auth_func_no#}';\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"功能id","hidden":"true","dataIndex":"FUN_TREE_ID","itemId":"BTN_FUNC_TREE_ID"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_add#}","itemId":"btn_add_win","iconCls":"record_add_icon"},"events":{"click":"Wb.reset(app.buttonFieldSet);\napp.OP_FLAG.setValue('_added');\nWb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      app.BTN_ID_WIN.setValue(resultJson.uuid);\n    }\n});\n\napp.BTN_ENABLE_WIN.setValue(true);\n\napp.btnWin.setTitle('{#xip_auth_func_btnAdd#}');\napp.btnWin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_edit#}","itemId":"btn_edit_win","iconCls":"record_edit_icon"},"events":{"click":"var rows = app.btnGrid.getSelectionModel().getSelection();\n\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_selectOpRecord#}');\n  return false ;\n}else if(rows.length>1){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_selectOpRecord#}');\n  return false ;\n}else{\n  var btnId = rows[0].get('BTN_ID');\n  app.btnWin.setTitle('{#xip_auth_func_btnEdit#}');\n  app.btnWin.show();\n  \n  app.OP_FLAG.setValue('_modified');\n  app.singleBtnStore.getProxy().extraParams.BTN_ID = btnId;\n  app.singleBtnStore.load();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_auth_func_delete#}","itemId":"btn_delete_win","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.btnGrid.getSelectionModel().getSelection();\n\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_selectDelRecord#}');\n  return false ;\n}else{\n  Ext.Msg.confirm('{#xip_auth_func_tips#}','{#xip_auth_func_ensureDelete#}',function(a){\n    if(a=='yes'){\n      var record = rows[0];//功能ID都一致\n      var funId = record.data.FUN_TREE_ID;\n      var ids = \"\";\n      Ext.each(rows,function(item){\n        var id = \"'\"+item.data.BTN_ID+\"'\";\n        if(ids === \"\"){\n            ids = id ;\n          }else{\n            ids = ids+\",\"+id;\n          }\n\n      });  \n      var json = {ids:ids,funTreeId:funId};\n      Wb.request({\n        url :'m?xwl=xip/auth/func/DATA/deleteBtn_win',\n        params:json,\n        success:function(){\n          Ext.Msg.alert('{#xip_auth_func_tips#}','{#xip_auth_func_deleteSuccess#}');\n          app.btnGrid.store.reload();\n        }\n      });\n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}