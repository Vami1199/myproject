{"inframe":false,"title":"参数管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nrequest.setAttribute(\"userId\",userId);\nvar ctxPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",ctxPath);\nvar paramsValue = request.getSession().getAttribute(\"XzSessionVars\");\nvar sysMode = paramsValue.get(\"godMode\");\nrequest.setAttribute(\"SYS_MODE\",sysMode);\nvar language = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute('language',language);\n\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/base/param/param\");","itemId":"module"},"events":{"initialize":"var uuid = '';\napp.reloadGrid =  function(){\n        //重新加载4个级别的GRID\n                  if (app.VAL_SQL.getValue() === null || app.VAL_SQL.getValue() === '') {\n                    if (app.VAL_SET_NAME.getValue() === null || app.VAL_SET_NAME.getValue() === '') {\n                      app.platformGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectPlatformStore_val';\n                      app.platformGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                      app.appGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectAppStore_val';\n                      app.appGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                      app.roleGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectRoleStore_val';\n                      app.roleGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                      app.userGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectUserStore_val';\n                      app.userGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                    } else {\n                      app.platformGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectPlatformStore';\n                      app.platformGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                      app.appGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectAppStore';\n                      app.appGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                      app.roleGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectRoleStore';\n                      app.roleGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                      app.userGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectUserStore';\n                      app.userGrid.store.load({\n                        params: {\n                          PARAM_ID: app.PARAM_ID.getValue()\n                        }\n                      });\n                    }\n                  } else {\n                    app.platformGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectPlatformStore_sql';\n                    app.platformGrid.store.load({\n                      params: {\n                        _sql: app.VAL_SQL.getValue(),\n                        PARAM_ID: app.PARAM_ID.getValue()\n                      }\n                    });\n                    app.appGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectAppStore_sql';\n                    app.appGrid.store.load({\n                      params: {\n                        _sql: app.VAL_SQL.getValue(),\n                        PARAM_ID: app.PARAM_ID.getValue()\n                      }\n                    });\n                    app.roleGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectRoleStore_sql';\n                    app.roleGrid.store.load({\n                      params: {\n                        _sql: app.VAL_SQL.getValue(),\n                        PARAM_ID: app.PARAM_ID.getValue()\n                      }\n                    });\n                    app.userGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectUserStore_sql';\n                    app.userGrid.store.load({\n                      params: {\n                        _sql: app.VAL_SQL.getValue(),\n                        PARAM_ID: app.PARAM_ID.getValue()\n                      }\n                    });\n                  }\n\n   };"},"children":[{"configs":{"itemId":"clientscript1"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"itemId":"windowBtns"},"children":[{"configs":{"itemId":"newWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_save#}","itemId":"newWinOk","iconCls":"save_icon"},"events":{"click":"var flag = app.PARAM_ID.getValue(); //获取ID\nvar insertArray = [];\nvar updateArray = [];\nif (!app.paramForm.getForm().isValid()) {\n  Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_qtxsybtxm#}');//提示 请填写所有必填项目\n  return false;\n}\nvar sql_ = app.VAL_SQL.getValue();\nvar array = sql_.split(',');\nif (!Ext.isEmpty(sql_)) {\n  if (array.length !== 2) {\n    Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_qaztsdgstxdydSQL#}');// 提示  请按照提示的格式填写对应的SQL\n    return;\n  }\n}\n//校验参数的合法性\nvar _existParams = false;\napp.platformGrid.store.each(function(platForm) {\n  var _tmpCode = platForm.get('VAL');\n  if (Ext.isEmpty(_tmpCode)) {\n    _existParams = true;\n    return false;\n  }\n});\nif (_existParams) {\n  Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_ptjcszbnwk#}');// 提示 平台级参数值不能为空\n  app.tab1.setActiveTab(0);\n  return false;\n}\n//校验应用级别参数是否存在,并且参数值不为空\napp.appGrid.store.each(function(app) {\n  if (Ext.isEmpty(app.data.VAL)) {\n    _existParams = true;\n    return false;\n  }\n});\nif (_existParams) {\n  Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_yyjcszbnwk#}');// 提示 应用级参数值不能为空\n  app.tab1.setActiveTab(1);\n  return false;\n}\n//校验角色级别参数是否存在,并且参数值不为空\napp.roleGrid.store.each(function(role) {\n  if (Ext.isEmpty(role.data.VAL)) {\n    _existParams = true;\n    return false;\n  }\n});\nif (_existParams) {\n  Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_jsjcszbnwk#}');//提示 角色级参数值不能为空\n  app.tab1.setActiveTab(2);\n  return false;\n}\n//校验用户级别参数是否存在,并且参数值不为空\napp.userGrid.store.each(function(user) {\n  if (Ext.isEmpty(user.data.VAL)) {\n    _existParams = true;\n    return false;\n  }\n});\nif (_existParams) {\n  Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_yhjcszbnwk#}');// 提示 用户级参数值不能为空\n  app.tab1.setActiveTab(3);\n  return false;\n}\n//将勾选的 ','分隔赋给val_level(平台级为P,应用为A,角色为R,用户为U)\nvar pcheck = app.platCheck.checked;\nvar acheck = app.appCheck.checked;\nvar rcheck = app.roleCheck.checked;\nvar ucheck = app.userCheck.checked;\nvar val_level = '';\nif (pcheck) {\n  val_level = val_level + ',' + 'P';\n}\nif (acheck) {\n  val_level = val_level + ',' + 'A';\n}\nif (rcheck) {\n  val_level = val_level + ',' + 'R';\n}\nif (ucheck) {\n  val_level = val_level + ',' + 'U';\n}\nval_level = val_level.substring(1, val_level.length);\n//判断ID是否存在 执行插入或更新\nif (Ext.isEmpty(flag)) {\n\n  var _value = app.PARAM_TYPE.getValue();\n  //执行插入\n  json_h = {\n    PARAM_CODE: app.PARAM_CODE.getValue(),\n    PARAM_NAME: app.PARAM_NAME.getValue(),\n    DESCRIPTION: app.DESCRIPTION.getValue(),\n    paramType: _value,\n    VAL_SQL: app.VAL_SQL.getValue(),\n    VAL_SET_NAME: app.VAL_SET_NAME.getValue(),\n    ENABLE_FLAG: app.ENABLE_FLAG.getValue(),\n    VAL_LEVEL: val_level\n  };\n  Wb.request({\n    url: 'm?xwl=xip/base/param/DATA/insertParamList',\n    params: json_h,\n    success: function(response) {\n      app.grid1.store.load();\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      app.PARAM_ID.setValue(resultJson.k); //成功后给PARAM_ID给赋值 \n      var param_name = app.PARAM_NAME.getValue();\n      var param_type = app.PARAM_TYPE.getValue();\n      //param_id赋值 sql赋值\n      var param_id = app.PARAM_ID.getValue();\n      var _sql = app.VAL_SQL.getValue();\n      //参数值\n      var val_set_code = app.VAL_SET_NAME.getValue();\n      //保存4个级别的参数值\n      var rec = app.platformGrid.store.getCount();\n      if (rec === 0) {} else {\n        for (var i = 0; i < rec; i++) {\n          var reco = app.platformGrid.store.getAt(i);\n          var param_val_id = reco.data.PARAM_VAL_ID;\n          var val = reco.data.VAL;\n          var sql = reco.data.VAL_SQL;\n          if (param_val_id === null || param_val_id === '') {\n            if (val === null || val === '') {\n              continue;\n            } else {\n              var val_ = reco.data.VAL_CODE;\n              if (reco.data.VAL_CODE === null || reco.data.VAL_CODE === '') {\n                val_ = reco.data.VAL;\n              } else {\n                val_ = reco.data.VAL_CODE;\n              }\n              if (reco.data.VAL_SQL !== null || reco.data.VAL_SQL !== '') {}\n              var json = {\n                PARAM_ID: param_id,\n                VAL: val_,\n                VAL_LEVEL: 'P',\n                TARGET_ID: 'P',\n                ENABLE_FLAG: reco.data.ENABLE_FLAG,\n                PARAM_VAL_ID:''\n              };\n              insertArray.push(json);\n            }\n\n          } else {\n            var tval;\n            if (reco.data.VAL_SET_CODE === null || reco.data.VAL_SET_CODE === '') {\n              tval = val;\n            } else {\n              tval = reco.data.VAL_CODE;\n            }\n            var json2 = {\n              PARAM_VAL_ID: reco.data.PARAM_VAL_ID,\n              VAL: tval,\n              ENABLE_FLAG: reco.data.ENABLE_FLAG,\n              LAST_UPDATED_BY: '{#userId#}'\n            };\n            updateArray.push(json2);\n            if (tval === null || tval === '') {\n              Ext.Msg.alert('{#xip_base_param_cszbnwk#}');// 参数值不能为空\n              return;\n            }\n          }\n\n        }\n      }\n\n      //角色级\n      var rec_r = app.roleGrid.store.getCount();\n      if (rec_r === 0) {} else {\n        for (var ir = 0; ir < rec_r; ir++) {\n          var reco_r = app.roleGrid.store.getAt(ir);\n          var param_val_id_r = reco_r.data.PARAM_VAL_ID;\n          var val_r = reco_r.data.VAL;\n          var val_code = reco_r.data.VAL_CODE;\n          if (param_val_id_r === null || param_val_id_r === '') {\n            if (val_r === null || val_r === '') {\n              continue;\n            } else {\n              if (reco_r.data.VAL_CODE === null || reco_r.data.VAL_CODE === '') {\n                val_r = reco_r.data.VAL;\n              } else {\n                val_r = reco_r.data.VAL_CODE;\n              }\n              if (reco_r.data.VAL_SQL !== null || reco_r.data.VAL_SQL !== '') {\n                //val=rec[i].data.VAL;\n              }\n              var json_r = {\n                PARAM_ID: app.PARAM_ID.getValue(),\n                VAL: val_r,\n                TARGET_ID: reco_r.data.TARGET_ID,\n                VAL_LEVEL: 'R',\n                ENABLE_FLAG: reco_r.data.ENABLE_FLAG,\n                CREATED_BY: '{#userId#}',\n                PARAM_VAL_ID:''\n              };\n              insertArray.push(json_r);\n\n            }\n\n          } else {\n            var tval_r;\n            if (reco_r.data.VAL_SET_CODE === null || reco_r.data.VAL_SET_CODE === '') {\n              tval_r = val_r;\n            } else {\n              tval_r = reco_r.data.VAL_CODE;\n            }\n\n            var json_ = {\n              PARAM_VAL_ID: reco_r.data.PARAM_VAL_ID,\n              VAL: tval_r,\n              ENABLE_FLAG: reco_r.data.ENABLE_FLAG,\n              LAST_UPDATED_BY: '{#userId#}'\n            };\n            updateArray.push(json_);\n            if (tval_r === null || tval_r === '') {\n              Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n              return;\n            }\n          }\n\n        }\n      }\n      //用户级\n      var rec_u = app.userGrid.store.getCount();\n      if (rec_u === 0) {} else {\n        for (var iu = 0; iu < rec_u; iu++) {\n          var reco_u = app.userGrid.store.getAt(iu);\n          var param_val_id_u = reco_u.data.PARAM_VAL_ID;\n          var val_u = reco_u.data.VAL;\n          if (param_val_id_u === null || param_val_id_u === '') {\n            if (val_u === null || val_u === '') {\n              continue;\n            } else {\n              var valu = reco_u.data.VAL_CODE;\n              if (reco_u.data.VAL_CODE === null || reco_u.data.VAL_CODE === '') {\n                valu = reco_u.data.VAL;\n              } else {\n                valu = reco_u.data.VAL_CODE;\n              }\n              if (reco_u.data.VAL_SQL !== null || reco_u.data.VAL_SQL !== '') {\n                //val=rec[i].data.VAL;\n              }\n              var json_u = {\n                PARAM_ID: param_id,\n                VAL: valu,\n                TARGET_ID: reco_u.data.TARGET_ID,\n                VAL_LEVEL: 'U',\n                ENABLE_FLAG: reco_u.data.ENABLE_FLAG,\n                CREATED_BY: '{#userId#}',\n                PARAM_VAL_ID:''\n              };\n              insertArray.push(json_u);\n            }\n\n          } else {\n            var tvalu;\n            if (reco_u.data.VAL_SET_CODE === null || reco_u.data.VAL_SET_CODE === '') {\n              tvalu = val_u;\n            } else {\n              tvalu = reco_u.data.VAL_CODE;\n            }\n\n            var json2_u = {\n              PARAM_VAL_ID: reco_u.data.PARAM_VAL_ID,\n              VAL: tvalu,\n              ENABLE_FLAG: reco_u.data.ENABLE_FLAG,\n              LAST_UPDATED_BY: '{#userId#}'\n            };\n            updateArray.push(json2_u);\n            if (tvalu === null || tvalu === '') {\n              Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n              return;\n            }\n          }\n\n        }\n      }\n      //应用级\n      var rec_a = app.appGrid.store.getCount();\n      if (rec_a === 0) {\n        //Ext.Msg.alert('提示','没有需要保存的数据');//\n      } else {\n        for (var ia = 0; ia < rec_a; ia++) {\n          var reco_a = app.appGrid.store.getAt(ia);\n          var flag;\n          if (reco_a.data.ENABLE_FLAG == '是') {//\n            flag = 'Y';\n          } else {\n            flag = 'N';\n          }\n          var param_val_id_a = reco_a.data.PARAM_VAL_ID;\n          var val_a = reco_a.data.VAL;\n          if (param_val_id_a === null || param_val_id_a === '') {\n            if (val_a === null || val_a === '') {\n              continue;\n            } else {\n              var val_a_ = reco_a.data.VAL_CODE;\n              if (reco_a.data.VAL_CODE === null || reco_a.data.VAL_CODE === '') {\n                val_a_ = reco_a.data.VAL;\n              } else {\n                val_a_ = reco_a.data.VAL_CODE;\n              }\n              if (reco_a.data.VAL_SQL !== null || reco_a.data.VAL_SQL !== '') {\n                //val=rec[i].data.VAL;\n              }\n              var json_a = {\n                PARAM_ID: param_id,\n                VAL: val_a_,\n                TARGET_ID: reco_a.data.TARGET_ID,\n                VAL_LEVEL: 'A',\n                ENABLE_FLAG: reco_a.data.ENABLE_FLAG,\n                CREATED_BY: '{#userId#}',\n                PARAM_VAL_ID:''\n              };\n              insertArray.push(json_a);\n            }\n\n          } else {\n            var tval_a;\n            if (reco_a.data.VAL_SET_CODE === null || reco_a.data.VAL_SET_CODE === '') {\n              tval_a = val_a;\n            } else {\n              tval_a = reco_a.data.VAL_CODE;\n            }\n            var json_a_update = {\n              PARAM_VAL_ID: reco_a.data.PARAM_VAL_ID,\n              VAL: tval_a,\n              ENABLE_FLAG: reco_a.data.ENABLE_FLAG,\n              LAST_UPDATED_BY: '{#userId#}'\n            };\n            updateArray.push(json_a_update);\n            if (tval_a === null || tval_a === '') {\n              Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n              return;\n            }\n          }\n\n        }\n      }\n         //插入参数值\n          Wb.request({\n            url: 'm?xwl=xip/base/param/DATA/insertParamVal',\n            params: Wb.apply({insertArray:Wb.encode(insertArray)}),\n            success: function(response) {\n                 app.reloadGrid();\n                //---------------刷新参数----------------\n                Ext.Ajax.request({\n                  url: '{#contextPath#}' + '/platformAction.do?method=reloadSysParams',\n                  method: 'post',\n                  success: function(response, options) {\n                  },\n                  failure: function(response, options) {\n                  }\n                });\n            }\n          });\n\n    }\n  });\n  \n} else {\n  var val_lev;\n  var json;\n  if (app.PARAM_TYPE.getValue() == 'S') {\n    //如果是上帝模式,VAL_LEVEL是通过勾选赋值,否则为新增保存时的值\n    if ('{#SYS_MODE#}' === 'Y') {\n      val_lev = val_level;\n    } else {\n      val_lev = app.VAL_LEVEL.getValue();\n    }\n    json = {\n      PARAM_ID: app.PARAM_ID.getValue(),\n      PARAM_CODE: app.PARAM_CODE.getValue(),\n      PARAM_NAME: app.PARAM_NAME.getValue(),\n      PARAM_TYPE: app.PARAM_TYPE.getValue(),\n      DESCRIPTION: app.DESCRIPTION.getValue(),\n      VAL_SQL: app.VAL_SQL.getValue(),\n      VAL_SET_NAME: app.VAL_SET_NAME.getValue(),\n      ENABLE_FLAG: app.ENABLE_FLAG.getValue(),\n      VAL_LEVEL: val_lev\n    };\n    \n  } else {\n    //不是系统参数,VAL_LEVEL是通过勾选赋值\n    json = {\n      PARAM_ID: app.PARAM_ID.getValue(),\n      PARAM_CODE: app.PARAM_CODE.getValue(),\n      PARAM_NAME: app.PARAM_NAME.getValue(),\n      PARAM_TYPE: app.PARAM_TYPE.getValue(),\n      DESCRIPTION: app.DESCRIPTION.getValue(),\n      VAL_SQL: app.VAL_SQL.getValue(),\n      VAL_SET_NAME: app.VAL_SET_NAME.getValue(),\n      ENABLE_FLAG: app.ENABLE_FLAG.getValue(),\n      VAL_LEVEL: val_level\n    };\n  }\n    Wb.request({\n      url: 'm?xwl=xip/base/param/DATA/updateParamList',\n      params: json,\n      success: function(response) {\n        //更新主表后 保存或更新子表\n        //平台级\n        var rec = app.platformGrid.store.getCount();\n        if (rec === 0) {} else {\n          for (var i = 0; i < rec; i++) {\n            var reco = app.platformGrid.store.getAt(i);\n            var param_val_id = reco.data.PARAM_VAL_ID;\n            var val = reco.data.VAL;\n            var sql = reco.data.VAL_SQL;\n            if (param_val_id === null || param_val_id === '') {\n              if (val === null || val === '') {\n                continue;\n              } else {\n                var val_ = reco.data.VAL_CODE;\n                if (reco.data.VAL_CODE === null || reco.data.VAL_CODE === '') {\n                  val_ = reco.data.VAL;\n                } else {\n                  val_ = reco.data.VAL_CODE;\n                }\n                if (reco.data.VAL_SQL !== null || reco.data.VAL_SQL !== '') {}\n                var jsonP = {\n                  PARAM_VAL_ID: reco.data.PARAM_VAL_ID,\n                  PARAM_ID: app.PARAM_ID.getValue(),\n                  VAL: val_,\n                  VAL_LEVEL: 'P',\n                  TARGET_ID: 'P',\n                  ENABLE_FLAG: reco.data.ENABLE_FLAG,\n                  CREATED_BY: '{#userId#}'\n                };\n                insertArray.push(jsonP);\n\n              }\n            } else {\n              var tval;\n              if (reco.data.VAL_CODE === null || reco.data.VAL_CODE === '') {\n                tval = val;\n              } else {\n                tval = reco.data.VAL_CODE;\n              }\n              var json2 = {\n                PARAM_VAL_ID: reco.data.PARAM_VAL_ID,\n                VAL: tval,\n                ENABLE_FLAG: reco.data.ENABLE_FLAG,\n                LAST_UPDATED_BY: '{#userId#}'\n              };\n              if (tval === null || tval === '') {\n                Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n                return;\n              }\n              updateArray.push(json2);\n\n            }\n          }\n        }\n\n        //角色级\n        var rec_r = app.roleGrid.store.getCount();\n        if (rec_r === 0) {\n        } else {\n          for (var ir = 0; ir < rec_r; ir++) {\n            var reco_r = app.roleGrid.store.getAt(ir);\n            var param_val_id_r = reco_r.data.PARAM_VAL_ID;\n            var val_r = reco_r.data.VAL;\n            var val_code = reco_r.data.VAL_CODE;\n            if (param_val_id_r === null || param_val_id_r === '') {\n              if (val_r === null || val_r === '') {\n                continue;\n              } else {\n                if (reco_r.data.VAL_CODE === null || reco_r.data.VAL_CODE === '') {\n                  val_r = reco_r.data.VAL;\n                } else {\n                  val_r = reco_r.data.VAL_CODE;\n                }\n                if (reco_r.data.VAL_SQL !== null || reco_r.data.VAL_SQL !== '') {\n                }\n                var json_r = {\n                  PARAM_ID: app.PARAM_ID.getValue(),\n                  VAL: val_r,\n                  TARGET_ID: reco_r.data.TARGET_ID,\n                  VAL_LEVEL: 'R',\n                  ENABLE_FLAG: reco_r.data.ENABLE_FLAG,\n                  CREATED_BY: '{#userId#}',\n                  PARAM_VAL_ID:''\n                };\n                insertArray.push(json_r);\n              }\n            } else {\n              var tval_r;\n              if (reco_r.data.VAL_CODE === null || reco_r.data.VAL_CODE === '') {\n                tval_r = val_r;\n              } else {\n                tval_r = reco_r.data.VAL_CODE;\n              }\n              var json_ = {\n                PARAM_VAL_ID: reco_r.data.PARAM_VAL_ID,\n                VAL: tval_r,\n                ENABLE_FLAG: reco_r.data.ENABLE_FLAG,\n                LAST_UPDATED_BY: '{#userId#}'\n              };\n              if (tval_r === null || tval_r === '') {\n                Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n                return;\n              }\n              updateArray.push(json_);\n            }\n\n          }\n        }\n        //用户级\n        var rec_u = app.userGrid.store.getCount();\n        if (rec_u === 0) {} else {\n          for (var iu = 0; iu < rec_u; iu++) {\n            var reco_u = app.userGrid.store.getAt(iu);\n            var param_val_id_u = reco_u.data.PARAM_VAL_ID;\n            var val_u = reco_u.data.VAL;\n            if (param_val_id_u === null || param_val_id_u === '') {\n              if (val_u === null || val_u === '') {\n                continue;\n              } else {\n                var valu = reco_u.data.VAL_CODE;\n                if (reco_u.data.VAL_CODE === null || reco_u.data.VAL_CODE === '') {\n                  valu = reco_u.data.VAL;\n                } else {\n                  valu = reco_u.data.VAL_CODE;\n                }\n                if (reco_u.data.VAL_SQL !== null || reco_u.data.VAL_SQL !== '') {\n                  //val=rec[i].data.VAL;\n                }\n                var json_u = {\n                  PARAM_ID: app.PARAM_ID.getValue(),\n                  VAL: valu,\n                  TARGET_ID: reco_u.data.TARGET_ID,\n                  VAL_LEVEL: 'U',\n                  ENABLE_FLAG: reco_u.data.ENABLE_FLAG,\n                  CREATED_BY: '{#userId#}',\n                  PARAM_VAL_ID:''\n                };\n                insertArray.push(json_u);\n              }\n\n            } else {\n              var tvalu;\n              if (reco_u.data.VAL_CODE === null || reco_u.data.VAL_CODE === '') {\n                tvalu = val_u;\n              } else {\n                tvalu = reco_u.data.VAL_CODE;\n              }\n              var json2_u = {\n                PARAM_VAL_ID: reco_u.data.PARAM_VAL_ID,\n                VAL: tvalu,\n                ENABLE_FLAG: reco_u.data.ENABLE_FLAG,\n                LAST_UPDATED_BY: '{#userId#}'\n              };\n              if (tvalu === null || tvalu === '') {\n                Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n                return;\n              }\n              updateArray.push(json2_u);\n            }\n\n          }\n        }\n        //应用级\n        var rec_a = app.appGrid.store.getCount();\n        if (rec_a === 0) {\n          //Ext.Msg.alert('提示','没有需要保存的数据');\n        } else {\n          for (var ia = 0; ia < rec_a; ia++) {\n            var reco_a = app.appGrid.store.getAt(ia);\n            var flag;\n            if (reco_a.data.ENABLE_FLAG == '是') {//\n              flag = 'Y';\n            } else {\n              flag = 'N';\n            }\n            var param_val_id_a = reco_a.data.PARAM_VAL_ID;\n            var val_a = reco_a.data.VAL;\n            if (param_val_id_a === null || param_val_id_a === '') {\n              if (val_a === null || val_a === '') {\n                continue;\n              } else {\n                var val_a_ = reco_a.data.VAL_CODE;\n                if (reco_a.data.VAL_CODE === null || reco_a.data.VAL_CODE === '') {\n                  val_a_ = reco_a.data.VAL;\n                } else {\n                  val_a_ = reco_a.data.VAL_CODE;\n                }\n                if (reco_a.data.VAL_SQL !== null || reco_a.data.VAL_SQL !== '') {\n                }\n                var json_a = {\n                  PARAM_ID: app.PARAM_ID.getValue(),\n                  VAL: val_a_,\n                  TARGET_ID: reco_a.data.TARGET_ID,\n                  VAL_LEVEL: 'A',\n                  ENABLE_FLAG: reco_a.data.ENABLE_FLAG,\n                  CREATED_BY: '{#userId#}',\n                  PARAM_VAL_ID:''\n                };\n                insertArray.push(json_a);\n              }\n\n            } else {\n              var tval_a;\n              if (reco_a.data.VAL_CODE === null || reco_a.data.VAL_CODE === '') {\n                tval_a = val_a;\n              } else {\n                tval_a = reco_a.data.VAL_CODE;\n              }\n              var json_a_update = {\n                PARAM_VAL_ID: reco_a.data.PARAM_VAL_ID,\n                VAL: tval_a,\n                ENABLE_FLAG: reco_a.data.ENABLE_FLAG,\n                LAST_UPDATED_BY: '{#userId#}'\n              };\n              if (tval_a === null || tval_a === '') {\n                Ext.Msg.alert('{#xip_base_param_cszbnwk#}');//参数值不能为空\n                return;\n              }\n              updateArray.push(json_a_update);\n            }\n\n          }\n        }\n        //----------------插入或更新参数值-----------------\n        if(insertArray.length>0){\n        if(updateArray.length>0){\n          //插入参数值\n          Wb.request({\n            url: 'm?xwl=xip/base/param/DATA/insertParamVal',\n            params: Wb.apply({insertArray:Wb.encode(insertArray)}),\n            success: function(response) {\n              //更新参数值\n              Wb.request({\n                url: 'm?xwl=xip/base/param/DATA/updatePlatFormVal',\n                params: Wb.apply({updateArray:Wb.encode(updateArray)}),\n                success: function(response) {\n                  app.reloadGrid();\n                  //---------------刷新参数----------------\n                  Ext.Ajax.request({\n                          url: '{#contextPath#}' + '/platformAction.do?method=reloadSysParams',\n                          method: 'post',\n                          success: function(response, options) {\n                          },\n                          failure: function(response, options) {\n                          }\n                  });\n                }\n              });\n            }\n          });\n\n        }else{\n          //插入参数值\n          Wb.request({\n            url: 'm?xwl=xip/base/param/DATA/insertParamVal',\n            params: Wb.apply({insertArray:Wb.encode(insertArray)}),\n            success: function(response) {\n              app.reloadGrid();\n               //---------------刷新参数----------------\n              Ext.Ajax.request({\n                      url: '{#contextPath#}' + '/platformAction.do?method=reloadSysParams',\n                      method: 'post',\n                      success: function(response, options) {\n                      },\n                      failure: function(response, options) {\n                      }\n              });\n            }\n          });\n        }\n\n      }else{\n        if(updateArray.length>0){\n             //更新参数值\n              Wb.request({\n                url: 'm?xwl=xip/base/param/DATA/updatePlatFormVal',\n                params: Wb.apply({updateArray:Wb.encode(updateArray)}),\n                success: function(response) {\n                  app.reloadGrid();\n                  //---------------刷新参数----------------\n                  Ext.Ajax.request({\n                          url: '{#contextPath#}' + '/platformAction.do?method=reloadSysParams',\n                          method: 'post',\n                          success: function(response, options) {\n                          },\n                          failure: function(response, options) {\n                          }\n                  });\n                }\n              });\n        }\n      }\n\n      }\n      \n    });\n   \n\n  }\n\n  Ext.Msg.alert('{#xip_base_param_prompt#}', '{#xip_base_param_bccg#}');//保存成功\n  app.grid1.store.load({\n               params:{paramCorN:app.paramCorN.getValue(),\n                       paramType:app.paramType.getValue()},\n               callback:function(){\n               }\n  });\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_close#}","itemId":"newWinClose","iconCls":"cancel_icon"},"events":{"click":"app.newWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"appWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"appWinOk","iconCls":"ok_icon"},"events":{"click":"var row = app.appFormGrid.getSelection();\n//var record=appNameGrid.getSelectionModel().getSelection();\nvar app_name2 = '';\nvar app_id2 = '';\nfor(var i=0; i<row.length; i++){\n  \n    var app_name = row[i].get('APP_NAME');\n    var app_id = row[i].get('APP_ID');\n    app_name2 = app_name2 + ',' + app_name;\n    app_id2 = app_id2 + ',' + app_id;\n}\napp.appNa.setValue(app_name2.substring(1,app_name2.length));\napp.APPID.setValue(app_id2.substring(1,app_id2.length));\napp.appWin.close();\nif(app.PARAM_NAME.getValue() === null||app.PARAM_NAME.getValue() === ''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxxzcs#}');//请先新增参数\n}else{\n   //判断当前所选的应用是否在当前GRID中，不在则添加\n   var i = app.appNa.getValue();\n   var array = i.split(',');\n   var appid = app.APPID.getValue();\n   var ar = appid.split(',');\n   var bl;\n   for(var j=0;j<array.length;j++){\n         for(var i=0;i<app.appGrid.store.getCount();i++){\n            var app_n = app.appGrid.store.getAt(i).get('APP_NAME');\n            if(array[j]===app_n){\n              bl=1;\n              break;\n            }else{\n              bl=0;        \n            }\n           \n         }\n     if(bl!==1){\n       //添加\n       var record={\n              VAL_SQL : app.VAL_SQL.getValue(),\n         VAL_SET_CODE : app.VAL_SET_NAME.getValue(),\n          ENABLE_FLAG : 'Y',\n             PARAM_ID : app.PARAM_ID.getValue(),\n            TARGET_ID : ar[j],\n           PARAM_NAME : app.PARAM_NAME.getValue(),\n             APP_NAME : array[j]};\n        Wb.addEdit(app.appGrid,record);\n      \n     }\n   }\n   \n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"appWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.appWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"roleWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"roleWinOk","iconCls":"ok_icon"},"events":{"click":"var row = app.roleFormGrid.getSelection();\nvar role_name2 = '';\nvar role_id2 = '';\nfor(var i=0;  i<row.length; i++){\n    var role_name = row[i].get('ROLE_NAME');\n    var role_id = row[i].get('ROLE_ID');\n    role_name2 = role_name2 + ',' + role_name;\n    role_id2 = role_id2 + ',' + role_id;\n}\napp.roleNA.setValue(role_name2.substring(1,role_name2.length));\napp.ROLEID.setValue(role_id2.substring(1,role_id2.length));\napp.roleWin.close();\nif(app.PARAM_NAME.getValue()===null||app.PARAM_NAME.getValue()===''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxxzcs#}');//请先新增参数\n}else{\n   //判断当前所选的应用是否在当前GRID中，不在则添加\n   var i = app.roleNA.getValue();\n   var array = i.split(',');\n   var roleid = app.ROLEID.getValue();\n   var ar = roleid.split(',');\n   var bl;\n   for(var j=0; j<ar.length; j++){\n         for(var i=0; i<app.roleGrid.store.getCount();i++){\n            var role_id = app.roleGrid.store.getAt(i).get('TARGET_ID');\n            if(ar[j]===role_id){\n              bl=1;\n              break;\n            }else{\n              bl=0;        \n            }\n           \n         }\n     if(bl!==1){\n       //添加\n       var record={\n               VAL_SQL : app.VAL_SQL.getValue(),\n          VAL_SET_CODE : app.VAL_SET_NAME.getValue(),\n           ENABLE_FLAG : 'Y',\n              PARAM_ID : app.PARAM_ID.getValue(),\n             TARGET_ID : ar[j],\n            PARAM_NAME : app.PARAM_NAME.getValue(),\n             ROLE_NAME : array[j]};\n       Wb.addEdit(app.roleGrid,record);\n     }\n   }\n   \n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"roleWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.roleWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"userWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"userWinOk","iconCls":"ok_icon"},"events":{"click":"var row = app.userFormGrid.getSelection();\nvar user_name2 = '';\nvar user_id2 = '';\nfor(var i=0; i<row.length; i++){\n   var user_name = row[i].get('USER_NAME');\n   var user_id = row[i].get('USER_ID');\n   user_name2 = user_name2+','+user_name;\n   user_id2 = user_id2+','+user_id;\n    \n}\napp.userNA.setValue(user_name2.substring(1,user_name2.length));\napp.USERID.setValue(user_id2.substring(1,user_id2.length));\napp.userWin.close();\nif(app.PARAM_NAME.getValue()===null || app.PARAM_NAME.getValue()===''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxxzcs#}');//请先新增参数\n}else{  \n   //判断当前所选的应用是否在当前GRID中，不在则添加\n   var i = app.userNA.getValue();\n   var array = i.split(',');\n   var userid = app.USERID.getValue();\n   var ar = userid.split(',');\n   var bl;\n   for(var j=0; j<ar.length; j++){\n         for(var i=0;i<app.userGrid.store.getCount();i++){\n            var user_id = app.userGrid.store.getAt(i).get('TARGET_ID');\n            if(ar[j]===user_id){\n              bl=1;\n              break;\n            }else{\n              bl=0;        \n            }\n           \n         }\n     if(bl!==1){\n       //添加\n       var record={\n               VAL_SQL : app.VAL_SQL.getValue(),\n          VAL_SET_CODE : app.VAL_SET_NAME.getValue(),\n           ENABLE_FLAG : 'Y',\n              PARAM_ID : app.PARAM_ID.getValue(),\n             TARGET_ID : ar[j],\n            PARAM_NAME : app.PARAM_NAME.getValue(),\n             USER_NAME : array[j]};\n         Wb.addEdit(app.userGrid,record);\n     }\n   }\n   \n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"userWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.userWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"valueWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"valueWinOk","iconCls":"ok_icon"},"events":{"click":"var record = app.valueGrid.getSelection();\nvar val_name = record[0].get('VNAME');\nvar val_code = record[0].get('VCODE');\nvar record1 = app.platformGrid.getSelection();\nrecord1[0].set('VAL',val_name);\nrecord1[0].set('VAL_CODE',val_code);\n\napp.valueWin.close();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"valueWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.valueWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"valueAppWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"valueWinAOk","iconCls":"ok_icon"},"events":{"click":"var record = app.valueGridA.getSelection();\nvar val_name = record[0].get('VNAME');\nvar val_code = record[0].get('VCODE');\nvar record1 = app.appGrid.getSelection();\nrecord1[0].set('VAL',val_name);\nrecord1[0].set('VAL_CODE',val_code);\n\napp.valueAppWin.close();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"valueWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.valueAppWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"valueRoleWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"valueWinROk","iconCls":"ok_icon"},"events":{"click":"var record = app.valueGridR.getSelection();\nvar val_name = record[0].get('VNAME');\nvar val_code = record[0].get('VCODE');\nvar record1 = app.roleGrid.getSelection();\nrecord1[0].set('VAL',val_name);\nrecord1[0].set('VAL_CODE',val_code);\n\napp.valueRoleWin.close();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"valueWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.valueRoleWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"valueUserWinBtn"},"children":[{"configs":{"text":"{#xip_base_param_OK#}","itemId":"valueWinUOk","iconCls":"ok_icon"},"events":{"click":"var record = app.valueGridU.getSelection();\nvar val_name = record[0].get('VNAME');\nvar val_code = record[0].get('VCODE');\nvar record1 = app.userGrid.getSelection();\nrecord1[0].set('VAL',val_name);\nrecord1[0].set('VAL_CODE',val_code);\n\napp.valueUserWin.close();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_cancel#}","itemId":"valueWinCancel","iconCls":"cancel_icon"},"events":{"click":"app.valueUserWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"windows"},"children":[{"configs":{"height":"550","layout":"border","width":"700","closeAction":"hide","buttons":"app.newWinBtn","buttonAlign":"center","dialog":"false","itemId":"newWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","height":"250","style":"border-width:0px","border":"false","itemId":"paramForm"},"children":[{"configs":{"height":"35","frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","width":"300","labelAlign":"right","itemId":"PARAM_CODE","fieldLabel":"<font color='red'>*<\/font>{#xip_base_param_paramCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","width":"300","labelAlign":"right","itemId":"PARAM_NAME","fieldLabel":"<font color='red'>*<\/font>{#xip_base_param_paramName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"height":"35","frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","width":"600","value":"U","labelAlign":"right","pickList":"[['S','{#xip_base_param_system#}'],['U','{#xip_base_param_kz#}']]","itemId":"PARAM_TYPE","fieldLabel":"{#xip_base_param_paramType#}"},"events":{"change":"// if(app.PARAM_TYPE.getValue()==='S'){\n//    app.paramPanel_check.show();\n//    app.paramForm.setHeight(230);\n//    app.appPanel.setDisabled(true);\n//    app.userPanel.setDisabled(true);\n//    app.rolePanel.setDisabled(true);\n//    app.platformPanel.setDisabled(false);\n// }else{\n//    app.paramPanel_check.hide();\n//    app.paramForm.setHeight(200);\n//    app.appPanel.setDisabled(false);\n//    app.userPanel.setDisabled(false);\n//    app.rolePanel.setDisabled(false);\n//    app.platformPanel.setDisabled(false);\n  \n// }"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"height":"35","frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel2"},"children":[{"configs":{"labelWidth":"100","width":"600","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#xip_base_param_paramDesc#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"height":"35","frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel3"},"children":[{"configs":{"labelWidth":"100","queryMode":"local","displayField":"NAME","width":"300","valueField":"CODE","tpl":"<tpl for=\".\">\n        <div class=\"x-boundlist-item\" style=\"height:21px\">{NAME}<\/div>\n<\/tpl>","labelAlign":"right","itemId":"VAL_SET_NAME","forceSelection":"true","fieldLabel":"{#xip_base_param_paramSource#}"},"events":{"select":"if(Ext.isEmpty(app.VAL_SQL.getValue())){\n  if(Ext.isEmpty(app.VAL_SET_NAME.getValue())){\n    app.VAL_SQL.setDisabled(false);\n//通过参数存在校验，将值集编码设置到应用参数上\n    app.platformGrid.store.each(function(paramForm){\n      paramForm.set('VAL_SET_CODE',app.VAL_SET_NAME.getValue());\n    });\n    app.appGrid.store.each(function(paramForm){\n      paramForm.set('VAL_SET_CODE',app.VAL_SET_NAME.getValue());\n    });     \n    app.roleGrid.store.each(function(paramForm){\n      paramForm.set('VAL_SET_CODE',app.VAL_SET_NAME.getValue());\n    });\n    app.userGrid.store.each(function(paramForm){\n      paramForm.set('VAL_SET_CODE',app.VAL_SET_NAME.getValue());\n    });      \n  }else{\n     app.VAL_SQL.setDisabled(true);\n  }    \n//============对应的SQL不为空==================== \n}else{\n  if(app.VAL_SET_NAME.getValue()!==''){\n  Ext.Msg.confirm('提示','您确定要清空SQL,选择值集做为参数值的来源吗？',function(a){\n    if(a=='yes'){\n      app.VAL_SQL.setValue('');\n      app.VAL_SQL.setDisabled(true); \n      app.platformGrid.store.each(function(platForm){\n        platForm.set('VAL_SQL',app.VAL_SQL.getValue());\n      });\n      app.appGrid.store.each(function(platForm){\n        platForm.set('VAL_SQL',app.VAL_SQL.getValue());\n      });     \n      app.roleGrid.store.each(function(platForm){\n        platForm.set('VAL_SQL',app.VAL_SQL.getValue());\n      });\n      app.userGrid.store.each(function(platForm){\n        platForm.set('VAL_SQL',app.VAL_SQL.getValue());\n      });      \n    }else {\n      app.VAL_SET_NAME.clearValue();\n   } \n  });\n  }\n}","beforeselect":"var orginalValue = app.VAL_SET_NAME.getValue();\n//底部数据存在时，根据当前comobox值的有无进行校验\nif(Ext.isEmpty(orginalValue) && !Ext.isEmpty(index)){\n  if(app.platformGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除平台级参数，再修改参数值来源！');\n      return false;\n  }\n  if(app.appGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除应用级参数，再修改参数值来源！');\n      return false;\n  } \n  if(app.roleGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除角色级参数，再修改参数值来源！');\n      return false;\n  }\n  if(app.userGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除用户级参数，再修改参数值来源！');\n      return false;\n  }  \n}else if(!Ext.isEmpty(orginalValue) && orginalValue !==record.data.CODE){\n  if(app.platformGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除平台级参数，再修改参数值来源！');\n      return false;\n  }\n  if(app.appGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除应用级参数，再修改参数值来源！');\n      return false;\n  } \n  if(app.roleGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除角色级参数，再修改参数值来源！');\n      return false;\n  }\n  if(app.userGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','请先删除用户级参数，再修改参数值来源！');\n      return false;\n  } \n}\n\n\n"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectVal_set_name"},"events":{"load":"var data={\"CODE\":'',\"NAME\":''};\napp.VAL_SET_NAME.store.insert(0,data);"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"100","displayField":"NAME","width":"300","value":"Y","valueField":"CODE","labelAlign":"right","pickList":"[['Y','{#xip_base_param_Y#}'],['N','{#xip_base_param_N#}']]","itemId":"ENABLE_FLAG","fieldLabel":"{#xip_base_param_isEnabel#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel4"},"children":[{"configs":{"labelWidth":"100","width":"600","emptyText":"{#xip_base_param_emptyText1#}","labelAlign":"right","itemId":"VAL_SQL","fieldLabel":"{#xip_base_param_paramSourceSQL#}"},"events":{"focus":" if(app.platformGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','平台级参数值已存在，请先删除后再修改参数值来源！');\n      return false;\n  }\n  if(app.appGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','应用级参数值已存在，请先删除后再修改参数值来源！');\n      return false;\n  } \n  if(app.roleGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','角色级参数值已存在，请先删除后再修改参数值来源！');\n      return false;\n  }\n  if(app.userGrid.store.getCount()!==0){\n      Ext.Msg.alert('提示','用户级参数值已存在，请先删除后再修改参数值来源！');\n      return false;\n  }  ","blur":"  var sql = app.VAL_SQL.getValue();\n  var array = sql.split(',');\n  if(!Ext.isEmpty(sql)){\n    if(array.length!==2){\n      Ext.Msg.alert('提示','请按照提示的格式填写对应的SQL');\n      app.VAL_SQL.setValue('');\n      return;\n    }\n  }\n//平台级\nif(app.platformGrid.store.getCount()!==0){\n  app.platformGrid.store.getAt(0).set('VAL_SQL',app.VAL_SQL.getValue());\n}\n//应用级\nif(app.appGrid.store.getCount()!==0){\n  for(var i=0;i<app.appGrid.store.getCount();i++){\n    app.appGrid.store.getAt(i).set('VAL_SQL',app.VAL_SQL.getValue());\n  }\n}\n//角色级\nif(app.roleGrid.store.getCount()!==0){\n    for(var i=0;i<app.roleGrid.store.getCount();i++){\n      app.roleGrid.store.getAt(i).set('VAL_SQL',app.VAL_SQL.getValue());\n    }\n}\n//用户级\nif(app.userGrid.store.getCount()!==0){\n  for(var i=0;i<app.userGrid.store.getCount();i++){\n    app.userGrid.store.getAt(i).set('VAL_SQL',app.VAL_SQL.getValue());\n  }\n}\nif(app.VAL_SQL.getValue()===null||app.VAL_SQL.getValue()===''){\n  if(app.VAL_SET_NAME.getValue()===null||app.VAL_SET_NAME.getValue()===''){\n    //将4个级别的VAL_CODE清空\n    if(app.platformGrid.store.getCount()!==0){\n      app.platformGrid.store.getAt(0).set('VAL_CODE','');\n    }\n    //应用级\n    if(app.appGrid.store.getCount()!==0){\n       for(var i=0;i<app.appGrid.store.getCount();i++){\n         app.appGrid.store.getAt(i).set('VAL_CODE','');\n       }\n    }\n    //角色级\n    if(app.roleGrid.store.getCount()!==0){\n      for(var i=0;i<app.roleGrid.store.getCount();i++){\n        app.roleGrid.store.getAt(i).set('VAL_CODE','');\n      }\n    }\n     //用户级\n    if(app.userGrid.store.getCount()!==0){\n      for(var i=0;i<app.userGrid.store.getCount();i++){\n         app.userGrid.store.getAt(i).set('VAL_CODE','');\n      }\n    }\n    \n    \n  }\n}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"},{"configs":{"height":"35","frame":"true","style":"border-width:0px;text-align:center;padding-bottom:6px","layout":"column","border":"false","itemId":"paramPanel_check","x":"60"},"children":[{"configs":{"labelAlign":"right","itemId":"platCheck","fieldLabel":"{#xip_base_param_platformLevel#}"},"events":{"change":"var flag = app.platCheck.checked;\napp.tab1.setActiveTab(0);\nif(flag){\n  app.platformPanel.setDisabled(false);\n}else{\n  //没勾选 清空store\n  app.platformGrid.getSelectionModel().selectAll();\n  var rows = app.platformGrid.getSelection();\n  if(rows.length!==0){\n     Ext.Msg.confirm('{#xip_base_param_prompt#}','{#xip_base_param_qrjyptjsj#}',function(a){\n       if(a=='yes'){\n         Wb.request({\n          url: 'm?xwl=xip/base/param/DATA/deletePlatG', \n          params: Wb.apply({\n            destroy: Wb.getData(rows)\n          }),\n          success: function() {\n            Wb.remove(app.platformGrid,rows);\n          }\n        });\n        app.platformPanel.setDisabled(true);\n       }else{\n         //将check勾选上\n        app.platCheck.setValue(true);\n        app.platformGrid.getSelectionModel().deselectAll();\n         \n       }\n     \n    });\n  }else{\n    app.platformPanel.setDisabled(true);\n  }\n  \n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"labelAlign":"right","itemId":"appCheck","fieldLabel":"{#xip_base_param_applicationLevel#}"},"events":{"change":"var flag = app.appCheck.checked;\napp.tab1.setActiveTab(1);\nif(flag){\n  app.appPanel.setDisabled(false);\n  \n}else{\n  //没勾选 清空store\n  if(app.appGrid.store.getCount()!==0){\n    app.appGrid.getSelectionModel().selectAll();\n  }\n  var rows = app.appGrid.getSelection();\n  if(rows.length!==0){\n    Ext.Msg.confirm('提示','确认禁用应用级,删除应用级数据？',function(a){\n      if(a=='yes'){\n        Wb.request({\n          url: 'm?xwl=xip/base/param/DATA/deleteAppG', \n          params: Wb.apply({\n             destroy: Wb.getData(rows)\n          }),\n          success: function() {\n            Wb.remove(app.appGrid,rows);\n          }\n        });\n        app.appPanel.setDisabled(true);\n      }else{\n         //将check勾选上\n        app.appCheck.setValue(true);\n        app.appGrid.getSelectionModel().deselectAll();\n      }\n      \n       \n    });\n  }else{\n    app.appPanel.setDisabled(true);\n  }\n  \n\n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"labelAlign":"right","itemId":"roleCheck","fieldLabel":"{#xip_base_param_roleLevel#}"},"events":{"change":"var flag = app.roleCheck.checked;\napp.tab1.setActiveTab(2);\nif(flag){\n  app.rolePanel.setDisabled(false);\n}else{\n  //没勾选 清空store\n  if(app.roleGrid.store.getCount()!==0){\n     app.roleGrid.getSelectionModel().selectAll();\n  }\n  var rows = app.roleGrid.getSelection();\n  if(rows.length!==0){\n    Ext.Msg.confirm('{#xip_base_param_prompt#}','{#xip_base_param_qrjyjsjsj#}',function(a){\n      if(a=='yes'){\n        Wb.request({\n          url: 'm?xwl=xip/base/param/DATA/deleteRoleG', \n          params: Wb.apply({\n             destroy: Wb.getData(rows)\n          }),\n          success: function() {\n            Wb.remove(app.roleGrid,rows);\n          }\n        });\n        app.rolePanel.setDisabled(true);\n      }else{\n        //将check勾选上\n        app.roleCheck.setValue(true);\n        app.roleGrid.getSelectionModel().deselectAll();\n      }\n      \n    });\n    \n  }else{\n     app.rolePanel.setDisabled(true);\n  }\n  \n  \n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"labelAlign":"right","itemId":"userCheck","fieldLabel":"{#xip_base_param_userLevel#}"},"events":{"change":"var flag = app.userCheck.checked;\napp.tab1.setActiveTab(3);\nif(flag){\n  app.userPanel.setDisabled(false);\n}else{\n  //没勾选 清空store\n  if(app.userGrid.store.getCount()!==0){\n     app.userGrid.getSelectionModel().selectAll();\n  }\n  var rows = app.userGrid.getSelection();\n  if(rows.length!==0){\n    Ext.Msg.confirm('提示','确认禁用用户级,删除用户级数据？',function(a){\n      if(a=='yes'){\n        Wb.request({\n          url: 'm?xwl=xip/base/param/DATA/deleteUserG', \n          params: Wb.apply({\n             destroy: Wb.getData(rows)\n          }),\n          success: function() {\n            Wb.remove(app.userGrid,rows);\n          }\n        });\n        app.userPanel.setDisabled(true);\n      }else{\n        //将check勾选上\n        app.userCheck.setValue(true);\n        app.userGrid.getSelectionModel().deselectAll();\n      }\n      \n    });\n  }else{\n    app.userPanel.setDisabled(true);\n  }\n  \n  \n}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"VAL_SET_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"PARAM_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"VAL_LEVEL","fieldLabel":"VAL_LEVEL"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"form"},{"configs":{"region":"center","style":"border-width:0px","activeTab":"plantformPanel","border":"false","itemId":"tab1"},"children":[{"configs":{"title":"{#xip_base_param_platformLevel#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"platformPanel"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","style":"border-width:0px","border":"false","itemId":"platformGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramName#}","width":"200","dataIndex":"PARAM_NAME","itemId":"PARAM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramValue#}","width":"200","dataIndex":"VAL","itemId":"VAL_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"focus":"var record = app.platformGrid.getSelection();\nvar val_set_code = record[0].get('VAL_SET_CODE');\nvar val_sql = record[0].get('VAL_SQL');\n\nif(val_set_code===null && val_sql===null || val_set_code===null && val_sql===''){\n  return;\n}\nif(val_set_code==='' && val_sql==='' || val_set_code==='' && val_sql===null){\n  return;\n}\nif(val_set_code===undefined && val_sql===undefined){\n  return;\n}\n\nvar win = new Ext.window.Window(app._valueWin);\nwin.show();\n\nvar _sql ;\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%{#valName#}%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\n\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGrid.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_isEnabel#}","width":"80","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG_COL","renderer":"if(value === \"Y\"||value===''){\n  return \"{#xip_base_param_Y#}\";\n}else{\n  return \"{#xip_base_param_N#}\";\n}"},"children":[{"configs":{"pickList":"[['Y','是'],['N','否']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"参数ID","hidden":"true","dataIndex":"PARAM_ID","itemId":"PARAM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"PARAM_VAL_ID","itemId":"PARAM_VAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueSetCode#}","hidden":"true","dataIndex":"VAL_SET_CODE","itemId":"VAL_SET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_SQL","hidden":"true","dataIndex":"VAL_SQL","itemId":"VAL_SQL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_CODE","hidden":"true","dataIndex":"VAL_CODE","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xip/base/param/DATA/selectPlatformStore"},"children":[],"expanded":false,"type":"store"},{"configs":{"style":"border-width:0px","itemId":"tbar"},"children":[{"configs":{"text":"{#xip_base_param_addTo#}","itemId":"platAddBtn","iconCls":"record_add_icon"},"events":{"click":"if(app.PARAM_NAME.getValue()===null||app.PARAM_NAME.getValue()===''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxtxcsxx#}');//请先填写参数信息\n}else{\nvar count = app.platformGrid.store.getCount();\nif(count===0){\n  var param_name = app.PARAM_NAME.getValue();\n  var val_set_name = app.VAL_SET_NAME.getValue();\n  var val_sql = app.VAL_SQL.getValue();\n  var record = {\n               VAL_SQL : val_sql,\n          VAL_SET_CODE : val_set_name,\n           ENABLE_FLAG : 'Y',\n            PARAM_NAME : param_name,\n              PARAM_ID : app.PARAM_ID.getValue()};\n  //Wb.addEdit(app.platformGrid);\n  app.platformGrid.store.load(function(){\n    app.platformGrid.store.insert(0,record);\n  });\n  \n}\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_delete#}","itemId":"platDelBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.platformGrid.getSelection();\nif(app.PARAM_TYPE.getValue()==='S' && '{#SYS_MODE#}' !== 'Y'){\n    Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_xtsjbnsc#}');//系统数据不能删除\n    return;   \n}\nif(rows.length === 0){\n   Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_nmyxzrhsj#}');//您没有选中任何数据\n   return ;\n }\nWb.confirm('{#xip_base_param_qrscsxjl#}',function(){//确认删除所选记录？\n   Wb.request({\n        url: 'm?xwl=xip/base/param/DATA/deletePlatG', \n        params: Wb.apply({\n          destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Wb.remove(app.platformGrid,rows);\n        }\n      });\n});\n\n\n  \n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"},{"configs":{"title":"{#xip_base_param_applicationLevel#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"appPanel"},"children":[{"configs":{"region":"north","hidden":"true","itemId":"form1"},"children":[{"configs":{"itemId":"appNa"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"APPID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","style":"border-width:0px","border":"false","itemId":"appGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PARAM_ID","hidden":"true","itemId":"PARAM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"APP_ID","hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramName#}","width":"150","dataIndex":"PARAM_NAME","itemId":"PARAM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_applicationName#}","width":"150","dataIndex":"APP_NAME","itemId":"APP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramValue#}","width":"180","dataIndex":"VAL","itemId":"VAL_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"focus":"var record = app.appGrid.getSelection();\nvar val_set_code = record[0].get('VAL_SET_CODE');\nvar val_sql = record[0].get('VAL_SQL');\n\nif(val_set_code===null && val_sql===null || val_set_code===null && val_sql===''){\n  return;\n}\nif(val_set_code==='' && val_sql==='' || val_set_code==='' && val_sql===null){\n  return;\n}\nif(val_set_code===undefined && val_sql===undefined){\n  return;\n}\n\nvar win = new Ext.window.Window(app._valueAppWin);\nwin.show();\n\nvar _sql ;\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameA.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\n\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridA.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"VAL_CODE","hidden":"true","dataIndex":"VAL_CODE","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_isEnabel#}","width":"80","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG_COL","renderer":"if(value === \"Y\"||value===''){\n  return \"{#xip_base_param_Y#}\";\n}else{\n  return \"{#xip_base_param_N#}\";\n}"},"children":[{"configs":{"pickList":"[['Y','是'],['N','否']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"PARAM_VAL_ID","hidden":"true","dataIndex":"PARAM_VAL_ID","itemId":"PARAM_VAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueSetCode#}","hidden":"true","dataIndex":"VAL_SET_CODE","itemId":"VAL_SET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_SQL","hidden":"true","dataIndex":"VAL_SQL","itemId":"VAL_SQL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_NAME","hidden":"true","dataIndex":"VAL_NAME","itemId":"VAL_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xip/base/param/DATA/selectAppStore"},"children":[],"expanded":false,"type":"store"},{"configs":{"style":"border-width:0px","itemId":"tbar"},"children":[{"configs":{"text":"{#xip_base_param_addApplication#}","itemId":"appAddBtn","iconCls":"record_add_icon"},"events":{"click":"if(app.PARAM_NAME.getValue()===null||app.PARAM_NAME.getValue()===''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxtxcsxx#}');//请先填写参数信息\n}else{\n  var win = new Ext.window.Window(app._appWin);\n  win.show();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_delete#}","itemId":"appDelBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.appGrid.getSelection();\nif(app.PARAM_TYPE.getValue()==='S' && '{#SYS_MODE#}' !== 'Y'){\n    Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_xtsjbnsc#}');//系统数据不能删除\n    return;   \n}\nif(rows.length === 0){\n   Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_nmyxzrhsj#}');//您没有选中任何数据\n   return ;\n }\n\nWb.confirm('确认删除所选记录？',function(){//确认删除所选记录\n  Wb.request({\n        url: 'm?xwl=xip/base/param/DATA/deleteAppG', \n        params: Wb.apply({\n           destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Wb.remove(app.appGrid,rows);\n        }\n      });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"},{"configs":{"title":"{#xip_base_param_roleLevel#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"rolePanel"},"children":[{"configs":{"region":"north","hidden":"true","itemId":"form1"},"children":[{"configs":{"itemId":"roleNA"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"ROLEID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","style":"border-width:0px","border":"false","itemId":"roleGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PARAM_ID","hidden":"true","dataIndex":"PARAM_ID","itemId":"PARAM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramName#}","width":"150","dataIndex":"PARAM_NAME","itemId":"PARAM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_roleName#}","width":"150","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramValue#}","width":"180","dataIndex":"VAL","itemId":"VAL_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"focus":"var record = app.roleGrid.getSelection();\nvar val_set_code = record[0].get('VAL_SET_CODE');\nvar val_sql = record[0].get('VAL_SQL');\n\nif(val_set_code===null && val_sql===null || val_set_code===null && val_sql===''){\n  return;\n}\nif(val_set_code==='' && val_sql==='' || val_set_code==='' && val_sql===null){\n  return;\n}\nif(val_set_code===undefined && val_sql===undefined){\n  return;\n}\n\nvar win = new Ext.window.Window(app._valueRoleWin);\nwin.show();\n\nvar _sql ;\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameR.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\n\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridR.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"VAL_CODE","hidden":"true","dataIndex":"VAL_CODE","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_isEnabel#}","width":"80","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG_COL","renderer":"if(value === \"Y\"||value===''){\n  return \"{#xip_base_param_Y#}\";\n}else{\n  return \"{#xip_base_param_N#}\";\n}"},"children":[{"configs":{"pickList":"[['Y','是'],['N','否']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"PARAM_VAL_ID","hidden":"true","dataIndex":"PARAM_VAL_ID","itemId":"PARAM_VAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueSetCode#}","hidden":"true","dataIndex":"VAL_SET_CODE","itemId":"VAL_SET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_SQL","hidden":"true","dataIndex":"VAL_SQL","itemId":"VAL_SQL_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xip/base/param/DATA/selectRoleStore"},"children":[],"expanded":false,"type":"store"},{"configs":{"style":"border-width:0px","itemId":"tbar"},"children":[{"configs":{"text":"{#xip_base_param_addRole#}","itemId":"roleAddBtn","iconCls":"record_add_icon"},"events":{"click":"if(app.PARAM_NAME.getValue()===null||app.PARAM_NAME.getValue()===''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxtxcsxx#}');//请先填写参数信息\n}else{\n  var win = new Ext.window.Window(app._roleWin);\n  win.show();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_delete#}","itemId":"roleDelBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.roleGrid.getSelection();\nif(app.PARAM_TYPE.getValue()==='S' && '{#SYS_MODE#}' !== 'Y'){\n    Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_xtsjbnsc#}');//系统数据不能删除\n    return;   \n}\nif(rows.length === 0){\n   Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_nmyxzrhsj#}');//您没有选中任何数据\n   return ;\n }\n\nWb.confirm('确认删除所选记录？',function(){\n   Wb.request({\n        url: 'm?xwl=xip/base/param/DATA/deleteRoleG', \n        params: Wb.apply({\n           destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Wb.remove(app.roleGrid,rows);\n        }\n      });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"},{"configs":{"title":"{#xip_base_param_userLevel#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"userPanel"},"children":[{"configs":{"region":"north","hidden":"true","itemId":"form1"},"children":[{"configs":{"itemId":"userNA"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"USERID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","style":"border-width:0px","border":"false","itemId":"userGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PARAM_ID","hidden":"true","itemId":"PARAM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ID","hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramName#}","width":"150","dataIndex":"PARAM_NAME","itemId":"PARAM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_userName#}","width":"150","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramValue#}","width":"180","dataIndex":"VAL","itemId":"VAL_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"focus":"var record = app.userGrid.getSelection();\nvar val_set_code = record[0].get('VAL_SET_CODE');\nvar val_sql = record[0].get('VAL_SQL');\n\nif(val_set_code===null && val_sql===null || val_set_code===null && val_sql===''){\n  return;\n}\nif(val_set_code==='' && val_sql==='' || val_set_code==='' && val_sql===null){\n  return;\n}\nif(val_set_code===undefined && val_sql===undefined){\n  return;\n}\n\nvar win = new Ext.window.Window(app._valueUserWin);\nwin.show();\n\nvar _sql ;\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameU.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\n\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridU.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"VAL_CODE","hidden":"true","dataIndex":"VAL_CODE","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_isEnabel#}","width":"80","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG_COL","renderer":"if(value === \"Y\"||value===''){\n  return \"{#xip_base_param_Y#}\";\n}else{\n  return \"{#xip_base_param_N#}\";\n}"},"children":[{"configs":{"pickList":"[['Y','是'],['N','否']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"PARAM_VAL_ID","hidden":"true","dataIndex":"PARAM_VAL_ID","itemId":"PARAM_VAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueSetCode#}","hidden":"true","dataIndex":"VAL_SET_CODE","itemId":"VAL_SET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_SQL","hidden":"true","dataIndex":"VAL_SQL","itemId":"VAL_SQL_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xip/base/param/DATA/selectUserStore"},"children":[],"expanded":false,"type":"store"},{"configs":{"style":"border-width:0px","itemId":"tbar"},"children":[{"configs":{"text":"{#xip_base_param_addUser#}","itemId":"userAddBtn","iconCls":"record_add_icon"},"events":{"click":"if(app.PARAM_NAME.getValue()===null||app.PARAM_NAME.getValue()===''){\n   Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_qxtxcsxx#}');//请先填写参数信息\n}else{\n  var win = new Ext.window.Window(app._userWin);\n  win.show();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_delete#}","itemId":"userDelBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.userGrid.getSelection();\nif(app.PARAM_TYPE.getValue()==='S' && '{#SYS_MODE#}' !== 'Y'){\n    Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_xtsjbnsc#}');//系统数据不能删除\n    return;   \n}\nif(rows.length === 0){\n   Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_nmyxzrhsj#}');//您没有选中任何数据\n   return ;\n }\n\nWb.confirm('{#xip_base_param_qrscsxjl#}',function(){//确认删除所选记录？\n  Wb.request({\n        url: 'm?xwl=xip/base/param/DATA/deleteUserG', \n        params: Wb.apply({\n           destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Wb.remove(app.userGrid,rows);\n        }\n      });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_base_param_applicationList#}","height":"300","width":"520","layout":"border","closeAction":"hide","buttons":"app.appWinBtn","buttonAlign":"center","dialog":"false","border":"false","itemId":"appWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"appForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"70","style":"padding-top:6px","labelAlign":"left","itemId":"appname","fieldLabel":"{#xip_base_param_applicationName#}"},"events":{"specialkey":"app.appFormGrid.store.load({params:{appname:app.appname.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","itemId":"appQuery","iconCls":"seek_icon","x":"150"},"events":{"click":"app.appFormGrid.store.load({params:{appname:app.appname.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","height":"200","selType":"checkboxmodel","itemId":"appFormGrid"},"events":{"itemdblclick":"app.appWinOk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"APP_ID","hidden":"true","dataIndex":"APP_ID","itemId":"APP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_applicationName#}","dataIndex":"APP_NAME","itemId":"APP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectApp"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_base_param_roleList#}","height":"300","width":"520","layout":"border","closeAction":"hide","buttons":"app.roleWinBtn","buttonAlign":"center","dialog":"false","border":"false","itemId":"roleWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"roleForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"95","style":"padding-top:6px","labelAlign":"left","itemId":"rolename","fieldLabel":"{#xip_base_param_roleNameOrCode#}"},"events":{"specialkey":"app.roleFormGrid.store.load({params:{rolename:app.rolename.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","style":"padding-top:6px","itemId":"roleQuery","iconCls":"seek_icon","x":"150"},"events":{"click":"app.roleFormGrid.store.load({params:{rolename:app.rolename.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","height":"200","itemId":"roleFormGrid"},"events":{"itemdblclick":"app.roleWinOk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_roleName#}","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_roleCode#}","width":"200","dataIndex":"ROLE_CODE","itemId":"ROLE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectRole"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_base_param_userList#}","height":"300","width":"520","layout":"border","closeAction":"hide","buttons":"app.userWinBtn","buttonAlign":"center","dialog":"false","border":"false","itemId":"userWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"userForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"70","style":"padding-top:6px","labelAlign":"left","itemId":"username","fieldLabel":"{#xip_base_param_userName#}"},"events":{"specialkey":"app.userFormGrid.store.load({params:{username:app.username.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","style":"padding-top:6px","itemId":"userQuery","iconCls":"seek_icon","x":"150"},"events":{"click":"app.userFormGrid.store.load({params:{username:app.username.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","height":"200","itemId":"userFormGrid"},"events":{"itemdblclick":"app.userWinOk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_userName#}","dataIndex":"USER_NAME","itemId":"USER_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectUser"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_base_param_valueList#}","height":"300","layout":"border","width":"520","buttons":"app.valueWinBtn","buttonAlign":"center","dialog":"false","itemId":"valueWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"valueForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"60","width":"200","labelAlign":"left","itemId":"valName","fieldLabel":"{#xip_base_param_valueName#}"},"events":{"specialkey":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valName.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGrid.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","itemId":"valQuery","iconCls":"seek_icon","x":"200"},"events":{"click":"//app.valName.setValue('');\nvar _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valName.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGrid.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","multiSelect":"true","height":"200","itemId":"valueGrid"},"events":{"itemdblclick":"app.valueWinOk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueCode#}","width":"200","dataIndex":"VCODE","itemId":"VCODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueName#}","dataIndex":"VNAME","itemId":"VNAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectParamVal"},"children":[],"expanded":true,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"title":"{#xip_base_param_valueList#}","height":"300","layout":"border","width":"520","buttons":"app.valueAppWinBtn","buttonAlign":"center","dialog":"false","itemId":"valueAppWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"valueForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"60","width":"200","labelAlign":"left","itemId":"valNameA","fieldLabel":"{#xip_base_param_valueName#}"},"events":{"specialkey":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameA.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridA.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","itemId":"valQueryA","iconCls":"seek_icon","x":"200"},"events":{"click":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameA.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridA.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","height":"200","itemId":"valueGridA"},"events":{"itemdblclick":"app.valueWinAOk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueCode#}","width":"200","dataIndex":"VCODE","itemId":"VCODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueName#}","dataIndex":"VNAME","itemId":"VNAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectParamVal"},"children":[],"expanded":true,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_base_param_valueList#}","height":"300","layout":"border","width":"520","buttons":"app.valueRoleWinBtn","buttonAlign":"center","dialog":"false","itemId":"valueRoleWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"valueForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"60","width":"200","labelAlign":"left","itemId":"valNameR","fieldLabel":"{#xip_base_param_valueName#}"},"events":{"specialkey":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameR.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridR.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","itemId":"valQueryR","iconCls":"seek_icon","x":"200"},"events":{"click":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameR.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridR.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","height":"200","itemId":"valueGridR"},"events":{"itemdblclick":"app.valueWinROk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueCode#}","width":"200","dataIndex":"VCODE","itemId":"VCODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueName#}","dataIndex":"VNAME","itemId":"VNAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectParamVal"},"children":[],"expanded":true,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#xip_base_param_valueList#}","height":"300","layout":"border","width":"520","buttons":"app.valueUserWinBtn","buttonAlign":"center","dialog":"false","itemId":"valueUserWin","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"valueForm"},"children":[{"configs":{"style":"border-width:0px;padding-top:6px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"60","width":"200","labelAlign":"left","itemId":"valNameU","fieldLabel":"{#xip_base_param_valueName#}"},"events":{"specialkey":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameU.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridU.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_base_param_query#}","itemId":"valQueryU","iconCls":"seek_icon","x":"200"},"events":{"click":"var _sql ;\nvar val_set_code = app.VAL_SET_NAME.getValue();\nif(val_set_code !== null && val_set_code !== '' && val_set_code !== undefined) {\n  _sql = 'select val_code VCODE,val_name VNAME from xip_pub_val_set_dtl  where enable_flag=\\'Y\\' and val_name like'+ \"'\"+'%'+app.valNameU.getValue()+'%'+\"'\"+'and val_set_code='+\"'\"+val_set_code+\"'\" ;\n}\nvar val_sql = app.VAL_SQL.getValue();\nif(val_sql !== null && val_sql !== '' && val_sql !== undefined) {\n  _sql = val_sql ;\n}\n\napp.valueGridU.store.load({params:{valSql:_sql}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","height":"200","itemId":"valueGridU"},"events":{"itemdblclick":"app.valueWinUOk.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueCode#}","width":"200","dataIndex":"VCODE","itemId":"VCODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueName#}","dataIndex":"VNAME","itemId":"VNAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xip/base/param/DATA/selectParamVal"},"children":[],"expanded":true,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"true","height":"80","style":"border-width:0px","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#xip_base_param_queryConditions#}","style":"padding-top:8px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"150","labelAlign":"right","itemId":"paramCorN","fieldLabel":"{#xip_base_param_paramCodeOrName#}"},"events":{"specialkey":"app.grid1.store.load({\n               params:{paramCorN:app.paramCorN.getValue(),\n                       paramType:app.paramType.getValue()}\n});"},"children":[],"expanded":false,"type":"text"},{"configs":{"pickList":"[['S','{#xip_base_param_system#}'],['U','{#xip_base_param_kz#}']]","labelAlign":"right","itemId":"paramType","fieldLabel":"{#xip_base_param_paramType#}"},"events":{"select":"app.grid1.store.load({\n               params:{paramCorN:app.paramCorN.getValue(),\n                       paramType:app.paramType.getValue()}\n});","specialkey":"app.grid1.store.load({\n               params:{paramCorN:app.paramCorN.getValue(),\n                       paramType:app.paramType.getValue()}\n});"},"children":[],"expanded":false,"type":"combo"},{"configs":{"text":"{#xip_base_param_query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.grid1.store.load({\n               params:{paramCorN:app.paramCorN.getValue(),\n                       paramType:app.paramType.getValue()}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_base_param_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"30"},"events":{"click":"// var value = app.grid1.store.getAt(9).data.ENABLE_FLAG;\n// var rec = app.grid1.getSelection()[0];\n// Wb.toast(rec.data.ENABLE_FLAG);\n// return false;\n\n//app.paramType.setValue(\"\");\nWb.reset(app.form1);\napp.paramType.clearValue();\napp.grid1.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.modifyBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_base_param_new#}","itemId":"addBtn","iconCls":"record_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._newWin);\nwin.show();\n//将4个级别的页签都置灰\napp.platformPanel.setDisabled(true);\napp.appPanel.setDisabled(true);\napp.userPanel.setDisabled(true);\napp.rolePanel.setDisabled(true);\nwin.setTitle('{#xip_base_param_new#}');//新增\n//参数编码，VAL_SQL启用\napp.PARAM_CODE.enable();\napp.VAL_SQL.enable();\n//上帝模式下 参数类型可以修改\nif('{#SYS_MODE#}' === 'Y'){\n  app.PARAM_TYPE.setReadOnly(false);\n}\napp.VAL_SET_NAME.store.load(function (){\n  app.ENABLE_FLAG.setValue('Y');\n  app.ENABLE_FLAG.setRawValue('{#xip_base_param_Y#}');\n});\n//加载应用、角色、用户级store\napp.appGrid.store.load();\napp.roleGrid.store.load();\napp.userGrid.store.load();\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_base_param_modify#}","itemId":"modifyBtn","iconCls":"record_edit_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif (rows.length != 1) {\n  Ext.MessageBox.alert('{#xip_base_param_prompt#}', '{#xip_base_param_qxzytsj#}');\n  return;\n} else {\n  Wb.edit(app.grid1, app.newWin);\n  var flag = rows[0].get('ENABLE_FLAG');\n  var val = rows[0].get('VAL_SET_NAME');\n  var code = rows[0].get('VAL_SET_CODE');\n  var sql = rows[0].get('VAL_SQL');\n  //是否启用combobox赋值\n  if (flag === 'Y') {\n    app.ENABLE_FLAG.setRawValue('{#xip_base_param_Y#}');\n  } else {\n    app.ENABLE_FLAG.setRawValue('{#xip_base_param_N#}');\n  }\n  //重新加载参数的来源值集combobox\n  app.VAL_SET_NAME.store.load(function() {\n    app.VAL_SET_NAME.setRawValue(val);\n    app.VAL_SET_NAME.setValue(code);\n    app.VAL_SET_CODE.setValue(code);\n  });\n  var type = rows[0].get('PARAM_TYPE');\n  app.PARAM_TYPE.setValue(type);\n  app.newWin.setTitle('{#xip_base_param_bjcs#}');//编辑参数\n\n  app.PARAM_CODE.disable();\n  if (!Ext.isEmpty(code)) {\n    app.VAL_SQL.disable();\n  } else {\n    app.VAL_SQL.enable();\n  }\n  if (sql === null || sql === '') {\n    if (val === null || val === '') {\n\n      app.platformGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectPlatformStore_val';\n      app.platformGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n      app.appGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectAppStore_val';\n      app.appGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n      app.roleGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectRoleStore_val';\n      app.roleGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n      app.userGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectUserStore_val';\n      app.userGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n\n    } else {\n\n      app.platformGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectPlatformStore';\n      app.platformGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n      app.appGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectAppStore';\n      app.appGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n      app.roleGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectRoleStore';\n      app.roleGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n      app.userGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectUserStore';\n      app.userGrid.store.load({\n        params: {\n          PARAM_ID: rows[0].get('PARAM_ID')\n        }\n      });\n\n    }\n\n\n  } else {\n    app.platformGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectPlatformStore_sql';\n    app.platformGrid.store.load({\n      params: {\n        _sql: sql,\n        PARAM_ID: rows[0].get('PARAM_ID')\n      }\n    });\n    app.appGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectAppStore_sql';\n    app.appGrid.store.load({\n      params: {\n        _sql: sql,\n        PARAM_ID: rows[0].get('PARAM_ID')\n      }\n    });\n    app.roleGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectRoleStore_sql';\n    app.roleGrid.store.load({\n      params: {\n        _sql: sql,\n        PARAM_ID: rows[0].get('PARAM_ID')\n      }\n    });\n    app.userGrid.store.getProxy().url = 'm?xwl=xip/base/param/DATA/selectUserStore_sql';\n    app.userGrid.store.load({\n      params: {\n        _sql: sql,\n        PARAM_ID: rows[0].get('PARAM_ID')\n      }\n    });\n  }\n  app.newWin.show();\n\n\n\n}\n\napp.tab1.setActiveTab(0);\nvar param_type = rows[0].get('PARAM_TYPE');\nvar val_level = rows[0].get('VAL_LEVEL');\nif (param_type == 'S') {\n  if ('{#SYS_MODE#}' === 'Y') {\n    //参数类型为系统且在上帝模式下 显示check\n    app.paramPanel.show();\n    app.paramForm.setHeight(240);\n  } else {\n    //隐藏check\n    app.paramPanel_check.hide();\n    app.paramForm.setHeight(220);\n  }\n   if (val_level.indexOf('A') !== -1) {\n      app.appPanel.setDisabled(false);\n      app.appCheck.setValue(true);\n    } else {\n      app.appPanel.setDisabled(true);\n    }\n    if (val_level.indexOf('P') !== -1) {\n      app.platformPanel.setDisabled(false);\n      app.platCheck.setValue(true);\n    } else {\n      app.platformPanel.setDisabled(true);\n    }\n    if (val_level.indexOf('R') !== -1) {\n      app.rolePanel.setDisabled(false);\n      app.roleCheck.setValue(true);\n    } else {\n      app.rolePanel.setDisabled(true);\n    }\n    if (val_level.indexOf('U') !== -1) {\n      app.userPanel.setDisabled(false);\n      app.userCheck.setValue(true);\n    } else {\n      app.userPanel.setDisabled(true);\n    }\n\n\n} else {\n  //根据val_level的值来显示页签,勾选对应的check\n  if (val_level.indexOf('A') !== -1) {\n    app.appPanel.setDisabled(false);\n    app.appCheck.setValue(true);\n  } else {\n    app.appPanel.setDisabled(true);\n  }\n  if (val_level.indexOf('P') !== -1) {\n    app.platformPanel.setDisabled(false);\n    app.platCheck.setValue(true);\n  } else {\n    app.platformPanel.setDisabled(true);\n  }\n  if (val_level.indexOf('R') !== -1) {\n    app.rolePanel.setDisabled(false);\n    app.roleCheck.setValue(true);\n  } else {\n    app.rolePanel.setDisabled(true);\n  }\n  if (val_level.indexOf('U') !== -1) {\n    app.userPanel.setDisabled(false);\n    app.userCheck.setValue(true);\n  } else {\n    app.userPanel.setDisabled(true);\n  }\n\n}\n//上帝模式下 参数类型可修改\nif('{#SYS_MODE#}' === 'Y'){\n  app.PARAM_TYPE.setReadOnly(false);\n}else{\n  app.PARAM_TYPE.setReadOnly(true);\n}\n\n//当前活动页签 为CHECK的第一个选中的\nif (val_level.indexOf('P') !== -1) {\n  app.tab1.setActiveTab(0);\n}else if(val_level.indexOf('A') !== -1){\n  app.tab1.setActiveTab(1);\n}else if(val_level.indexOf('R') !== -1){\n  app.tab1.setActiveTab(2);\n}else if(val_level.indexOf('U') !== -1){\n  app.tab1.setActiveTab(3);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_base_param_delete#}","itemId":"deleteBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nfor(var i=0;i<rows.length;i++){\n  if(rows[i].data.PARAM_TYPE==='S'){\n    Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_xtsjbnsc#}');//系统数据不能删除\n    return;\n  }\n}\nif(rows.length===0){\n  Ext.MessageBox.alert('{#xip_base_param_prompt#}','{#xip_base_param_nmyxzrhsj#}');//您没有选中任何数据\n}\nelse{\n   Ext.Msg.confirm('{#xip_base_param_prompt#}','{#xip_base_param_qrscsxjl#}',function(a){//您确定要删除\n    if(a=='yes'){\n      Wb.request({\n        url: 'm?xwl=xip/base/param/DATA/deleteParamList', \n        params: Wb.apply({\n           destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Ext.Msg.alert('{#xip_base_param_prompt#}','{#xip_base_param_sccg#}');//删除成功\n          Wb.remove(app.grid1,rows);\n        }\n      });\n    \n    }else{\n      return false ;\n    }\n   \n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_base_param_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"参数ID","hidden":"true","dataIndex":"PARAM_ID","itemId":"PARAM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_valueSetCode#}","hidden":"true","dataIndex":"VAL_SET_CODE","itemId":"VAL_SET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramCode#}","width":"200","dataIndex":"PARAM_CODE","itemId":"PARAM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramName#}","width":"200","dataIndex":"PARAM_NAME","itemId":"PARAM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramType#}","dataIndex":"PARAM_TYPE","itemId":"PARAM_TYPE_COL","renderer":"if(value === \"S\"){\n  return \"{#xip_base_param_system#}\";\n}else{\n  return \"{#xip_base_param_kz#}\";\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramDesc#}","width":"350","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramValueSource#}","width":"200","dataIndex":"VAL_SET_NAME","itemId":"VAL_SET_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_paramValueSourceSQL#}","width":"360","dataIndex":"VAL_SQL","itemId":"VAL_SQL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_base_param_isEnabel#}","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG_COL","renderer":"if(value === \"Y\"){\n  return \"{#xip_base_param_Y#}\";\n}else{\n  return \"<font color='red'>{#xip_base_param_N#}<\/font>\";\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_LEVEL","hidden":"true","dataIndex":"VAL_LEVEL","itemId":"VAL_LEVEL_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/base/param/DATA/SelectParamList"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}