{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","initScript":"var authModel = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(\"AUTH_MODAL\");\nrequest.setAttribute(\"authModel\",authModel);\n\nrequest.setAttribute(\"contextPath\",request.getContextPath());\n\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/hr/emp/dafaultRole/defaultRole\");","itemId":"module"},"children":[{"configs":{"title":"{#xip_hr_emp_dafaultRole_addroletitle#}","height":"400","width":"580","layout":"border","closeAction":"hide","buttonAlign":"center","dialog":"false","border":"false","itemId":"winrole","modal":"true"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#xip_hr_emp_dafaultRole_OK#}","itemId":"confirmbtn","iconCls":"ok_icon"},"events":{"click":"//==============添加角色授权================== \n\nvar authmodal ='{#authModel#}';\nvar rows = app.RolegridAll.getSelectionModel().getSelection();\nif(rows.length === 0){\n\n   Ext.Msg.alert('{#xip_hr_emp_dafaultRole_prompt#}','{#xip_hr_emp_dafaultRole_qxzysqdjs#}');//'提示','请选择要授权的角色！'\n   return false;\n}\n\nvar _tmpJson;\nvar _addArray = [];\nExt.each(rows,function(a){\n  _tmpJson = {AUTH_MODAL:authmodal,TARGET_ID:a.data.ROLE_ID};\n  _addArray.push(_tmpJson); \n});\n\nvar json = { newArray :Ext.JSON.encode(_addArray)};\n\n   Wb.request({url: 'm?xwl=xip/hr/emp/dafaultRole/data/insertrole', params: json, success: function(response){\n            \n                Ext.Msg.alert('{#xip_hr_emp_dafaultRole_prompt#}','{#xip_hr_emp_dafaultRole_sqcg#}');//'提示','授权成功！'\n               \n                app.grid.store.load();\n                app.RolegridAll.store.load( {  params:{roleN:app.roleN.getValue()}} );\n\t\t\t\tapp.menuFunctionTreeAll.store.load();\n              \n     \n          }});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_close#}","itemId":"closebtn","iconCls":"cancel_icon"},"events":{"click":"app.winrole.close();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"north","height":"50","frame":"true","style":"border-width:0px","border":"false","itemId":"Roleform"},"children":[{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","border":"false","itemId":"panel1"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".5","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"60","height":"20","labelAlign":"right","itemId":"roleN","fieldLabel":"{#xip_hr_emp_dafaultRole_role#}"},"events":{"specialkey":"\n  app.RolegridAll.store.load( {  params:{roleN:app.roleN.getValue()}} );\n\t\n"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".5","border":"false","itemId":"panel1"},"children":[{"configs":{"text":"{#xip_hr_emp_dafaultRole_query#}","style":"margin-left:10px","itemId":"roleQueryBtn","iconCls":"seek_icon"},"events":{"click":"\napp.RolegridAll.store.load( {  params:{roleN:app.roleN.getValue()}} );"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"RolegridAll"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_emp_dafaultRole_serialNumber#}","align":"center","xtype":"rownumberer","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ROLE_ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_roleName#}","width":"200","dataIndex":"ROLE_NAME","itemId":"ROLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_roleDesc#}","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/emp/dafaultRole/data/selectRoleAll"},"children":[],"expanded":true,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"title":"{#xip_hr_emp_dafaultRole_addfuntitle#}","height":"400","width":"500","layout":"fit","closeAction":"hide","buttonAlign":"center","dialog":"false","itemId":"winfun","modal":"true"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#xip_hr_emp_dafaultRole_OK#}","itemId":"saveFunBtn","iconCls":"ok_icon"},"events":{"click":"var selectLength = app.menuFunctionTreeAll.getChecked().length;\n\nif(selectLength===0){\n\n   Ext.Msg.alert('{#xip_hr_emp_dafaultRole_prompt#}','{#xip_hr_emp_dafaultRole_qxztjdsqgn#}');//'提示','请选择添加的授权功能！'\n   return false;\n}  \nvar authmodal ='{#authModel#}';\n//========为用户添加授权功能================\nvar _addSelectRecord = app.menuFunctionTreeAll.getChecked();\n\nvar _addArray = [];\nvar _addUnit;\n\nfor(var i = 0;i<selectLength;i++){\n  var item = _addSelectRecord[i];\n\n  if(item.data.node_type === 'F'){ \n    \n    _addUnit = {AUTH_MODAL:authmodal,TARGET_ID:item.data.id};\n \n    _addArray.push(_addUnit);\n  } \n}\n//==============执行请求操作=================\n\nvar json = { newArray :Ext.JSON.encode(_addArray)};\n\n   Wb.request({url: 'm?xwl=xip/hr/emp/dafaultRole/data/insertrole', params: json, success: function(response){\n            \n                Ext.Msg.alert('{#xip_hr_emp_dafaultRole_prompt#}','{#xip_hr_emp_dafaultRole_sqcg#}');//'提示','授权成功！'\n               \n                app.grid.store.load();\n                app.RolegridAll.store.load( {  params:{roleN:app.roleN.getValue()}} );\n\t\t\t\tapp.menuFunctionTreeAll.store.load();\n              \n     \n          }});\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_close#}","itemId":"closeFunWin","iconCls":"cancel_icon"},"events":{"click":"app.winfun.close();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"center","rootVisible":"true","animate":"true","root":"{id:'rootNode',text:'功能菜单',expanded:true}","itemId":"menuFunctionTreeAll","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: function(node,data,overModel,dropPosition,dropFunction,options){\n      return false;\n    },\n    drop: function(node,data,overModel,dropPosition,options){\n      return false;\n    }\n  }\n}"},"events":{"checkchange":"node.cascadeBy(function(n){\n    n.set('checked', checked); \n});\n    checkParent(node);\nfunction checkParent(node){\n  node = node.parentNode;\n  if(!node) return;\n  var checkP=false;\n  node.cascadeBy(function (n)\n  {\n  if (n != node) {\n  if (n.get('checked') === true) {\n  checkP = true;\n  }\n  }\n  });\n  node.set('checked', checkP);\n  checkParent(node);\n}"},"children":[{"configs":{"itemId":"store","url":"{#contextPath#}/userAuthoriseTreeCreateAction.do?method=getFunTreeForNone","fields":"[{name:'text'},{name:'id'},{name:'parent_id'},{name:'node_type'},{name:'node_order'}]"},"events":{"load":"app.menuFunctionTreeAll.expandAll();","beforeload":"operation.params.parentID=operation.node.get('ID');"},"children":[],"expanded":true,"type":"treestore"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"itemId":"funName"},"events":{"specialkey":"\n\n  \napp.grantQueryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"-","itemId":"item11"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_query#}","itemId":"grantQueryBtn","iconCls":"seek_icon"},"events":{"click":"var treeId = app.menuFunctionTreeAll.getId();\ntreeNodeQuery(app.funName.getValue(),'text',treeId);\n\n/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\nfunction treeNodeQuery(text,by,treeId) { \n \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = Ext.getCmp(treeId);\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      me = menuFunTree,\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n  \n   \n}\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"tree"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","border":"true","itemId":"grid"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/emp/dafaultRole/data/selectGrid"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_new#}","itemId":"addBtn","iconCls":"new_icon"},"events":{"click":"var a ='{#authModel#}';\n\n if(a== 'USER'){\n   app.menuFunctionTreeAll.store.load();\n   app.winfun.show();\n \n }\nif(a=='ROLE'){\n  app.RolegridAll.store.load();\n  app.winrole.show();\n  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_delete#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"var rows=app.grid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_hr_emp_dafaultRole_prompt#}','{#xip_hr_emp_dafaultRole_qxzyscdjl#}');//'提示','请选择要删除的记录!'\n  return;\n}\nelse{\n   Ext.Msg.confirm('{#xip_hr_emp_dafaultRole_prompt#}','{#xip_hr_emp_dafaultRole_nqdysc#}',function(a){//'提示','您确定要删除？'\n    if(a=='yes'){\n       \n           Wb.request({\n           url : 'm?xwl=xip/hr/emp/dafaultRole/data/deleteGrid',\n           params : Wb.apply({destroy: Wb.getData(rows)}),\n           success :function(response){\n             \n              app.grid.store.load();\n           }\n        });\n    }\n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item21"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_emp_dafaultRole_serialNumber#}","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"主键id","hidden":"true","dataIndex":"DEFAULT_FUNS_ID","itemId":"DEFAULT_FUNS_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_authorizationMode#}","width":"200","dataIndex":"AUTH_MODAL","itemId":"AUTH_MODAL","renderer":"if(value === \"ROLE\"){\n  return \"{#xip_hr_emp_dafaultRole_roleAuthorization#}\";//角色授权\n}else if(value === \"USER\"){\n  return \"{#xip_hr_emp_dafaultRole_userAuthorization#}\";//功能授权\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"功能id和角色id","hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_emp_dafaultRole_defaultAuthority#}","width":"300","dataIndex":"FUN_NAME","itemId":"FUN_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}