{"inframe":false,"title":"部门管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var ctxPath = request.getContextPath();\nvar funCodeStr = request.getParameter(\"funCode\");\nrequest.setAttribute(\"contextPath\",ctxPath);\nrequest.setAttribute(\"tipCode\",funCodeStr);\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","loginRequired":"false","jsLinks":"[\"xip/js/messageTip.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/hr/dept/dept\");","head":"<script type=\"text/javascript\">\n  function assginEmployee(orgId,deptId,postId,deptName,postName){\n    app.empAsgWin.setTitle('<center>【'+deptName+'】--'+'【'+postName+'】'+'  分配<\/center>');\n    //往隐藏框中添加 orgId、deptId、postId（组织ID、部门ID、岗位ID）\n    app.asgPostId.setValue(postId);\n    app.asgOrgId.setValue(orgId);\n    app.asgDeptId.setValue(deptId);\n    app.empAsgWin.show();\n    app.grid1.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n    app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n\n  }\n  function swap(src, dst, isAll){\n      var srcSt=src.store, dstSt=dst.store, srcSelModel=src.getSelectionModel(),\n      sel=isAll?srcSt.getRange():srcSelModel.getSelection(),\n      srcIndex, len, key='EMP_CODE';\n      var bl = 0;\n      srcIndex=srcSt.indexOf(sel[0]);\n      srcSt.remove(sel);\n      Ext.Array.each(sel,function(r){\n//         if(!Wb.findRecord(dstSt,key,r.get(key)))\n//           dstSt.add(r);\n        for(var i = 0;i<dstSt.getCount();i++){\n           var key = dstSt.getAt(i).get(key);\n           if(r.get(key)===key){\n             bl=1;\n             return;\n           }\n        }\n        if(bl==0){\n          dstSt.add(r);\n        }\n      });\n      dst.getSelectionModel().select(sel);\n      len=srcSt.getCount()-1;\n      if(len<srcIndex)\n        srcIndex=len;\n      if(srcIndex!=-1)\n        srcSelModel.select(srcIndex);\n}\n<\/script>\n\n\n","itemId":"module"},"events":{"initialize":"/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\nfunction treeNodeQuery(text,by,treeId) { \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = treeId;\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n}\n"},"children":[{"configs":{"itemId":"deptOrderStore","url":"m?xwl=xip/hr/dept/DATA/getDeptOrder"},"events":{"beforeload":"app.deptOrderStore.getProxy().extraParams.orgComobox = app.orgComobox.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"winBtns"},"children":[{"configs":{"itemId":"winBtn"},"children":[{"configs":{"text":"{#xip_hr_dept_save#}","itemId":"winSave","iconCls":"save_icon"},"events":{"click":"\n\n/*-------增加岗位信息----------------*/ \nif(!app.form1.getForm().isValid()){\n  Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_xxtxbwz#}\") ;//\"提示\",\"信息填写不完整！\"\n  return false ;\n}\n//判断为新增还是修改\nif(app.positionId.getValue()==='-1'){\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var _primaryKey = resultJson.uuid;\n      var json = { primaryKey   : _primaryKey,\n                  positionCode : app.positionCode.getValue(),\n                  positionName : app.positionName.getValue(),\n                  winOrgId     : app.winOrgId.getValue(),\n                  winDeptId    : app.winDeptId.getValue(),\n                  isUse        : app.isUse.getValue()};  \n\n      var jsonbean = { postId   : _primaryKey,\n                      postCode : app.positionCode.getValue(),\n                      postName : app.positionName.getValue(),\n                      orgId     : app.winOrgId.getValue(),\n                      deptId    : app.winDeptId.getValue(),\n                      enableFlag        : app.isUse.getValue()};  \n      Ext.Ajax.request({\n        url: '{#contextPath#}'+'/hrAction.do?method=savePost',\n        method: 'POST',\n        sync: false,\n        timeout: 300000,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        jsonData: jsonbean,\n        success: function(res, opts) {\n          var rep = Ext.JSON.decode(res.responseText);\n          var flag = rep.flag;\n          var msg = rep.msg;\n\n          if(flag==\"0\"){\n            app.positionId.setValue(_primaryKey);\n            Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_gwtjcg#}');//'提示','岗位添加成功！'\n          }else{\n            Ext.Msg.alert('{#xip_hr_dept_prompt#}',msg);//'提示'\n          }\n        }\n      });\n    }\n  });\n\n}else{\n  var json = {  positionCode : app.positionCode.getValue(),\n              positionName : app.positionName.getValue(),\n              isUse        : app.isUse.getValue(),\n              winOrgId     : app.winOrgId.getValue(),\n              winDeptId    : app.winDeptId.getValue(),\n              positionId   : app.positionId.getValue()};\n  \n  var jsonbean = {  postCode : app.positionCode.getValue(),\n              postName : app.positionName.getValue(),\n              enableFlag        : app.isUse.getValue(),\n              orgId     : app.winOrgId.getValue(),\n              deptId    : app.winDeptId.getValue(),\n              postId   : app.positionId.getValue()};\n       Ext.Ajax.request({\n        url: '{#contextPath#}'+'/hrAction.do?method=updatePost',\n        method: 'POST',\n        sync: false,\n        timeout: 300000,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        jsonData: jsonbean,\n        success: function(res, opts) {\n          var rep = Ext.JSON.decode(res.responseText);\n          var flag = rep.flag;\n          var msg = rep.msg;\n         Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",msg);//\"提示\"\n    }\n  });\n}\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_dept_saveAndNext#}","itemId":"winContinue"},"events":{"click":"/*-------增加岗位信息----------------*/\napp.positionCode.setReadOnly(false);\nif(!app.form1.getForm().isValid()){\n  Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_xxtxbwz#}\") ;//\"提示\",\"信息填写不完整！\"\n  return false ;\n}\n/**------执行Update操作------*/\nif(app.positionId.getValue()==='-1'){\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var _primaryKey = resultJson.uuid;\n      var json = { primaryKey   : _primaryKey,\n                  positionCode : app.positionCode.getValue(),\n                  positionName : app.positionName.getValue(),\n                  winOrgId     : app.winOrgId.getValue(),\n                  winDeptId    : app.winDeptId.getValue(),\n                  isUse        : app.isUse.getValue()};  \n\n      var jsonbean = { postId   : _primaryKey,\n                      postCode : app.positionCode.getValue(),\n                      postName : app.positionName.getValue(),\n                      orgId     : app.winOrgId.getValue(),\n                      deptId    : app.winDeptId.getValue(),\n                      enableFlag        : app.isUse.getValue()}; \n      Ext.Ajax.request({\n        url: '{#contextPath#}'+'/hrAction.do?method=savePost',\n        method: 'POST',\n        sync: false,\n        timeout: 300000,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        jsonData: jsonbean,\n        success: function(res, opts) {\n          var rep = Ext.JSON.decode(res.responseText);\n          var flag = rep.flag;\n          var msg = rep.msg;\n\n          if(flag==\"0\"){\n            app.positionCode.setValue('');\n            app.positionName.setValue('');\n            app.positionId.setValue('-1');\n            app.positionGrid.store.removeAll();\n            Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_gwtjcg#}');//'提示','岗位添加成功！'\n          }else{\n            Ext.Msg.alert('{#xip_hr_dept_prompt#}',msg);//'提示'\n          }\n        }\n      });\n    }\n  });\n\n}else{\n  var json = {  positionCode : app.positionCode.getValue(),\n              positionName : app.positionName.getValue(),\n              isUse        : app.isUse.getValue(),\n              winOrgId     : app.winOrgId.getValue(),\n              winDeptId    : app.winDeptId.getValue(),\n              positionId   : app.positionId.getValue()};\n\n  var jsonbean = {  postCode : app.positionCode.getValue(),\n                  postName : app.positionName.getValue(),\n                  enableFlag        : app.isUse.getValue(),\n                  orgId     : app.winOrgId.getValue(),\n                  deptId    : app.winDeptId.getValue(),\n                  postId   : app.positionId.getValue()};\n\n  Ext.Ajax.request({\n    url: '{#contextPath#}'+'/hrAction.do?method=updatePost',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: jsonbean,\n    success: function(res, opts) {\n      var rep = Ext.JSON.decode(res.responseText);\n      var flag = rep.flag;\n      var msg = rep.msg;\n      if(flag==\"0\"){\n        app.positionCode.setValue('');\n        app.positionName.setValue('');\n        app.positionId.setValue('-1');\n        app.positionGrid.store.removeAll();\n        Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_gwgxcg#}');//'提示','岗位更新成功！'\n      }else{\n        Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",msg);//\"提示\"\n      }\n    }\n  });\n}\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_dept_close#}","itemId":"winClose","iconCls":"cancel_icon"},"events":{"click":"app.position_win.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"asgBtn"},"children":[{"configs":{"text":"{#xip_hr_dept_OK#}","hidden":"true","itemId":"asgSave","iconCls":"save_icon"},"events":{"click":"app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId';\napp.treePosGrid.store.load({params:{orgComobox:app.asgOrgId.getValue(),deptId:app.asgDeptId.getValue()}});\napp.empAsgWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"wins"},"children":[{"configs":{"title":"{#xip_hr_dept_addEmp#}","height":"380","width":"580","layout":"border","closeAction":"hide","dialog":"true","itemId":"userSelectWin","modal":"true"},"events":{"ok":"var rows = app.userSelectGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxztjdjl#}');//'提示','请选择添加的记录!'\n}else{\n  var newArray=[];\n  var _deptId = app.winDeptId.getValue();\n  var _postId = app.positionId.getValue();\n  var _orgId = app.winOrgId.getValue();\n  Ext.each(rows,function(item){\n\n    var _record = item.getData();\n    _record.deptId = _deptId;\n    _record.postId = _postId;\n    _record.orgId = _orgId; \n    _record.asgId = '';\n    _record.empId = _record.EMP_ID;\n    //     _record.DEPT_ID = _deptId;\n    //     _record.POST_ID = _postId;\n    //     _record.ORG_ID = _orgId; \n    //     _record.ASG_ID = '';\n    newArray.push(_record); \n  });\n\n  Ext.Ajax.request({\n    url: '{#contextPath#}'+'/hrAction.do?method=saveEmgAsg',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: Ext.JSON.encode(newArray),\n\n    success: function(res, opts) {\n\n      //   Wb.request({\n      //     url:'m?xwl=xip/hr/dept/DATA/asgCreate',\n      //     params:Wb.apply({\n      //                 newArray:Ext.JSON.encode(newArray)\n      //            }),\n      //     success:function(){\n\n      var rep = Ext.JSON.decode(res.responseText);\n      var flag = rep.flag;\n      var msg = rep.msg;\n      if(flag==\"0\"){\n        Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_bccg#}');//'提示','保存成功'\n        app.positionGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n        app.userSelectWin.close();\n      }else{\n        Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);//\"提示\"\n      }\n    }\n  });\n}"},"children":[{"configs":{"region":"north","height":"70","frame":"true","style":"border-width:0px","layout":"fit","itemId":"userSelectForm"},"children":[{"configs":{"title":"{#xip_hr_dept_queryConditions#}","layout":"column","itemId":"fieldset4"},"children":[{"configs":{"labelWidth":"60","hidden":"true","width":"180","labelAlign":"right","itemId":"userName","fieldLabel":"{#xip_hr_dept_username#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","width":"250","labelAlign":"right","itemId":"empWinName","fieldLabel":"{#xip_hr_dept_empCodeOrName#}"},"events":{"specialkey":"app.userSelectGrid.store.load({params:{\n                                  empWinName:app.empWinName.getValue(),\n                                  postId:app.positionId.getValue(),\n                                  deptId:app.winDeptId.getValue()\n                             }});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_hr_dept_query#}","itemId":"userQuertBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.userSelectGrid.store.load({params:{\n                                  empWinName:app.empWinName.getValue(),\n                                  postId:app.positionId.getValue(),\n                                  deptId:app.winDeptId.getValue()\n                             }});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_dept_reset#}","itemId":"userResetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"app.empWinName.setValue('');\napp.userSelectGrid.store.load({params:{\n                                  empWinName:app.empWinName.getValue(),\n                                  postId:app.positionId.getValue(),\n                                  deptId:app.winDeptId.getValue()\n                             }});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"userSelectGrid","simpleSelect":"true"},"children":[{"configs":{"autoDestroy":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/getUsers"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"用户id","hidden":"true","dataIndex":"EMP_ID","itemId":"COLUMN_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empCode#}","width":"200","dataIndex":"EMP_CODE","itemId":"COLUMN_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empName#}","width":"220","dataIndex":"EMP_NAME","itemId":"COLUMN_EMP_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"height":"470","width":"580","layout":"fit","closeAction":"hide","buttons":"app.winBtn","buttonAlign":"center","dialog":"false","border":"false","itemId":"position_win","modal":"true"},"events":{"beforeclose":"var _orgId = app.orgComobox.getValue();\nvar _deptId = app.deptId.getValue();\nif(Ext.isEmpty(_deptId)){\n   app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPosition'; \n   app.treePosGrid.store.load({params:{orgComobox:_orgId}});\n  \n}else{\n   app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId'; \n   app.treePosGrid.store.load({params:{orgComobox:_orgId,deptId:_deptId}});\n}\nWb.reset(app.form1);\napp.positionGrid.store.removeAll();"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"anchor","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#xip_hr_dept_postInformation#}","itemId":"fieldset1"},"children":[{"configs":{"height":"35","frame":"false","style":"border-width:0px","layout":"column","columnWidth":"1","border":"false","bodyPadding":"5 0 0 0","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"260","labelAlign":"right","itemId":"positionCode","fieldLabel":" <font color='red'>*<\/font>{#xip_hr_dept_postCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","width":"260","labelAlign":"right","itemId":"positionName","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_dept_postName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"height":"35","frame":"false","style":"border-width:0px","layout":"column","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","width":"260","labelAlign":"right","itemId":"beyondDept","fieldLabel":"{#xip_hr_dept_belongDept#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"VAL_NAME","width":"260","valueField":"VAL_CODE","value":"Y","labelAlign":"right","itemId":"isUse","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_dept_isEnabled#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/getEnableFlag"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"positionId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"winOrgId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"winDeptId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"orginalCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"{#xip_hr_dept_allocationInfomation#}","style":"border-width:0px","collapsible":"false","layout":"fit","itemId":"fieldset3"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","height":"280","frame":"false","border":"true","itemId":"positionGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_addAllocation#}","itemId":"addAsignBtn","iconCls":"user_add_icon"},"events":{"click":"\n\nif(app.form1.getForm().isValid()===false){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_xxtxbwzqqr#}');//提示 信息填写不完整,请确认!\n  return;\n}\n//判断为新增还是修改\nif(app.positionId.getValue()==='-1'){\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var _primaryKey = resultJson.uuid;\n      var json = { primaryKey   : _primaryKey,\n                  positionCode : app.positionCode.getValue(),\n                  positionName : app.positionName.getValue(),\n                  winOrgId     : app.winOrgId.getValue(),\n                  winDeptId    : app.winDeptId.getValue(),\n                  isUse        : app.isUse.getValue()};  \n\n\n      var jsonbean = { postId   : _primaryKey,\n                      postCode : app.positionCode.getValue(),\n                      postName : app.positionName.getValue(),\n                      orgId     : app.winOrgId.getValue(),\n                      deptId    : app.winDeptId.getValue(),\n                      enableFlag        : app.isUse.getValue()};  \n      Ext.Ajax.request({\n        url: '{#contextPath#}'+'/hrAction.do?method=savePost',\n        method: 'POST',\n        sync: false,\n        timeout: 300000,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        jsonData: jsonbean,\n        success: function(res, opts) {\n          var rep = Ext.JSON.decode(res.responseText);\n          var flag = rep.flag;\n          var msg = rep.msg;\n          if(flag==\"0\"){\n            app.positionId.setValue(_primaryKey);\n            app.position_win.setTitle(app.treeDeptName.getValue()+'{#xip_hr_dept_gwbj#}'); // -岗位编辑\n            app.empWinName.setValue(\"\");\n            app.userSelectWin.show();\n            app.userSelectGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n          }else{\n            Ext.Msg.alert('{#xip_hr_dept_prompt#}',msg);\n          }\n        }\n      });\n    }\n  });\n\n}else{\n\n\n  var jsonbean = {  postCode : app.positionCode.getValue(),\n                  postName : app.positionName.getValue(),\n                  enableFlag        : app.isUse.getValue(),\n                  orgId     : app.winOrgId.getValue(),\n                  deptId    : app.winDeptId.getValue(),\n                  postId   : app.positionId.getValue()};\n  Ext.Ajax.request({\n    url: '{#contextPath#}'+'/hrAction.do?method=updatePost',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: jsonbean,\n    success: function(res, opts) {\n\n      //      Wb.request({\n      //          url:'m?xwl=xip/hr/dept/DATA/positionEdit',\n      //          success:function(){\n      var rep = Ext.JSON.decode(res.responseText);\n      var flag = rep.flag;\n      var msg = rep.msg;\n      if(flag==\"0\"){\n        app.userSelectWin.show();\n          app.empWinName.setValue(\"\");\n        app.userSelectGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n      }else{\n        Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);\n      }\n\n\n    }\n  });\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_deleteAllocation#}","itemId":"delAsignBtn","iconCls":"user_delete_icon"},"events":{"click":"var rows = app.positionGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzczdjl#}');//'提示','请选择操作的记录!'\n  return;\n}\nExt.Msg.confirm('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qryscfpxxm#}',function(a){//'提示','确定要删除分配信息吗？'\n  if(a=='yes'){\n    var secIds = '';\n    for(var i=0; i<rows.length; i++){\n      secIds += '\\''+(rows[i].data.ASG_ID) + '\\',';    \n    }\n    secIds = secIds.substring(0,secIds.length-1);\n    Ext.Ajax.request({\n      url: '{#contextPath#}'+'/hrAction.do?method=delEmgAsg',\n      method: 'POST',\n      sync: false,\n      timeout: 300000,\n\n      params:{ids:secIds},\n      success: function(res, opts) {\n\n        var rep = Ext.JSON.decode(res.responseText);\n        var flag = rep.flag;\n        if(flag==\"0\"){\n\n\n          Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_scfpxxcg#}');//'提示','删除分配信息成功'\n          app.positionGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n        }else{\n          Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);//提示\n        }\n      }\n    });\n  }\n});\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_dept_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"分配ID","hidden":"true","dataIndex":"ASG_ID","itemId":"ASG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empCode#}","width":"120","dataIndex":"EMP_CODE","itemId":"EMP_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empName#}","width":"120","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_postCode#}","hidden":"true","dataIndex":"POST_CODE","itemId":"POST_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_postName#}","hidden":"true","dataIndex":"POST_NAME","itemId":"POST_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/getAsignByPosId"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"height":"500","width":"800","layout":"border","resizable":"true","closeAction":"hide","buttons":"app.asgBtn","buttonAlign":"center","dialog":"false","itemId":"empAsgWin","modal":"true"},"events":{"close":"//app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId'; ,deptId:app.asgDeptId.getValue()\napp.treePosGrid.store.load({params:{orgComobox:app.asgOrgId.getValue(),deptId:app.asgDeptId.getValue()}});\napp.empName.setValue('');\napp.empName1.setValue('');"},"children":[{"configs":{"region":"west","title":"<center>{#xip_hr_dept_assignableEmp#}<\/center>","height":"498","frame":"false","width":"'45%'","layout":"border","columnWidth":"1","split":"true","itemId":"panel1","y":"0","x":"0"},"children":[{"configs":{"region":"north","height":"40","frame":"true","width":"'100%'","layout":"form","border":"false","itemId":"panel4"},"children":[{"configs":{"frame":"true","style":"border-width:0px","width":"'100%'","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"50","labelAlign":"right","itemId":"empName","fieldLabel":"{#xip_hr_dept_Name#}"},"events":{"specialkey":"app.grid1.store.load({params:{empName:app.empName.getValue(),asgPostId:app.asgPostId.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_hr_dept_query#}","itemId":"button5","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load({params:{empName:app.empName.getValue(),asgPostId:app.asgPostId.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"asgPostId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"asgOrgId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"asgDeptId"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","frame":"false","layout":"fit","border":"false","itemId":"panel1"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","frame":"true","scroll":"vertical","border":"false","itemId":"grid1","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/selectEmp"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_dept_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"分配ID","hidden":"true","dataIndex":"ASG_ID","itemId":"ASG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empCode#}","width":"120","dataIndex":"EMP_CODE","itemId":"EMP_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"east","title":"<center>{#xip_hr_dept_AssignedEmp#}<\/center>","height":"498","frame":"false","width":"'45%'","layout":"border","columnWidth":"1","split":"true","itemId":"panel11","y":"0"},"children":[{"configs":{"region":"north","height":"40","frame":"true","layout":"form","border":"false","itemId":"panel4","x":"'100%'"},"children":[{"configs":{"bodyStyle":"padding: 0px 10px 3px","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"50","labelAlign":"right","itemId":"empName1","fieldLabel":"{#xip_hr_dept_Name#}"},"events":{"specialkey":"app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue(),empName1:app.empName1.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_hr_dept_query#}","itemId":"button51","iconCls":"seek_icon"},"events":{"click":"app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue(),empName1:app.empName1.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","frame":"true","layout":"fit","border":"false","itemId":"panel1"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","frame":"true","scroll":"vertical","border":"false","itemId":"grid11","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/selectAsignEmp"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_dept_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"分配ID","hidden":"true","dataIndex":"ASG_ID","itemId":"ASG_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empCode#}","width":"120","dataIndex":"EMP_CODE","itemId":"EMP_CODE_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empName#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL1","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","height":"498","frame":"false","width":"'10%'","layout":"border","split":"true","itemId":"panel12"},"children":[{"configs":{"region":"south","bodyStyle":"padding: 0px 10px 0px","height":"'30%'","frame":"true","style":"border-width:0px","layout":"form","columnWidth":"1","border":"false","itemId":"panel4"},"children":[{"configs":{"text":"<<","width":"50","itemId":"button7","menuAlign":"center","tooltip":"{#xip_hr_dept_cancelAllocation#}"},"events":{"click":"var rows = app.grid11.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzygxx#}');//'提示','请选择员工信息!'\n  return false ;\n}else{\n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n      \tvar id = \"'\" + r.data.ASG_ID+ \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n  \n      Ext.Ajax.request({\n      url: '{#contextPath#}'+'/hrAction.do?method=delEmgAsg',\n      method: 'POST',\n      sync: false,\n      timeout: 300000,\n\n      params:{ids:idList},\n      success: function(res, opts) {\n\n        var rep = Ext.JSON.decode(res.responseText);\n        var flag = rep.flag;\n//       Wb.request({\n//         url:'m?xwl=xip/hr/dept/DATA/delEmpAsg',\n//         params:{ids:idList},\n//         success:function(){\n                if(flag==\"0\"){\n          Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_qxygfpcg#}\");//\"提示\",\"取消员工分配成功!\"\n          app.grid1.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n          app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n                }else{\n          Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);//提示\n        }\n        }\n      });\n    }\nswap(app.grid11,app.grid1);\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"region":"north","height":"'30%'","frame":"true","style":"border-width:0px","columnWidth":"1","border":"false","itemId":"panel1"},"children":[],"expanded":false,"type":"panel"},{"configs":{"region":"center","bodyStyle":"padding: 0px 10px 0px","frame":"true","style":"border-width:0px","layout":"form","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"text":">>","width":"50","itemId":"button7","tooltip":"{#xip_hr_dept_addAllocation#}"},"events":{"click":"//获取要添加授权的参数\nvar a_orgId = app.asgOrgId.getValue();\nvar a_deptId = app.asgDeptId.getValue();\nvar a_postId = app.asgPostId.getValue();\nvar rows = app.grid1.getSelectionModel().getSelection();\nvar empIdList=\"\";\nif(rows.length===0){\n  Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzysqdyg#}');//'提示','请选择要授权的员工！'\n  return false;\n}\n//********执行授权操作***************\n//********交换store数据**************\n//********无需校验授权的重复性*********\nvar _addArray = [];\nvar _tmpJson;\nExt.each(rows,function(item){\n//  _tmpJson = {EMP_ASG_ID:'',ORG_ID:a_orgId,DEPT_ID:a_deptId,POST_ID:a_postId,EMP_ID:item.data.EMP_ID};\n    _tmpJson = {asgId:'',orgId:a_orgId,deptId:a_deptId,postId:a_postId,empId:item.data.EMP_ID};\n  _addArray.push(_tmpJson); \n  \n   \n  \n  \n});\n\n\n\n  Ext.Ajax.request({\n    url: '{#contextPath#}'+'/hrAction.do?method=saveEmgAsg',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: Ext.JSON.encode(_addArray),\n\n    success: function(res, opts) {\n            var rep = Ext.JSON.decode(res.responseText);\n      var flag = rep.flag;\n      var msg = rep.msg;\n      if(flag==\"0\"){\n    Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\", '{#xip_hr_dept_ygfpcg#}');//\"提示\", '员工分配成功！'\n    swap(app.grid1,app.grid11);\n    app.grid1.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n    app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n      }else{\n        Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);//\"提示\"\n      }\n  }\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"height":"200","width":"450","layout":"fit","resizable":"false","closeAction":"hide","dialog":"true","itemId":"deptAddWin"},"events":{"hide":"app.deptAddForm.getForm().reset();\nvar _treeRecord = app.deptTree.getSelectionModel().getSelection()[0];\nif(_treeRecord.data.parent_id === '-1'){\n  //button2.setDisabled(true);\n}\n","ok":"\nif(!app.deptAddForm.getForm().isValid()){\n  Wb.warn('{#xip_hr_dept_qtxsybtx#}');//'请填写所有必填信息！'\n  alert();\n  return;\n}\n\napp.deptInfoForm.show();\n//点击保存之前，将窗口填写的信息全部\napp.treeDeptCode.setValue(app.ADD_DEPT_CODE.getValue());\napp.treeDeptDesc.setValue(app.ADD_DEPT_DESC.getValue());\napp.treeDeptName.setValue(app.ADD_DEPT_NAME.getValue());\napp.check1.setValue(app.ADD_DEPT_ENABLE.getValue());\napp.deptSaveBtn.fireEvent('click');\napp.deptAddWin.close();\n\n"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"deptAddForm"},"children":[{"configs":{"bodyStyle":"padding: 15px 50px 0px","frame":"true","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"60","hidden":"true","itemId":"UP_DEPT_ID","fieldLabel":"上级部门ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"60","hidden":"true","labelAlign":"right","itemId":"ADD_DEPT_ID","fieldLabel":"部门ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"ADD_DEPT_CODE","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_dept_deptCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"ADD_DEPT_NAME","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_dept_deptName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"ADD_DEPT_DESC","fieldLabel":"{#xip_hr_dept_deptDesc#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"ADD_DEPT_ENABLE","checked":"true","fieldLabel":"{#xip_hr_dept_isEnabled#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"// var _tipCode = '{#tipCode#}';\n// var _deptTip = Wb.getCookie(_tipCode);\n// if(Ext.isEmpty(_deptTip)){\n//   MsgTip.msg('<font color=\"red\">提示<\/font>', '先选择一个组织，然后在左边的树点击鼠标右键菜单进行操作，<br>拖动节点可以改变部门的顺序和上下级.',true,5000,_tipCode, true);  \n// }\n//Wb.toast('<font color=\"red\" style=\"font-weight:bold\">提示<\/font><br>'+'先选择一个组织，然后在左边的树点击鼠标右键菜单进行操作，<br>拖动节点可以改变部门的顺序和上下级.');\nWb.toast('<font color=\"red\" style=\"font-weight:bold\">{#xip_hr_dept_prompt#}<\/font>'+'{#xip_hr_dept_firstMessage#}');"},"children":[{"configs":{"region":"west","height":"'100%'","frame":"false","width":"'28%'","layout":"border","columnWidth":"1","split":"true","border":"true","itemId":"panel1"},"children":[{"configs":{"region":"north","frame":"true","width":"'100%'","layout":"fit","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"bodyStyle":"padding: 0px 10px 3px","frame":"true","style":"border-width:0px","width":"'100%'","layout":"form","columnWidth":"1","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","displayField":"NAME","valueField":"CODE","emptyText":"{#xip_hr_dept_qxzzz#}","labelAlign":"right","itemId":"orgComobox","forceSelection":"true","fieldLabel":"{#xip_hr_dept_org#}","editable":"true"},"events":{"select":"app.deptInfoForm.getForm().reset();\napp.upDeptId.setValue(app.orgComobox.getValue());\napp.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\napp.deptTree.store.load({params:{deptName:app.deptName.getValue(),orgComobox:app.orgComobox.getValue()}});\napp.deptSaveBtn.setDisabled(true);\nvar _tmp = document.getElementById('_toolTipsClickHide');\n//MsgTip.hide(_tmp);"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/getComboxOrg"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","emptyText":"{#xip_hr_dept_srbmmchahccx#}","labelAlign":"right","itemId":"deptName","fieldLabel":"{#xip_hr_dept_dept#}"},"events":{"specialkey":"if (!Ext.isEmpty(app.orgComobox.getValue())){\n  treeNodeQuery(text.value,'text',app.deptTree);\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","layout":"column","width":"'100%'","columnWidth":"1","border":"false","itemId":"panel2"},"children":[],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","height":"'100%'","width":"'100%'","layout":"border","border":"false","itemId":"panelWest"},"children":[{"configs":{"rootVisible":"false","region":"center","height":"'100%'","frame":"false","animate":"false","root":"{text:Str.all,parent_id:'-1',text:'{#xip_hr_dept_orgDeptTree#}',flag:'Y',expanded:true}","width":"'100%'","split":"true","border":"false","itemId":"deptTree","viewConfig":"{\n  plugins : {\n    pluginId : 'ddPlug',\n    ptype : 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop:function(node, data, om, dp){\n      /*-------------存储被拖拽节点的信息-----------*/\n      //Wb.saveNodePos(Wb.getNode(data.item));\n      if(om.get('id')===app.orgComobox.getValue()){\n         return false;\n      }\n      //return true;  \n    },\n    drop : function(node, data, om, dp){\n/*-----------node：被拖拽的节点，om：要拖拽到的节点，dp：被拖拽的位置<before，after，append>---------*/\n  var dst = om, src = data.records[0], orderIndex, srcId, parentId, pn,tmpOrder;\n  Wb.mask(app.deptTree);\n  dst.expand(false,function(){\n    Wb.unmask(app.deptTree);\n/*------------部门id---------------*/\n    srcId = src.get('id');  \n/*-----------判断拖拽的类型---------*/\n    if(dp=='append'){\n      pn = dst;\n      parentId = dst.get('id');\n      if(!Ext.isEmpty(dst.lastChild.previousSibling)){\n        tmpOrder = dst.lastChild.previousSibling.get('seq_updept');\n        if(!Ext.isEmpty(tmpOrder)){\n          orderIndex = Number(tmpOrder)+Number(1);\n        }else{\n          orderIndex = 1;\n        }\n      }else{\n        orderIndex = 1;\n      }\n    }else{\n      pn = src.parentNode;\n      parentId = pn.get('id');\n      if (dp == 'before'){\n        if(Ext.isEmpty(dst.get('seq_updept'))){\n          orderIndex = 1;\n        }else{\n          orderIndex = Number(dst.get('seq_updept'));\n           }\n      }else{\n        if(Ext.isEmpty(dst.get('seq_updept'))){\n           orderIndex = 1;\n         }else{\n            orderIndex = Number(dst.get('seq_updept')) + Number(1);\n           }  \n    }\n   }\n    Wb.request({\n                url : 'm?xwl=xip/hr/dept/DATA/updateDeptIndex',\n                mask:app.deptTree,\n                params : {seq_updept:orderIndex, deptId:srcId, parentId:parentId},\n                failure : function() {\n                  Wb.revertNodePos(src);\n                },\n                success : function() {\n                  pn.eachChild(function(x) {\n                    var i ;\n                    if(Ext.isEmpty(x.get('seq_updept'))){\n                       i =1;\n                    }else{\n                       i = Number(x.get('seq_updept'));\n                    }\n                    if (i >= orderIndex) {\n                      x.set('seq_updept', Number(i) + Number(1));\n                      x.commit();\n                    }\n                  });\n                  src.set('parent_id', parentId);\n                  src.set('seq_updept', orderIndex);\n                  src.commit();\n                }\n               });    \n  });\n  }\n  }\n}"},"events":{"itemclick":"app.queryPositionName.setValue('');\nvar parentId = record.data.parent_id;\napp.deptSaveBtn.setDisabled(false);\nif(parentId==='-1'){\n  app.deptInfoForm.hide();\n  app.deptSaveBtn.setDisabled(true);\n  app.postAddBtn.setDisabled(true);\n  //button4.setDisabled(true);\n  app.postEditBtn.setDisabled(true);\n  app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPosition';   \n  app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n  app.treeDeptName.setValue('');\n  app.treeDeptCode.setValue('');\n  app.treeDeptDesc.setValue('');\n  app.deptId.setValue('');\n   //upDeptId.setValue(parentId);\n  app.upDeptId.setValue(record.data.id); \n}else{\n  app.deptInfoForm.show();\n  var orgComoboxId = app.orgComobox.getValue();\n  var _deptId = record.data.id;\n  app.postAddBtn.setDisabled(false);\n  app.postDeleteBtn.setDisabled(false);\n  app.postEditBtn.setDisabled(false);\n  app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId'; \n  app.treePosGrid.store.load({params:{orgComobox:orgComoboxId,deptId:_deptId}});\n\n  var _treeDeptName = record.data.text;\n  var _treeDeptCode = record.data.code;\n  var _treeDeptDesc = record.data.shortname;\n  var _isEnabled = record.data.isenable;\n  var _treeDeptId = record.data.id;\n  var _treeDeptUpId = record.data.up_dp_id;\n  app.deptId.setValue(_treeDeptId);\n  app.upDeptId.setValue(_treeDeptUpId);\n  app.treeDeptName.setValue(_treeDeptName);\n  app.treeDeptCode.setValue(_treeDeptCode);\n  app.treeDeptDesc.setValue(_treeDeptDesc);\n  app.operateCode.setValue('edit');\n  if(_isEnabled==='Y'){\n    app.check1.setValue(true);   \n  }else{\n    app.check1.setValue(false);\n  }\n}","tagEvents":"itemcontextmenu:function(view,record,item,index,event,options){\n  event.preventDefault();\n  event.stopEvent();\n  var isRoot = record.data.parent_id;\n  var flag = record.data.text;\n  app.deptSaveBtn.setDisabled(false);\n  //根节点只新增下级部门\n  if(isRoot ==='-1' && flag !=='{#xip_hr_dept_orgDeptTree#}'){\n    var nodemenu = new Ext.menu.Menu({  \n      floating:\ttrue,  \n      items\t:\t[{  \n        text\t:\t'{#xip_hr_dept_xzxjbu#}',  \n        iconCls\t:\t'new_icon',\n        handler\t:\tfunction(){\n          app.deptInfoForm.getForm().reset();\n          var deptUpId = record.data.id;//组织ID\n          app.upDeptId.setValue(deptUpId);\n          app.treePosGrid.store.removeAll();\n          app.UP_DEPT_ID.setValue(deptUpId);\n          app.deptAddWin.show();\n        }  \n      }]  \t                  \n    });\n    nodemenu.showAt(event.getXY());\n  }else if(isRoot !== '-1'){ \n    var nodemenu = new Ext.menu.Menu({  \n      floating:\ttrue,  \n      items\t:\t[{  \n        text\t:\t'{#xip_hr_dept_xzxjbu#}',  \n        iconCls\t:\t'new_icon',\n        handler\t:\tfunction(){  \n          app.postAddBtn.setDisabled(true);\n          app.postEditBtn.setDisabled(true);\t\n          app.deptInfoForm.getForm().reset();\n          var tempId = record.get('id');\n          app.upDeptId.setValue(tempId);\n          app.treePosGrid.store.removeAll();\n          app.UP_DEPT_ID.setValue(tempId);\n          app.deptAddWin.show();\n        }  \n      },{  \n        text\t:\t'{#xip_hr_dept_deptdel#}',  \n        iconCls\t:\t'delete_icon',\n        handler\t:\tfunction(){\n          var tmpParentDeptId = record.get('id');\n          deleteDept(tmpParentDeptId);\n        }  \n      }]  \n    });  \n    nodemenu.showAt(event.getXY());  \t\t\t   \n  }\n\n  function deleteDept(parentId){\n    Ext.MessageBox.confirm('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qdscbm#}',function(item){\n      if(item === 'yes'){\n\n        Ext.Ajax.request({\n          url: '{#contextPath#}'+'/hrAction.do?method=delDepts',\n          method: 'POST',\n          sync: false,\n          timeout: 300000,\n\n          params:{deptId:parentId},\n          success: function(res, opts) {\n\n            var rep = Ext.JSON.decode(res.responseText);\n            var flag = rep.flag;\n            if(flag==\"0\"){\n              //更新树\n              var node = app.deptTree.getSelectionModel().getSelection()[0];;\n              var parentNode = node.parentNode;\n\n              parentNode.removeChild(node);\n              parentNode.commit();\n              Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_delsuc#}\");\n            }else{\n              Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);\n            }\n\n\n\n\n          }\n        });\n      }\n    });\n  }\n\n}\n\n\n","beforeload":"store.getProxy().extraParams.orgComobox = app.orgComobox.getValue();\nstore.getProxy().extraParams.deptName = app.deptName.getValue();"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"{#contextPath#}/deptTreeAction.do?method=getDeptTreeByorgId","fields":"[{name:'isenable'},{name:'seq_updept'},{name:'text'},{name:'id'},{name:'shortname'},{name:'up_dp_id'},{name:'orgid'},{name:'parent_id'},{name:'code'}]\n"},"events":{"load":"app.deptTree.expandAll();\nvar _findId = app.orgComobox.getValue();\nvar _selRecord = app.deptTree.store.getNodeById(_findId);\napp.deptTree.getSelectionModel().select(_selRecord);\napp.postAddBtn.setDisabled(true);\napp.postEditBtn.setDisabled(true);"},"children":[],"expanded":false,"type":"treestore"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_deptExport#}","itemId":"exportBtn","iconCls":"db_export_icon"},"events":{"click":"var orgId = app.orgComobox.getValue();\nif(Ext.isEmpty(orgId)){\n  orgId = '';\n}\n\nXip.exportExcel('XIP_PUB_DEPTS', {orgId:orgId, deptName:app.deptName.getValue()}, '{#xip_hr_dept_dept#}');"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_deptImport#}","itemId":"importBtn","iconCls":"db_import_icon"},"events":{"click":"Xip.importExcel('XIP_PUB_DEPTS', null);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_refresh#}","itemId":"refresh","iconCls":"refresh_icon"},"events":{"click":"app.deptTree.store.load({params:{deptName:app.deptName.getValue(),orgComobox:app.orgComobox.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"tree"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","height":"'100%'","frame":"false","width":"'100%'","layout":"border","border":"false","itemId":"contentPanel"},"children":[{"configs":{"region":"center","height":"'100%'","frame":"false","width":"'100%'","layout":"border","border":"false","itemId":"orgCenter"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","hidden":"true","width":"document.body.clientWidth","layout":"form","border":"false","itemId":"deptInfoForm"},"children":[{"configs":{"style":"border-width:0px","itemId":"tbar"},"children":[{"configs":{"text":"{#xip_hr_dept_save#}","itemId":"deptSaveBtn","disabled":"true","iconCls":"save_icon"},"events":{"click":"\n\nif(Ext.isEmpty(app.orgComobox.getValue())){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzzz#}!');\n  return false;\n}\nif(Ext.isEmpty(app.upDeptId.getValue())){\n  Ext.MessageBox.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzsjbm#}');\n  return false;\n\n}\n//=====保存部门操作，只保存部门，部门下的岗位保存重新弹出新的窗口=====\nvar _deptCode = app.treeDeptCode.getValue();\nif(Ext.isEmpty(_deptCode)){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzsjbmcode#}');\n  return false;\n}\nvar _deptName = app.treeDeptName.getValue();\nif(Ext.isEmpty(_deptName)){\n  Ext.Msg.alert('{#xip_hr_dept_prompt#}','{#xip_hr_dept_qxzsjbmname#}');\n  return false;\n}\nvar _deptId = app.deptId.getValue();\nvar _orgId = app.orgComobox.getValue();\nvar _upDeptId = app.upDeptId.getValue();\nvar _isEnable = 'N';\nif(app.check1.getValue()){\n  _isEnable = 'Y';  \n}\nvar isExist = 0;\nvar isCurrentId;\nWb.request({\n  url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n  success:function(response){\n    var temp = response.responseText;\n    var resultJson = Wb.decode(temp);\n    var _primaryKey = resultJson.uuid;\n\n    var _operateCode = app.operateCode.getValue();\n    var _deptId = app.deptId.getValue();\n    var _lastNode = app.deptTree.getRootNode().lastChild;\n    if(_operateCode!=='edit'){\n      //======新增操作=====\n\n      app.deptOrderStore.load(function(){\n        var json = {isEnabled   : _isEnable,\n                    primaryKey  : _primaryKey,\n                    treeDeptCode: app.treeDeptCode.getValue(),\n                    treeDeptName: app.treeDeptName.getValue(),\n                    treeDeptDesc: app.treeDeptDesc.getValue(),\n                    deptId      : app.deptId.getValue(),\n                    orgComobox  : app.orgComobox.getValue(),\n                    upDeptId    : app.upDeptId.getValue(),\n                    TMP_ORDER   : app.deptOrderStore.getAt(0).get('TMP_ORDER')\n                   };  \n        var deptBean = {enableFlag   : _isEnable,\n                        deptId  : _primaryKey,\n                        deptCode: app.treeDeptCode.getValue(),\n                        deptName: app.treeDeptName.getValue(),\n                        deptShortName: app.treeDeptDesc.getValue(),\n                        // deptId      : app.deptId.getValue(),\n                        orgId  : app.orgComobox.getValue(),\n                        upDpId    : app.upDeptId.getValue(),\n                        seq_updept   : app.deptOrderStore.getAt(0).get('TMP_ORDER')\n                       };  \n        Ext.Ajax.request({\n          url: '{#contextPath#}'+'/hrAction.do?method=saveDept',\n          method: 'POST',\n          sync: false,\n          timeout: 300000,\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          jsonData: deptBean,\n          success: function(res, opts) {\n\n\n            var rep = Ext.JSON.decode(res.responseText);\n            var flag = rep.flag;\n            var msg = rep.msg;\n\n            if(flag==\"0\"){\n\n              //动态添加新增的部门信息\n              var currentNode ;\n              var selNode =  app.deptTree.getSelectionModel().getSelection()[0];\n              if(selNode === app.deptTree.getRootNode()){\n                currentNode = selNode.firstChild;\n              }else{\n                currentNode =  app.deptTree.getSelectionModel().getSelection()[0];\n              }\n              var _isEnable = 'N';\n              if(app.check1.isChecked){\n                _isEnable ='Y';\n              }\n              var _incoPath = '{#contextPath#}/webbuilder/controls/ext/resources/themes/images/access/tree/leaf.gif';\n              var _json = {text:app.treeDeptName.getValue(),\n                           isenable:_isEnable,\n                           shortname:app.treeDeptDesc.getValue(),\n                           code:app.treeDeptCode.getValue(),\n                           up_dp_id:app.upDeptId.getValue(),\n                           id:json.primaryKey,\n                           orgid:app.orgComobox.getValue(),\n                           seq_updept:'',\n                           parent_id:app.upDeptId.getValue(),\n                           icon:_incoPath,\n                           children:[]};\n              currentNode.expand();\n              var c = currentNode.appendChild(_json);\n              currentNode.commit();\n              app.deptTree.view.select(c);\n              app.operateCode.setValue('edit');\n              app.deptId.setValue(json.primaryKey);\n              app.postAddBtn.setDisabled(false);\n              app.postDeleteBtn.setDisabled(false);\n              app.postEditBtn.setDisabled(false);\n              Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_bmsaveok#}!\");\n              if(Ext.isEmpty(app.deptId.getValue())){\n                app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPosition';\n                app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n              }else{\n                app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId';\n                app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue(),deptId:app.deptId.getValue()}});\n              }\n\n            }else{\n              Ext.Msg.alert('{#xip_hr_dept_prompt#}',msg);\n            }\n          }\n        });\n      });\n\n    }else{\n      var json = {isEnabled   : _isEnable,\n                  treeDeptCode: app.treeDeptCode.getValue(),\n                  treeDeptName: app.treeDeptName.getValue(),\n                  treeDeptDesc: app.treeDeptDesc.getValue(),\n                  deptId      : app.deptId.getValue(),\n                  orgComobox  : app.orgComobox.getValue()\n                 };\n      var jsondata = {enableFlag   : _isEnable,\n                      deptId  : app.deptId.getValue(),\n                      deptCode: app.treeDeptCode.getValue(),\n                      deptName: app.treeDeptName.getValue(),\n                      deptShortName: app.treeDeptDesc.getValue(),\n                      // deptId      : app.deptId.getValue(),\n                      orgId  : app.orgComobox.getValue()\n\n                     };  \n\n\n      Ext.Ajax.request({\n        url: '{#contextPath#}'+'/hrAction.do?method=updateDepts',\n        method: 'POST',\n        sync: false,\n        timeout: 300000,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        jsonData: jsondata,\n        success: function(res, opts) {\n          var rep = Ext.JSON.decode(res.responseText);\n          var flag = rep.flag;\n          var msg = rep.msg;\n\n          if(flag==\"0\"){\n\n\n            var currentNode = app.deptTree.getSelectionModel().getSelection()[0];\n            currentNode.set('text',app.treeDeptName.getValue());\n            currentNode.set('shortname',app.treeDeptDesc.getValue());\n            currentNode.set('code',app.treeDeptCode.getValue());\n            var _isEnable = 'N';\n            if(app.check1.getValue()){\n              _isEnable ='Y';\n            }\n            currentNode.set('isenable',_isEnable);\n            currentNode.commit();\n            Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_bmsaveok#}\");\n            if(Ext.isEmpty(app.deptId.getValue())){\n              app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPosition';\n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n            }else{\n              app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId';\n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue(),deptId:app.deptId.getValue()}});\n            }\n          }else{\n            Ext.Msg.alert('{#xip_hr_dept_prompt#}',msg);\n          }\n\n        }\n\n\n\n      });\n    }\n\n\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"title":"{#xip_hr_dept_deptInformation#}","width":"'100%'","layout":"column","itemId":"fieldSet2","x":"5"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".45","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","width":"320","labelAlign":"right","itemId":"treeDeptCode","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_dept_deptCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"320","labelAlign":"right","itemId":"treeDeptDesc","fieldLabel":"{#xip_hr_dept_deptSimpleName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".45","border":"false","itemId":"panel11"},"children":[{"configs":{"labelWidth":"120","width":"320","labelAlign":"right","itemId":"treeDeptName","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_dept_deptName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"check1","fieldLabel":"{#xip_hr_dept_isEnabled#}","checked":"true"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"deptId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"upDeptId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"operateCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"fit","border":"false","bodyPadding":"5px 0px 0px 0px","itemId":"panel1"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"form2"},"children":[{"configs":{"title":"{#xip_hr_dept_postInformation#}","width":"'100%'","layout":"fit","itemId":"fieldSet5"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","itemId":"treePosGrid"},"events":{"itemdblclick":"app.postEditBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_dept_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"部门ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位ID","hidden":"true","dataIndex":"POST_ID","itemId":"POST_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_belongDept#}","width":"160","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_postCode#}","dataIndex":"POST_CODE","itemId":"POST_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_postName#}","width":"190","dataIndex":"POST_NAME","itemId":"POST_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_empAllocationNumber#}","width":"220","dataIndex":"EMP_NUM","itemId":"EMP_NUM_COL","renderer":"var c_orgId = record.get('ORG_ID');\nvar c_deptId = record.get('DEPT_ID');\nvar c_postId = record.get('POST_ID');\nvar c_deptName = record.get('DEPT_NAME');\nvar c_postName = record.get('POST_NAME');\nvar str = \"<a href=\\\"javascript:assginEmployee('\"+c_orgId+\"','\"+c_deptId+\"','\"+c_postId+\"','\"+c_deptName+\"','\"+c_postName+\"');\\\">{#xip_hr_dept_empAllocationNumber#}：\"+record.get('EMP_NUM')+\"<\/a>\" ;\n//var str = \"<a href=#>员工分配数：\"+record.get('EMP_NUM')+\"<\/a>\" ;\nreturn str;\n\n\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_dept_isEnabled#}","dataIndex":"ENABLE_FLAG","itemId":"ENABLE_FLAG","renderer":"if(record.get('ENABLE_FLAG')=='Y'){\n  return '{#xip_hr_dept_Y#}';\n}else if(record.get('ENABLE_FLAG')=='N'){\n  return '<font color=\"red\">{#xip_hr_dept_N#}<\/font>';\n}else{\n  return record.get('ENABLE_FLAG');\n}","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"attribute1","hidden":"true","dataIndex":"ATTRIBUTE1","itemId":"STATE"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_new#}","itemId":"postAddBtn","iconCls":"record_add_icon"},"events":{"click":"var _deptId = app.deptId.getValue();\nvar _orgId = app.orgComobox.getValue();\nvar _deptName = app.treeDeptName.getValue();\nif(Ext.isEmpty(_deptId)){\n  /*Ext.MessageBox.alert('','请选择需要添加岗位的部门！');*/\n  Ext.MessageBox.alert('','xip_hr_dept_selectDeptFirst');\n  return false;\n}else{\n  app.beyondDept.setValue(_deptName);\n  app.positionId.setValue('-1');\n  app.winDeptId.setValue(_deptId);\n  app.winOrgId.setValue(_orgId);\n  app.beyondDept.setReadOnly(true);\n  app.positionCode.setReadOnly(false);\n  app.position_win.show();\n  app.position_win.setTitle(_deptName+'{#xip_hr_dept_gwxz#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_modify#}","itemId":"postEditBtn","iconCls":"record_edit_icon"},"events":{"click":"var sm = app.treePosGrid.getSelectionModel();\nif(!sm.hasSelection() || sm.getSelection().length>1){\n  /*Ext.MessageBox.alert('提示','请选择一条岗位信息');*/\n  Ext.MessageBox.alert('','{#xip_hr_dept_qxzczdjl#}');\n  return false;\n}else{\n  var rows = sm.getSelection();\n  var _deptId = rows[0].data.DEPT_ID;\n  var _orgId = rows[0].data.ORG_ID;\n  var _deptName = rows[0].data.DEPT_NAME;\n  var _positionId = rows[0].data.POST_ID;\n  var _enabled = rows[0].data.ENABLE_FLAG;\n  var _positionCode = rows[0].data.POST_CODE;\n  var _positionName = rows[0].data.POST_NAME;\n  app.beyondDept.setValue(_deptName);\n  app.positionId.setValue(_positionId);\n  app.winDeptId.setValue(_deptId);\n  app.winOrgId.setValue(_orgId);\n  app.beyondDept.setReadOnly(true);\n  app.positionCode.setValue(_positionCode);\n  app.positionName.setValue(_positionName);\n  app.orginalCode.setValue(_positionCode);\n  app.isUse.setValue(_enabled);\n\n  if(_enabled==='Y'){\n    app.isUse.setRawValue('{#xip_hr_dept_Y#}');\n  }else{\n    app.isUse.setRawValue('{#xip_hr_dept_N#}');\n  }\n  app.positionCode.setReadOnly(true);\n  app.positionGrid.store.load({params:{deptId:_deptId,postId:_positionId}});\n  app.position_win.show();\n  app.position_win.setTitle(_deptName+'{#xip_hr_dept_gwbj#}');\n  app.positionCode.setReadOnly(true);\n\n}\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_delete#}","itemId":"postDeleteBtn","iconCls":"record_delete_icon"},"events":{"click":"var sm = app.treePosGrid.getSelectionModel();\nif(!sm.hasSelection()){\n  Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_qxzdelpost#}!\");\n  return false;\n}\nExt.MessageBox.confirm('{#xip_hr_dept_prompt#}','{#xip_hr_dept_postokdel#}',function(item){\n  if(item==='yes'){  \n    var rows = sm.getSelection();\n    var _postIdLIst = \"\";\n    Ext.each(rows,function(item){\n      var _postId = \"'\"+item.data.POST_ID+\"'\";\n      if(_postIdLIst === \"\"){\n          _postIdLIst = _postId ;\n        }else{\n          _postIdLIst = _postIdLIst+\",\"+_postId;\n        }\n      \n    });  \n         Ext.Ajax.request({\n        url: '{#contextPath#}'+'/hrAction.do?method=delPosts',\n        method: 'POST',\n        sync: false,\n        timeout: 300000,\n\n        params: {postId:_postIdLIst},\n        success: function(res, opts) {\n     var rep = Ext.JSON.decode(res.responseText);\n          var flag = rep.flag;\n\n          if(flag==\"0\"){\n          Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",\"{#xip_hr_dept_postdelok#}\");\n          if(!Ext.isEmpty(app.deptId.getValue())){\n            app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPositionByDeptId';\n            app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue(),deptId:app.deptId.getValue()}});\n          }else{\n            app.treePosGrid.store.getProxy().url='m?xwl=xip/hr/dept/DATA/getDeptPosition';\n            app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n          }\n\n        }else{\n           Ext.Msg.alert(\"{#xip_hr_dept_prompt#}\",rep.msg);\n         }\n       }\n    });\n  }\n});\n\n\n  "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_postExport#}","itemId":"exportBtn","iconCls":"db_export_icon"},"events":{"click":"var orgId = app.orgComobox.getValue();\nif(Ext.isEmpty(orgId)){\n  orgId = '';\n}\n\nvar deptId = '';\nif(app.deptInfoForm.hidden==false){\n  deptId = app.deptId.getValue();\n}\n\nXip.exportExcel('XIP_PUB_POSTS', {orgId:orgId, deptId:deptId}, '{#xip_hr_dept_post#}');"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item6"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_dept_postImport#}","itemId":"importBtn","iconCls":"db_import_icon"},"events":{"click":"Xip.importExcel('XIP_PUB_POSTS', null);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"->","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"labelAlign":"right","itemId":"queryPositionName","fieldLabel":"{#xip_hr_dept_postCodeOrName#}"},"events":{"specialkey":"var _deptId = Ext.isEmpty(app.deptTree.getSelectionModel().getSelection()[0])? '':app.deptTree.getSelectionModel().getSelection()[0].get('id');\nvar json;\nif(Ext.isEmpty(_deptId))\n json= {orgComobox:app.orgComobox.getValue()};\nelse\n  json={orgComobox:app.orgComobox.getValue(),deptId:_deptId};\napp.treePosGrid.store.load({params:json});"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"var _deptId = Ext.isEmpty(app.deptTree.getSelectionModel().getSelection()[0])? '':app.deptTree.getSelectionModel().getSelection()[0].get('id');\nvar json;\nif(Ext.isEmpty(_deptId))\n json= {orgComobox:app.orgComobox.getValue()};\nelse\n  json={orgComobox:app.orgComobox.getValue(),deptId:_deptId};\napp.treePosGrid.store.load({params:json});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item7"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/dept/DATA/getDeptPosition"},"events":{"beforeload":"app.treePosGrid.store.getProxy().extraParams.POST_NAME = app.queryPositionName.getValue();\napp.treePosGrid.store.getProxy().extraParams.orgComobox = app.orgComobox.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}