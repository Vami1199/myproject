{"inframe":false,"title":"组织管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\nvar funCodeStr = request.getParameter(\"funCode\");\nrequest.setAttribute(\"tipCode\",funCodeStr);\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","loginRequired":"false","jsLinks":"[\"xip/js/messageTip.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/hr/org/org\");","itemId":"module"},"events":{"finalize":"/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\nfunction treeNodeQuery(text,by,treeId) { \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = treeId;\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      me = menuFunTree,\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n}\n\n","initialize":"\nfunction beforeDropType(node, data, om, dp) {\n  if(om===null){\n    return false;\n  }\n  //Wb.saveNodePos(Wb.getNode(data.item));\n  return true;\n}\nfunction dropType(node, data, om, dp){\n/*-----------node：被拖拽的节点，om：要拖拽到的节点，dp：被拖拽的位置<before，after，append>---------*/\n  var  src = data.records[0], orderIndex, srcId, parentId, pn,tmpOrder;\n  \n  Wb.mask(app.tree1);\n  om.expand(false,function(){\n    Wb.unmask(app.tree1);\n/*------------部门id---------------*/\n    srcId = src.get('ORG_ID');  \n/*-----------判断拖拽的类型---------*/\n    if(dp=='append'){\n      pn = om;\n      parentId = om.get('ORG_ID');\n      if(Ext.isEmpty(parentId))\n        parentId = '-1';\n      if(!Ext.isEmpty(om.lastChild.previousSibling)){\n        tmpOrder = om.lastChild.previousSibling.get('ATTRIBUTE4');\n        if(!Ext.isEmpty(tmpOrder)){\n          orderIndex = tmpOrder+1;\n        }else{\n          orderIndex = 1;\n        }\n      }else{\n        orderIndex = 1;\n      }\n    }else{\n      pn = src.parentNode;\n      parentId = pn.get('ORG_ID');\n      if(Ext.isEmpty(parentId))\n        parentId = '-1';\n      if (dp == 'before'){\n        if(Ext.isEmpty(om.get('ATTRIBUTE4'))){\n          orderIndex = 1;\n        }else{\n          orderIndex = om.get('ATTRIBUTE4');\n           }\n      }else{\n        if(Ext.isEmpty(om.get('ATTRIBUTE4'))){\n           orderIndex = 1;\n         }else{\n            orderIndex = om.get('ATTRIBUTE4') + 1;\n           }  \n    }\n   }\n    Wb.request({\n                url : 'm?xwl=xip/hr/org/data/update_o',\n                mask:app.tree1,\n                params : {ATTRIBUTE4:orderIndex, ORG_ID:srcId, parent_id:parentId},\n                failure : function() {\n                  Wb.revertNodePos(src);\n                },\n                success : function() {\n                  pn.eachChild(function(x) {\n                    var i = x.get('ATTRIBUTE4');\n                    if(Ext.isEmpty(i))\n                      i = 1;\n                    if (i >= orderIndex) {\n                      x.set('ATTRIBUTE4', i + 1);\n                      x.commit();\n                    }\n                  });\n                  src.set('parent_id', parentId);\n                  src.set('ATTRIBUTE4', orderIndex);\n                  src.commit();\n                }\n               });    \n  });\n  app.grid1.store.load();\n  }"},"children":[{"configs":{"footerScript":"function findchildnode(roonodes){\n  \n        var childnodes = roonodes.childNodes;\n  \n        for(var i=0;i<childnodes.length;i++){  //从节点中取出子节点依次遍历\n          var nd = childnodes[i];\n          if(app.ORG_ID.getValue()===nd.get('ORG_ID')){\n           app.tree1.view.select(nd);\n           }\n           if(nd.hasChildNodes()){  //判断子节点下是否存在子节点\n             nd.expand();\n             findchildnode(nd);    //如果存在子节点  递归\n           } \n        }\n   }","itemId":"clientscript1"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"itemId":"store"},"children":[{"configs":{"autoLoad":"true","itemId":"store4UpOrg","url":"m?xwl=xip/hr/org/data/GetUpOrgList"},"events":{"load":"Ext.define('Org', {\n    extend: 'Ext.data.Model',\n    fields: [\n        {name: 'ORG_ID',  type: 'string'},\n        {name: 'ORG_CODE',   type: 'string'},\n        {name: 'ORG_NAME', type: 'string'}\n    ]\n});\n\nvar _org = Ext.create('Org', {\n  ORG_ID    : '-1',\n  ORG_CODE  : '',\n  ORG_NAME  : '{#xip_hr_org_systemOrg#}' \n});\n\nstore.insert(0,_org);"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"window1btn"},"children":[{"configs":{"text":"{#xip_hr_org_save#}","itemId":"btnSave","iconCls":"save_icon"},"events":{"click":"var _upOrgId = app.upOrg.getValue() ;\n \n\nif(_upOrgId === '{#xip_hr_org_systemOrg#}' ||_upOrgId==''){ //系统组织\n  _upOrgId = '-1' ;\n}\nvar _orgCode = app.ORG_CODE.getValue();\nvar _orgName = app.ORG_NAME.getValue();\n\nif(_upOrgId === \"\" || _upOrgId === null){\n  Ext.Msg.alert(\"{xip_hr_org_prompt##}\",\"{#xip_hr_org_qxzsjzz#}\");//\"提示\",\"请选择上级组织！\"\n  return false ;\n}\nif(_orgCode === \"\" || _orgCode === null){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_qlrzzbm#}\");//提示\",\"请录入组织编码！\"\n  return false ;\n}\nif(_orgName === \"\" || _orgName === null){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_qlrzzmc#}\");//\"提示\",\"请录入组织名称！\"\n  return false ;\n}\nvar _orgId = app.ORG_ID.getValue();\nif(_upOrgId == _orgId){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_sjzzbnxzzs#}\");//\"提示\",\"上级组织不能选择自身！\"\n  return false ;\n}\nvar orgShortName = app.ORG_SHORT_NAME.getValue();\nvar upOrgid      = app.UP_ORG_ID.getValue();\nvar cbxOrgType   = app.ORG_TYPE.getValue();\nvar cbxOrgEnable = app.ENABLE_FLAG.getValue();    \n\nif(Ext.isEmpty(_orgId)){//新增\n\n\n  var json = {\n    orgCode:_orgCode,\n    orgName:_orgName,\n    orgShortName:orgShortName,\n    upOrgid:upOrgid,\n    cbxOrgType:cbxOrgType,\n    cbxOrgEnable: cbxOrgEnable\n\n  };\n  var jsonbean = {\n    orgCode:_orgCode,\n    orgName:_orgName,\n    orgShortName:orgShortName,\n    upOrgId:upOrgid,\n    orgType:cbxOrgType,\n    enableFlag: cbxOrgEnable\n\n  };\n\n  Ext.Ajax.request({\n    url: '{#contextPath#}'+'/hrAction.do?method=saveOrgs',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: jsonbean,\n    success: function(res, opts) {\n\n      var rep = Ext.JSON.decode(res.responseText);\n      var flag = rep.flag;\n      var msg = rep.msg;\n      if(flag==\"0\"){\n        var orgid = rep.orgId;\n\n        //动态添加新增的组织信息\n        var currentNode=app.tree1.getSelection()[0];\n        var selNode = app.tree1.getSelection()[0];\n        var _json = {text:_orgName,\n                     ENABLE_FLAG:cbxOrgEnable,\n                     ORG_SHORT_NAME:orgShortName,\n                     up_org_name:app.UP_ORG_NAME.getValue(),\n                     ORG_TYPE:cbxOrgType,\n                     ORG_CODE:_orgCode,\n                     //                           ORG_ID:resultJson.k,\n                     ORG_ID:orgid,\n                     parent_id:upOrgid,\n                     icon:'{#contextPath#}'+'/webbuilder/images/app/ss.gif',\n                     children:[]\n                    };\n\n        currentNode.expand();\n        currentNode.data.leaf=false;\n        var c = currentNode.appendChild(_json);\n        currentNode.commit();\n        app.tree1.view.select(c);\n        app.window1.hide();\n        app.grid1.store.load();\n        Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_zzxxbccg#}\");//\"提示\",\"组织信息保存成功!\"\n\n      }else{\n        Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",rep.msg);//提示\n      }\n    }\n  });\n\n}else{//更新\n  if(upOrgid==''){\n    upOrgid='-1';\n  }\n  var json1 = {\n    orgId: _orgId,\n    orgCode:_orgCode,\n    orgName:_orgName,\n    orgShortName:orgShortName,\n    upOrg:upOrgid,\n    cbxOrgType:cbxOrgType,\n    cbxOrgEnable: cbxOrgEnable\n\n  };\n\n  var jsonbean = {\n    orgId: _orgId,\n    orgCode:_orgCode,\n    orgName:_orgName,\n    orgShortName:orgShortName,\n    upOrgId:upOrgid,\n    orgType:cbxOrgType,\n    enableFlag: cbxOrgEnable\n\n  };\n\n  Ext.Ajax.request({\n    url: '{#contextPath#}'+'/hrAction.do?method=updateOrgs',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: jsonbean,\n    success: function(res, opts) {\n\n      var rep = Ext.JSON.decode(res.responseText);\n      var rflag = rep.flag;\n      var msg = rep.msg;\n      if(rflag==\"0\"){    \n        var roonodes = app.tree1.getRootNode();\n        findchildnode(roonodes);\n        var flag;\n        var n =  app.tree1.getSelectionModel().getSelection();\n\n        if (n && n.length > 0){\n\n\n          flag=n[0];\n        }else{\n          flag= null;\n        }\n\n\n        if(flag!==null){\n\n          flag.set('text',app.ORG_NAME.getValue());\n          flag.set('ORG_SHORT_NAME',app.ORG_SHORT_NAME.getValue());\n          flag.set('ORG_CODE',app.ORG_CODE.getValue());\n          flag.set('ENABLE_FLAG',app.ENABLE_FLAG.getValue());\n          flag.set('up_org_name',app.UP_ORG_NAME.getValue());\n          flag.set('ORG_TYPE',app.ORG_TYPE.getValue());\n          flag.set('parent_id',app.UP_ORG_ID.getValue());\n          flag.commit();\n        }\n\n        app.window1.hide();\n        app.grid1.store.load();\n        app.tree1.store.load();\n\n\n      }else{\n        Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",rep.msg);//提示\n      }\n    },\n    failure : function (){\n\n    }\t\t\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_org_saveAndNext#}","itemId":"btnAddAndSave"},"events":{"click":"var _upOrgId = app.upOrg.getValue() ;\nif(_upOrgId === '{#xip_hr_org_systemOrg#}'){//系统组织\n  _upOrgId = '-1' ;\n}\nvar _orgCode = app.ORG_CODE.getValue();\nvar _orgName = app.ORG_NAME.getValue();\n\nif(_upOrgId === \"\" || _upOrgId === null){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_qxzsjzz#}\");//\"提示\",\"请选择上级组织！\"\n  return false ;\n}\nif(_orgCode === \"\" || _orgCode === null){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_qlrzzbm#}\");//\"提示\",\"请录入组织编码！\"\n  return false ;\n}\nif(_orgName === \"\" || _orgName === null){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_qlrzzmc#}\");//\"提示\",\"请录入组织名称！\"\n  return false ;\n}\nvar _orgId = app.ORG_ID.getValue();\nif(_upOrgId == _orgId){\n  Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_sjzzbnxzzs#}\");//\"提示\",\"上级组织不能选择自身！\"\n  return false ;\n}\nvar orgShortName = app.ORG_SHORT_NAME.getValue();\nvar upOrgid      = app.UP_ORG_ID.getValue();\nvar cbxOrgType   = app.ORG_TYPE.getValue();\nvar cbxOrgEnable = app.ENABLE_FLAG.getValue();    \n\n//新增\n\n\nvar json = {\n  orgCode:_orgCode,\n  orgName:_orgName,\n  orgShortName:orgShortName,\n  upOrgid:upOrgid,\n  cbxOrgType:cbxOrgType,\n  cbxOrgEnable: cbxOrgEnable\n\n};\n\nvar jsonbean = {\n  orgCode:_orgCode,\n  orgName:_orgName,\n  orgShortName:orgShortName,\n  upOrgId:upOrgid,\n  orgType:cbxOrgType,\n  enableFlag: cbxOrgEnable\n\n};\nExt.Ajax.request({\n  url: '{#contextPath#}'+'/hrAction.do?method=saveOrgs',\n  method: 'POST',\n  sync: false,\n  timeout: 300000,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  jsonData: jsonbean,\n  success: function(res, opts) {\n\n    var rep = Ext.JSON.decode(res.responseText);\n    var flag = rep.flag;\n    var msg = rep.msg;\n    if(flag==\"0\"){\n      var orgid = rep.orgId;   \n     // var temp = response.responseText;\n     // var resultJson = Ext.JSON.decode(temp);\n      //动态添加新增的组织信息\n\n      var currentNode;\n      var selNode = app.tree1.getSelection()[0];\n      if(Ext.isEmpty(selNode)){\n        currentNode = app.tree1.getRootNode();\n      }else{\n        currentNode = app.tree1.getSelection()[0];\n      }\n      var _json = {text:_orgName,\n                   ENABLE_FLAG:cbxOrgEnable,\n                   ORG_SHORT_NAME:orgShortName,\n                   up_org_name:app.UP_ORG_NAME.getValue(),\n                   ORG_TYPE:cbxOrgType,\n                   ORG_CODE:_orgCode,\n                   ORG_ID:orgid,\n                   //  ORG_ID:resultJson.k,\n                   parent_id:upOrgid,\n                   icon:'{#contextPath#}'+'/webbuilder/images/app/ss.gif',\n                   children:[]\n                  };\n\n      currentNode.expand();\n      currentNode.data.leaf=false;\n      var c = currentNode.appendChild(_json);\n      currentNode.commit();\n\n      // 重新赋值\n      //app.form.getForm().reset();\n      app.ORG_CODE.setValue() ;\n      app.ORG_NAME.setValue() ;\n      app.ORG_SHORT_NAME.setValue() ;\n      app.ORG_TYPE.setValue('O') ;\n      app.ENABLE_FLAG.setValue('Y');\n      app.ORG_ID.setValue();\n      app.grid1.store.load();\n      Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",\"{#xip_hr_org_zzxxbccg#}\");//\"提示\",\"组织信息保存成功!\"\n    }else{\n      Ext.Msg.alert(\"{#xip_hr_org_prompt#}\",rep.msg);//\"提示\"\n    }\n  }\n});\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_hr_org_close#}","itemId":"closeWin","iconCls":"cancel_icon"},"events":{"click":"app.window1.hide();\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"height":"220","layout":"fit","width":"500","closeAction":"hide","buttons":"app.window1btn","buttonAlign":"center","dialog":"false","itemId":"window1","modal":"true"},"children":[{"configs":{"frame":"true","style":"border-width:0px","bodyPadding":"10px","border":"false","itemId":"form"},"children":[{"configs":{"labelWidth":"120","store":"app.store4UpOrg","queryMode":"local","displayField":"ORG_NAME","width":"450","valueField":"ORG_ID","labelAlign":"right","itemId":"upOrg","fieldLabel":"{#xip_hr_org_upOrg#}"},"events":{"select":"\napp.UP_ORG_NAME.setValue(app.upOrg.getRawValue());\napp.UP_ORG_ID.setValue(app.upOrg.getValue());"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"450","labelAlign":"right","itemId":"ORG_CODE","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_org_orgCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"450","labelAlign":"right","itemId":"ORG_NAME","fieldLabel":"<font color='red'>*<\/font>{#xip_hr_org_orgName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"450","labelAlign":"right","itemId":"ORG_SHORT_NAME","fieldLabel":"{#xip_hr_org_orgSimpleName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","displayField":"NAME","hidden":"true","value":"O","labelAlign":"right","itemId":"ORG_TYPE","fieldLabel":"{#xip_hr_org_orgType#}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","width":"450","value":"Y","pickList":"[['Y','{#xip_hr_org_statusY#}'],['N','{#xip_hr_org_statusN#}']]","labelAlign":"right","itemId":"ENABLE_FLAG","fieldLabel":"{#xip_hr_org_enableStatus#}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"hidden":"true","itemId":"UP_ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"UP_ORG_ID1"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"UP_ORG_NAME"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"// var _tipCode = '{#tipCode#}';\n// var _orgTip = Wb.getCookie(_tipCode);\n// if(Ext.isEmpty(_orgTip)){\n//   MsgTip.msg('<font color=\"red\">提示<\/font>', '鼠标右键点击左边系统组织或其下的节点进行操作,<br>拖动节点可以改变组织的顺序和上下级.',null,null,_tipCode,true);  \n// }\n//Wb.toast('<font color=\"red\" style=\"font-weight:bold\">提示<\/font><br>'+'鼠标右键点击左边系统组织或其下的节点进行操作,<br>拖动节点可以改变组织的顺序和上下级.');\nWb.toast('<font color=\"red\" style=\"font-weight:bold\">{#xip_hr_org_prompt#}<\/font>'+'{#xip_hr_org_firstMsg#}');"},"children":[{"configs":{"rootVisible":"true","region":"west","tools":"Wb.getTreeTools()","title":"{#xip_hr_org_orgTree#}","animate":"false","root":"{text:Str.all,PARENT_ID:'root',text:'{#xip_hr_org_systemOrg#}',expanded:true}","collapsible":"true","width":"350","split":"true","itemId":"tree1","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug2',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: beforeDropType,\n    drop:dropType\n    }\n    }"},"events":{"itemclick":"var _tmp = document.getElementById('_toolTipsClickHide');\nMsgTip.hide(_tmp);\n\napp.grid1.store.load({params:{'textOrgCode':record.data.ORG_CODE}});","itemdblclick":"app.window1.setTitle('{#xip_hr_org_modifyOrg#}');/*修改组织*/\napp.btnAddAndSave.hide();\n\n\nvar _uporgid = record.data.parent_id;  \nif(_uporgid === undefined){\n  return ;\n}\nvar _uporgname = record.data.up_org_name; \n\nvar _orgid = record.data.ORG_ID ;\nvar _orgcode = record.data.ORG_CODE ;  \nvar _orgname = record.data.text ;\nvar _orgtype = record.data.ORG_TYPE;\nvar _shortname = record.data.ORG_SHORT_NAME;\nvar _enabled = record.data.ENABLE_FLAG;\n\n\napp.store4UpOrg.load({params:{'_orgId':_orgid}});\n\napp.upOrg.setValue(_uporgid) ;\napp.upOrg.setRawValue(_uporgid === '-1' ? '{#xip_hr_org_systemOrg#}' :_uporgname) ;/**/\n\napp.upOrg.setReadOnly(false);\napp.ORG_CODE.setReadOnly(true);\napp.UP_ORG_ID.setValue(_uporgid);\napp.UP_ORG_ID1.setValue(_uporgid);\napp.UP_ORG_NAME.setValue(_uporgname);\n\napp.ORG_ID.setValue(_orgid);\napp.ORG_CODE.setValue(_orgcode);\napp.ORG_NAME.setValue(_orgname);\napp.ORG_SHORT_NAME.setValue(_shortname);\napp.ORG_TYPE.setValue(_orgtype);\napp.ENABLE_FLAG.setValue(_enabled);    \n\napp.window1.show();        ","tagEvents":"itemcontextmenu : function(view, record, item, index, event, options){\nrecord.expand();\nevent.preventDefault();\nevent.stopEvent();\n//var _uporgid = record.data.id;  \nvar btnAdd = new Ext.menu.Item({  \n  text\t:\t'{#xip_hr_org_addOrg#}',  \n  iconCls\t:\t'new_icon',\n  handler\t:\tfunction(){\n    app.window1.setTitle('{#xip_hr_org_addOrg#}');\n    app.btnAddAndSave.show();\n    var win = new Ext.window.Window(app._window1);\n     win.setTitle('{#xip_hr_org_addOrg#}');\n    var _orgid = record.data.id;\n    if(_orgid == 'root'){\n      app.upOrg.setValue('-1') ;\n      app.UP_ORG_ID.setValue('-1');\n    }else{\n     // app.upOrg.setValue(record.data.ORG_ID) ;\n      app.UP_ORG_ID.setValue(record.data.ORG_ID);\n    }\n    var _orgname = record.data.text; \n     app.upOrg.setValue(record.data.ORG_ID);\n     app.upOrg.setRawValue(_orgname) ;\n   \n    app.UP_ORG_NAME.setValue(_orgname);\n    app.upOrg.setReadOnly(true);\n    //alert(_orgid);\n   \n\n    win.show();\n  }  \n});\n\nvar btnUpdate = new Ext.menu.Item({  \n  text:'{#xip_hr_org_modifyOrg#}',  \n  iconCls:'edit_icon',\n  handler:function(){\n    app.window1.setTitle('{#xip_hr_org_modifyOrg#}');\n    app.btnAddAndSave.hide();\n\n    var _uporgid = record.data.parent_id;  \n    var _uporgname = record.data.up_org_name; \n    if(_uporgid === '-1'){\n      _uporgname = '{#xip_hr_org_sysOrg#}';\n    }\n    var _orgid = record.data.ORG_ID ;\n    var _orgcode = record.data.ORG_CODE ;    \n    var _orgname = record.data.text ;\n    var _orgtype = record.data.ORG_TYPE;\n    var _shortname = record.data.ORG_SHORT_NAME;\n    var _enabled = record.data.ENABLE_FLAG;\n\n   app.store4UpOrg.load({params:{'_orgId':_orgid}});\n \n    app.upOrg.setValue(_uporgid) ;\n    app.upOrg.setRawValue(_uporgname) ;     \n    app.upOrg.setReadOnly(false);\napp.ORG_CODE.setReadOnly(true);\n    app.ORG_ID.setValue(_orgid);\n    app.ORG_CODE.setValue(_orgcode);\n    app.ORG_NAME.setValue(_orgname);\n    app.ORG_SHORT_NAME.setValue(_shortname);\n    app.ORG_TYPE.setValue(_orgtype);\n    app.ENABLE_FLAG.setValue(_enabled);\n\n    app.window1.show();          \n  }  \n});\n\nvar _id = record.data.id ;\nvar itemArray = [];\nif (_id === 'root'){\n  itemArray.push(btnAdd) ;\n}else{\n  itemArray.push(btnAdd) ;\n  itemArray.push(btnUpdate) ;\n}\n\nvar nodemenu = new Ext.menu.Menu({  \n\tfloating:true,  \n\titems:itemArray \n});\n\nnodemenu.showAt(event.getPoint());\n\n\n\n\n\n} "},"children":[{"configs":{"hidden":"true","itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_org_expand#}","itemId":"btnExpend","iconCls":"folder_open_icon"},"events":{"click":"app.tree1.expandAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item11"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_org_collapse#}","itemId":"btnCollapsed","iconCls":"folder_closed_icon"},"events":{"click":"app.tree1.collapseAll();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item12"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_org_refresh#}","itemId":"btnRefresh","iconCls":"refresh_icon"},"events":{"click":"app.tree1.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item13"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xip/hr/org/data/GetOrgTree"},"events":{"beforeload":"operation.params.parentID=operation.node.get('ORG_ID');"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","title":"{#xip_hr_org_orgList#}","layout":"border","itemId":"panel1"},"children":[{"configs":{"region":"center","itemId":"grid1"},"events":{"itemdblclick":"var rows = app.grid1.getSelectionModel().getSelection();\n\nvar _orgid = rows[0].data.ORG_ID;  \nvar _orgname = rows[0].data.ORG_NAME; \nvar _orgcode = rows[0].data.ORG_CODE ;    \nvar _orgtype = rows[0].data.ORG_TYPE;\nvar _shortname = rows[0].data.ORG_SHORT_NAME;\nvar _enabled = rows[0].data.ENABLE_FLAG;\nvar _upOrgId = rows[0].data.UP_ORG_ID;\nvar _upOrgName = rows[0].data.UP_ORG_NAME;\napp.upOrg.setReadOnly(false);\napp.upOrg.setValue(_upOrgId) ;\napp.upOrg.setRawValue(_upOrgId === '-1' ? '{#xip_hr_org_systemOrg#}' :_upOrgName) ;  // 系统组织\n\n\napp.ORG_ID.setValue(_orgid);\napp.ORG_CODE.setValue(_orgcode);\napp.ORG_NAME.setValue(_orgname);\napp.ORG_SHORT_NAME.setValue(_shortname);\napp.ORG_TYPE.setValue(_orgtype);\napp.ENABLE_FLAG.setValue(_enabled);    \napp.UP_ORG_ID.setValue(_upOrgId);\n\napp.window1.setTitle('{#xip_hr_org_modifyOrg#}'); // 修改组织\napp.btnAddAndSave.hide();\napp.window1.show();\napp.upOrg.setReadOnly(true);\napp.ORG_CODE.setReadOnly(true);\n"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"30","hidden":"true","width":"200","labelAlign":"right","itemId":"textOrgCode","fieldLabel":"{#xip_hr_org_code#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","width":"220","labelAlign":"right","itemId":"textOrgName","fieldLabel":"{#xip_hr_org_orgName#}"},"events":{"specialkey":"app.btnQuery.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnQuery","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load({params:{textOrgName:app.textOrgName.getValue()}});\n\ntreeNodeQuery(app.textOrgName.getValue(),'text', app.tree1);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item12"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_org_export#}","itemId":"btnExport","iconCls":"db_export_icon"},"events":{"click":"Xip.exportExcel('XIP_PUB_ORGS', {orgName:app.textOrgName.getValue()}, '{#xip_hr_org_org#}'); // 组织"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#xip_hr_org_import#}","itemId":"btnImport","iconCls":"db_import_icon"},"events":{"click":"Xip.importExcel('XIP_PUB_ORGS', null);"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/hr/org/data/GetOrgList"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_hr_org_serialNumber#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ORG_ID","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_org_orgCode#}","width":"150","dataIndex":"ORG_CODE","itemId":"ORG_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_org_orgName#}","width":"250","dataIndex":"ORG_NAME","itemId":"ORG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_org_orgSimpleName#}","width":"160","dataIndex":"ORG_SHORT_NAME","itemId":"ORG_SHORT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_org_orgType#}","hidden":"true","dataIndex":"ORG_TYPE","itemId":"ORG_TYPE_COL","renderer":"if(value === \"O\"){\n  return \"{#xip_hr_org_entityOrg#}\";\n}else if(value === \"V\"){\n  return \"{#xip_hr_org_virtualOrg#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_org_upOrg#}","hidden":"true","width":"250","dataIndex":"UP_ORG_NAME","itemId":"UP_ORG_NAME_COL","renderer":"if(record.data.UP_ORG_ID == '-1'){\n  value = '{#xip_hr_org_systemOrg#}' ;\n}\n return value ;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"上级组织ID","hidden":"true","dataIndex":"UP_ORG_ID","itemId":"UP_ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_hr_org_enableStatus#}","width":"100","align":"center","dataIndex":"ENABLE_FLAG","itemId":"ENABLEFLAG_COL","renderer":"if(value === \"Y\"){\n  return \"{#xip_hr_org_statusY#}\";\n}else if(value === \"N\"){\n  return \"<font color=red>{#xip_hr_org_statusN#}<\/font>\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}