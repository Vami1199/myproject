{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/tools/upgrade/json/upgrade\");\n\nrequest.setAttribute(\"contextPath\", request.getContextPath());","itemId":"module"},"events":{"initialize":"Ext.define('Appl',{\n  extend\t:\t'Ext.data.Model',\n  fields\t:\t[\n    {name: 'ID', \t\ttype: 'string'},\n    {name: 'CODE',  \ttype: 'string'},\n    {name: 'NAME',     type: 'string'},\n    {name: 'VERSION',  type: 'string'}\n  ]\t\n}) ;"},"children":[{"configs":{"model":"'Appl'","proxy":"{\n  type: 'ajax',\n  url\t: '{#contextPath#}/upgradeAction.do?method=getSysApps',\n  reader\t: {\n    type: 'json',\n    root: 'dataList',\n    totalProperty:'totalProperty'\n  }\n}","pageSize":"-1","itemId":"appStore","fields":"[\n  {name: 'ID', \t\ttype: 'string'},\n  {name: 'CODE',  \ttype: 'string'},\n  {name: 'NAME',     type: 'string'},\n  {name: 'VERSION',  type: 'string'}\n]"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"myFormButtons"},"children":[{"configs":{"text":"{#xip_tools_upgrade_execute_version#}","itemId":"btnUpgrade"},"events":{"click":"// 获取应用编码\nvar _appCode = app.appl.getValue() ;\nif(_appCode==\"\" || _appCode==null || _appCode==\"undefined\"){\n  Wb.toast('{#xip_tools_upgrade_select_app#}');\n  return false ;\n}\n// 获取应用ID\nvar r = app.appl.findRecordByValue(_appCode) ;\nvar _appId = r.data.ID ;\n// 获取当前版本号\nvar _currentVer = app.hisVer.getValue() ;\nif(_currentVer==\"\" || _currentVer==null || _currentVer==\"undefined\"){\n  Wb.toast('{#xip_tools_upgrade_ver_number_empty#}');\n  return false ;\n}\t\n\n// 获取最新版本号\nvar _lastedVer = app.lastedVer.getValue() ;\nif(_lastedVer==\"\" || _lastedVer==null || _lastedVer==\"undefined\"){\n  Wb.toast('{#xip_tools_upgrade_latest_ver_no#}');\n  return false ;\n}\n// 获取升级选项\nvar _chkDDL ='0', _chkCRUD='0', _chkInitData='0', _chkDiffData='0', _chkWB='0' ;\nvar chkArray = app.chkGroup.getChecked() ;\nif(chkArray.length == 0){\n  Wb.toast('{#xip_tools_upgrade_version_option#}');\n  return false ;\n}else{\n  Ext.each(chkArray, function(a){\n    var name = a.name ;\n    if(name == 'chkDdl') _chkDDL = '1';\n    if(name == 'chkCrud') _chkCRUD = '1';\n    if(name == 'chkInitdata') _chkInitData = '1';\n    if(name == 'chkDiffdata') _chkDiffData = '1';\n    if(name == 'chkWb') _chkWB = '1';\n  });\n}\n\n// 确认是否执行升级处理\nExt.MessageBox.confirm('', '{#xip_tools_upgrade_confirm_tip#}', function(a){\n  if(a==\"yes\"){\n    Ext.Msg.wait('{#xip_tools_upgrade_submit_request#}');\n    // 提交请求\n    Ext.Ajax.request({\n      url : '{#contextPath#}/upgradeAction.do?method=executeUpgrade',\n      params\t: {\n        'currentVer'    :   _currentVer,\n        'lastedVer'\t\t:\t_lastedVer,\n        'appId'\t\t\t:\t_appId,\n        'appCode'\t\t:\t_appCode,\n        'chkDDL'\t\t:\t_chkDDL,\n        'chkCRUD'\t\t:\t_chkCRUD,\n        'chkInitData'\t:\t_chkInitData,\n        'chkDiffData'\t:\t_chkDiffData,\n        'chkWB'\t\t\t:\t_chkWB\n      },\n      method : 'post',\n      timeout : 3600 * 36 * 36,\n      success : function(response, options) {\n        Ext.Msg.hide();\n        var resp = Ext.JSON.decode(response.responseText);\n        Ext.Msg.alert('', resp.msg, function(){\n          app.myGrid.getStore().load();\n        },this) ;\n      },\n      failure : function(reponse, options) {\n        Ext.Msg.hide();\n        var resp = Ext.JSON.decode(response.responseText);\n        Wb.toast(resp.msg);\n      }\n    });\t\n\n  }else{\n    return false ;\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"topbar"},"children":[{"configs":{"text":"->","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"中文","width":"70","itemId":"btnChiness"},"events":{"click":"Ext.Ajax.request({\n       url  : 'platformAction.do?method=lanInsertInSession',\n       params : {\n             'language' : \"zh\"},\n       method:'post',\n       success: function(response,options){\n         //刷新页面重新加载JS\n          location.reload();\n       },\n       failure: function(){\n       }\n     });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"English","width":"70","itemId":"btnEnglish"},"events":{"click":"Ext.Ajax.request({\n       url  : 'platformAction.do?method=lanInsertInSession',\n       params : {\n             'language' : \"en\"},\n       method:'post',\n       success: function(response,options){\n         //刷新页面重新加载JS\n          location.reload();\n       },\n       failure: function(){\n       }\n     });"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"tbar":"app.topbar","region":"north","layout":"fit","itemId":"topPanel"},"children":[{"configs":{"region":"center","title":"{#xip_tools_upgrade_execute_condition#}","height":"120","buttons":"app.myFormButtons","buttonAlign":"center","itemId":"myForm"},"children":[{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".4","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"120","readOnly":"false","store":"app.appStore","displayField":"NAME","valueField":"CODE","listConfig":"{\n  emptyText : '{#xip_tools_upgrade_no_match_val#}',\n  maxHeight : 180\n}","emptyText":"{#xip_tools_upgrade_select_app#}","labelAlign":"right","itemId":"appl","fieldLabel":"{#xip_tools_upgrade_handler_app#}","selectOnFocus":"true","editable":"false"},"events":{"select":"// 获取当前版本信息\nvar r = app.appl.findRecordByValue(app.appl.getValue()) ;\napp.hisVer.setValue(r.data.VERSION) ;\n// 获取最新版本信息\nExt.Ajax.request({\n  url : '{#contextPath#}/upgradeAction.do?method=getVerConfigInfo',\n  params : {\n    'appCode' : app.appl.getValue()\n  },\n  async\t: false,\n  method : 'post',\n  timeout : 360000,\n  success : function(response, options) {\n    var resp = Ext.JSON.decode(response.responseText);\n    if(resp.flag == '0'){\n      app.lastedVer.setValue(resp.lastedVersion) ;\n      app.updatedDate.setValue(resp.updatedDate) ;\n    }\n  },\n  failure : function(reponse, options) {\n    var response = Ext.JSON.decode(response.responseText);\n    Wb.toast(response.msg);\n  }\n});\t\n// 加载日志信息\napp.myGrid.getStore().load();","tagEvents":"'render':function(){\n  app.appStore.load({\n    callback : function(){\n      app.appl.setValue('XIP');\t\t\n      // 获取当前版本信息\n      var r = app.appl.findRecordByValue('XIP') ;\n      app.hisVer.setValue(r.data.VERSION) ;\n      // 加载日志信息\n      app.myGrid.getStore().load();\n      // 获取最新版本信息\n      Ext.Ajax.request({\n        url \t: '{#contextPath#}/upgradeAction.do?method=getVerConfigInfo',\n        params\t: {\n          'appCode'  : 'XIP'\n        },\n        async\t: false,\n        method \t: 'post',\n        timeout : 360000,\n        success : function(response, options) {\n          var resp = Ext.JSON.decode(response.responseText);\n          if(resp.flag == '0'){\n            app.lastedVer.setValue(resp.lastedVersion) ;\n            app.updatedDate.setValue(resp.updatedDate) ;\n          }\n        },\n        failure : function(reponse, options) {\n          var response = Ext.JSON.decode(response.responseText);\n          Wb.toast(response.msg);\n        }\n      });\t\t\t        \t\t\t\t\n    }\n  });\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".2","border":"false","itemId":"td2"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"hisVer","fieldLabel":"{#xip_tools_upgrade_history_version#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".2","border":"false","itemId":"td3"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"lastedVer","fieldLabel":"{#xip_tools_upgrade_new_version#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".2","border":"false","itemId":"td4"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"updatedDate","fieldLabel":"{#xip_tools_upgrade_version_date#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".8","border":"false","itemId":"td1"},"children":[{"configs":{"vertical":"true","labelWidth":"120","columns":"5","labelAlign":"right","itemId":"chkGroup","fieldLabel":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{#xip_tools_upgrade_option#}"},"children":[{"configs":{"readOnly":"false","name":"chkDdl","inputValue":"1","itemId":"chkDdl","boxLabel":"{#xip_tools_upgrade_ddl_sql#}","checked":"true"},"children":[],"expanded":false,"type":"check"},{"configs":{"readOnly":"false","name":"chkCrud","inputValue":"2","itemId":"chkCrud","boxLabel":"{#xip_tools_upgrade_crud_sql#}","checked":"true"},"children":[],"expanded":false,"type":"check"},{"configs":{"readOnly":"false","name":"chkInitdata","inputValue":"3","itemId":"chkInitdata","boxLabel":"{#xip_tools_upgrade_initial_data#}","checked":"true"},"children":[],"expanded":false,"type":"check"},{"configs":{"readOnly":"false","name":"chkDiffdata","inputValue":"4","itemId":"chkDiffdata","boxLabel":"{#xip_tools_upgrade_differ_data#}","checked":"true"},"children":[],"expanded":false,"type":"check"},{"configs":{"readOnly":"false","name":"chkWb","inputValue":"5","itemId":"chkWb","boxLabel":"{#xip_tools_upgrade_wb_module#}","checked":"true"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"checkgroup"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","title":"{#xip_tools_upgrade_log#}","height":"document.body.clientHeight-120","itemId":"myGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","xtype":"rownumberer","itemId":"numCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_version#}","width":"120","dataIndex":"UPDVER","itemId":"updevrCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_option#}","width":"200","dataIndex":"UPDOPT","itemId":"updoptCol","renderer":"if(value === \"1\"){\n  return '{#xip_tools_upgrade_ddl#}' ;\n}else if(value === \"2\"){\n  return '{#xip_tools_upgrade_crud#}' ;\n}else if(value === \"3\"){\n  return '{#xip_tools_upgrade_init#}' ;\n}else if(value === \"4\"){\n  return '{#xip_tools_upgrade_differ#}' ;\n}else if(value === \"5\"){\n  return '{#xip_tools_upgrade_wb#}' ;\n}else if(value === \"0\"){\n  return '{#xip_tools_upgrade_synchronize#}' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_start_time#}","width":"150","dataIndex":"STARTDATE","format":"Y-m-d H:i:s","itemId":"startDateCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_end_time#}","width":"150","dataIndex":"ENDDATE","format":"Y-m-d H:i:s","itemId":"endDateCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_exe_time#}","width":"150","dataIndex":"CREATIONDATE","format":"Y-m-d H:i:s","itemId":"creationDateCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_is_success#}","width":"80","dataIndex":"UPDFLAG","itemId":"updflagCol","renderer":"if(value === \"S\"){\n  return '{#xip_tools_upgrade_success#}' ;\n}else if(value === \"F\"){\n  return '{#xip_tools_upgrade_failure#}';\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_upgrade_result#}","width":"400","dataIndex":"UPDDESC","itemId":"upddescCol","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:16px;';  \nreturn value ;"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"proxy":"{\n  type\t: \t'ajax',\n  url\t\t: \t'{#contextPath#}/upgradeAction.do?method=getApplUpgradeLogs',\n  reader\t: {\n    type\t: \t'json',\n    root\t: \t'dataList',\n    totalProperty\t: 'totalProperty'\n  }\n}","pageSize":"10","autoLoad":"false","itemId":"store","fields":"[\n  {name: 'UPDVER', \t\ttype: 'string'},\n  {name: 'UPDOPT',  \t\ttype: 'string'},\n  {name: 'STARTDATE',    type: 'String'},\n  {name: 'ENDDATE',  \ttype: 'String'},\n  {name: 'UPDFLAG',  \ttype: 'string'},\n  {name: 'UPDDESC',  \ttype: 'string'},\n  {name: 'CREATIONDATE', type: 'String'}\n]"},"events":{"beforeload":"var params = {'appCode' : app.appl.getValue()} ;\nExt.apply(app.myGrid.getStore().proxy.extraParams, params);"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}