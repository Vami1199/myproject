{"inframe":false,"title":"定时任务管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"com.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","loginRequired":"false","loadJS":"ext","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/tools/conc/task/json/task\");","itemId":"module"},"events":{"initialize":"function getuuid() {\n var s = [];\n var hexDigits = \"0123456789abcdef\";\n for (var i = 0; i < 36; i++) {\n s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n }\n s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n s[8] = s[13] = s[18] = s[23] = \"-\";\n\nvar uuid = s.join(\"\");\n return uuid;\n}\n\n//重置组件成默认样式\nfunction reInitEditWinForm(){\n     app.PROGRAM_NAME.setReadOnly(false);\n     app.RUN_TYPE.setReadOnly(false);\n     app.START_DATE.setReadOnly(false);\n     app.END_DATE.setReadOnly(false);\n     app.RUN_INTERVAL.setReadOnly(false);\n     app.INTERVAL_UNIT.setReadOnly(false);\n     app.NEXT_DATE.setReadOnly(false);\n\n}"},"children":[{"configs":{"title":"{#xip_connc_task_set_param_val#}","height":"180","width":"400","layout":"fit","closeAction":"hide","dialog":"true","itemId":"textParamWin","modal":"true"},"events":{"ok":"var r = app.progrid.getSelection()[0] ;\nr.set('ATTRIBUTE10',app.taParamVal.getValue() );\nr.set('PARAM_VAL',app.taParamVal.getValue()) ; \n\nwin.hide() ;"},"children":[{"configs":{"layout":"fit","itemId":"form1"},"children":[{"configs":{"itemId":"taParamVal"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"maximized":"false","title":"{#xip_connc_task_set_param_val#}","height":"350","layout":"fit","width":"450","closeAction":"hide","dialog":"true","itemId":"droppingParamWin","modal":"true","maximizable":"true"},"events":{"ok":"var record = app.droppingGrid.getSelection()[0] ;\n\nvar r = app.progrid.getSelection()[0] ;\nr.set('ATTRIBUTE10',record.get('NAME') );\nr.set('PARAM_VAL',record.get('ID')) ; \nwin.hide() ;"},"children":[{"configs":{"multiSelect":"false","selType":"rowmodel","forceFit":"true","itemId":"droppingGrid","simpleSelect":"false"},"events":{"itemdblclick":"var r = app.progrid.getSelection()[0] ;\nr.set('ATTRIBUTE10',record.get('NAME') );\nr.set('PARAM_VAL',record.get('ID')) ; \napp.droppingParamWin.hide() ;"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xip/tools/conc/task/data/findzjid"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_connc_task_order#}","align":"center","width":"55","xtype":"rownumberer","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"ID","titleAlign":"center","itemId":"ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_val_code#}","dataIndex":"CODE","titleAlign":"center","itemId":"CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_val_name#}","dataIndex":"NAME","titleAlign":"center","itemId":"NAME"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"height":"500","layout":"border","width":"700","closeAction":"hide","resizable":"true","buttonAlign":"center","itemId":"prowin","border":"false","dialog":"false","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","bodyPadding":"0 0 0 30","border":"false","itemId":"proform"},"children":[{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","displayField":"PROGRAM_NAME","width":"300","valueField":"PROGRAM_ID","labelAlign":"right","itemId":"PROGRAM_NAME","forceSelection":"true","fieldLabel":"<font color='red'>*<\/font>{#xip_connc_task_program_name#}"},"events":{"select":"var id=app.PROGRAM_NAME.getValue();\napp.PROGRAM_ID.setValue(id);//获取gird的相应列赋给表单\nvar rid=app.RUN_CONFIG_ID.getValue();\n\nif(rid === null || rid === '' || rid === undefined){\n  \napp.progrid.store.getProxy().url='m?xwl=xip/tools/conc/task/data/selectgrid2url';\n\napp.progrid.store.load({params:{PROGRAM_ID: id }});  \n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/conc/task/data/findname","showMask":"false"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"100","allowBlank":"false","width":"300","valueField":"CODE","labelAlign":"right","pickList":"[['I','{#xip_connc_task_rt_immediate#}'],['P','{#xip_connc_task_rt_plan#}']]","itemId":"RUN_TYPE","forceSelection":"true","fieldLabel":"<font color='red'>*<\/font>{#xip_connc_task_run_type#}"},"events":{"select":"var status = app.RUN_TYPE.getValue();\nif(status == 'I'){\n  \n  app.START_DATE.setDisabled(true);\n  app.END_DATE.setDisabled(true);\n  app.RUN_INTERVAL.setReadOnly(true);\n  app.INTERVAL_UNIT.setReadOnly(true);\n  app.NEXT_DATE.setDisabled(true);\n\n\n  app.START_DATE.reset();\n  app.END_DATE.reset();\n  app.RUN_INTERVAL.reset();\n  app.INTERVAL_UNIT.reset();\n  app.NEXT_DATE.reset();\n}\n\nif(status == 'P'){\n  app.START_DATE.setDisabled(false);\n  app.END_DATE.setDisabled(false);\n  app.RUN_INTERVAL.setReadOnly(false);\n  app.INTERVAL_UNIT.setReadOnly(false);\n  app.NEXT_DATE.setDisabled(false);\n}\n"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel1"},"children":[{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"START_DATE","fieldLabel":"{#xip_connc_task_START_DATE#}"},"events":{"change":"var start_date=app.START_DATE.getValue();\n\napp.NEXT_DATE.setValue(start_date);"},"children":[],"expanded":false,"type":"datetime"},{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"END_DATE","fieldLabel":"{#xip_connc_task_END_DATE#}"},"children":[],"expanded":false,"type":"datetime"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel2"},"children":[{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"RUN_INTERVAL","fieldLabel":"{#xip_connc_task_INTERVAL#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"NEXT_DATE","fieldLabel":"{#xip_connc_task_NEXT_DATE#}"},"children":[],"expanded":false,"type":"datetime"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","border":"false","itemId":"paramPanel3"},"children":[{"configs":{"labelWidth":"100","width":"300","valueField":"CODE","labelAlign":"right","pickList":"[['Y','{#xip_connc_task_year#}'],['M','{#xip_connc_task_month#}'],['D','{#xip_connc_task_day#}'],['H','{#xip_connc_task_time#}'],['MI','{#xip_connc_task_Minute#}']]","itemId":"INTERVAL_UNIT","forceSelection":"true","fieldLabel":"{#xip_connc_task_INTERVAL_UNIT#}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"100","readOnly":"true","hideTrigger":"true","width":"300","labelAlign":"right","pickList":"[['N','{#xip_connc_task_STATUS_new#}'],\n ['C','{#xip_connc_task_STATUS_end#}'],\n ['R','{#xip_connc_task_STATUS_exec#}'],\n ['W','{#xip_connc_task_STATUS_wait#}']]","itemId":"STATUS","fieldLabel":"{#xip_connc_task_STATUS#}"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"PROGRAM_ID","fieldLabel":"proid"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"RUN_CONFIG_ID","fieldLabel":"runid"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","title":"{#xip_connc_task_fd_detail#}","layout":"fit","itemId":"fieldset1"},"children":[{"configs":{"pagingBar":"false","multiSelect":"true","forceFit":"true","itemId":"progrid","editable":"false"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/tools/conc/task/data/selectgrid2"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_connc_task_order#}","hidden":"true","width":"55","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_PARAM_CODE#}","sortable":"false","width":"100","dataIndex":"PARAM_CODE","titleAlign":"center","itemId":"COL_PARAM_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#xip_connc_task_PARAM_NAME#}","sortable":"false","width":"150","dataIndex":"PARAM_NAME","titleAlign":"center","itemId":"COL_PARAM_NAME"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#xip_connc_task_PARAM_VAL#}","sortable":"false","width":"180","dataIndex":"ATTRIBUTE10","titleAlign":"center","itemId":"COL_PARAM_VAL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"参数值","hidden":"true","dataIndex":"PARAM_VAL","itemId":"COL_PROGRAM_Valus"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"参数类型","hidden":"true","width":"180","dataIndex":"PROGRAM_TYPE","itemId":"COL_PROGRAM_TYPE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"参数值id","hidden":"true","dataIndex":"RUN_PARAM_ID","itemId":"COL_RUN_PARAM_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"值集id","hidden":"true","dataIndex":"VAL_SET_ID","itemId":"COL_VAL_SET_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"值集编码","hidden":"true","dataIndex":"VAL_SET_CODE","itemId":"COL_VAL_SET_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"sql语句","hidden":"true","dataIndex":"SQL_STR","itemId":"COL_SQL_STR"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PROGRAM_PARAM_ID","hidden":"true","dataIndex":"PROGRAM_PARAM_ID","itemId":"COL_PROGRAM_PARAM_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"RUN_CONFIG_ID","hidden":"true","dataIndex":"RUN_CONFIG_ID","itemId":"COL_RUN_CONFIG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"sortable":"false","width":"100","align":"center","xtype":"actioncolumn","itemId":"COL_OP"},"children":[{"configs":{"itemId":"items"},"children":[{"configs":{"itemId":"setParamAction","iconCls":"record_edit_icon","tooltip":"{#xip_connc_task_set_param_val#}","handler":"// 选中当前行\nvar sm = app.progrid.getSelectionModel() ;\nsm.select(rowIndex) ;\n\n//  S:SQL V:值集 H:手工录入\nvar valSrcType = record.get('VAL_SRC_TYPE') ; \nif(valSrcType === \"V\"){\t// 值集\n  var valSetCode = record.get('VAL_SET_CODE') ;\n  var sql = \"SELECT T.VAL_SET_DTL_ID ID, T.VAL_CODE CODE, T.VAL_NAME NAME FROM XIP_PUB_VAL_SET_DTL T WHERE T.VAL_SET_CODE = '\"+valSetCode+\"'\" ;\n  var store = app.droppingGrid.getStore() ;\n  store.load({\n    params :{\n      'valSql' : sql\n    }\n  }) ;\n  app.droppingParamWin.show() ;\n  \n}else if(valSrcType === \"S\"){ // SQL语句\n  var sql = record.get('SQL_STR') ;\n  var store = app.droppingGrid.getStore() ;\n  store.load({\n    params :{\n      'valSql' : sql\n    }\n  }) ;\n  app.droppingParamWin.show() ;\n\n}else if(valSrcType === \"H\"){ // 手工录入\n  var paramVal = record.get('ATTRIBUTE10') ;\n  app.taParamVal.setValue(paramVal) ;\n  app.textParamWin.show();\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"itemId":"sep"},"children":[],"expanded":false,"type":"column"},{"configs":{"itemId":"delParamAction","iconCls":"delete_icon","handler":"// 选中当前行\nvar sm = app.progrid.getSelectionModel() ;\nsm.select(rowIndex) ;\n\n// 清空\nrecord.set('ATTRIBUTE10','');\nrecord.set('PARAM_VAL','') ; ","tooltip":"{#xip_connc_task_del_param_val#}"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#xip_connc_task_saveWin#}","itemId":"saveWin","iconCls":"save_icon"},"events":{"click":"if(app.proform.getForm().isValid()===false){\n  Ext.Msg.alert('{#xip_connc_task_tip#}','{#xip_connc_task_notnull#}!');\n  return;\n}\nvar _RUN_TYPE = app.RUN_TYPE.getValue();\nvar _start=app.START_DATE.getValue();\nvar _end=app.END_DATE.getValue();\nif(_RUN_TYPE === 'P'){\n  if(Ext.isEmpty(_start) || Ext.isEmpty(_end) || Ext.isEmpty(app.RUN_INTERVAL.getValue()) || Ext.isEmpty(app.INTERVAL_UNIT.getValue()) || Ext.isEmpty(app.NEXT_DATE.getValue())){\n    Ext.Msg.alert('','{#xip_connc_task_msg1#}');\n    return false;\n  }\n}\nif(_start>_end){\n  Ext.Msg.alert('','{#xip_connc_task_msg2#}');\n  return;\n}\nvar  runid = app.RUN_CONFIG_ID.getValue();\nvar json = {\n  RUN_CONFIG_ID:'',\n  PROGRAM_ID:app.PROGRAM_ID.getValue(),\n  RUN_TYPE:app.RUN_TYPE.getValue(),\n  START_DATE:app.START_DATE.getValue(),\n  END_DATE:app.END_DATE.getValue(),\n  RUN_INTERVAL:app.RUN_INTERVAL.getValue(),\n  INTERVAL_UNIT:app.INTERVAL_UNIT.getValue(),\n  NEXT_DATE:app.NEXT_DATE.getValue(),\n  STATUS:app.STATUS.getValue()\n  \n};\n\nif(runid===''){//新增\n  json.RUN_CONFIG_ID = getuuid();\n\n  app.RUN_CONFIG_ID.setValue(json.RUN_CONFIG_ID);\n  Wb.request({\n    url : 'm?xwl=xip/tools/conc/task/data/insertgrid',\n    params: json,\n    success: function(response,options){\n     \n      var rows=app.progrid.store.getModifiedRecords();\n      var insertArray=[];\n      Ext.each(rows,function(item){\n        var _record = item.getData();\n        // _record.DEPT_ID = _deptId;\n        //_record.POST_ID = _postId;\n        //json={PARAM_VAL:_record.get('PARAM_VAL'),RUN_PARAM_ID:_record.get('RUN_PARAM_ID')};\n        if(Ext.isEmpty(_record.PARAM_VAL)){\n          _record.PARAM_VAL =_record.ATTRIBUTE10;\n        }\n        _record.RUN_CONFIG_ID = app.RUN_CONFIG_ID.getValue();\n        _record.RUN_PARAM_ID = getuuid();\n        insertArray.push(_record); \n      });\n      \n       Wb.request({\n           url: 'm?xwl=xip/tools/conc/task/data/insertparameter', \n           params: Wb.apply({\n                insertArray : insertArray\n           }),\n           success: function() {\n             app.grid.store.reload();\n              Ext.Msg.alert('','{#xip_connc_task_saveok#}');\n           }\n        });\n    }\n  });\n  //insertajax.request(json);\n}else{//更新\n  json.RUN_CONFIG_ID = runid;\n   Wb.request({\n           url: 'm?xwl=xip/tools/conc/task/data/updategrid', \n           params: json,\n           success: function() {\n             app.grid.store.reload();\n           }\n        });\n  var rows = app.progrid.store.getModifiedRecords();\n  var updateArray=[];\n\n  Ext.each(rows,function(item){\n    var _record = item.getData();\n    var _paramVal =_record.PARAM_VAL; \n    if(Ext.isEmpty(_paramVal)){\n       _record.PARAM_VAL =_record.ATTRIBUTE10;\n     }\n    // _record.DEPT_ID = _deptId;\n    //_record.POST_ID = _postId;\n    //json={PARAM_VAL:_record.get('PARAM_VAL'),RUN_PARAM_ID:_record.get('RUN_PARAM_ID')};\n    updateArray.push(_record); \n  });   \n   Wb.request({\n           url: 'm?xwl=xip/tools/conc/task/data/updateparameter', \n             params: Wb.apply({\n                updateArray : updateArray\n           }),\n           success: function() {\n             app.grid.store.reload();\n             Ext.Msg.alert('','{#xip_connc_task_saveok#}');\n           }\n        });\n\n}\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_connc_task_closeWin#}","itemId":"closeWin","iconCls":"cancel_icon"},"events":{"click":"app.prowin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"height":"400","width":"700","layout":"border","resizable":"true","closeAction":"hide","buttonAlign":"center","dialog":"false","border":"false","itemId":"itemwin"},"children":[{"configs":{"region":"center","plugins":"  [{\n ptype: 'rowexpander',\n rowBodyTpl : [\n '<div style=\"margin-top:10px;text-align:right;\">{#xip_connc_task_executeResult#}:<b>{RESULT}<\/b><div style=\"width:50px;text-align:left\">&nbsp;<\/div><\/div>',\n ]\n }]","itemId":"itemgrid"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/tools/conc/task/data/selectgrid3"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_START_DATE#}","width":"150","dataIndex":"START_DATE","itemId":"C_START_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_END_DATE#}","width":"150","dataIndex":"END_DATE","itemId":"C_END_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_STATUS#}","width":"60","dataIndex":"STATUS","itemId":"C_STATUS","renderer":"if(value === \"N\"){\n  return \"{#xip_connc_task_STATUS_new#}\";\n}else if(value === \"C\"){\n  return \"{#xip_connc_task_STATUS_end#}\";\n}else if(value === \"R\"){\n  return \"{#xip_connc_task_STATUS_exec#}\";\n}else if(value === \"W\"){\n  return \"{#xip_connc_task_STATUS_wait#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_result#}","align":"left","dataIndex":"RESULT","itemId":"C_RESULT","renderer":"return \"<div style='text-align:right'>\"+value+\"<\/div>\";","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PROGRAM_ID","hidden":"true","dataIndex":"PROGRAM_ID","itemId":"C_PROGRAM_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"RUN_CONFIG_ID","hidden":"true","dataIndex":"RUN_CONFIG_ID","itemId":"C_RUN_CONFIG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"运行id","hidden":"true","dataIndex":"RUN_ID","itemId":"C_RUN_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"节点id","hidden":"true","dataIndex":"NODE_ID","itemId":"C_NODE_ID"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#xip_connc_task_closeWin#}","itemId":"closeitem","iconCls":"cancel_icon"},"events":{"click":"app.itemwin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"itemId":"menu"},"children":[{"configs":{"height":"300","width":"200","itemId":"tr"},"children":[{"configs":{"exportTitle":"false","columnLines":"true","height":"300","width":"200","itemId":"gridcombo"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/conc/task/data/findname","showMask":"false"},"events":{"load":"app.menu.showBy(app.ed_zj);\napp.ed_zj.focus(false,true);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROGRAM_ID","itemId":"COL_PROGRAM_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_program_name#}","width":"200","dataIndex":"PROGRAM_NAME","itemId":"COL_PROGRAM_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"menu"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","itemId":"queryform","border":"false"},"children":[{"configs":{"title":"{#xip_connc_task_fieldset1#}","style":"padding-top:8px","collapsible":"true","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"100","displayField":"PROGRAM_NAME","width":"200","valueField":"PROGRAM_ID","labelAlign":"right","itemId":"cxmcCombox","forceSelection":"true","fieldLabel":"{#xip_connc_task_program_name#}"},"events":{"select":"app.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );","specialkey":"app.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/conc/task/data/findname","showMask":"false"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","displayField":"PROGRAM_NAME","width":"200","valueField":"PROGRAM_ID","pickList":"[['I','{#xip_connc_task_rt_immediate#}'],['P','{#xip_connc_task_rt_plan#}']]","labelAlign":"right","itemId":"yxlxCombox","forceSelection":"true","fieldLabel":"{#xip_connc_task_run_type#}"},"events":{"select":"app.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );","specialkey":"app.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"60","width":"200","pickList":"[['N','{#xip_connc_task_STATUS_new#}'],['C','{#xip_connc_task_STATUS_end#}'],['R','{#xip_connc_task_STATUS_exec#}'],['W','{#xip_connc_task_STATUS_wait#}']]","labelAlign":"right","itemId":"ztCombox","fieldLabel":"{#xip_connc_task_STATUS#}"},"events":{"select":"app.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );","specialkey":"app.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );"},"children":[],"expanded":true,"type":"combo"},{"configs":{"text":"{#xip_connc_task_queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"\napp.grid.store.load( {  params:{cxmcCombox:app.cxmcCombox.getValue(),yxlxCombox:app.yxlxCombox.getValue(),ztCombox:app.ztCombox.getValue() }} );"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_connc_task_resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"20"},"events":{"click":"app.queryform.getForm().reset();\napp.grid.store.load();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid"},"events":{"itemdblclick":"\napp.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#xip_connc_task_addBtn#}","itemId":"addBtn","iconCls":"application_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._prowin);\nwin.show();\napp.prowin.setTitle('{#xip_connc_task_add_title#}');\n\napp.STATUS.setValue('N');\napp.START_DATE.setDisabled(true);\napp.END_DATE.setDisabled(true);\napp.RUN_INTERVAL.setReadOnly(true);\napp.INTERVAL_UNIT.setReadOnly(true);\napp.NEXT_DATE.setDisabled(true);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_connc_task_editBtn#}","itemId":"editBtn","iconCls":"table_edit_icon"},"events":{"click":"\nWb.edit(app.grid,app.prowin);\napp.prowin.setTitle('{#xip_connc_task_edit_title#}');\n\n\napp.progrid.store.getProxy().url='m?xwl=xip/tools/conc/task/data/selectgrid2';\n//回显程序名称cmbox\nvar rec=app.grid.getSelection();\nvar name=rec[0].get('PROGRAM_NAME');\nvar id=rec[0].get('PROGRAM_ID');\napp.PROGRAM_NAME.store.load(\n  function (){\n    app.PROGRAM_NAME.setRawValue(name);\n    app.PROGRAM_NAME.setValue(id);  \n  }\n);\napp.progrid.store.load({\n  params:{\n\tRUN_CONFIG_ID: app.RUN_CONFIG_ID.getValue()\n  }\n});\n\n\n\nvar _status = app.STATUS.getValue();\n\n//新增和等待状态的可以修改，其它状态不可以\nif(_status=='N' || _status=='W'){\n  if(app.RUN_TYPE.getValue()=='P'){\n    \n    app.END_DATE.setDisabled(false);\n     app.RUN_INTERVAL.setReadOnly(false);\n     app.NEXT_DATE.setDisabled(false);\n\n  }else{\n     app.END_DATE.setDisabled(true);\n     app.RUN_INTERVAL.setReadOnly(true);\n     app.NEXT_DATE.setDisabled(true);\n  }\n}else{\n     app.END_DATE.setDisabled(true);\n     app.RUN_INTERVAL.setReadOnly(true);\n     app.NEXT_DATE.setDisabled(true);\n  \n}\n\n     app.END_DATE.setDisabled(true);\n     app.RUN_INTERVAL.setReadOnly(true);\n     app.NEXT_DATE.setDisabled(true);\n     app.INTERVAL_UNIT.setReadOnly(true);\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_connc_task_deleteBtn#}","itemId":"deleteBtn","iconCls":"application_delete_icon"},"events":{"click":"\nvar recs = app.grid.getSelection();\nvar status=recs[0].get('STATUS');\n\nif (!recs.length) {\n  Wb.warn('{#xip_connc_task_delsel#}');\n  return false ;\n}\nif(status === 'R'){\n  Wb.warn(\"{#xip_connc_task_rundelsel#}\") ;\n  return false ;\n}\nExt.Msg.confirm('{#xip_connc_task_tip#}','{#xip_connc_task_suredel#}',function(a){\n    if(a=='yes'){\n    \n      var json ={\n        RUN_CONFIG_ID:recs[0].get('RUN_CONFIG_ID')\n      };\n    Wb.request({\n        url: 'm?xwl=xip/tools/conc/task/data/deleteall', \n           params:  json,\n   \n           success: function() {\n           Ext.Msg.alert('{#xip_connc_task_tip#}','{#xip_connc_task_delok#}');  \n          app.grid.store.reload();\n           }\n    \n    });\n    }\n  });\n \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_connc_task_itembtn#}","itemId":"itembtn","iconCls":"item_icon"},"events":{"click":"\n\n\nWb.edit(app.grid,app.itemwin);\napp.itemwin.setTitle('{#xip_connc_task_task_detail#}');\nvar rec=app.grid.getSelection();\n\n\napp.itemgrid.store.load({params:{\nRUN_CONFIG_ID: rec[0].get('RUN_CONFIG_ID')\n}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/conc/task/data/selectgrid"},"events":{"beforeload":"\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#xip_connc_task_order#}","width":"55","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_program_name#}","width":"150","dataIndex":"PROGRAM_NAME","itemId":"COLUMN_PROGRAM_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_run_type#}","width":"80","align":"center","dataIndex":"RUN_TYPE","itemId":"COLUMN_RUN_TYPE","renderer":"if(value === \"I\"){\n  return \"{#xip_connc_task_rt_immediate#}\";\n}else if(value === \"P\"){\n  return \"{#xip_connc_task_rt_plan#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_START_DATE#}","width":"150","dataIndex":"START_DATE","itemId":"COLUMN_START_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_END_DATE#}","width":"150","dataIndex":"END_DATE","itemId":"COLUMN_END_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_INTERVAL#}","dataIndex":"RUN_INTERVAL","itemId":"COLUMN_RUN_INTERVAL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_NEXT_DATE#}","width":"150","dataIndex":"NEXT_DATE","itemId":"COLUMN_NEXT_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_INTERVAL_UNIT#}","width":"100","dataIndex":"INTERVAL_UNIT","itemId":"COLUMN_INTERVAL_UNIT","renderer":"if(value === \"Y\"){\n  return \"{#xip_connc_task_IU_year#}\";\n}else if(value === \"M\"){\n  return \"{#xip_connc_task_IU_month#}\";\n}else if(value === \"D\"){\n  return \"{#xip_connc_task_IU_day#}\";\n}else if(value === \"H\"){\n  return \"{#xip_connc_task_IU_hour#}\";\n}else if(value === \"MI\"){\n  return \"{#xip_connc_task_IU_min#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_connc_task_STATUS#}","width":"60","dataIndex":"STATUS","itemId":"COLUMN_STATUS","renderer":"if(value === \"N\"){\n  return \"{#xip_connc_task_STATUS_new#}\";\n}else if(value === \"C\"){\n  return \"{#xip_connc_task_STATUS_end#}\";\n}else if(value === \"R\"){\n  return \"{#xip_connc_task_STATUS_exec#}\";\n}else if(value === \"W\"){\n  return \"{#xip_connc_task_STATUS_wait#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PROGRAM_ID","hidden":"true","dataIndex":"PROGRAM_ID","itemId":"COLUMN_PROGRAM_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"RUN_CONFIG_ID","hidden":"true","dataIndex":"RUN_CONFIG_ID","itemId":"COLUMN_RUN_CONFIG_ID"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}