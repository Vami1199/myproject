{"inframe":false,"title":"通知","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","initScript":"var ctxPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",ctxPath);\n\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","jsLinks":"[\"workflow/util/workflowUtil4.0.js\"]","serverScript":"//三方语言,引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xip/tools/notice/notice');","itemId":"module"},"events":{"initialize":"app.showWin = function(){\n  app.selectedUserWin.show();\n};\napp.deleteUser = function(){\n    var record = app.selectGrid.getSelectionModel().getSelection();\n    app.selectGrid.store.remove(record);\n    var type = record[0].data.TYPE;\n    if(type === 'O'){\n      //点击删除 去掉勾选的对号\n      var uid=record[0].data.ID;\n      var bl;\n      for(var j=0;j<app.orgGrid.store.getCount();j++){\n        var u_id = app.orgGrid.store.getAt(j).get('ORG_ID');\n        if(uid===u_id){\n          app.orgGrid.getSelectionModel().deselect(app.orgGrid.store.getAt(j));\n          bl=1;\n          break;\n        }\n      }\n      //执行JS中的方法\n      allcount2();\n    }\n    if(type === 'D'){\n      //点击删除 去掉勾选的对号\n      var uid = record[0].data.ID;\n      var bl;\n      for(var j=0;j<app.deptGrid.store.getCount();j++){\n        var u_id = app.deptGrid.store.getAt(j).get('DEPT_ID');\n        if(uid===u_id){\n          app.deptGrid.getSelectionModel().deselect(app.deptGrid.store.getAt(j));\n          bl=1;\n          break;\n        }\n      }\n      //执行JS中的方法\n      allcount2();\n    }\n    if(type === 'P'){\n      //点击删除 去掉勾选的对号\n      var uid = record[0].data.ID;\n      var bl;\n      for(var j=0;j<app.postGrid.store.getCount();j++){\n        var u_id = app.postGrid.store.getAt(j).get('POST_ID');\n        if(uid===u_id){\n          app.postGrid.getSelectionModel().deselect(app.postGrid.store.getAt(j));\n          bl=1;\n          break;\n        }\n      }\n      //执行JS中的方法\n      allcount2();\n    }\n     if(type === 'U'){\n      //点击删除 去掉勾选的对号\n      var uid=record[0].data.ID;\n      var bl;\n      for(var j=0;j<app.userGrid.store.getCount();j++){\n        var u_id = app.userGrid.store.getAt(j).get('USER_ID');\n        if(uid===u_id){\n          app.userGrid.getSelectionModel().deselect(app.userGrid.store.getAt(j));\n          bl=1;\n          break;\n        }\n      }\n      //执行JS中的方法\n      allcount2();\n    }\n };\n//定义监听store加载的变量\nvar loadSta;\nvar loadStaD;\nvar loadStaP;\nvar loadStaU;\n\napp.userCount  =function ()\n{ \n  var row = app.orgGrid.getSelection();\n  var count = row.length;\n  var c = app.selectGrid.store.getModifiedRecords().length;\n if(count===0){\n   \n   if(loadSta===false){\n     if(c===0){\n       document.getElementById(\"users\").innerHTML = \"{#tools_notice_already_choose#}\"; \n     }\n     else{\n       document.getElementById(\"users\").innerHTML = \"{#tools_notice_already_choose#}\"+\"(\"+c+\")\"; \n     }\n    }\n   else{\n     document.getElementById(\"users\").innerHTML =  \"{#tools_notice_already_choose#}\"+\"(\"+c+\")\";\n   }\n    \n }else{\n    document.getElementById(\"users\").innerHTML = \"{#tools_notice_already_choose#}\"+\"(\"+c+\")\"; \n  }\n\n};\n\n"},"children":[{"configs":{"footerScript":"\n\n  \n  //删除全部已选的用户\n  function deleteAllUsers(){\n    Ext.Msg.confirm('{#tools_notice_prompt#}','{#tools_notice_prompt_msg1#}',function(btn){\n      if(btn == 'yes'){\n        userStore.removeAll();\n        UserGrid.getSelectionModel().deselectAll();\n        allcount2();\n      }\n    });\n  }\n  \n  function allcount2()\n{ \n  var row = Wb.getSelRec(orgGrid);\n  var count = row.length;\n  var c = selectUserGridStore.getModifiedRecords().length;\n if(count===0){\n   if(orgGrid.getStore().isLoading()===false){\n    \n     if(c===0){\n       document.getElementById(\"users\").innerHTML = \"{#tools_notice_already_choose#}\"; \n     }\n     else{\n       document.getElementById(\"users\").innerHTML = \"{#tools_notice_already_choose#}\"+\"(\"+c+\")\"; \n     }\n     \n    }\n   else{\n\n     document.getElementById(\"users\").innerHTML =  \"{#tools_notice_already_choose#}\"+\"(\"+c+\")\";\n   }\n    \n    \n }else{\n\n    document.getElementById(\"users\").innerHTML = \"{#tools_notice_already_choose#}\"+\"(\"+c+\")\"; \n  }\n \n\n}\n\n","itemId":"clientscript1"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"script":"//获取微信服务配置\nvar wxCasUrl = com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"cas.casServerUrl\");\nvar agentId = com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"wx.agentId\");\nvar token = com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"wx.token\");\nvar corpId = com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"wx.corpId\");\nvar corpSecret = com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"wx.corpSecret\");\nvar aesKey = com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"wx.aesKey\");\nrequest.setAttribute(\"agentId\",agentId);\nrequest.setAttribute(\"token\",token);\nrequest.setAttribute(\"corpId\",corpId);\nrequest.setAttribute(\"corpSecret\",corpSecret);\nrequest.setAttribute(\"aesKey\",aesKey);\n//获取邮件服务配置\nvar mailHost = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(com.xzsoft.xip.platform.util.PlatformConstants.MAIL_SERVER_HOST);\nvar mailPort = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(com.xzsoft.xip.platform.util.PlatformConstants.MAIL_SERVER_PORT);\nvar mailUser = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(com.xzsoft.xip.platform.util.PlatformConstants.MAIL_USER);\nvar mailPassword = com.xzsoft.xip.platform.util.PlatformUtil.getSystemParamVal(com.xzsoft.xip.platform.util.PlatformConstants.MAIL_PASSWORD);\nrequest.setAttribute(\"mailHost\",mailHost);\nrequest.setAttribute(\"mailPort\",mailPort);\nrequest.setAttribute(\"mailUser\",mailUser);\nrequest.setAttribute(\"mailPassword\",mailPassword);","itemId":"serverscript1"},"children":[],"expanded":true,"type":"serverscript"},{"configs":{"itemId":"winBtn"},"children":[{"configs":{"itemId":"noticeWinBtn"},"children":[{"configs":{"text":"{#tools_notice_save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var title = app.noticeTitle.getValue();\nif(title===null||title===''){\n  Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_prompt_msg2#}');\n  return;\n}\nvar content = app.htmleditor1.getValue();\nvar notice_id = app.noticeID.getValue();\nif(notice_id=== null||notice_id===''){\n   //保存\n   var json = { \n               title: title,\n               content: content\n              };\n   Wb.request({\n     url :'m?xwl=xip/tools/notice/DATA/saveNotice',\n     params: json,\n     success: function(response){\n       Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_save_success#}');\n       app.grid1.store.load();\n       var notice = response.responseText;\n       var resultJson = Ext.JSON.decode(notice);\n       var notice_id = resultJson.k;\n       app.noticeID.setValue(notice_id);\n     }\n    \n   });\n  \n}else{\n  //更新\n  var json={\n            NOTICE_TITLE: title,\n            NOTICE_CONTENT: content,\n            NOTICE_ID: notice_id\n           };\n   Wb.request({\n     url :'m?xwl=xip/tools/notice/DATA/updateNotice',\n     params: json,\n     success: function(response){\n       Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_edit_success#}');\n       app.grid1.store.load();\n     }\n    \n   });\n  \n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_send#}","itemId":"sendBtn","iconCls":"wait_icon"},"events":{"click":"var title = app.noticeTitle.getValue();\nvar content = app.htmleditor1.getValue();\nif(title===null||title===''){\n  Wb.warn('{#tools_notice_prompt_msg3#}');\n  return;\n}\nif(content===null||content===''){\n  Wb.warn('{#tools_notice_prompt_msg4#}');\n  return;\n}\n// userStore.load();\nvar win = new Ext.window.Window(app._sendWin);\nwin.show();\napp.orgGrid.store.load();\n// changeSql = ' and 1=0';\n// Wb.load(postStore,{whereSql:changeSql});\n\n//判断微信服务信息是否配置  是否显示微信提醒\nvar agentId = '{#agentId#}';\nvar token = '{#token#}';\nvar corpId = '{#corpId#}';\nvar corpSecret = '{#corpSecret#}';\nvar aesKey = '{#aesKey#}';\nif(agentId!==null && agentId!==''&& token!==null && token!==''&& corpId!==null && corpId!==''&& corpSecret!==null && corpSecret!==''&&  aesKey!==null && aesKey!==''){\n  app.wxCheck.show();\n}else{\n  app.wxCheck.hide();\n}\n//判断邮件服务信息是否配置  是否显示邮件提醒\nvar mailHost = '{#mailHost#}';\nvar mailPort = '{#mailPort#}';\nvar mailUser = '{#mailUser#}';\nvar mailPassword = '{#mailPassword#}';\nif(mailHost!==null && mailHost!=='' && mailPort!==null && mailPort!=='' && mailUser!==null && mailUser!=='' && mailPassword!==null && mailPassword!==''){\n    app.EmailCheck.show();\n}else{\n    app.EmailCheck.hide();\n}\n//判断短信方法是否实现  显示短信提醒\nExt.Ajax.request({\n  url    : '{#contextPath#}'+'/platformAction.do?method=noteTest',\n  method :'post',\n  success: function(response,options){\n      var respText = Ext.JSON.decode(response.responseText);\n      if(respText.msg==\"true\"){\n        //显示短信提醒\n        app.noteCheck.show();\n      }else{\n        app.noteCheck.hide();\n      }\n  },\n  failure : function(response,options){\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_close#}","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.noticeWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"sendWinBtn"},"children":[{"configs":{"text":"{#tools_notice_sure#}","itemId":"rigthBtn","iconCls":"ok_icon"},"events":{"click":"if(app.selectGrid.store.getCount()===0){\n  Wb.warn(\"{#tools_notice_choose_send_object#}\");\n  return;\n}\nvar notice_id = app.noticeID.getValue();\nvar title = app.noticeTitle.getValue();\nvar content = app.htmleditor1.getValue();\nif(notice_id===null || notice_id===''){\n    var json2 = { \n                 title: title,\n                 content: content\n                };\n   Wb.request({\n     url:'m?xwl=xip/tools/notice/DATA/saveNotice_send',\n     params:json2,\n     success:function(response){\n        //保存子表\n        var notice = response.responseText;\n        var resultJson = Ext.JSON.decode(notice);\n        var notice_id = resultJson.k;\n        //获取\n        var dd = '';\n        for(var i=0;i<app.selectGrid.store.getCount();i++){\n          var user_id = app.selectGrid.store.getAt(i).get('ID');\n          var type = app.selectGrid.store.getAt(i).get('TYPE');\n          var org_id = app.selectGrid.store.getAt(i).get('ORG_ID');\n          var dept_id = app.selectGrid.store.getAt(i).get('DEPT_ID');\n          if(type==='D'){\n             user_id = app.selectGrid.store.getAt(i).get('ID')+'ORGID'+ org_id;\n          }\n          if(type==='P'){\n             user_id = app.selectGrid.store.getAt(i).get('ID')+'ORGID'+ org_id+'DEPTID'+dept_id;\n          }\n          dd = dd +','+\"ID\"+':'+\"\\\"\"+user_id+\"\\\"\"+','+\"TYPE\"+':'+\"\\\"\"+type+\"\\\"\";\n        }\n        var Params= '{'+dd.substring(1,dd.length)+'}';\n        //通知提示类型\n        var alertType = \"\";\n        if(app.wxCheck.checked){\n            alertType = '&'+'WX';\n        }\n        if(app.EmailCheck.checked){\n            alertType = alertType+'&'+'EMAIL';\n        }\n        if(app.noteCheck.checked){\n            alertType = alertType+'&'+'NOTE';\n        }\n        Ext.Msg.wait(\"{#tools_notice_sending_wait#}\");\n        //调用action中的方法\n        Ext.Ajax.request({\n          url    : '{#contextPath#}'+'/platformAction.do?method=sendNotice',\n          method :'post',\n          timeout:1000*60*10,\n          params : {\n                      notice_id : notice_id,\n                      arr       : Params,\n                      alertType : alertType\n                    },\n          success: function(response,options){\n              var respText = Ext.JSON.decode(response.responseText);\n              Ext.Msg.alert('',respText.msg);\n              app.grid1.store.load();\n              app.sendWin.close();\n              app.noticeWin.close();\n          },\n          failure : function(response,options){\n              Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_server_norepeat_fail#}');\n          }\n        });\n\n\n\n\n       \n     }\n   });\n\n}else{\n    var json = { \n                 notice_id : notice_id,\n                 title: title,\n                 content: content\n                };\n   Wb.request({\n     url:'m?xwl=xip/tools/notice/DATA/updateNotice_send',\n     params:json,\n     success:function(response){\n      //保存子表\n      var notice_id = app.noticeID.getValue();\n      //获取\n        var dd = '';\n        for(var i=0;i<app.selectGrid.store.getCount();i++){\n          var user_id = app.selectGrid.store.getAt(i).get('ID');\n          var type = app.selectGrid.store.getAt(i).get('TYPE');\n          var org_id = app.selectGrid.store.getAt(i).get('ORG_ID');\n          var dept_id = app.selectGrid.store.getAt(i).get('DEPT_ID');\n          if(type==='D'){\n             user_id = app.selectGrid.store.getAt(i).get('ID')+'ORGID'+ org_id;\n          }\n          if(type==='P'){\n             user_id = app.selectGrid.store.getAt(i).get('ID')+'ORGID'+ org_id+'DEPTID'+dept_id;\n          }\n          dd = dd +','+\"ID\"+':'+\"\\\"\"+user_id+\"\\\"\"+','+\"TYPE\"+':'+\"\\\"\"+type+\"\\\"\";\n        }\n        var Params= '{'+dd.substring(1,dd.length)+'}';\n        //通知提示类型\n        var alertType = \"\";\n        if(app.wxCheck.checked){\n            alertType = '&'+'WX';\n        }\n        if(app.EmailCheck.checked){\n            alertType = alertType+'&'+'EMAIL';\n        }\n        if(app.noteCheck.checked){\n            alertType = alertType+'&'+'NOTE';\n        }\n        Ext.Msg.wait(\"{#tools_notice_sending_wait#}\");\n        //调用action中的方法\n        Ext.Ajax.request({\n          url    : '{#contextPath#}'+'/platformAction.do?method=sendNotice',\n          method :'post',\n          params : {\n                      notice_id : notice_id,\n                      arr       : Params,\n                      alertType : alertType\n                    },\n          success: function(response,options){\n              var respText = Ext.JSON.decode(response.responseText);\n              Ext.Msg.alert('',respText.msg);\n              app.grid1.store.load();\n              app.sendWin.close();\n              app.noticeWin.close();\n          },\n          failure : function(response,options){\n              Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_server_norepeat_fail#}');\n          }\n        });\n\n\n\n       \n     }\n   });\n\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_cancel#}","itemId":"sendWincloseBtn","iconCls":"cancel_icon"},"events":{"click":"app.sendWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"folder"},{"configs":{"height":"380","width":"460","layout":"border","closeAction":"hide","dialog":"false","border":"false","itemId":"selectedUserWin","modal":"true"},"children":[{"configs":{"region":"center","height":"380","selType":"checkboxmodel","width":"460","itemId":"selectGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"ID","itemId":"ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_name#}","width":"250","dataIndex":"NAME","itemId":"NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_type#}","hidden":"true","dataIndex":"TYPE","itemId":"TYPE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_delete#}","itemId":"DELETE_COL","renderer":"var str = \"<a href=\\\"javascript:app.deleteUser();\\\"> 删除 <\/a>\";\nreturn str;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_org_id#}","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL_"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_department_id#}","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL_"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectedUserGrid"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"height":"530","width":"500","layout":"border","closeAction":"destroy","buttons":"app.sendWinBtn","buttonAlign":"center","dialog":"false","itemId":"sendWin","modal":"true"},"events":{"close":"app.selectGrid.store.removeAll();"},"children":[{"configs":{"region":"north","frame":"true","height":"'7%'","style":"border-width:0px","layout":"column","border":"false","itemId":"northPanel"},"children":[{"configs":{"labelAlign":"right","itemId":"wxCheck","fieldLabel":"{#tools_notice_weixin_remind#}"},"children":[],"expanded":false,"type":"check"},{"configs":{"labelAlign":"right","itemId":"EmailCheck","fieldLabel":"{#tools_notice_email_remind#}"},"children":[],"expanded":false,"type":"check"},{"configs":{"labelAlign":"right","itemId":"noteCheck","fieldLabel":"{#tools_notice_message_remind#}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","height":"'85%'","style":"border-width:0px","itemId":"centerTab"},"children":[{"configs":{"title":"{#tools_notice_org#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"orgPanel"},"children":[{"configs":{"region":"north","frame":"true","height":"'11%'","style":"border-width:0px","layout":"form","border":"false","itemId":"orgForm"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"50","labelAlign":"right","itemId":"orgName","fieldLabel":"{#tools_notice_org#}"},"events":{"specialkey":"app.orgGrid.store.load({params:{orgName:app.orgName.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_notice_query#}","itemId":"queryOrgBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.orgGrid.store.load({params:{orgName:app.orgName.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_reset#}","itemId":"resetOrgBtn","iconCls":"refresh_icon","x":"30"},"events":{"click":"app.orgName.setValue('');\napp.orgGrid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"FLAG"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"USER_ID_"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"form"},{"configs":{"region":"center","multiSelect":"false","selType":"checkboxmodel","border":"false","itemId":"orgGrid","simpleSelect":"true"},"events":{"selectionchange":"var flag = app.FLAG.getValue();\nvar row = app.orgGrid.getSelection();\nvar sm = app.orgGrid.getSelectionModel();\nvar records = sm.getSelection();\nif(flag=== null||flag=== ''){\n  \n}\nelse{\n  //app.orgGrid.store.isLoading()\n  if(row.length < flag && loadSta===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.USER_ID_.getValue().split(',');\n    for(var i=0 ;i< arrayid.length ;i++){\n        var aid = arrayid[i];\n        for(var v=0;v< row.length;v++){\n          var idN = records[v].get('ORG_ID');\n          if(aid=== idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k< app.selectGrid.store.getCount();k++){\n                  var  user_id3 = app.selectGrid.store.getAt(k).get('ID');\n                  if(aid === user_id3){\n                    app.selectGrid.store.removeAt(k);\n                  }\n               }\n       }\n    }\n   }\n}\napp.userCount();","tagEvents":"select:function(record, index, eOpts){\n   var row = app.orgGrid.getSelection();\n  var sm = app.orgGrid.getSelectionModel();\n  var records = sm.getSelection();\n  var len = app.selectGrid.store.getModifiedRecords().length;\n  var record = app.selectGrid.store.getModifiedRecords();\n  //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n  var arrid = '';\n  for(var v= 0;v< row.length;v++){\n    var idNu = records[v].get('ORG_ID');\n    arrid = arrid+','+idNu;\n  }\n  app.USER_ID_.setValue(arrid.substring(1,arrid.length));\n  //给SelectedUserWin中的STORE添加数据\n  if(row.length === 1){\n    var bl;\n    for(var i=0;i<len;i++){\n    var user_id = record[i].data.ID;\n    if(records[0].get('ORG_ID')=== user_id){\n        bl=1;\n        break;\n      }\n      else{\n        bl=0;\n      }\n    }\n    if(bl!==1){\n        var json = {\n                    ID: records[0].get('ORG_ID'),\n                    NAME: records[0].get('ORG_NAME'),\n                    TYPE: 'O'\n                   };\n       app.selectGrid.store.add(json);\n\n    }\n\n  }else{\n\n    var bl;\n    for(var i=0;i<len;i++){\n      var user_id = app.selectGrid.store.getAt(i).get('ID');\n      if(records[row.length-1].get('ORG_ID')=== user_id){\n        bl=1;\n        break;\n      }\n      else{\n        bl=0;\n      }\n    }\n    if(bl!==1){\n       var json={\n                 ID: records[row.length-1].get('ORG_ID'),\n                 NAME: records[row.length-1].get('ORG_NAME'),\n                 TYPE: 'O'\n                };\n       app.selectGrid.store.add(json);\n    }\n  }\n  app.FLAG.setValue(row.length);\n  app.userCount();\n}"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ORG_ID","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_org_name#}","dataIndex":"ORG_NAME","itemId":"ORG_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"25","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectOrg"},"events":{"load":"var arr = [];\nfor(var i=0;i< app.selectGrid.store.getCount();i++){\n  var uid = app.selectGrid.store.getAt(i).get('ID');\n  for(var j=0;j< app.orgGrid.store.getCount();j++){\n    if(uid === app.orgGrid.store.getAt(j).get('ORG_ID')){\n       arr.push(app.orgGrid.store.getAt(j));\n       break;\n    }  \n  }\n}\napp.orgGrid.getSelectionModel().select(arr);\nloadSta = false;","beforeload":"loadSta = true;"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#tools_notice_dept#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"deptPanel"},"children":[{"configs":{"region":"north","frame":"true","height":"'18%'","style":"border-width:0px","border":"false","itemId":"deptForm"},"children":[{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"labelWidth":"55","queryMode":"local","displayField":"NAME","width":"344","valueField":"CODE","emptyText":"{#tools_notice_choose_org#}","labelAlign":"right","itemId":"orgComboBox","fieldLabel":"{#tools_notice_org#}"},"events":{"select":"app.deptGrid.store.load({params:{ORG_ID:app.orgComboBox.getValue()}});"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectOrg_dept"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"USER_ID_1"},"children":[],"expanded":false,"type":"text"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"55","labelAlign":"right","itemId":"deptName","fieldLabel":"{#tools_notice_dept#}"},"events":{"specialkey":"app.deptGrid.store.load({params:{\n                     ORG_ID:app.orgComboBox.getValue(),\n                     deptName: app.deptName.getValue()}\n                     });\n"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_notice_query#}","itemId":"queryDeptBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.deptGrid.store.load({params:{\n                     ORG_ID:app.orgComboBox.getValue(),\n                     deptName: app.deptName.getValue()}\n                     });\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_reset#}","itemId":"resetDeptBtn","iconCls":"refresh_icon","x":"30"},"events":{"click":"app.deptName.setValue('');\napp.orgComboBox.clearValue();\napp.deptGrid.store.load({params:{\n                     ORG_ID:app.orgComboBox.getValue(),\n                     deptName: app.deptName.getValue()}\n                     });\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","selType":"checkboxmodel","border":"false","itemId":"deptGrid","simpleSelect":"true"},"events":{"tagEvents":"select:function(record, index, eOpts){    \n    var row = app.deptGrid.getSelection();\n    var sm = app.deptGrid.getSelectionModel();\n    var records = sm.getSelection();\n    var len = app.selectGrid.store.getModifiedRecords().length;\n    var record = app.selectGrid.store.getModifiedRecords();\n    //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n    var arrid = '';\n    for(var v= 0 ;v< row.length ;v++){\n      var idNu = records[v].get('DEPT_ID');\n      arrid = arrid+','+idNu;\n    }\n    app.USER_ID_1.setValue(arrid.substring(1,arrid.length));\n    //给SelectedUserWin中的STORE添加数据\n    if(row.length === 1){\n      var bl;\n      for(var i=0 ;i<len ;i++){\n      var user_id = record[i].data.ID;\n      if(records[0].get('DEPT_ID') === user_id){\n          bl = 1;\n          break;\n        }\n        else{\n          bl = 0;\n        }\n      }\n      if(bl!== 1){\n          var json = {\n                      ID: records[0].get('DEPT_ID'),\n                      NAME: records[0].get('DEPT_NAME'),\n                      TYPE: 'D',\n                      ORG_ID: app.orgComboBox.getValue() \n                     };\n          app.selectGrid.store.add(json);\n\n      }\n\n    }else{\n\n      var bl;\n      for(var i=0;i<len;i++){\n        var user_id = app.selectGrid.store.getAt(i).get('ID');\n        if(records[row.length-1].get('DEPT_ID')=== user_id){\n          bl = 1;\n          break;\n        }\n        else{\n          bl = 0;\n        }\n      }\n      if(bl!==1){\n         var json={\n                   ID: records[row.length-1].get('DEPT_ID'),\n                   NAME: records[row.length-1].get('DEPT_NAME'),\n                   TYPE: 'D',\n                   ORG_ID: app.orgComboBox.getValue() \n                  };\n         app.selectGrid.store.add(json);\n      }\n    }\n    app.FLAG.setValue(row.length);\n    app.userCount();\n}","selectionchange":"var flag = app.FLAG.getValue();\nvar row = app.deptGrid.getSelection();\nvar sm = app.deptGrid.getSelectionModel();\nvar records = sm.getSelection();\nif(flag=== null||flag=== ''){\n  \n}\nelse{\n  if(row.length < flag && loadStaD===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.USER_ID_1.getValue().split(',');\n    for(var i=0 ;i< arrayid.length ;i++){\n        var aid = arrayid[i];\n        for(var v=0 ;v< row.length ;v++){\n          var idN = records[v].get('DEPT_ID');\n          if(aid === idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k< app.selectGrid.store.getCount();k++){\n                  var  user_id3 = app.selectGrid.store.getAt(k).get('ID');\n                  if(aid === user_id3){\n                    app.selectGrid.store.removeAt(k);\n                  }\n              }\n        }\n    }\n   \n   }\n  \n}\n app.userCount();"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DEPT_ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_dept_name#}","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"25","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectDept"},"events":{"load":"var arr = [];\nfor(var i=0;i< app.selectGrid.store.getCount();i++){\n  var uid = app.selectGrid.store.getAt(i).get('ID');\n  for(var j=0;j< app.deptGrid.store.getCount();j++){\n    if(uid === app.deptGrid.store.getAt(j).get('DEPT_ID')){\n       arr.push(app.deptGrid.store.getAt(j));\n       break;\n    }  \n  }\n}\napp.deptGrid.getSelectionModel().select(arr);\nloadStaD = false;","beforeload":"loadStaD = true;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#tools_notice_post#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"postPanel"},"children":[{"configs":{"region":"north","frame":"true","height":"'26%'","style":"border-width:0px","border":"false","itemId":"postForm"},"children":[{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr_org"},"children":[{"configs":{"labelWidth":"55","queryMode":"local","displayField":"NAME","width":"344","valueField":"CODE","emptyText":"{#tools_notice_choose_org#}","labelAlign":"right","itemId":"orgComboBox11","fieldLabel":"{#tools_notice_org#}"},"events":{"select":"var dept_id = app.deptComboBox1.getValue();\nif(dept_id===null||dept_id===''){\n  //获取组织ID\n  var whereSql = app.orgComboBox11.getValue();\n  //加载部门combobox\n  app.deptComboBox1.store.load({params:{ORG_ID:whereSql}});\n  //加载postGrid\n  changeSql = ' and 1=0';\n  app.postGrid.store.load({params:{whereSql:changeSql}});\n}else{\n  var ORG_ID = app.orgComboBox11.getValue();\n  //加载部门combobox\n  app.deptComboBox1.store.load({params:{ORG_ID:whereSql}});\n  //加载postGrid\n  changeSql = ' and 1=0';\n  app.postGrid.store.load({params:{whereSql:changeSql}});\n  app.deptComboBox1.clearValue();\n}\n\n"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectOrg_post"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr_dept"},"children":[{"configs":{"labelWidth":"55","queryMode":"local","displayField":"DEPT_NAME","width":"344","valueField":"DEPT_ID","emptyText":"{#tools_notice_choose_dept#}","labelAlign":"right","itemId":"deptComboBox1","fieldLabel":"{#tools_notice_dept#}"},"events":{"select":"  var ORG_ID = app.orgComboBox11.getValue();\n  var whereSql = app.deptComboBox1.getValue();\n  changeSql = ' and t.ORG_ID = \\''+ORG_ID+'\\''+' and t.DEPT_ID =  \\''+whereSql+'\\'';\n  app.postGrid.store.load({params:{whereSql:changeSql}});"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectDept_post"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"USER_ID_11"},"children":[],"expanded":false,"type":"text"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"55","labelAlign":"right","itemId":"postName","fieldLabel":"{#tools_notice_post#}"},"events":{"specialkey":"var ORG_ID = app.orgComboBox11.getValue();\nvar whereSql = app.deptComboBox1.getValue();\nchangeSql = ' and t.ORG_ID = \\''+ORG_ID+'\\''+' and t.DEPT_ID =  \\''+whereSql+'\\'';\napp.postGrid.store.load({params:{whereSql:changeSql,postName:app.postName.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_notice_query#}","itemId":"queryPostBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"var ORG_ID = app.orgComboBox11.getValue();\nvar whereSql = app.deptComboBox1.getValue();\nchangeSql = ' and t.ORG_ID = \\''+ORG_ID+'\\''+' and t.DEPT_ID =  \\''+whereSql+'\\'';\napp.postGrid.store.load({params:{whereSql:changeSql,postName:app.postName.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_reset#}","itemId":"resetPostBtn","iconCls":"refresh_icon","x":"30"},"events":{"click":"app.postName.setValue('');\napp.orgComboBox11.clearValue();\napp.deptComboBox1.clearValue();\nvar ORG_ID = app.orgComboBox11.getValue();\nvar whereSql = app.deptComboBox1.getValue();\nchangeSql = ' and t.ORG_ID = \\''+ORG_ID+'\\''+' and t.DEPT_ID =  \\''+whereSql+'\\'';\napp.postGrid.store.load({params:{whereSql:changeSql,postName:app.postName.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","selType":"checkboxmodel","border":"false","itemId":"postGrid","simpleSelect":"true"},"events":{"tagEvents":"select:function(record, index, eOpts){\n  var row = app.postGrid.getSelection();\n  var sm = app.postGrid.getSelectionModel();\n  var records = sm.getSelection();\n  var len = app.selectGrid.store.getModifiedRecords().length;\n  var record = app.selectGrid.store.getModifiedRecords();\n  //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n  var arrid = '';\n  for(var v= 0;v< row.length;v++){\n    var idNu = records[v].get('POST_ID');\n    arrid = arrid+','+idNu;\n  }\n  app.USER_ID_11.setValue(arrid.substring(1,arrid.length));\n  //给SelectedUserWin中的STORE添加数据\n  if(row.length === 1){\n    var bl;\n    for(var i=0;i<len;i++){\n    var user_id = record[i].data.ID;\n    if(records[0].get('POST_ID')=== user_id){\n        bl=1;\n        break;\n      }\n      else{\n        bl=0;\n      }\n    }\n    if(bl!==1){\n        var json = {\n                    ID: records[0].get('POST_ID'),\n                    NAME: records[0].get('POST_NAME'),\n                    TYPE: 'P',\n                    ORG_ID: app.orgComboBox11.getValue(),\n                    DEPT_ID: app.deptComboBox1.getValue()\n                   };\n        app.selectGrid.store.add(json);\n\n    }\n\n  }else{\n\n    var bl;\n    for(var i=0;i<len;i++){\n      var user_id = app.selectGrid.store.getAt(i).get('ID');\n      if(records[row.length-1].get('POST_ID')=== user_id){\n        bl=1;\n        break;\n      }\n      else{\n        bl=0;\n      }\n    }\n    if(bl!==1){\n       var json={\n                 ID: records[row.length-1].get('POST_ID'),\n                 NAME: records[row.length-1].get('POST_NAME'),\n                 TYPE: 'P',\n                 ORG_ID: app.orgComboBox11.getValue(),\n                 DEPT_ID: app.deptComboBox1.getValue()\n                };\n       app.selectGrid.store.add(json);\n    }\n  }\n  app.FLAG.setValue(row.length);\n  app.userCount();;\n}","selectionchange":"var flag = app.FLAG.getValue();\nvar row = app.postGrid.getSelection();\nvar sm = app.postGrid.getSelectionModel();\nvar records = sm.getSelection();\nif(flag=== null||flag=== ''){\n  \n}\nelse{\n  if(row.length < flag && loadStaP===false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.USER_ID_11.getValue().split(',');\n    for(var i=0 ;i< arrayid.length ;i++){\n        var aid = arrayid[i];\n        for(var v=0 ;v< row.length ;v++){\n          var idN = records[v].get('POST_ID');\n          if(aid === idN){\n            abl=1;\n            break;\n          }else{\n            abl=0;\n          }\n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k< app.selectGrid.store.getCount();k++){\n                  var  user_id3 = app.selectGrid.store.getAt(k).get('ID');\n                  if(aid === user_id3){\n                    app.selectGrid.store.removeAt(k);\n                  }\n              }\n        }\n    }\n   \n   }\n  \n}\napp.userCount();"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"POST_ID","hidden":"true","dataIndex":"POST_ID","itemId":"POST_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_post_name#}","dataIndex":"POST_NAME","itemId":"POST_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"25","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectPost"},"events":{"load":"var arr = [];\nfor(var i=0;i< app.selectGrid.store.getCount();i++){\n  var uid = app.selectGrid.store.getAt(i).get('ID');\n  for(var j=0;j< app.postGrid.store.getCount();j++){\n    if(uid === app.postGrid.store.getAt(j).get('POST_ID')){\n       arr.push(app.postGrid.store.getAt(j));\n       break;\n    }  \n  }\n}\napp.postGrid.getSelectionModel().select(arr);\nloadStaP = false;","beforeload":"loadStaP = true ;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#tools_notice_user#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"userPanel"},"children":[{"configs":{"region":"north","frame":"true","height":"'34%'","style":"border-width:0px","border":"false","itemId":"userForm"},"children":[{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"org_tr"},"children":[{"configs":{"labelWidth":"55","queryMode":"local","displayField":"NAME","width":"344","valueField":"CODE","emptyText":"{#tools_notice_choose_org#}","labelAlign":"right","itemId":"orgComboBox_u","fieldLabel":"{#tools_notice_org#}"},"events":{"select":"//部门ID\nvar dept_id = app.deptComboBox_u.getValue();\nif(dept_id===null||dept_id===''){\n  //组织ID\n  var whereSql = app.orgComboBox_u.getValue();\n  changeSql = ' and b.ORG_ID = \\''+whereSql+'\\'';\n  //加载部门combobox 和userGrid\n  app.deptComboBox_u.store.load({params:{ORG_ID:whereSql}});\n  app.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\n  app.userGrid.store.load({params:{whereSql:changeSql}});\n}else{\n  //清空部门岗位combobox\n  app.deptComboBox_u.clearValue();\n  app.postComboBox_u.clearValue();\n  changeSql = ' and b.ORG_ID = \\''+ app.orgComboBox_u.getValue()+'\\'';\n  app.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\n  app.userGrid.store.load({params:{whereSql:changeSql}});\n  var ORG_ID = app.deptComboBox_u.getValue();\n  app.deptComboBox_u.store.load({params:{ORG_ID:ORG_ID}});\n}\n\n"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectOrg_user"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"dept_tr"},"children":[{"configs":{"labelWidth":"55","queryMode":"local","displayField":"DEPT_NAME","width":"344","valueField":"DEPT_ID","emptyText":"{#tools_notice_choose_dept#}","labelAlign":"right","itemId":"deptComboBox_u","fieldLabel":"{#tools_notice_dept#}"},"events":{"select":"var ORG_ID = app.orgComboBox_u.getValue();\nvar whereSql = app.deptComboBox_u.getValue();\nvar postChangeSql = ' and t.ORG_ID = \\''+ORG_ID+'\\''+' and t.DEPT_ID =  \\''+whereSql+'\\'';\n//加载岗位combobox\napp.postComboBox_u.store.load({params:{whereSql:postChangeSql}});\napp.postComboBox_u.clearValue();\nvar changeSql = ' and b.ORG_ID = \\''+ORG_ID+'\\''+' and b.DEPT_ID =  \\''+whereSql+'\\'';\n//userGrid加载\napp.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\napp.userGrid.store.load({params:{whereSql:changeSql}});"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectDept_user"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"post_tr"},"children":[{"configs":{"labelWidth":"55","queryMode":"local","displayField":"POST_NAME","width":"344","valueField":"POST_ID","emptyText":"{#tools_notice_choose_post#}","labelAlign":"right","itemId":"postComboBox_u","fieldLabel":"{#tools_notice_post#}"},"events":{"select":"var ORG_ID = app.orgComboBox_u.getValue();\nvar whereSql = app.deptComboBox_u.getValue();\nchangeSql = ' and b.ORG_ID = \\''+ORG_ID+'\\''+' and b.DEPT_ID =  \\''+whereSql+'\\''+' and b.POST_ID =  \\''+app.postComboBox_u.getValue()+'\\'';\napp.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\napp.userGrid.store.load({params:{whereSql:changeSql}});"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectPost_user"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"tr"},"children":[{"configs":{"labelWidth":"55","labelAlign":"right","itemId":"userName","fieldLabel":"{#tools_notice_user#}"},"events":{"specialkey":"var ORG_ID = app.orgComboBox_u.getValue();\nvar whereSql = app.deptComboBox_u.getValue();\nvar post_id = app.postComboBox_u.getValue();\nvar changeSql;\nif(!Ext.isEmpty(ORG_ID)){\n  changeSql = ' and b.ORG_ID = \\''+ORG_ID+'\\'';\n  app.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\n}\nif(!Ext.isEmpty(whereSql)){\n  changeSql = changeSql +' and b.DEPT_ID =  \\''+whereSql+'\\'';\n  app.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\n}\nif(!Ext.isEmpty(post_id)){\n  changeSql = changeSql +' and b.POST_ID =  \\''+ post_id +'\\'';\n  app.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser_haveOrg';\n}\napp.userGrid.store.load({params:{whereSql:changeSql,userName:app.userName.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_notice_query#}","itemId":"queryUserBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"var ORG_ID = app.orgComboBox_u.getValue();\nvar whereSql = app.deptComboBox_u.getValue();\nvar post_id = app.postComboBox_u.getValue();\nvar changeSql;\nif(!Ext.isEmpty(ORG_ID)){\n  changeSql = ' and b.ORG_ID = \\''+ORG_ID+'\\'';\n}\nif(!Ext.isEmpty(whereSql)){\n  changeSql = changeSql +' and b.DEPT_ID =  \\''+whereSql+'\\'';\n}\nif(!Ext.isEmpty(post_id)){\n  changeSql = changeSql +' and b.POST_ID =  \\''+ post_id +'\\'';\n} \napp.userGrid.store.load({params:{whereSql:changeSql,userName:app.userName.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_reset#}","itemId":"resetUserBtn","iconCls":"refresh_icon","x":"30"},"events":{"click":"app.userName.setValue('');\napp.orgComboBox_u.clearValue();\napp.deptComboBox_u.clearValue();\napp.postComboBox_u.clearValue();\nvar ORG_ID = app.orgComboBox_u.getValue();\nvar whereSql = app.deptComboBox_u.getValue();\nvar post_id = app.postComboBox_u.getValue();\nvar changeSql;\n// if(!Ext.isEmpty(ORG_ID)){\n//   changeSql = ' and b.ORG_ID = \\''+ORG_ID+'\\'';\n// }\n// if(!Ext.isEmpty(whereSql)){\n//   changeSql = changeSql +' and b.DEPT_ID =  \\''+whereSql+'\\'';\n// }\n// if(!Ext.isEmpty(post_id)){\n//   changeSql = changeSql +' and b.POST_ID =  \\''+ post_id +'\\'';\n// }\napp.userGrid.store.getProxy().url = 'm?xwl=xip/tools/notice/DATA/selectUser';\napp.userGrid.store.load({params:{whereSql:changeSql,userName:app.userName.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"USER_ID_111"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","selType":"checkboxmodel","border":"false","itemId":"userGrid","simpleSelect":"true"},"events":{"tagEvents":"select:function(record, index, eOpts){   \n    var row = app.userGrid.getSelection();\n    var sm = app.userGrid.getSelectionModel();\n    var records = sm.getSelection();\n    var len = app.selectGrid.store.getModifiedRecords().length;\n    var record = app.selectGrid.store.getModifiedRecords();\n    //获取当前页中已勾选的ID，拼接成字符串放到一个隐藏的文本框中\n    var arrid = '';\n    for(var v= 0;v< row.length;v++){\n      var idNu = records[v].get('USER_ID');\n      arrid = arrid+','+idNu;\n    }\n    app.USER_ID_111.setValue(arrid.substring(1,arrid.length));\n    //给SelectedUserWin中的STORE添加数据\n    if(row.length === 1){\n      var bl;\n      for(var i=0;i<len;i++){\n      var user_id = record[i].data.ID;\n      if(records[0].get('USER_ID')=== user_id){\n          bl=1;\n          break;\n        }\n        else{\n          bl=0;\n        }\n      }\n      if(bl!==1){\n          var json = {\n                      ID: records[0].get('USER_ID'),\n                      NAME: records[0].get('USER_NAME'),\n                      TYPE: 'U'\n                     };\n           app.selectGrid.store.add(json);\n\n      }\n\n    }else{\n\n      var bl;\n      for(var i=0;i<len;i++){\n        var user_id =  app.selectGrid.store.getAt(i).get('ID');\n        if(records[row.length-1].get('USER_ID')=== user_id){\n          bl=1;\n          break;\n        }\n        else{\n          bl=0;\n        }\n      }\n      if(bl!==1){\n         var json={\n                   ID: records[row.length-1].get('USER_ID'),\n                   NAME: records[row.length-1].get('USER_NAME'),\n                   TYPE: 'U'\n                  };\n          app.selectGrid.store.add(json);\n      }\n    }\n    app.FLAG.setValue(row.length);\n    app.userCount();\n}","selectionchange":"var flag = app.FLAG.getValue();\nvar row = app.userGrid.getSelection();\nvar sm = app.userGrid.getSelectionModel();\nvar records = sm.getSelection();\nif(flag=== null||flag=== ''){\n  \n}\nelse{\n  if(row.length < flag && loadStaU === false){\n    //获取当前页中已勾选的ID(取消勾选时)\n    var abl;\n    var arrayid = app.USER_ID_111.getValue().split(',');\n    for(var i=0;i< arrayid.length;i++){\n        var aid = arrayid[i];\n        for(var v=0;v< row.length;v++){\n          var idN = records[v].get('USER_ID');\n          if(aid === idN){\n            abl = 1;\n            break;\n          }else{\n            abl = 0;\n          }\n        }\n        if(abl!==1){\n          //在弹出的WIN中删掉ID为该ID的数据\n               for(var k=0;k< app.selectGrid.store.getCount();k++){\n                  var  user_id3 = app.selectGrid.store.getAt(k).get('ID');\n                  if(aid === user_id3){\n                    app.selectGrid.store.removeAt(k);\n                  }\n              }\n        }\n    }\n   \n   }\n  \n}\n app.userCount();"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USER_ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_user_name#}","width":"150","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_emp_name#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectUser"},"events":{"load":"var arr = [];\nfor(var i=0;i< app.selectGrid.store.getCount();i++){\n  var uid = app.selectGrid.store.getAt(i).get('ID');\n  for(var j=0;j< app.userGrid.store.getCount();j++){\n    if(uid === app.userGrid.store.getAt(j).get('USER_ID')){\n       arr.push(app.userGrid.store.getAt(j));\n       break;\n    }  \n  }\n}\napp.userGrid.getSelectionModel().select(arr);\nloadStaU = false;","beforeload":"loadStaU = true;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"tab"},{"configs":{"region":"south","height":"'7%'","style":"border-width:0px","layout":"border","itemId":"southPanel"},"children":[{"configs":{"region":"west","frame":"true","style":"border-width:0px","width":"'46%'","border":"false","itemId":"westPanel"},"children":[],"expanded":false,"type":"panel"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","border":"false","itemId":"centerPanel"},"children":[{"configs":{"style":"border-width:0px","html":"<!DOCTYPE html>\n<html>\n<head>\n<\/head>\n<body>\n<a href=\"javascript:void(0)\"  onclick = \"app.showWin();\"  style=\"text-decoration:none;color:black;font-weight:bold;\" id=\"users\" >已选<\/a>\n  <\/body>\n<\/html>","itemId":"selectedLable"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"title":"{#tools_notice_add#}","height":"500","width":"700","layout":"border","resizable":"false","closeAction":"hide","buttons":"app.noticeWinBtn","buttonAlign":"center","dialog":"false","itemId":"noticeWin","modal":"true"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px","bodyCls":"my-panel-no-border","layout":"form","border":"false","itemId":"panel1"},"children":[{"configs":{"frame":"true","height":"10","bodyCls":"my-panel-no-border","hidden":"true","border":"false","itemId":"panel_blank"},"children":[],"expanded":false,"type":"panel"},{"configs":{"height":"35","frame":"true","style":"border-width:0px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"noticePanel"},"children":[{"configs":{"labelWidth":"70","width":"590","labelAlign":"right","itemId":"noticeTitle","fieldLabel":"{#tools_notice_notice_title#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_notice_enclosure#}","width":"70","textAlign":"center","itemId":"attBtn","x":"12"},"events":{"click":"var notice_id = app.noticeID.getValue();\nif(notice_id===''||notice_id===null){\n  Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_save_notice_first#}');\n}else{\n  try{\n     var record = app.grid1.getSelectionModel().getSelection();\n     if(record[0].get('ATTRIBUTE1')==='Y'){\n        showAttachmentManager('{#XIP.userId#}',notice_id,'','NOTICE','','N','N','N');\n     }else{\n        showAttachmentManager('{#XIP.userId#}',notice_id,'','NOTICE','','Y','Y','Y');\n  \n     }\n  }catch(e){\n    showAttachmentManager('{#XIP.userId#}',notice_id,'','NOTICE','','Y','Y','Y');\n  }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"noticeID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#tools_notice_text#}","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"fieldset1"},"children":[{"configs":{"height":"360","itemId":"htmleditor1"},"children":[],"expanded":false,"type":"htmleditor"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#tools_notice_query_condition#}","style":"padding-top:8px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelAlign":"right","itemId":"noticeTitle1","fieldLabel":"{#tools_notice_notice_title#}"},"events":{"specialkey":"app.grid1.store.load({params:{noticeTitle1:app.noticeTitle1.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_notice_query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"15"},"events":{"click":"app.grid1.store.load({params:{noticeTitle1:app.noticeTitle1.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_notice_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"30"},"events":{"click":"app.noticeTitle1.setValue('');\napp.grid1.store.load({params:{noticeTitle1:app.noticeTitle1.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"NOTICE_ID","hidden":"true","dataIndex":"NOTICE_ID","itemId":"NOTICE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_notice_title#}","width":"400","dataIndex":"NOTICE_TITLE","itemId":"NOTICE_TITLE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_text#}","hidden":"true","dataIndex":"NOTICE_CONTENT","itemId":"NOTICE_CONTENT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_notice_send_status#}","align":"center","dataIndex":"ATTRIBUTE1","itemId":"ATTRIBUTE1_COL","renderer":"if(value === \"Y\"){\n  return \"<font color='green'>\"+'{#tools_notice_already_send#}'+\"<\/font>\";\n}else{\n  return \"<font color='red'>\"+'{#tools_notice_no_send#}'+\"<\/font>\";\n}"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/notice/DATA/selectNoticeList"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_notice_add#}","itemId":"addBtn","iconCls":"record_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._noticeWin);\nwin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_notice_browse#}","itemId":"editBtn","iconCls":"zoom_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length!==1){\n  Wb.warning('{#tools_notice_please_select_record#}');\n  return;\n}\nvar status = rows[0].get('ATTRIBUTE1');\nif(status=='N'){\n  //可以编辑发送公告\n  var win = new Ext.window.Window(app._noticeWin);\n  win.show();\n  win.setTitle('{#tools_notice_edit_notice#}');\n  app.noticeID.setValue(rows[0].get('NOTICE_ID'));\n  app.noticeTitle.setValue(rows[0].get('NOTICE_TITLE'));\n  app.htmleditor1.setValue(rows[0].get('NOTICE_CONTENT'));\n  app.sendBtn.show();\n  app.saveBtn.show();\n  \n}else{\n    //可以查看\n   var win = new Ext.window.Window(app._noticeWin);\n   win.show();\n   win.setTitle('{#tools_notice_seek_notice#}');\n   app.noticeID.setValue(rows[0].get('NOTICE_ID'));\n   app.noticeTitle.setValue(rows[0].get('NOTICE_TITLE'));\n   app.htmleditor1.setValue(rows[0].get('NOTICE_CONTENT'));\n   app.sendBtn.hide();\n   app.saveBtn.hide();\n   \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_notice_revoke#}","itemId":"revokeBtn","iconCls":"minus_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length!==1){\n  Wb.warn('{#tools_notice_please_select_record#}');\n  return;\n}\nvar notice_id = rows[0].get('NOTICE_ID'); \nvar status = rows[0].get('ATTRIBUTE1'); \nif(status==='Y'){\n  Ext.Msg.confirm('{#tools_notice_prompt#}','{#tools_notice_sure_revoke_notice#}',function(a){\n    if(a=='yes'){\n       var json ={ NOTICE_ID:notice_id };\n        Wb.request({\n         url :'m?xwl=xip/tools/notice/DATA/deleteNotice',\n         params: json,\n         success: function(response){\n           Ext.Msg.alert('{#tools_notice_prompt#}','{#tools_notice_revoke_success#}');\n           app.grid1.store.load();\n         }\n\n       });\n    }\n  });\n}else{\n   Wb.warn('{#tools_notice_no_send_not_revoke#}');\n    return;\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}