{"inframe":false,"title":"租户管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var ctxPath = request.getContextPath() ;\nrequest.setAttribute(\"contextPath\",ctxPath);\n//---------------------判断是否启用redis----------------\nvar isRedis=com.xzsoft.xip.platform.util.PlatformUtil.getUseRedis();\nrequest.setAttribute(\"isRedis\",isRedis);\nvar isTenant=com.xzsoft.xip.platform.util.PlatformUtil.getXipConfigVal(\"xip.useMultitenant\");\nrequest.setAttribute(\"isTenant\",isTenant);\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);\n\n\n","loginRequired":"false","jsLinks":"[\"xip/js/xip-debug.js\"]","serverScript":"//三方语言,引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xip/tools/tenant/tenant');","itemId":"module"},"events":{"initialize":"if('{#isTenant#}'=='false' || '{#isRedis#}' == \"false\"){\n\nExt.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_prompt_msg1#}');\n  return;\n}\n\nfunction getuuid() {\n var s = [];\n var hexDigits = \"0123456789abcdef\";\n for (var i = 0; i < 36; i++) {\n s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n }\n s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n s[8] = s[13] = s[18] = s[23] = \"-\";\n\nvar uuid = s.join(\"\");\n return uuid;\n}"},"children":[{"configs":{"itemId":"appstore","url":"m?xwl=xip/tools/tenant/data/getApps"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"Setupstore","url":"m?xwl=xip/tools/tenant/data/selectIsSetup"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"Winbtns"},"children":[{"configs":{"text":"{#tools_tenant_save#}","itemId":"saveWin","iconCls":"save_icon"},"events":{"click":"if(!app.form.getForm().isValid()){\n  Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_prompt_msg2#}');\n  return false;\n}\n\nvar _TENANT_ID = app.TENANT_ID.getValue();\nvar _DOMAIN = app.DOMAIN.getValue();\nvar  _DS_NAME = app.DS_NAME.getValue();\nvar  _APP_NAME = app.APP_NAME.getValue();\nvar  _CAS_SERVER = app.CAS_SERVER.getValue();\nvar  _CAS_CLIENT = app.CAS_CLIENT.getValue();\nvar  _ENABLE_FLAG = app.ENABLE_FLAG.getValue();\n\nvar  _WX_CORPID = app.WX_CORPID.getValue();\nvar  _WX_CORPSECRET = app.WX_CORPSECRET.getValue();\nvar  _WX_AESKEY = app.WX_AESKEY.getValue();\nvar  _WX_AGENTID = app.WX_AGENTID.getValue();\nvar  _WX_TOKEN = app.WX_TOKEN.getValue();\n\n\nvar urlExp= /^(http|ftp|https):\\/\\/[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%&amp;/~\\+#])?$/;\n    \nif(!Ext.isEmpty(_CAS_SERVER)){\n  if(!urlExp.test(_CAS_SERVER)){\n    Wb.warn('{#tools_tenant_cas_server_illgal#}');\n    return;\n  }\n}\nif(!Ext.isEmpty(_CAS_CLIENT)){\n  if(!urlExp.test(_CAS_CLIENT)){\n    Wb.warn('{#tools_tenant_project_url_illgal#}');\n    return;\n  }\n}\n\nvar json = {\n  TENANT_ID:'',\n  DOMAIN:_DOMAIN,\n  DS_NAME:_DS_NAME,\n  APP_NAME:_APP_NAME,\n  CAS_SERVER:_CAS_SERVER,\n  CAS_CLIENT:_CAS_CLIENT,\n  ENABLE_FLAG:_ENABLE_FLAG,\n \n  WX_CORPID:_WX_CORPID,\n  WX_CORPSECRET:_WX_CORPSECRET,\n  WX_AESKEY:_WX_AESKEY,\n  WX_AGENTID:_WX_AGENTID,\n  WX_TOKEN:_WX_TOKEN\n};\n\nif(_TENANT_ID===''){//新增\n  json.TENANT_ID = getuuid(); \n   app.TENANT_ID.setValue(json.TENANT_ID);\n        Wb.request({\n           url: 'm?xwl=xip/tools/tenant/data/insert', \n           params: json,\n           success: function() {\n           Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_save_success#}');\n           app.win.setTitle('{#tools_tenant_edit_node#}');\n           app.grid.store.reload();\n            Ext.Ajax.request({\n              url : '{#contextPath#}' + '/TenantAction.do?method=CommonRedisHashMap',\n              method : 'post',\n              success : function(response, options) {\n              }\n            }); \n           }\n        });\n}else{//更新\n\n  json.TENANT_ID = _TENANT_ID;\n Wb.request({\n           url: 'm?xwl=xip/tools/tenant/data/update', \n           params: json,\n           success: function() {\n            Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_save_success#}');\n            Ext.Ajax.request({\n              url : '{#contextPath#}' + '/TenantAction.do?method=CommonRedisHashMap',\n              method : 'post',\n              success : function(response, options) {\n               \n              }\n            }); \n           app.grid.store.reload();\n           }\n        });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_tenant_save_next#}","itemId":"savenextWin"},"events":{"click":"if(!app.form.getForm().isValid()){\n  Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_prompt_msg2#}');\n  return false;\n}\n\nvar _TENANT_ID = app.TENANT_ID.getValue();\nvar _DOMAIN = app.DOMAIN.getValue();\nvar  _DS_NAME = app.DS_NAME.getValue();\nvar  _APP_NAME = app.APP_NAME.getValue();\nvar  _CAS_SERVER = app.CAS_SERVER.getValue();\nvar  _CAS_CLIENT = app.CAS_CLIENT.getValue();\nvar  _ENABLE_FLAG = app.ENABLE_FLAG.getValue();\n\nvar  _WX_CORPID = app.WX_CORPID.getValue();\nvar  _WX_CORPSECRET = app.WX_CORPSECRET.getValue();\nvar  _WX_AESKEY = app.WX_AESKEY.getValue();\nvar  _WX_AGENTID = app.WX_AGENTID.getValue();\nvar  _WX_TOKEN = app.WX_TOKEN.getValue();\n\nvar urlExp= /^(http|ftp|https):\\/\\/[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%&amp;/~\\+#])?$/;\n    \nif(!Ext.isEmpty(_CAS_SERVER)){\n  if(!urlExp.test(_CAS_SERVER)){\n    Wb.warn('{#tools_tenant_cas_server_illgal#}');\n    return;\n  }\n}\nif(!Ext.isEmpty(_CAS_CLIENT)){\n  if(!urlExp.test(_CAS_CLIENT)){\n    Wb.warn('{#tools_tenant_project_url_illgal#}');\n    return;\n  }\n}\nvar json = {\n  TENANT_ID:'',\n  DOMAIN:_DOMAIN,\n  DS_NAME:_DS_NAME,\n  APP_NAME:_APP_NAME,\n  CAS_SERVER:_CAS_SERVER,\n  CAS_CLIENT:_CAS_CLIENT,\n  ENABLE_FLAG:_ENABLE_FLAG,\n \n  WX_CORPID:_WX_CORPID,\n  WX_CORPSECRET:_WX_CORPSECRET,\n  WX_AESKEY:_WX_AESKEY,\n  WX_AGENTID:_WX_AGENTID,\n  WX_TOKEN:_WX_TOKEN\n};\n\nif(_TENANT_ID===''){//新增\n  json.TENANT_ID = getuuid(); \n   app.TENANT_ID.setValue(json.TENANT_ID);\n        Wb.request({\n           url: 'm?xwl=xip/tools/tenant/data/insert', \n           params: json,\n           success: function() {\n           app.form.getForm().reset();\n           app.TENANT_ID.setValue('');\n           Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_save_success#}');\n           app.win.setTitle('{#tools_tenant_add#}');\n           app.grid.store.reload();\n           }\n        });\n}else{//更新\n\n  json.TENANT_ID = _TENANT_ID;\n Wb.request({\n           url: 'm?xwl=xip/tools/tenant/data/update', \n           params: json,\n           success: function() {\n           app.form.getForm().reset();\n           app.TENANT_ID.setValue('');\n           Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_save_success#}');\n           app.win.setTitle('{#tools_tenant_add#}');\n           app.grid.store.reload();\n           }\n        });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_tenant_close#}","itemId":"closeWin","iconCls":"cancel_icon"},"events":{"click":"app.win.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"pwdWinBtn"},"children":[{"configs":{"text":"{#tools_tenant_sure#}","itemId":"pwdBtnSave","iconCls":"ok_icon"},"events":{"click":"/*------修改用户密码------*/\nvar userId = app.userId11.getValue();  /*---用户ID---*/\nvar modifyPwd = app.newPwd.getValue();    /*---新密码---*/\nvar conPwd = app.confirmPwd.getValue();  /*---确认密码---*/\nvar dsname =app.DS_NAME_HIDE.getValue(); /*---jndi数据源---*/\nif(modifyPwd === null || modifyPwd === \"\"){\n  Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_set_new_password#}\") ;\n  return false ;\n}\nif(conPwd === null || conPwd === \"\"){\n  Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_sure_new_password#}\") ;\n  return false ;\n}\nif(modifyPwd!==conPwd){\n  Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_password_diff#}\") ;\n  app.confirmPwd.setValue('');\n  return false ;\n}\n\nmodifyPwd = Xip.getMD5(modifyPwd);\n/**------执行Update操作------*/\n\n\nvar json = {newPwd:modifyPwd,uerid:userId,DS_NAME:dsname};  \nWb.request({\n  url: 'm?xwl=xip/tools/tenant/data/ModifyPasswoord',\n  params: json,\n  success: function(response) {\n    Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_edit_password_success#}\");\n    app.grid1.store.reload();\n    app.pwdwin.hide();\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_tenant_close#}","itemId":"pwdBtnCancel","iconCls":"cancel_icon"},"events":{"click":"app.pwdwin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"upWinBtn"},"children":[{"configs":{"text":"{#tools_tenant_sure#}","itemId":"upBtnSave","iconCls":"ok_icon"},"events":{"click":"// 获取应用编码\nvar _appCode = app.appCode.getValue() ;\nif(_appCode===\"\" || _appCode === null || _appCode==\"undefined\"){\n  Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_choose_app_info#}\");\n  return false ;\n}\n\n// 获取当前版本号\nvar _currentVer = app.currentVer.getValue() ;\nif(_currentVer===\"\" || _currentVer===null || _currentVer==\"undefined\"){\n  Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_version_not_null#}\");\n  return false ;\n}\t\t\n// 获取最新版本号\nvar _lastedVer = app.lastedVer.getValue() ;\nif(_lastedVer===\"\" || _lastedVer===null || _lastedVer==\"undefined\"){\n  Ext.Msg.alert(\"{#tools_tenant_prompt#}\",\"{#tools_tenant_new_version_not_null#}\");\n  return false ;\n}\nExt.MessageBox.confirm('{#tools_tenant_prompt#}','{#tools_tenant_sure_excute_update#}',function(a){\n  if(a==\"yes\"){\n    /*------租户升级信息------*/\n    var _appId = app.appId.getValue();  /*---ID---*/\n    var _appCode = app.appCode.getValue();    /*---code---*/\n    var _currentVer = app.currentVer.getValue();  /*---当前版本---*/\n    var _lastedVer =app.lastedVer.getValue(); /*---最新版本---*/\n    var _tenantid=app.tenantidup.getValue();\n    var _dsname=app.Dsnameup.getValue();\n    var msg = Ext.MessageBox.show({\n      title :\t'{#tools_tenant_please_wait#}',\n      msg   :  '{#tools_tenant_submiting#}',\n      width :  240,\n      wait  : true,\n      progress : true,\n      closable : false\n    });\n    Ext.Ajax.request({\n      url  : '{#contextPath#}'+'/TenantAction.do?method=TenantUpdate',\n      params\t: { \n        'dsname'      : _dsname,\n        'tenantid' :   _tenantid,\n        'currentVer'  : _currentVer,\n        'lastedVer'\t:\t_lastedVer,\n        'appId'\t\t:\t_appId,\n        'appCode'\t\t:\t_appCode,\n        'chkDDL'\t\t:\t'1',\n        'chkCRUD'\t\t:\t'1',\n        'chkInitData'\t:\t'1',\n        'chkDiffData'\t:\t'1',\n        'chkWB'\t\t\t:\t'1'  },\n      method  : 'post',\n      timeout : 3600 * 36 * 36,\n      success : function(response, options) {\n        \n        msg.hide();\n        var response1 = Ext.JSON.decode(response.responseText);\n        Ext.Msg.alert(\"{#tools_tenant_prompt#}\",response1.msg) ;\n      },\n      failure : function(reponse, options) {\n        msg.hide();\n        var response = Ext.JSON.decode(response.responseText);\n        Ext.Msg.alert(\"{#tools_tenant_prompt#}\", response.msg);\n      }\n    });\t\n  }else {\n    return false;\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_tenant_close#}","itemId":"upBtnCancel","iconCls":"cancel_icon"},"events":{"click":"app.upwin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"height":"380","layout":"fit","width":"600","closeAction":"hide","buttons":"app.Winbtns","buttonAlign":"center","dialog":"false","itemId":"win","modal":"true"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"anchor","bodyPadding":"padding: 10px 10px 5px 5px","border":"false","itemId":"form"},"children":[{"configs":{"hidden":"true","itemId":"TENANT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","width":"260","value":"Y","labelAlign":"right","pickList":"[['mysql','mysql'],['oracle','oracle']]","itemId":"DB_TYPE","forceSelection":"true","fieldLabel":"{#tools_tenant_db_type#}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"anchor:'100%'","title":"{#tools_tenant_tenant_info#}","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","width":"260","labelAlign":"right","itemId":"DOMAIN","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_domain#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","width":"260","labelAlign":"right","itemId":"DS_NAME","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_db_source_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel11"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","width":"260","labelAlign":"right","itemId":"APP_NAME","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_system_name#}"},"events":{"beforerender":"  "},"children":[],"expanded":true,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","width":"260","value":"Y","labelAlign":"right","pickList":"[['Y','{#tools_tenant_isOpen#}'],['N','{#tools_tenant_isClose#}']]","itemId":"ENABLE_FLAG","forceSelection":"true","fieldLabel":"{#tools_tenant_enable#}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel111"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","width":"520","labelAlign":"right","itemId":"CAS_SERVER","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_cas_server#}"},"events":{"afterrender":"var _tip='';\n_tip = '<font color=\"red\">格式示例:<\/br>http://www.xzsoft.cc <\/br> http://localhost<\/br> http://192.168.0.1 <\/br> http://xzsoft.cc'; \nExt.QuickTips.init();\nExt.QuickTips.register({\ntarget : this.el,  \ntext : _tip});","beforerender":"  "},"children":[],"expanded":true,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px;padding-bottom:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel1111"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","width":"520","labelAlign":"right","itemId":"CAS_CLIENT","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_project_url#}"},"events":{"afterrender":"var _tip='';\n_tip = '<font color=\"red\">格式示例:<\/br>http://www.xzsoft.cc <\/br> http://localhost<\/br> http://192.168.0.1 <\/br> http://xzsoft.cc'; \nExt.QuickTips.init();\nExt.QuickTips.register({\ntarget : this.el,  \ntext : _tip});"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"tagConfigs":"anchor:'100%'","title":"{#tools_tenant_weixin_info#}","itemId":"fieldset2"},"children":[{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel11"},"children":[{"configs":{"labelWidth":"100","width":"260","labelAlign":"right","itemId":"WX_CORPID","fieldLabel":"{#tools_tenant_weinxin_id#}"},"events":{"beforerender":"  "},"children":[],"expanded":true,"type":"text"},{"configs":{"labelWidth":"100","maxLength":"2","minValue":"0","width":"260","value":"0","labelAlign":"right","itemId":"WX_AGENTID","fieldLabel":"{#tools_tenant_app_id#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel11111"},"children":[{"configs":{"labelWidth":"100","width":"520","labelAlign":"right","itemId":"WX_CORPSECRET","fieldLabel":"{#tools_tenant_weinxin_password#}"},"events":{"beforerender":"  "},"children":[],"expanded":true,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel111"},"children":[{"configs":{"labelWidth":"100","width":"520","labelAlign":"right","itemId":"WX_TOKEN","fieldLabel":"{#tools_tenant_back_token#}"},"events":{"beforerender":"  "},"children":[],"expanded":true,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px;padding-bottom:6px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel1111"},"children":[{"configs":{"labelWidth":"100","width":"520","labelAlign":"right","itemId":"WX_AESKEY","fieldLabel":"{#tools_tenant_back_ase_password#}"},"events":{"beforerender":"  "},"children":[],"expanded":true,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"height":"380","layout":"fit","width":"600","closeAction":"hide","buttonAlign":"center","dialog":"false","itemId":"win1","modal":"true"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_edit_password#}","itemId":"updatepw","iconCls":"key_icon"},"events":{"click":"var win = new Ext.window.Window(app._pwdwin);\nvar sm = app.grid1.getSelectionModel();\nif(!sm.hasSelection()){\n  Ext.MessageBox.alert('{#tools_tenant_prompt#}','{#tools_tenant_choose_user#}');\n  return false;\n}\nvar rows = sm.getSelection();\nvar ids = '';\nExt.each(rows,function(a){\n  ids += \"'\"+a.data.USER_ID+\"',\";\n});\nids = ids.substring(0,ids.length-1);\napp.userId11.setValue(ids);\nwin.show();\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"hidden":"true","itemId":"DS_NAME_HIDE"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xip/tools/tenant/data/select1"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#tools_tenant_rowNum#}","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_user_name#}","dataIndex":"USER_NAME","itemId":"USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_emp_name#}","width":"220","dataIndex":"EMP_NAME","itemId":"EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_emp_code#}","dataIndex":"EMP_CODE","itemId":"EMP_CODE","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#tools_tenant_password_reset#}","height":"200","layout":"fit","width":"380","closeAction":"hide","buttons":"app.pwdWinBtn","buttonAlign":"center","dialog":"false","itemId":"pwdwin","modal":"true"},"children":[{"configs":{"bodyStyle":"padding: 30px 0px 0px 20px","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"pwdform"},"children":[{"configs":{"hidden":"true","itemId":"userId11"},"children":[],"expanded":false,"type":"text"},{"configs":{"frame":"true","style":"border-width:0px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"100","maxLength":"10","allowBlank":"false","minLength":"6","inputType":"password","labelAlign":"right","itemId":"newPwd","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_new_password#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel11"},"children":[{"configs":{"labelWidth":"100","maxLength":"10","allowBlank":"false","minLength":"6","inputType":"password","labelAlign":"right","itemId":"confirmPwd","fieldLabel":"<font color='red'>*<\/font>{#tools_tenant_sure_password#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"title":"{#tools_tenant_update_version#}","height":"320","layout":"fit","width":"450","closeAction":"hide","buttons":"app.upWinBtn","buttonAlign":"center","dialog":"false","itemId":"upwin","modal":"true"},"children":[{"configs":{"bodyStyle":"padding: 30px 0px 0px 20px","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"upform"},"children":[{"configs":{"hidden":"true","itemId":"Dsnameup"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"tenantidup"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"appId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"appCode"},"children":[],"expanded":false,"type":"text"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","width":"180","labelAlign":"right","itemId":"currentVer","fieldLabel":"{#tools_tenant_current_version#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","width":"180","labelAlign":"right","itemId":"lastedVer","fieldLabel":"{#tools_tenant_new_version#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","bodyCls":"my-panel-no-border","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","width":"360","labelAlign":"right","itemId":"apppicker","fieldLabel":"{#tools_tenant_choose_app#}"},"children":[{"configs":{"height":"200","store":"app.appstore","itemId":"pickComp"},"events":{"itemclick":"  var picker = this.ownerCmp;\n   picker.setValue(record.get('APP_NAME'));\n   app.appId.setValue(record.get('APP_ID'));\n   app.appCode.setValue(record.get('APP_CODE'));\n   app.currentVer.setValue(record.get('VERSION'));\n\n//获取最新版本信息\nExt.Ajax.request({\n  url  : '{#contextPath#}'+'/upgradeAction.do?method=getVerConfigInfo',\n  params\t: {\n    'appCode'  : record.get('APP_CODE')\n  },\n  async\t: false,\n  method : 'post',\n  timeout : 360000,\n  success : function(response, options) {\n    var resp = Ext.JSON.decode(response.responseText);\n    if(resp.flag == '0'){ \n      app.lastedVer.setValue(resp.lastedVersion) ;\n       \n    }else{\n     app.lastedVer.setValue('') ;}\n  },\n  failure : function(reponse, options) {\n   \n    var response = Ext.JSON.decode(response.responseText);\n    Ext.Msg.alert(\"{#tools_tenant_prompt#}\", response.msg);\n  }\n});\t\n picker.collapse();"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","align":"center","width":"30","itemId":"columnNum1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_app_id#}","hidden":"true","dataIndex":"APP_ID","itemId":"APP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_app_code#}","width":"80","dataIndex":"APP_CODE","itemId":"APP_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_app_name#}","dataIndex":"APP_NAME","itemId":"APP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_version_num#}","hidden":"true","dataIndex":"VERSION","itemId":"VERSION_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","frame":"true","height":"80","style":"border-width:0px","layout":"fit","border":"false","itemId":"queryform"},"children":[{"configs":{"title":"{#tools_tenant_query_condition#}","collapsible":"true","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"120","width":"250","labelAlign":"right","itemId":"jdbm","fieldLabel":"{#tools_tenant_dbSource_system#}"},"events":{"specialkey":"app.grid.store.load( {  params:{jdbm:app.jdbm.getValue() }} );"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#tools_tenant_query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"app.grid.store.load( {  params:{jdbm:app.jdbm.getValue() }} );"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#tools_tenant_reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"20"},"events":{"click":"app.queryform.getForm().reset();\napp.grid.store.load();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"rowmodel","itemId":"grid"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/tenant/data/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_add#}","itemId":"addBtn","iconCls":"application_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._win);\nwin.show();\napp.win.setTitle('{#tools_tenant_add#}');\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_edit#}","itemId":"editBtn","iconCls":"table_edit_icon"},"events":{"click":"//var win = new Ext.window.Window(app._win);\nWb.edit(app.grid,app.win);\napp.win.setTitle('{#tools_tenant_edit#}');\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_delete#}","itemId":"deleteBtn","iconCls":"application_delete_icon"},"events":{"click":"\nvar recs = app.grid.getSelection();\n\n\nif (!recs.length) {\n  Wb.warn('{#tools_tenant_choose_delete_record#}');\n  return false ;\n}\nvar dsname=recs[0].get('DS_NAME');\nExt.Ajax.request({\n  url : '{#contextPath#}' + '/TenantAction.do?method=getDNameValid',\n  params\t: {\n    dsname : dsname,\n    type : 'false'\n  },\n  method : 'post',\n\n  success : function(response, options) {\n    var resp = Ext.JSON.decode(response.responseText);\n     if(resp.flag == '1'){\n          Ext.Ajax.request({\n            url : '{#contextPath#}' + '/TenantAction.do?method=getDsNameForDbName',\n            params\t: {\n              dsname : dsname\n            },\n            method : 'post',\n            success : function(response1, options) {\n           \n              var resp1 = Ext.JSON.decode(response1.responseText);\n\n              if(resp1.flag == '0'){\n                Wb.info(\"{#tools_tenant_tenant_not_delete#}\");\n\n              }else{ \n                    \n                Wb.del(app.grid, {\n                  url: 'm?xwl=xip/tools/tenant/data/delete',\n                  titleField: 'APP_NAME',\n                  success: function (){\n                    Ext.Ajax.request({\n                      url : '{#contextPath#}' + '/TenantAction.do?method=CommonRedisHashMap',\n                      method : 'post',\n                      success : function(response, options) {\n                      }\n                    }); \n                    Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_delete_success#}');\n                  }\n                });\n                   }\n\n            }\n          });\n     }else{\n       Wb.del(app.grid, {\n         url: 'm?xwl=xip/tools/tenant/data/delete',\n         titleField: 'APP_NAME',\n         success: function (){\n           Ext.Ajax.request({\n             url : '{#contextPath#}' + '/TenantAction.do?method=CommonRedisHashMap',\n             method : 'post',\n             success : function(response, options) {\n             }\n           }); \n           Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_delete_success#}');\n         }\n       });\n    }\n\n},\n  failure : function(reponse, options) {\n  }\n});\n  \n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_install#}","itemId":"installBtn","iconCls":"settings2_icon"},"events":{"click":"var rows=app.grid.getSelectionModel().getSelection();\nvar tid=rows[0].get('TENANT_ID');\nvar dsname=rows[0].get('DS_NAME');\nvar  sta=rows[0].get('STATUS');\nif(sta == \"Y\"){\n\n  Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_tenant_already_install#}');\n  \n}\n\nelse{\n\nExt.Ajax.request({\n  url : '{#contextPath#}' + '/TenantAction.do?method=getDNameValid',\n  params\t: {\n    dsname : dsname,\n    type : 'false'\n  },\n  method : 'post',\n\n  success : function(response, options) {\n\n    var resp = Ext.JSON.decode(response.responseText);\n    if(resp.flag == '1'){\n      Ext.MessageBox.confirm('{#tools_tenant_prompt#}','{#tools_tenant_sure_excute_install#}',function(a){\n        if(a==\"yes\"){\n\n     var msg = Ext.MessageBox.show({\n                title :\t'{#tools_tenant_please_wait#}',\n                msg   :  '{#tools_tenant_submiting#}',\n                width :  240,\n                wait  : true,\n                progress : true,\n                closable : false\n              });\n                    Ext.Ajax.request({\n                      url : '{#contextPath#}' + '/TenantAction.do?method=tenantSetUp',\n                      params\t: {\n                        tenantId : tid\n\n                      },\n                      method : 'post',\n                     timeout: 3600*3600*24,\n                      success : function(response, options) {\n                        msg.hide();\n                        var resp1 = Ext.JSON.decode(response.responseText);\n                        Ext.Msg.alert(\"{#tools_tenant_prompt#}\",resp1.msg) ;\n\n                         app.grid.store.reload();\n\n                        \n                            \n                      },\n                      failure : function(response, options) {\n                        msg.hide();\n                        var resp = Ext.JSON.decode(response.responseText);\n                        Ext.Msg.alert(\"{#tools_tenant_prompt#}\",resp.msg) ;\n                      }\n                    });\n\n\n\n\n\n        }else {\n          return false;\n        }\n      });\n\n\n    }else{\n      Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_not_the_source#}');\n    }\n\n  },\n  failure : function(reponse, options) {\n  }\n});\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_password_edit#}","itemId":"editpassword","iconCls":"key_icon"},"events":{"click":"var win = new Ext.window.Window(app._win1);\nvar rows=app.grid.getSelectionModel().getSelection();\nvar dsname=rows[0].get('DS_NAME');\nExt.Ajax.request({\n  url : '{#contextPath#}' + '/TenantAction.do?method=getDNameValid',\n  params\t: {\n    dsname : dsname,\n    type : 'false'\n  },\n  method : 'post',\n\n  success : function(response, options) {\n   \n    var resp = Ext.JSON.decode(response.responseText);\n    if(resp.flag == '1'){\n     Ext.Ajax.request({\n        url : '{#contextPath#}' + '/TenantAction.do?method=getDsNameForDbName',\n        params\t: {\n          dsname : dsname\n        },\n        method : 'post',\n        success : function(response1, options) {\n      \n          var resp1 = Ext.JSON.decode(response1.responseText);\n          \n       if(resp1.flag == '1'){\n       Wb.info(\"{#tools_tenant_not_install_info#}\");\n       \n       }else{\n       app.DS_NAME_HIDE.setValue(dsname);\n      app.grid1.store.load({params :{DS_NAME:dsname }});\n      win.show();\t\n       }\n       \n        }\n      });\n\n     \n    }else{\n    Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_not_the_source#}');\n    }\n\n  },\n  failure : function(reponse, options) {\n   \n   \n  }\n});\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item6"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#tools_tenant_update_version#}","itemId":"updateBtn","iconCls":"level_up_icon"},"events":{"click":"var win = new Ext.window.Window(app._upwin);\nvar rows=app.grid.getSelectionModel().getSelection();\nvar dsname=rows[0].get('DS_NAME');\nvar tenantid = rows[0].get('TENANT_ID');\n\n\nExt.Ajax.request({\n  url : '{#contextPath#}' + '/TenantAction.do?method=getDNameValid',\n  params\t: {\n    dsname : dsname,\n    type : 'false'\n  },\n  method : 'post',\n\n  success : function(response, options) {\n\n    var resp = Ext.JSON.decode(response.responseText);\n    if(resp.flag == '1'){\n      Ext.Ajax.request({\n        url : '{#contextPath#}' + '/TenantAction.do?method=getDsNameForDbName',\n        params\t: {\n          dsname : dsname\n        },\n        method : 'post',\n        success : function(response1, options) {\n\n          var resp1 = Ext.JSON.decode(response1.responseText);\n\n          if(resp1.flag == '1'){\n            Wb.info(\"{#tools_tenant_install_tenant_first#}\");\n\n          }else{\n            app.tenantidup.setValue(tenantid);\n            app.Dsnameup.setValue(dsname);\n            app.appstore.load({params :{DS_NAME:dsname }});\n            win.show();\n\n          }\n\n        }\n      });\n\n\n\n    }else{\n      Ext.Msg.alert('{#tools_tenant_prompt#}','{#tools_tenant_not_the_source#}');\n    }\n\n  },\n  failure : function(reponse, options) {\n  }\n});\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"TENANT_ID","itemId":"tenantid"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_domain#}","width":"150","dataIndex":"DOMAIN","itemId":"COLUMN_DOMAIN"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_db_source_name#}","width":"150","dataIndex":"DS_NAME","itemId":"COLUMN_DS_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_system_name#}","width":"150","dataIndex":"APP_NAME","itemId":"COLUMN_APP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_login_server#}","width":"220","dataIndex":"CAS_SERVER","itemId":"COLUMN_CAS_SERVER"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_project_url#}","width":"220","dataIndex":"CAS_CLIENT","itemId":"COLUMN_CAS_CLIENT"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_enable#}","width":"80","dataIndex":"ENABLE_FLAG","itemId":"COLUMN_ENABLE_FLAG","renderer":"if(value=='Y'){\n\treturn '{#tools_tenant_yes#}';\n}else{\n\t\n   return '<font color=\"red\">'+'{#tools_tenant_no#}'+'<\/font>';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_weixin_num_id#}","hidden":"true","width":"80","dataIndex":"WX_CORPID","itemId":"COLUMN_WX_CORPID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_weixin_num_password#}","hidden":"true","width":"80","dataIndex":"WX_CORPSECRET","itemId":"COLUMN_WX_CORPSECRET"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_weixin_app_back_ase#}","hidden":"true","width":"80","dataIndex":"WX_AESKEY","itemId":"COLUMN_WX_AESKEY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_weixin_app_id#}","hidden":"true","width":"80","dataIndex":"WX_AGENTID","itemId":"COLUMN_WX_AGENTID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_weixin_app_token#}","hidden":"true","width":"80","dataIndex":"WX_TOKEN","itemId":"COLUMN_WX_TOKEN"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#tools_tenant_install_status#}","hidden":"true","dataIndex":"STATUS","itemId":"COLUMN_STATUS"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}