{"inframe":false,"title":"数据导入导出模板管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nvar userName = request.getSession().getAttribute(\"XzSessionVars\").get('userName');\nvar empName = request.getSession().getAttribute(\"XzSessionVars\").get('empName');\n\nvar authModel = request.getSession().getAttribute(\"XzSessionVars\").get('AUTH_MODAL');\nvar roleId = request.getSession().getAttribute(\"XzSessionVars\").get('roleId');\nvar roleName = request.getSession().getAttribute(\"XzSessionVars\").get('roleName');\nvar roleCode = request.getSession().getAttribute(\"XzSessionVars\").get('roleCode');\n\nvar ctxPath = request.getContextPath() ;\n\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"userName\",userName);\nrequest.setAttribute(\"empName\",empName);\n\nrequest.setAttribute(\"authModel\",authModel);\nrequest.setAttribute(\"roleId\",roleId);\nrequest.setAttribute(\"roleName\",roleName);\nrequest.setAttribute(\"roleCode\",roleCode);\n\nrequest.setAttribute(\"contextPath\",ctxPath);\n\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/tools/io/json/dataTemMa\");","itemId":"module"},"events":{"initialize":"function getuuid() {\n var s = [];\n var hexDigits = \"0123456789abcdef\";\n for (var i = 0; i < 36; i++) {\n s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n }\n s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n s[8] = s[13] = s[18] = s[23] = \"-\";\n\nvar uuid = s.join(\"\");\n return uuid;\n}\n"},"children":[{"configs":{"itemId":"singleTempStore","url":"m?xwl=xip/tools/io/dataTemMa/DATA/getTemplateById"},"events":{"load":"if(app.singleTempStore.getAt(0)) {\n  var record = app.singleTempStore.getAt(0);\n  \n  app.TMP_H_ID.setValue(record.get('TMP_H_ID'));\n  app.TMP_H_CODE.setValue(record.get('TMP_H_CODE'));\n  app.TMP_H_NAME.setValue(record.get('TMP_H_NAME'));\n  app.TARGET_OBJECT.setValue(record.get('TARGET_OBJECT'));\n  app.PRIMARY_KEY_COLUMN.setValue(record.get('PRIMARY_KEY_COLUMN'));\n  app.TAG_COLUMN.setValue(record.get('TAG_COLUMN'));\n  app.VALIDATION_TYPE.setValue(record.get('VALIDATION_TYPE'));\n  app.VALIDATION_NAME.setValue(record.get('VALIDATION_NAME'));\n  app.IS_MARKED.setValue(record.get('IS_MARKED'));\n  app.H_DESC.setValue(record.get('H_DESC'));\n  app.SQL_STR.setValue(record.get('SQL_STR'));\n  app.INSERT_SQL_STR.setValue(record.get('INSERT_SQL_STR'));\n  app.UPDATE_SQL_STR.setValue(record.get('UPDATE_SQL_STR'));\n  \n  app.appComboBox.setValue(record.get('APP_ID'));\n  //app.appComboBox.setRawValue(record.get('APP_NAME'));\n  \n  \n  \n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tempWinBtns"},"children":[{"configs":{"text":"{#xip_tools_dataTemMa_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"//校验\nif(app.tempForm.getForm().isValid()===false){\n  Ext.Msg.alert('','{#xip_tools_dataTemMa_notnull#}');\n  return;\n}\nvar saveJson = {\n  'TMP_H_ID':app.TMP_H_ID.getValue(),\n  'TMP_H_CODE':app.TMP_H_CODE.getValue(),\n  'TMP_H_NAME':app.TMP_H_NAME.getValue(),\n  'APP_ID':app.appComboBox.getValue(),\n  'TARGET_OBJECT':app.TARGET_OBJECT.getValue(),\n  'PRIMARY_KEY_COLUMN':app.PRIMARY_KEY_COLUMN.getValue(),\n  'TAG_COLUMN':app.TAG_COLUMN.getValue(),\n  'VALIDATION_TYPE':app.VALIDATION_TYPE.getValue(),\n  'VALIDATION_NAME':app.VALIDATION_NAME.getValue(),\n  'H_DESC':app.H_DESC.getValue(),\n  'SQL_STR':app.SQL_STR.getValue(),\n  'INSERT_SQL_STR':app.INSERT_SQL_STR.getValue(),\n  'UPDATE_SQL_STR':app.UPDATE_SQL_STR.getValue(),\n  'IS_MARKED':(app.IS_MARKED.getValue()===''||app.IS_MARKED.getValue()===null)?'N':app.IS_MARKED.getValue()\n};\n\nvar opType = app.OP_TYPE.getValue();\nif(opType=='_added'){\n  Wb.request({\n    url:'m?xwl=xip/tools/io/dataTemMa/DATA/insertTemplate',\n    params:saveJson,\n    success:function(){\n      app.OP_TYPE.setValue('_modified');\n//       if(app.tempSubGrid.store.getModifiedRecords().length===0 && app.tempSubGrid.store.getRemovedRecords().length===0){\n//         Ext.Msg.alert('提示','保存成功!');\n//         app.tempSubGrid.store.load({params:{tempId:app.TMP_H_ID.getValue()}});\n//       }else{\n//         app.tempSubGrid.plugins[0].completeEdit();\n//         app.tempSubGrid.store.sync({\n//         callback :function(){\n//           Wb.unmask();\n//           Ext.Msg.alert('提示','保存成功!');\n//           app.tempSubGrid.store.commitChanges();\n//         }\n//       });\n//       }\n      var insertValue = [];\n      app.tempSubGrid.store.each(function(e){\n        var n = \"0000\"+e.data.COLUMN_NUM;\n        var json = { \n                     TMP_H_ID   : e.data.TMP_H_ID,\n                     TMP_L_ID   : e.data.TMP_L_ID,\n                     COLUMN_CODE: e.data.COLUMN_CODE,\n                     COLUMN_NAME: e.data.COLUMN_NAME,\n                     COLUMN_WIDTH: e.data.COLUMN_WIDTH,\n                     L_DESC     : e.data.L_DESC,\n                     COLUMN_NUM : n.substring(n.length-4,n.length)\n                    };\n        insertValue.push(json);\n        \n      });\n        Wb.request({\n        url: 'm?xwl=xip/tools/io/dataTemMa/DATA/insertTempSubs', \n        params: Wb.apply({\n           array: Wb.encode(insertValue)\n        }),\n        success: function() {\n          Wb.info(\"{#xip_tools_dataTemMa_saveok#}\");\n          app.tempSubGrid.store.load({params:{tempId:app.TMP_H_ID.getValue()}});\n        }\n      });\n      \n      app.tempGrid.store.load();\n    }\n  });\n}else if(opType=='_modified'){\n  Wb.request({\n    url:'m?xwl=xip/tools/io/dataTemMa/DATA/updateTemplate',\n    params:saveJson,\n    success:function(){\n      app.OP_TYPE.setValue('_modified');\n//        if(app.tempSubGrid.store.getModifiedRecords().length===0 && app.tempSubGrid.store.getRemovedRecords().length===0){\n//         Ext.Msg.alert('提示','保存成功!');\n//       }else{\n//         app.tempSubGrid.plugins[0].completeEdit();\n//         app.tempSubGrid.store.sync({\n//         callback :function(){\n//           Wb.unmask();\n//           Ext.Msg.alert('提示','保存成功!',function(){\n//             app.tempSubGrid.store.commitChanges();\n//             app.tempSubGrid.store.load({params:{tempId:app.TMP_H_ID.getValue()}});\n//           });\n      \n          \n//          }\n//       });\n//       }\n       Wb.request({\n        url: 'm?xwl=xip/tools/io/dataTemMa/DATA/deleteTemp_H', \n        params: {TMP_H_ID:app.TMP_H_ID.getValue()},\n        success: function() {\n           var insertValue = [];\n           app.tempSubGrid.store.each(function(e){\n            var n = \"0000\"+e.data.COLUMN_NUM;\n            var json = { \n                         TMP_H_ID   : e.data.TMP_H_ID,\n                         TMP_L_ID   : e.data.TMP_L_ID,\n                         COLUMN_CODE: e.data.COLUMN_CODE,\n                         COLUMN_NAME: e.data.COLUMN_NAME,\n                         COLUMN_WIDTH: e.data.COLUMN_WIDTH,\n                         L_DESC     : e.data.L_DESC,\n                         COLUMN_NUM : n.substring(n.length-4,n.length)\n                        };\n            insertValue.push(json);\n\n          });\n            Wb.request({\n              url: 'm?xwl=xip/tools/io/dataTemMa/DATA/insertTempSubs', \n              params: Wb.apply({\n                 array: Wb.encode(insertValue)\n              }),\n              success: function() {\n                Wb.info(\"{#xip_tools_dataTemMa_saveok#}\");\n                app.tempSubGrid.store.load({params:{tempId:app.TMP_H_ID.getValue()}});\n              }\n           });\n\n        }\n      });\n\n      app.tempGrid.store.load();\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_closeBtn#}","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.tempWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"height":"550","width":"680","layout":"border","resizable":"false","closeAction":"hide","buttons":"app.tempWinBtns","buttonAlign":"center","dialog":"false","itemId":"tempWin","modal":"true"},"events":{"close":"// Wb.reset(app.tempForm);\n// app.tempSubGrid.store.removeAll();"},"children":[{"configs":{"region":"center","height":"550","width":"680","itemId":"tab1"},"children":[{"configs":{"title":"{#xip_tools_dataTemMa_tpl_info#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"panel1"},"children":[{"configs":{"region":"center","bodyStyle":"border-style:none","height":"550","frame":"true","style":"border-width:0px","width":"680","border":"false","itemId":"tempForm"},"children":[{"configs":{"title":"{#xip_tools_dataTemMa_tpl_info#}","frame":"true","style":"padding-top:25px;padding-bottom:45px;padding-left:20px;","layout":"fit","itemId":"tempFieldSet","border":"true"},"children":[{"configs":{"frame":"true","style":"border-width:0px","hidden":"true","layout":"column","border":"false","itemId":"hideFiledPanel"},"children":[{"configs":{"itemId":"TMP_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"OP_TYPE"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"anchor:'100%'","height":"40","frame":"true","style":"border-width:0px","layout":"column","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"200","labelAlign":"right","itemId":"TMP_H_CODE","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_tpl_code#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","width":"200","labelAlign":"right","itemId":"TMP_H_NAME","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_tpl_name#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"APP_NAME","width":"200","valueField":"APP_ID","labelAlign":"right","itemId":"appComboBox","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_app#}"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/data/getApps"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"anchor:'100%'","height":"40","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"200","labelAlign":"right","itemId":"TARGET_OBJECT","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_src_tab#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","width":"200","labelAlign":"right","itemId":"PRIMARY_KEY_COLUMN","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_src_pkey#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","width":"200","labelAlign":"right","itemId":"TAG_COLUMN","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_record_col#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"anchor:'100%'","height":"40","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel4"},"children":[{"configs":{"labelWidth":"80","width":"200","pickList":"[['PRO','{#xip_tools_dataTemMa_proc#}'],['JAVA','{#xip_tools_dataTemMa_java#}'],['WEB','webService']]","labelAlign":"right","itemId":"VALIDATION_TYPE","fieldLabel":"{#xip_tools_dataTemMa_chk_type#}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","width":"400","labelAlign":"right","itemId":"VALIDATION_NAME","fieldLabel":"{#xip_tools_dataTemMa_chk_func#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"anchor:'100%'","height":"35","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel5"},"children":[{"configs":{"labelWidth":"80","displayField":"NAME","width":"200","valueField":"CODE","labelAlign":"right","itemId":"IS_MARKED","fieldLabel":"{#xip_tools_dataTemMa_marked#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/data/getValSetDtl&valSetName=YN"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","width":"400","labelAlign":"right","itemId":"H_DESC","fieldLabel":"{#xip_tools_dataTemMa_tpl_desc#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","itemId":"panel_sql","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"600","labelAlign":"right","itemId":"SQL_STR","fieldLabel":"<font color='red'>*<\/font>{#xip_tools_dataTemMa_qry_sql#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","itemId":"panel_insertSql","border":"false"},"children":[{"configs":{"labelWidth":"80","width":"600","labelAlign":"right","itemId":"INSERT_SQL_STR","fieldLabel":"{#xip_tools_dataTemMa_ins_sql#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","itemId":"panel_updateSql","border":"false"},"children":[{"configs":{"labelWidth":"80","width":"600","labelAlign":"right","itemId":"UPDATE_SQL_STR","fieldLabel":"{#xip_tools_dataTemMa_upd_sql#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#xip_tools_dataTemMa_tpl_filed#}","frame":"true","style":"border-width:0px","layout":"border","border":"false","itemId":"panel2"},"children":[{"configs":{"region":"center","title":"{#xip_tools_dataTemMa_tpl_filed#}","style":"border-width:0px","layout":"fit","itemId":"tempFieldsgrid"},"children":[{"configs":{"selType":"checkboxmodel","itemId":"tempSubGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_col_code#}","width":"120","dataIndex":"COLUMN_CODE","itemId":"COLUMN_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_col_name#}","width":"120","dataIndex":"COLUMN_NAME","itemId":"COLUMN_NAME_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_col_width#}","width":"100","dataIndex":"COLUMN_WIDTH","itemId":"COLUMN_WIDTH_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_col_desc#}","dataIndex":"L_DESC","itemId":"L_DESC_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"TMP_L_ID","hidden":"true","dataIndex":"TMP_L_ID","itemId":"TMP_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"TMP_H_ID","hidden":"true","dataIndex":"TMP_H_ID","itemId":"TMP_H_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"proxy":"{\n  type:\"ajax\",\n  api:{\n    read: 'm?xwl=xip/tools/io/dataTemMa/DATA/getTempSubByTempId',\n    update: 'm?xwl=xip/tools/io/dataTemMa/DATA/updateTempSubs',\n    create: 'm?xwl=xip/tools/io/dataTemMa/DATA/insertTempSubs',\n    destroy: 'm?xwl=xip/tools/io/dataTemMa/DATA/deleteTempSubs'\n  },\n  reader:{\n    type:\"json\",\n    root:\"rows\",\n    totalProperty:\"total\"\n  },\n  listeners:{\n    exception:function(proxy,response,operation,options){\n      Wb.except(response.responseText);\n    }\n  }\n}","autoLoad":"false","itemId":"store","showMask":"false"},"events":{"beforesync":"(function(){\n Wb.mask();\n\n} )();\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#xip_tools_dataTemMa_add_src_fileds#}","itemId":"btn_sub_queryfield","iconCls":"record_add_icon"},"events":{"click":"if(app.OP_TYPE.getValue()=='_added'){\n  Ext.Msg.alert('','{#xip_tools_dataTemMa_msg#}');\n  return;\n}\n\nvar tableName = app.TARGET_OBJECT.getValue();\ntableName = tableName.toUpperCase();\n\nvar hid = app.TMP_H_ID.getValue();\n\nvar win = new Ext.window.Window(app._tableColumnsWin);\nwin.show();\napp.tableColumnsGrid.store.load({params:{'templateId':hid}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_del_src_fileds#}","itemId":"btn_sub_delete","iconCls":"record_delete_icon"},"events":{"click":"var m = app.tempSubGrid.getSelectionModel(),s=m.getSelection(),i,j;\nvar rows = app.tempSubGrid.getSelection();\nif(s.length===0)return;\nExt.Msg.confirm('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_okdel#}',function(a){\n    if(a=='yes'){\n//        app.tempSubGrid.plugins[0].completeEdit();\n//        app.tempSubGrid.store.remove(s);\n//        Wb.info(\"删除成功！\");\n           \n      Wb.request({\n        url: 'm?xwl=xip/tools/io/dataTemMa/DATA/deleteTemp_L', \n        params: Wb.apply({\n           destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Wb.info(\"{#xip_tools_dataTemMa_delok#}\");\n          Wb.remove(app.tempSubGrid,rows);\n          //app.tempSubGrid.store.load({params:{tempId:app.TMP_H_ID.getValue()}});\n        }\n      });\n    }\n  }); \n//i = app.tempSubGrid.store.indexOf(s[0]);\n// j = app.tempSubGrid.store.getCount() - 1;\n// if (i > j)\n//   i = j;\n// if (i > -1)\n//   m.select(i);"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"},{"configs":{"height":"400","layout":"fit","width":"550","closeAction":"hide","itemId":"tableColumnsWin","dialog":"true"},"events":{"ok":"var TMP_L_ID = \"\";  \nvar code = \"\";\n  var name = \"\";\nvar rows = app.tableColumnsGrid.getSelectionModel().getSelection();\nif(rows.length==0){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selrow#}');\n}else{\n  var e = app.tempSubGrid.plugins[0];\n  e.completeEdit();\n \n  var hid = app.TMP_H_ID.getValue(); \n  var _index = app.tempSubGrid.store.getCount();\n  var _columnNum = app.tempSubGrid.store.getCount()+1;\n\n  for(var i=0; i<rows.length; i++){\n    //判断是否存在，存在则跳过\n    //alert(rows[i].get('COLUMN_NAME'));\n    var num = app.tempSubGrid.store.find('COLUMN_CODE',rows[i].get('COLUMN_NAME'));\n    code = rows[i].get('COLUMN_NAME');\n    name = rows[i].get('COLUMN_NAME');\n         if(num==-1){\n           TMP_L_ID = getuuid();\n            var insertJson = {\n                          'TMP_H_ID' : hid,\n                          'TMP_L_ID' : TMP_L_ID,\n                          'COLUMN_CODE' : code,\n                          'COLUMN_NAME' : name,\n                          'COLUMN_WIDTH' : '20',\n                          'L_DESC' : '',\n                          'COLUMN_NUM' :_columnNum\n                  \n                  };\n                \n     \n     app.tempSubGrid.store.insert(_index,insertJson);\n                 _index++;\n                 _columnNum++; \n          }\n   \n\n  }\n  \n  app.tableColumnsWin.hide();\n}"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","itemId":"tableColumnsGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"列名称","width":"120","dataIndex":"COLUMN_NAME","itemId":"COLUMN_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"数据类型","width":"80","dataIndex":"COLUMN_TYPE","itemId":"COLUMN_TYPE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"数据长度","width":"100","dataIndex":"COLUMN_SIZE","itemId":"COLUMN_SIZE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"描述","dataIndex":"COMMENTS","itemId":"COMMENTS_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","autoLoad":"false","url":"{#contextPath#}//templateManageAction.do?method=getFields"},"events":{"beforeload":"store.getProxy().extraParams.templateId = app.TMP_H_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"queryForm"},"children":[{"configs":{"title":"{#xip_tools_dataTemMa_fd#}","height":"60","style":"padding-top:8px","layout":"column","itemId":"queryFormFieldSet"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"tempName","fieldLabel":"{#xip_tools_dataTemMa_tempName#}"},"events":{"specialkey":"app.tempGrid.store.load();"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_tools_dataTemMa_queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.tempGrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"Wb.reset(app.queryForm);\napp.tempGrid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"tempGrid"},"events":{"itemdblclick":"app.btn_edit.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/io/dataTemMa/DATA/getTemplates"},"events":{"beforeload":"store.getProxy().extraParams.tempName = app.tempName.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#xip_tools_dataTemMa_btn_add#}","itemId":"btn_add","iconCls":"record_add_icon"},"events":{"click":" Wb.request({\n    url:'m?xwl=xip/tools/transfer/transDefined/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var win = new Ext.window.Window(app._tempWin);\n      win.show();\n      win.setTitle('{#xip_tools_dataTemMa_add_tpl#}');\n      app.OP_TYPE.setValue('_added');\n      app.TMP_H_ID.setValue(resultJson.uuid);\n    }\n });\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_btn_edit#}","itemId":"btn_edit","iconCls":"record_edit_icon"},"events":{"click":"var rows = app.tempGrid.getSelectionModel().getSelection();\nvar win = new Ext.window.Window(app._tempWin);\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selrow#}!');\n}else if(rows.length>1){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selarow#}');\n}else{\n  var id = rows[0].data.TMP_H_ID;\n  app.singleTempStore.load({params:{tempId:id}});\n  win.show();\n  win.setTitle('{#xip_tools_dataTemMa_edit_tpl#}');\n  app.TMP_H_CODE.setReadOnly(true);\n  app.tempSubGrid.store.load({params:{tempId:id}});\n  app.OP_TYPE.setValue('_modified');\n  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_btn_delete#}","itemId":"btn_delete","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.tempGrid.getSelectionModel().getSelection();\nif(rows.length==0){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selrow#}');\n}else{\n  Ext.Msg.confirm('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_okdel#}',function(a){\n    if(a=='yes'){\n      var tempId = rows[0].data.TMP_H_ID;\n      Wb.request({\n        url:'m?xwl=xip/tools/io/dataTemMa/DATA/deleteTemplate',\n        params:{TMP_H_ID:tempId},\n        success:function(){\n          Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_delok#}');\n          app.tempGrid.store.load();\n        }\n      });\n    }\n  }); \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_btn_export#}","itemId":"btn_export","iconCls":"export_icon"},"events":{"click":"var rows = app.tempGrid.getSelectionModel().getSelection();\nif(rows.length==0){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selrow#}');\n}else if(rows.length>1){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selarow#}');\n}else{\n  var code = rows[0].data.TMP_H_CODE;\n  if(code == 'TMP_001'){\n    Xip.exportExcel(rows[0].data.TMP_H_CODE,{param1:'1', param2:'1'},'{#xip_tools_dataTemMa_btn_export#}');\n  }else{\n  \tXip.exportExcel(rows[0].data.TMP_H_CODE,null,'{#xip_tools_dataTemMa_btn_export#}'); \n  }\n  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_dataTemMa_btn_import#}","itemId":"btn_import","iconCls":"import_icon"},"events":{"click":"var rows = app.tempGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selrow#}!');\n}else if(rows.length>1){\n  Ext.Msg.alert('{#xip_tools_dataTemMa_tip#}','{#xip_tools_dataTemMa_selarow#}!');\n}else{\n  var code = rows[0].data.TMP_H_CODE;\n  Xip.importExcel(rows[0].data.TMP_H_CODE,{});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_tpl_code#}","width":"200","dataIndex":"TMP_H_CODE","itemId":"TMP_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_tpl_name#}","width":"200","dataIndex":"TMP_H_NAME","itemId":"TMP_H_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_chk_type#}","width":"120","align":"center","dataIndex":"VALIDATION_TYPE","itemId":"VALIDATION_TYPE_COL","renderer":"if(value=='PRO'){\n  return '{#xip_tools_dataTemMa_proc#}';\n}else if(value=='FUN'){\n  return '{#xip_tools_dataTemMa_func#}';\n}else{\n  return '';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_chk_func#}","width":"200","dataIndex":"VALIDATION_NAME","itemId":"VALIDATION_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_src_tab#}","width":"200","dataIndex":"TARGET_OBJECT","itemId":"TARGET_OBJECT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"来源表主键","hidden":"true","width":"120","dataIndex":"PRIMARY_KEY_COLUMN","itemId":"PRIMARY_KEY_COLUMN_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_dataTemMa_desc#}","dataIndex":"H_DESC","itemId":"H_DESC_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"标记列","hidden":"true","dataIndex":"TAG_COLUMN","itemId":"TAG_COLUMN_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"SQL_STR","hidden":"true","dataIndex":"SQL_STR","itemId":"SQL_STR_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"TMP_H_ID","itemId":"TMP_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应用ID","hidden":"true","dataIndex":"APP_ID","itemId":"APP_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}