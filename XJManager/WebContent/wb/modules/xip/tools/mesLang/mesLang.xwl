{"inframe":false,"title":"问题多语言","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"com.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/tools/mesLang/mesLang\");","itemId":"module"},"children":[{"configs":{"itemId":"win1Btn"},"children":[{"configs":{"text":"{#save#}","itemId":"btnSave","iconCls":"save_icon"},"events":{"click":"var type = app.flag.getValue();\nif (!app.winForm.getForm().isValid()) {\n  Ext.Msg.alert('{#alert#}', '{#required#}');\n  return false;\n}\nvar json = {\n  MES_CODE : app.MES_CODE.getValue(),\n  MES_LANG : app.MES_LANG.getValue(),\n  MES_CONTENT : app.MES_CONTENT.getValue(),\n  LANG_NAME : app.MES_LANG.getRawValue()\n};\n\n//修改为按照编码与语言判断是否存在\n\n\n  var flag=true;\n\n  Wb.request({\n    url: 'm?xwl=xip/tools/mesLang/DATA/selectexist',\n    params:json,\n   \n    method: 'POST',\n    success:function(response){\n      \n      var rep = Ext.JSON.decode(response.responseText);\n      var num = rep.NUM;\n \n      if( num>0){\n\t\t//存在编码及语言相同数据则跟新数据\n          Wb.request({\n          url : 'm?xwl=xip/tools/mesLang/DATA/update',\n          params:json,\n          success:function(response){\n            Ext.Msg.alert('{#alert#}','{#saveSuc#}');\n            app.mesGrid.store.load();\n          }\n         });\n\n\n      }else{\n        //不存在则插入数据\n          json.MES_ID = Xip.getId();\n           Wb.request({\n          url : 'm?xwl=xip/tools/mesLang/DATA/save',\n          params:json,\n          success:function(response){\n            app.MES_ID.setValue(json.MES_ID);\n            app.flag.setValue(\"edit\");\n            Ext.Msg.alert('{#alert#}','{#saveSuc#}');\n            app.mesGrid.store.load();\n          }\n         });\n      }\n    }\n  });\n\n\n\n\n\n/**\n\n\n\nif(type==\"add\"){\n  //插入\n  json.MES_ID = Xip.getId();\n   Wb.request({\n          url : 'm?xwl=xip/tools/mesLang/DATA/save',\n          params:json,\n          success:function(response){\n            app.MES_ID.setValue(json.MES_ID);\n            app.flag.setValue(\"edit\");\n            Ext.Msg.alert('{#alert#}','{#saveSuc#}');\n            app.mesGrid.store.load();\n          }\n         });\n}else{\n  //更新\n  json.MES_ID = app.MES_ID.getValue();\n   Wb.request({\n          url : 'm?xwl=xip/tools/mesLang/DATA/update',\n          params:json,\n          success:function(response){\n            Ext.Msg.alert('{#alert#}','{#saveSuc#}');\n            app.mesGrid.store.load();\n          }\n         });\n}**/"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#close#}","itemId":"btnCancel","iconCls":"cancel_icon"},"events":{"click":"app.win1.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"height":"360","width":"650","layout":"fit","resizable":"false","closeAction":"hide","buttonAlign":"center","buttons":"app.win1Btn","dialog":"false","itemId":"win1","modal":"true"},"events":{"hide":"Wb.reset(app.winForm);"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"winForm"},"children":[{"configs":{"hidden":"true","itemId":"flag"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MES_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"height":"30","frame":"true","style":"border-width:0px","layout":"column","columnWidth":".5","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"320","labelAlign":"right","itemId":"MES_CODE","fieldLabel":"<font color='red'>*<\/font>{#mesCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"70","allowBlank":"false","displayField":"VAL_NAME","width":"280","valueField":"VAL_CODE","labelAlign":"right","itemId":"MES_LANG","fieldLabel":"<font color='red'>*<\/font>{#lang#}","editable":"false"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/tools/mesLang/DATA/getLanguage"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"column","columnWidth":".5","border":"false","itemId":"panel3"},"children":[{"configs":{"labelWidth":"80","height":"250","allowBlank":"false","width":"600","labelAlign":"right","itemId":"MES_CONTENT","fieldLabel":"<font color='red'>*<\/font>{#content#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","itemId":"queryform","border":"false"},"children":[{"configs":{"title":"{#conditionQuery#}","style":"padding-top:8px","collapsible":"true","layout":"column","itemId":"fieldset"},"children":[{"configs":{"labelWidth":"80","displayField":"VAL_NAME","width":"200","valueField":"VAL_CODE","labelAlign":"right","itemId":"langCombo","fieldLabel":"{#lang#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/base/app/appLang/DATA/getLanguage"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","width":"240","labelAlign":"right","itemId":"mesCode","fieldLabel":"{#mesCode#}"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"var lang = app.langCombo.getValue();\nvar mesCode = app.mesCode.getValue();\napp.mesGrid.store.load({params:{lang:lang, mesCode:mesCode}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"20"},"events":{"click":"app.queryform.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"mesGrid","editable":"true"},"events":{"itemdblclick":"app.editMes.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"numCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#lang#}","align":"center","width":"80","dataIndex":"MES_LANG","titleAlign":"center","itemId":"mesLangCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#mesCode#}","width":"200","dataIndex":"MES_CODE","itemId":"mesCodeCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#content#}","dataIndex":"MES_CONTENT","itemId":"mesContentCol","flex":"1"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"50","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/mesLang/DATA/selectMesGrid"},"events":{"beforeload":"store.getProxy().extraParams.lang = app.langCombo.getValue();\nstore.getProxy().extraParams.mesCode = app.mesCode.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addMes","iconCls":"record_add_icon"},"events":{"click":"app.win1.show();\napp.flag.setValue('add');\napp.win1.setTitle('{#add#}');\napp.MES_CODE.setReadOnly(false);\n//app.MES_LANG.setReadOnly(false);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#edit#}","itemId":"editMes","iconCls":"record_edit_icon"},"events":{"click":"var sm = app.mesGrid.getSelectionModel();\nif(!sm.hasSelection() || sm.getSelection().length>1){\n  Ext.MessageBox.alert('{#alert#}','{#selRecord#}');\n  return false;\n}else{\n  /*------------编辑--------------*/\n  var rows = sm.getSelection();\n  app.win1.setTitle('{#edit#}');\n  //app.winForm.loadRecord(rows[0]);\n  app.MES_ID.setValue(rows[0].get('MES_ID'));\n  app.MES_CODE.setValue(rows[0].get('MES_CODE'));\n  app.MES_LANG.store.load(function(){\n     app.MES_LANG.setRawValue(rows[0].get('MES_LANG'));\n     app.MES_LANG.setValue(rows[0].get('LANG'));\n  });\n \n  app.MES_CONTENT.setValue(rows[0].get('MES_CONTENT'));\n  \n  app.win1.show();\n // app.MES_CODE.setReadOnly(true);\n // app.MES_LANG.setReadOnly(true);\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"deleteMes","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.mesGrid.getSelectionModel().getSelection();\n\nif(rows.length===0){\n  Ext.Msg.alert('{#alert#}','{#selRecord#}');\n  return false ;\n}else{\n  Ext.Msg.confirm('{#alert#}','{#confirm#}',function(a){\n    if(a=='yes'){\n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n      \tvar id = \"'\" + r.data.MES_ID + \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n      var json = {'ids' : idList} ;\n      Wb.request({\n        url:'m?xwl=xip/tools/mesLang/DATA/delete',\n        params:json,\n        success:function(){\n           Ext.Msg.alert('{#alert#}','{#delSuc#}');\n           app.mesGrid.store.reload();\n        }\n      });\n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}