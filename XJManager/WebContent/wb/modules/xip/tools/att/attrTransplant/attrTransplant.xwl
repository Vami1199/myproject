{"inframe":false,"title":"附件移植","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"request.setAttribute(\"contextPath\",request.getContextPath());","serverScript":"//三方语言,引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xip/tools/att/attrTransplant/json/attrTransplant');","itemId":"module"},"events":{"initialize":"var timer;\n\n/**\n  加载附件移植信息  \n**/\nfunction loadAttrTransplantInfo(){\n  Ext.Msg.wait('{#att_attrTransplant_in_query#}');\n  Ext.Ajax.request({\n    url: '{#contextPath#}' +'/xipAttMrgAction.do?method=getAttrTransplantInfo',\n    method: 'POST',\n    success: function(response,options){\n      Ext.Msg.hide();\n      var resp = Ext.JSON.decode(response.responseText);\n\n      if(!Ext.isEmpty(resp.total)){\n        app.total.setValue(resp.total);\n      }\n\n      if(!Ext.isEmpty(resp.hasDone)){\n        app.hasDone.setValue(resp.hasDone);\n      }\n\n      if(!Ext.isEmpty(resp.current)){\n        var currentStrore = app.currentGrid.getStore();\n        currentStrore.removeAll();\n        for(var i=0; i<resp.current.length; i++){\n          currentStrore.insert(0, {'attrName':resp.current[i].attrName});\n        }\n        currentStrore.commitChanges();\n      }\n\n      if(!Ext.isEmpty(resp.error)){\n\t\tvar errorStrore = app.errorGrid.getStore();\n        errorStrore.removeAll();\n        for(var j=0; j<resp.error.length; j++){\n          errorStrore.insert(0, {'attrName':resp.error[j].attrName});\n        }\n        errorStrore.commitChanges();\n      }\n\n    },\n    failure: function(response,options){\n      Ext.Msg.hide();\n    }\n  });    \n}"},"children":[{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","frame":"true","bodyPadding":"5 0 0","border":"false","itemId":"form"},"children":[{"configs":{"frame":"true","height":"40","style":"border-width:0px","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"panel1"},"children":[{"configs":{"allowBlank":"false","queryMode":"local","displayField":"CAT_NAME","valueField":"CAT_CODE","labelAlign":"right","itemId":"attCatCombox","fieldLabel":"{#att_attrTransplant_enclosure_type#}"},"events":{"select":"app.sourceServerCombox.setReadOnly(false);\napp.targetServerCombox.setReadOnly(false);\n\napp.sourceServerCombox.clearValue();\napp.targetServerCombox.clearValue();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/att/attrTransplant/data/getAttrCat"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","height":"40","style":"border-width:0px","layout":"column","border":"false","itemId":"panel2"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","allowBlank":"false","displayField":"ATT_SERVER_NAME","valueField":"ATT_SERVER_ID","labelAlign":"right","itemId":"sourceServerCombox","fieldLabel":"{#att_attrTransplant_source_server#}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/tools/att/attrTransplant/data/getServersByCat"},"events":{"beforeload":"var _index = app.attCatCombox.getStore().find('CAT_CODE',app.attCatCombox.getValue());\nvar attCatId = app.attCatCombox.getStore().getAt(_index).get('ATT_CAT_ID');\n\napp.sourceServerCombox.getStore().getProxy().extraParams.ATT_CAT_ID = attCatId;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","allowBlank":"false","displayField":"ATT_SERVER_NAME","valueField":"ATT_SERVER_ID","labelAlign":"right","itemId":"targetServerCombox","fieldLabel":"{#att_attrTransplant_tiger_server#}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xip/tools/att/attrTransplant/data/getServersByCat"},"events":{"beforeload":"var _index = app.attCatCombox.getStore().find('CAT_CODE',app.attCatCombox.getValue());\nvar attCatId = app.attCatCombox.getStore().getAt(_index).get('ATT_CAT_ID');\n\napp.targetServerCombox.getStore().getProxy().extraParams.ATT_CAT_ID = attCatId;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"panel3"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","minValue":"1","value":"10","labelAlign":"right","itemId":"maxThread","fieldLabel":"{#att_attrTransplant_max_thread#}","maxValue":"20"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","height":"30","style":"border-width:0px","layout":"column","border":"false","itemId":"panel3"},"children":[{"configs":{"text":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{#att_attrTransplant_start_transplant#}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","itemId":"startTransplant","x":"40"},"events":{"click":"if(Ext.isEmpty(app.attCatCombox.getValue())){\n  Ext.Msg.alert('','{#att_attrTransplant_select_enclosure_type#}');\n  return;\n}\n\nif(Ext.isEmpty(app.sourceServerCombox.getValue())){\n  Ext.Msg.alert('','{#att_attrTransplant_select_source_server#}');\n  return;\n}\n\nif(Ext.isEmpty(app.targetServerCombox.getValue())){\n  Ext.Msg.alert('','{#att_attrTransplant_select_source_server#}');\n  return;\n}\n\nvar attCatCode = app.attCatCombox.getValue();\n\nvar sourceAttServerId = app.sourceServerCombox.getValue();\nvar sourceServerIndex = app.sourceServerCombox.getStore().find('ATT_SERVER_ID',sourceAttServerId);\nvar sourceCatSecId = app.sourceServerCombox.getStore().getAt(sourceServerIndex).get('CAT_SEC_ID');\nvar sourceOrgId = app.sourceServerCombox.getStore().getAt(sourceServerIndex).get('ORG_ID');\n\nvar targetAttServerId = app.targetServerCombox.getValue();\nvar targetAttServerIndex = app.targetServerCombox.getStore().find('ATT_SERVER_ID',targetAttServerId);\nvar targetCatSecId = app.targetServerCombox.getStore().getAt(targetAttServerIndex).get('CAT_SEC_ID');\nvar targetOrgId = app.targetServerCombox.getStore().getAt(targetAttServerIndex).get('ORG_ID');\n\nvar maxThreads = app.maxThread.getValue();\n\n//检查源服务器是否可连接\nvar flag = true;\nExt.Msg.wait('{#att_attrTransplant_testing_source_server#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/xipAttMrgAction.do?method=serverTest',\n  timeout: 60*60*3600,\n  async:false,\n  params: {attCatCode:attCatCode, org_id:sourceOrgId},\n  method: 'POST',\n  success: function(response,options){\n    var resultJson = Ext.JSON.decode(response.responseText);\n    if(resultJson.flag=='true'){\n      flag = true;\n    }else{\n      flag = false;\n    }\n    msg = resultJson.msg;\n    Ext.Msg.hide();\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    msg = \"{#att_attrTransplant_server_norepeat#}\";\n    flag = false;\n  }\n});\n\nif(!flag){\n  Ext.Msg.alert('', msg);\n  return;\n}\n\n//检查目标服务器是否可连接\nExt.Msg.wait('{#att_attrTransplan_testing_tiger_server#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/xipAttMrgAction.do?method=serverTest',\n  timeout: 60*60*3600,\n  async:false,\n  params: {attCatCode:attCatCode, org_id:targetOrgId},\n  method: 'POST',\n  success: function(response,options){\n    var resultJson = Ext.JSON.decode(response.responseText);\n    if(resultJson.flag=='true'){\n      flag = true;\n    }else{\n      flag = false;\n    }\n    msg = resultJson.msg;\n    Ext.Msg.hide();\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    msg = \"{#att_attrTransplant_server_norepeat#}\";\n    flag = false;\n  }\n});\n\nif(!flag){\n  Ext.Msg.alert('', msg);\n  return;\n}\n\nExt.Msg.wait(\"{#att_attrTransplan_transplanting#}\");\n  var params = {\n    attCatCode: attCatCode,\n    sourceAttServerId: sourceAttServerId,\n    sourceCatSecId: sourceCatSecId,\n    targetAttServerId: targetAttServerId,\n    targetCatSecId: targetCatSecId,\n    maxThreads: maxThreads\n  };\n\n  Ext.Ajax.request({\n    url: '{#contextPath#}' +'/xipAttMrgAction.do?method=attrTransplant',\n    method: 'POST',\n    params: params,\n    success: function(response,options){\n      Ext.Msg.hide();\n      \n      var resultJson = Ext.JSON.decode(response.responseText);\n      if(resultJson.flag == 0){\n        Ext.Msg.alert('', resultJson.msg);\n        return;\n      }\n      \n      timer = window.setInterval(loadAttrTransplantInfo, 5000);\n    },\n    failure: function(response,options){\n      Ext.Msg.hide();\n      Ext.Msg.alert('','{#att_attrTransplan_transplant_error#}');\n    }\n  }); "},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","title":"{#att_attrTransplan_run_result#}","layout":"border","itemId":"southPanel"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel4"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"total","fieldLabel":"{#att_attrTransplan_enclosure_total#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"hasDone","fieldLabel":"{#att_attrTransplan_complete#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"text":"{#att_attrTransplan_refresh_result#}","width":"100","itemId":"refreshBtn","y":"6","x":"30"},"events":{"click":"timer = window.setInterval(loadAttrTransplantInfo, 5000);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#att_attrTransplan_stop_refresh#}","width":"80","itemId":"stopBtn","y":"6","x":"40"},"events":{"click":"if(timer!=null){\n  clearInterval(timer);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","title":"{#att_attrTransplan_running#}","pagingBar":"false","itemId":"currentGrid"},"children":[{"configs":{"pageSize":"-1","itemId":"store","fields":"[{name:'attrName'}]"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"numCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrTransplan_enclosure_name#}","dataIndex":"attrName","itemId":"attrNameCol","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"},{"configs":{"region":"east","title":"{#att_attrTransplan_run_error#}","pagingBar":"false","width":"350","split":"true","itemId":"errorGrid"},"children":[{"configs":{"pageSize":"-1","itemId":"store","fields":"[{name:'attrName'}]"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"numCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrTransplan_enclosure_name#}","dataIndex":"attrName","itemId":"attrNameCol","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}