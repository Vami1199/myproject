{"inframe":false,"title":"附件控制","hidden":false,"roles":{"default":1},"children":[{"configs":{"cssLinks":"[\"xip/css/default.css\"]","loginRequired":"false","jsLinks":"[\"xip//swfupload/swfupload.js\"]","serverScript":"//三方语言,引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xip/tools/att/attrManage/json/attrControl');","head":"<script type=\"text/javascript\">\n\n/*\n HTML5 Shiv v3.7.0 | @afarkas @jdalton @jon_neal @rem | MIT/GPL2 Licensed\n*/\n(function(l,f){function m(){var a=e.elements;return\"string\"==typeof a?a.split(\" \"):a}function i(a){var b=n[a[o]];b||(b={},h++,a[o]=h,n[h]=b);return b}function p(a,b,c){b||(b=f);if(g)return b.createElement(a);c||(c=i(b));b=c.cache[a]?c.cache[a].cloneNode():r.test(a)?(c.cache[a]=c.createElem(a)).cloneNode():c.createElem(a);return b.canHaveChildren&&!s.test(a)?c.frag.appendChild(b):b}function t(a,b){if(!b.cache)b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag();\na.createElement=function(c){return!e.shivMethods?b.createElem(c):p(c,a,b)};a.createDocumentFragment=Function(\"h,f\",\"return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&(\"+m().join().replace(/[\\w\\-]+/g,function(a){b.createElem(a);b.frag.createElement(a);return'c(\"'+a+'\")'})+\");return n}\")(e,b.frag)}function q(a){a||(a=f);var b=i(a);if(e.shivCSS&&!j&&!b.hasCSS){var c,d=a;c=d.createElement(\"p\");d=d.getElementsByTagName(\"head\")[0]||d.documentElement;c.innerHTML=\"x<style>article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}<\/style>\";\nc=d.insertBefore(c.lastChild,d.firstChild);b.hasCSS=!!c}g||t(a,b);return a}var k=l.html5||{},s=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,r=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,j,o=\"_html5shiv\",h=0,n={},g;(function(){try{var a=f.createElement(\"a\");a.innerHTML=\"<xyz><\/xyz>\";j=\"hidden\"in a;var b;if(!(b=1==a.childNodes.length)){f.createElement(\"a\");var c=f.createDocumentFragment();b=\"undefined\"==typeof c.cloneNode||\n\"undefined\"==typeof c.createDocumentFragment||\"undefined\"==typeof c.createElement}g=b}catch(d){g=j=!0}})();var e={elements:k.elements||\"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video\",version:\"3.7.0\",shivCSS:!1!==k.shivCSS,supportsUnknownElements:g,shivMethods:!1!==k.shivMethods,type:\"default\",shivDocument:q,createElement:p,createDocumentFragment:function(a,b){a||(a=f);\nif(g)return a.createDocumentFragment();for(var b=b||i(a),c=b.frag.cloneNode(),d=0,e=m(),h=e.length;d<h;d++)c.createElement(e[d]);return c}};l.html5=e;q(f)})(this,document);\n<\/script>\n\n<style type=\"text/css\">\n  article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}\n<\/style>\n\n","itemId":"module"},"events":{"initialize":"Wb.apply(app, {\n  init: function(attrgrid, srcid, attcat, orgid, busno, canup, candown, candel, userid, filesize, contextPath) {\n    attrManagerUtil.flagxwl = attrgrid;\n    attrManagerUtil.srcId = srcid;\n    attrManagerUtil.attCat = attcat;\n    attrManagerUtil.orgId = orgid;\n    attrManagerUtil.busNo = busno;\n    attrManagerUtil.userId = userid;\n    attrManagerUtil.contextPath = contextPath;\n    attrManagerUtil.canUp = canup;\n    attrManagerUtil.candown = candown;\n    attrManagerUtil.canDel = candel;\n    \n    if(!Ext.isEmpty(filesize) && filesize!='undefined'){\n      attrManagerUtil.fileSizeLimit = filesize;\n    }else{\n      Ext.Ajax.request({\n        url : contextPath +'/m?xwl=xip/tools/att/attrManage/data/getAttrCatByCatCode',\n        method: 'POST',\n        params:{\"attCatCode\": attrManagerUtil.attCat},\n        success: function(response,options){\n          var temp = response.responseText;\n          var response = Ext.JSON.decode(temp);\n          attrManagerUtil.fileSizeLimit = response.FILE_SIZE_LIMIT==null?0:response.FILE_SIZE_LIMIT;\n        },\n        failure: function(response,options){\n        }\n      });\n    }\n    \n    if(!attrManagerUtil.isSupportHtml5){\n      var config = attrManagerUtil.getSWFConfig(app.btn_upload);\n\n      attrManagerUtil.swfupload = new SWFUpload(config);\n\n      Ext.get(attrManagerUtil.swfupload.movieName).setStyle({\n        position : 'absolute',\n        top : 0,\n        left : -2\n      });\n    }\n    \n    if(canup=='Y'){\n      app.btn_upload.enable();\n    }else if(canup=='N'){\n      app.btn_upload.disable();\n    }\n    if(candown =='N'){\n      app.btn_batch_download.disable();\n    }\n    else if(candown =='Y'){\n      app.btn_batch_download.enable();\n    }\n    if(candel=='N' ) {\n      app.deleteBtn.disable();\n    }\n    else if(candel=='Y' ){\n      app.deleteBtn.enable();\n    }\n    \n    app.attrGrid.store.load();\n  }\n});\n"},"children":[{"configs":{"headerHtml":"<script> \n  var attrManagerUtil = {\n    fileSizeLimit: 0,\n    flagxwl:\"\",\n    srcId:\"\",\n    attCat:\"\",\n    orgId:\"\",\n    busNo:\"\",\n    canUp:\"\",\n    canDown:\"\",\n    canDel:\"\",\n    userId:\"\",\n    files: [],\n    barList: null,\n    index: 0,\n    swfupload: null,\n    //页面是否支持html5\n    isSupportHtml5: null,\n    //添加时存在的重名的文件\n    duplNameFiles: [],\n    //添加时超过设置大小的文件\n    tooLargeFiles: [],\n    //添加时全部文件\n    selectedAllFiles: [],\n    contextPath:'',\n    init: function(){\n      if(window.applicationCache){\n        attrManagerUtil.isSupportHtml5 = true;\n      }else{\n        attrManagerUtil.isSupportHtml5 = false;\n      }\n    },\n    //上传路径  \n    getUploadUrl: function(){\n      return attrManagerUtil.contextPath+'/xipAttMrgAction.do?method=upload&src_id='+attrManagerUtil.srcId+'&attCatCode='+attrManagerUtil.attCat+'&org_id='+attrManagerUtil.orgId+'&bus_no='+attrManagerUtil.busNo+'&userId='+attrManagerUtil.userId;\n    },\n\n    //swfupload加载前时触发\n    swfupload_preload_handler : function(obj){\n      if (!obj.support.loading) {\n        Ext.Msg.alert('','{#att_attrManage_brower_low#}');\n        return false;\n      }\n    },\n\n    //swfupload加载完毕时触发\n    swfupload_loaded_function : function(){\n\n    },\n\n    //swfupload加载失败时触发\n    swfupload_load_failed_handler : function(){\n      Ext.Msg.alert('','{#att_attrManage_SWFUpload_fail#}');\n    },\n\n    file_dialog_start_handler : function(){\n      attrManagerUtil.duplNameFiles = new Array();\n      attrManagerUtil.tooLargeFiles = new Array();\n      attrManagerUtil.selectedAllFiles = new Array();\n    },\n\n    //file添加到上传队列时触发\n    file_queued_handler : function(file){\n      //判断是否有重名的文件，如果有则添加到files[]数组中\n      if(attrManagerUtil.flagxwl.attrGrid.store.find('ATT_FILE_NAME',file.name) > -1){\n        attrManagerUtil.duplNameFiles.push(file);\n      }\n      //判断是否有过大的文件，如果有则田添加到tooLargeFiles数组中\n      if(attrManagerUtil.fileSizeLimit>0){\n        if(file.size > attrManagerUtil.fileSizeLimit * 1024 * 1024){\n          attrManagerUtil.tooLargeFiles.push(file);\n        }\n      }\n      attrManagerUtil.selectedAllFiles.push(file);\n    },\n\n    //file添加到上传队列失败时触发\n    file_queue_error_handler : function(file, errorCode, message){\n\n    },\n\n    //file全部添加到队列时触发\n    file_dialog_complete_handler : function(selectedFilesNum, currentQueued, totalQueued){\n      if(selectedFilesNum==0 || attrManagerUtil.selectedAllFiles.length==0){\n        return;\n      }\n\n      var flag = true;\n      var msg = '';\n\n      Ext.Msg.wait('{#att_attrManage_in_connect#}');\n      Ext.Ajax.request({\n        url : attrManagerUtil.contextPath+'/xipAttMrgAction.do?method=serverTest',\n        timeout: 60*60*3600,\n        async:false,\n        params: {attCatCode:attrManagerUtil.attCat, org_id:attrManagerUtil.orgId},\n        method: 'POST',\n        success: function(response,options){\n          var resultJson = Ext.JSON.decode(response.responseText);\n          if(resultJson.flag=='true'){\n            flag = true;\n          }else{\n            flag = false;\n          }\n          msg = resultJson.msg;\n          Ext.Msg.hide();\n        },\n        failure: function(response,options){\n          Ext.Msg.hide();\n          msg = \"{#att_attrManage_server_norepeat#}\";\n          flag = false;\n        }\n      });\n\n      if(!flag){\n        for(var j=0; j<attrManagerUtil.selectedAllFiles.length; j++){\n          attrManagerUtil.swfupload.cancelUpload(attrManagerUtil.selectedAllFiles[j].id,false);\n        }\n\n        attrManagerUtil.swfupload.uploadStopped = false;\n\n        Ext.Msg.alert('', msg);\n        return;\n      }\n\n      //存在重名文件\n      if(attrManagerUtil.duplNameFiles.length!=0){\n        var message = '';\n        for(var i=0; i<attrManagerUtil.duplNameFiles.length; i++){\n          message = message + '{#att_attrManage_file#}' + attrManagerUtil.duplNameFiles[i].name +'{#att_attrManage_isExist#}'+'<br/>';\n        }\n\n        for(var j=0; j<attrManagerUtil.selectedAllFiles.length; j++){\n          attrManagerUtil.swfupload.cancelUpload(attrManagerUtil.selectedAllFiles[j].id,false);\n        }\n\n        attrManagerUtil.swfupload.uploadStopped = false;\n\n        Ext.Msg.alert('', message);\n        return;\n      }\n\n      //存在过大文件\n      if(attrManagerUtil.tooLargeFiles.length!=0){\n        var message = '';\n        for(var i=0; i<attrManagerUtil.tooLargeFiles.length; i++){\n          message = message + '{#att_attrManage_file#}' + attrManagerUtil.tooLargeFiles[i].name +'{#att_attrManage_toBig#}'+'<br/>';\n        }\n\n        for(var j=0; j<attrManagerUtil.selectedAllFiles.length; j++){\n          attrManagerUtil.swfupload.cancelUpload(attrManagerUtil.selectedAllFiles[j].id,false);\n        }\n\n        attrManagerUtil.swfupload.uploadStopped = false;\n\n        Ext.Msg.alert('', message);\n        return;\n      }\n\n      for(var j=0; j<attrManagerUtil.selectedAllFiles.length; j++){\n        var json = {ATT_FILE_NAME:attrManagerUtil.selectedAllFiles[j].name, UPLOAD_INDEX:attrManagerUtil.index, UPLOAD_MSG:'{#att_attrManage_ready_upload#}', id:attrManagerUtil.selectedAllFiles[j].id};\n        attrManagerUtil.flagxwl.attrGrid.store.insert(attrManagerUtil.flagxwl.attrGrid.store.getCount(), json);\n      }\n\n      attrManagerUtil.flagxwl.attrGrid.store.commitChanges();\n\n      if (attrManagerUtil.swfupload.getStats().files_queued > 0) {\n        attrManagerUtil.swfupload.uploadStopped = false;\t\t\n        attrManagerUtil.swfupload.startUpload();\n      }\n\n      Ext.Msg.wait('{#att_attrManage_in_upload#}');\n    },\n\n    //开始上传\n    upload_start_handler : function(file){\n      //var rec = attrManagerUtil.flagxwl.attrGrid.store.getById(file.id);\n      var rec = attrManagerUtil.flagxwl.attrGrid.store.findRecord('ATT_FILE_NAME', file.name);\n      rec.set('UPLOAD_MSG', '{#att_attrManage_start_upload#}');\n      rec.commit();\n    },\n\n    //上传过程中\n    upload_progress_handler : function(file, bytesLoaded, bytesTotal){\n      //var rec = attrManagerUtil.flagxwl.attrGrid.store.getById(file.id);\n      var rec = attrManagerUtil.flagxwl.attrGrid.store.findRecord('ATT_FILE_NAME', file.name);\n      rec.set('UPLOAD_MSG', '{#att_attrManage_uploading#}');\n      rec.commit();\n    },\n\n    //上传成功\n    upload_success_handler : function(file, serverData, responseReceived){\n      //var rec = attrManagerUtil.flagxwl.attrGrid.store.getById(file.id);\n      var rec = attrManagerUtil.flagxwl.attrGrid.store.findRecord('ATT_FILE_NAME', file.name);\n      rec.set('UPLOAD_MSG', '{#att_attrManage_upload_success#}');\n      rec.commit();\n    },\n\n    //上传失败\n    upload_error_handler : function(file, errorCode, message){\n      //var rec = attrManagerUtil.flagxwl.attrGrid.store.getById(file.id);\n      var rec = attrManagerUtil.flagxwl.attrGrid.store.findRecord('ATT_FILE_NAME', file.name);\n      rec.set('UPLOAD_MSG', '{#att_attrManage_upload_fail#}');\n      rec.commit();\n    },\n\n    //全部上传完毕\n    upload_complete_handler : function(file){\n      if (attrManagerUtil.swfupload.getStats().files_queued > 0 && attrManagerUtil.swfupload.uploadStopped == false) {\n        attrManagerUtil.swfupload.startUpload();\n      }else{\n        attrManagerUtil.flagxwl.attrGrid.store.load({params:{src_id: attrManagerUtil.srcId}});\n\n        Ext.Msg.hide();\n      }\n    },\n\n    getSWFConfig : function(btn){\n      var placeHolderId = Ext.id();\n      var em = btn.getEl().child('em');\n      if(em==null){\n        em = Ext.get(btn.getId()+'-btnWrap');\n      }\t\t\n      em.setStyle({\n        position : 'relative',\n        display : 'block'\n      });\n      em.createChild({\n        tag : 'div',\n        id : placeHolderId\n      });\n      return {\n        debug : false,\n        flash_url : attrManagerUtil.contextPath+'/xip/swfupload/swfupload.swf', \n        flash9_url : attrManagerUtil.contextPath+'/xip/swfupload/swfupload_fp9.swf', \n        upload_url : attrManagerUtil.getUploadUrl(),\n        post_params : {\n          'src_id': attrManagerUtil.srcId,\n          'attCatCode': attrManagerUtil.attCat,\n          'org_id': attrManagerUtil.orgId,\n          'bus_no': attrManagerUtil.busNo,\n          'userId': attrManagerUtil.userId\n        },\n        file_size_limit : (100*1024),//MB\n        file_types : '*.*',\n        file_types_description : 'All Files',\n        file_upload_limit : 50,\n        file_queue_limit : 0,\n\n        button_width: em.getWidth(),\n        button_height: em.getHeight(),\n        button_window_mode: SWFUpload.WINDOW_MODE.TRANSPARENT,\n        button_cursor: SWFUpload.CURSOR.HAND,\n        button_placeholder_id: placeHolderId, \n\n        swfupload_preload_handler : attrManagerUtil.swfupload_preload_handler, //swfupload加载前时触发 \n        swfupload_loaded_handler : attrManagerUtil.swfupload_loaded_function,  //swfupload加载完毕时触发\n        swfupload_load_failed_handler : attrManagerUtil.swfupload_load_failed_handler,  //swfupload加载失败时触发\n\n        file_dialog_start_handler :attrManagerUtil.file_dialog_start_handler, //选择文件窗口打开是触发\n        file_queued_handler : attrManagerUtil.file_queued_handler,  //file添加到上传队列时触发\n        file_queue_error_handler : attrManagerUtil.file_queue_error_handler,  //file添加到上传队列失败时触发\n        file_dialog_complete_handler : attrManagerUtil.file_dialog_complete_handler,  //所选file全部添加到队列时触发\n\n        upload_start_handler : attrManagerUtil.upload_start_handler,  //开始上传\n        upload_progress_handler : attrManagerUtil.upload_progress_handler,  //上传过程中\n        upload_success_handler : attrManagerUtil.upload_success_handler,  //上传成功\n        upload_error_handler : attrManagerUtil.upload_error_handler,  //上传失败\n        upload_complete_handler : attrManagerUtil.upload_complete_handler  //全部上传完毕\n      };\n    },\n\n    //以下部分为html5所用的方法\n    uploadProgress: function(evt) {\n      if (evt.lengthComputable) {\n        var record = attrManagerUtil.flagxwl.attrGrid.store.findRecord('UPLOAD_INDEX', attrManagerUtil.index);\n\n        if(record){\n          record.set('UPLOAD_MSG','{#att_attrManage_uploading#}');\n          attrManagerUtil.flagxwl.attrGrid.store.commitChanges();\n        }\n\n        console.log(evt.loaded);\n        console.log(evt.total);\n        var percentComplete = Math.round(evt.loaded * 100 / evt.total) +'%';\n        attrManagerUtil.barList[attrManagerUtil.index].innerHTML = '{#att_attrManage_upload_schedule#}' + percentComplete;\n        attrManagerUtil.barList[attrManagerUtil.index].style.width = percentComplete;\n      }\n    },\n\n    uploadComplete: function(evt) {\n      var record = attrManagerUtil.flagxwl.attrGrid.store.findRecord('UPLOAD_INDEX', attrManagerUtil.index);\n\n      if(record){\n        record.set('UPLOAD_MSG','{#att_attrManage_upload_success#}');\n        attrManagerUtil.flagxwl.attrGrid.store.commitChanges();\n      }\n\n      if(attrManagerUtil.index === attrManagerUtil.files.length - 1) {\n        console.log('all');\n        attrManagerUtil.flagxwl.attrGrid.store.load({params:{src_id: attrManagerUtil.srcId}});\n\n        Ext.Msg.hide();\n\n        //变量重置\n        attrManagerUtil.files = [];\n        attrManagerUtil.barList = null;\n        attrManagerUtil.index = 0;\n\n        return;\n      }\n      attrManagerUtil.index++;\n      attrManagerUtil.uploadFile();\n    },\n\n    uploadFailed: function(evt) {\n      var record = attrManagerUtil.flagxwl.attrGrid.store.findRecord('UPLOAD_INDEX', attrManagerUtil.index);\n      if(record){\n        record.set('UPLOAD_MSG','{#att_attrManage_upload_fail#}');\n        attrManagerUtil.flagxwl.attrGrid.store.commitChanges();\n      }\n      Ext.Msg.alert('','{#att_attrManage_upload_error#}');\n      return;\n    },\n\n    uploadCanceled: function(evt ) {\n      var record = attrManagerUtil.flagxwl.attrGrid.store.findRecord('UPLOAD_INDEX', attrManagerUtil.index);\n      if(record){\n        record.set('UPLOAD_MSG','{#att_attrManage_cancel_upload#}');\n        attrManagerUtil.flagxwl.attrGrid.store.commitChanges();\n      }\n      Ext.Msg.alert('','{#att_attrManage_upload_file_cancel#}');\n      return;\n    },\n\n    uploadFile: function() {\n      var xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", attrManagerUtil.uploadProgress, false);\n      xhr.addEventListener(\"load\", attrManagerUtil.uploadComplete, false);\n      xhr.addEventListener(\"error\", attrManagerUtil.uploadFailed, false);\n      xhr.addEventListener(\"abort\", attrManagerUtil.uploadCanceled, false);\n\n      uploadUrl = attrManagerUtil.getUploadUrl();\n\n      xhr.open(\"POST\", uploadUrl, true);\n      var fd = new FormData();\n      fd.append(\"fileToUpload\", attrManagerUtil.files[attrManagerUtil.index]);\n      xhr.send(fd);\n    },\n\n    startUpload: function(){\n      Ext.Msg.wait('{#att_attrManage_in_upload#}');\n      attrManagerUtil.uploadFile();\n    },\n\n    fireUpload: function(uploadFiles){\n      var fs = uploadFiles;\n\n      //判断是否选择了文件\n      if(fs.length==0){\n        Ext.Msg.alert('','{#att_attrManage_select_upload_file#}');\n        return;\n      }\n\n      //判断文件名称是否有重复的\n      var flag = true;\n      var msg = '';\n      if(fs!=null){\n        for(var i=0; i<fs.length; i++){\n          if(attrManagerUtil.flagxwl.attrGrid.store.find('ATT_FILE_NAME',fs[i].name) > -1){\n            flag = false;\n            msg = '{#att_attrManage_file#}' + fs[i].name + '{#att_attrManage_isExist#}';\n            break;\n          }\n        }\n      }\n\n      if(!flag){\n        Wb.info(msg);\n        return;\n      }\n\n      Ext.Msg.wait('{#att_attrManage_in_connect#}');\n      Ext.Ajax.request({\n        url : attrManagerUtil.contextPath+'/xipAttMrgAction.do?method=serverTest',\n        timeout: 60*60*3600,\n        async:false,\n        params: {attCatCode:attrManagerUtil.attCat, org_id:attrManagerUtil.orgId},\n        method: 'POST',\n        success: function(response,options){\n          var resultJson = Ext.JSON.decode(response.responseText);\n          if(resultJson.flag=='true'){\n            flag = true;\n          }else{\n            flag = false;\n          }\n          msg = resultJson.msg;\n          Ext.Msg.hide();\n        },\n        failure: function(response,options){\n          Ext.Msg.hide();\n          msg = \"{#att_attrManage_server_norepeat#}\";\n          flag = false;\n        }\n      });\n\n      if(!flag){\n        Ext.Msg.alert('', msg);\n        return;\n      }\n\n      //判断文件大小是否超过限制\n      if(attrManagerUtil.fileSizeLimit>0){\n        for(var i = 0; i < fs.length; i++) {\n          var file = fs[i];\n          var fileSize = 0;\n\n          if(file.size > attrManagerUtil.fileSizeLimit * 1024 * 1024){\n            Ext.Msg.alert('', '{#att_attrManage_file#}'+file.name+'{#att_attrManage_toBig#}');\n            return;\n          }\n        }\n      }\n\n      var html = '';\n      for(var i = 0; i < fs.length; i++) {\n        var file = fs[i];\n        attrManagerUtil.files.push(file);\n        var fileSize = 0;\n        if (file.size > 1024 * 1024) {\n          fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';\n        } else {\n          fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';\n        }\n        html += '<div class=\"file-item well\">'+\n          '<div class=\"progress\">'+\n          '<div class=\"bar\" name=\"bar\" style=\"text-align: left;\">'+'{#att_attrManage_upload_schedule#}'+'：0%<\/div><\/div>' +\n          '<hr style=\"height:1px;border:none;border-top:1px dashed #0066CC;\" />' +\n          '<div><div class=\"span2\">'+'{#att_attrManage_file_name#}'+'：'+ file.name +'<\/div>' +\n          '<hr style=\"height:1px;border:none;border-top:1px dashed #0066CC;\" />' +              \n          '<div class=\"span2\">'+'{#att_attrManage_file_size#}'+'：'+ fileSize +'<\/div>' +\n          '<hr style=\"height:1px;border:none;border-top:1px dashed #0066CC;\" />' +\n          '<div class=\"span2\">'+'{#att_attrManage_file_type#}'+'：'+ file.type +'<\/div>'+\n          '<\/div>'+\n          '<\/div>'+\n          '<hr style=\"height:1px;border:none;border-top:1px solid #555555;\"/>';\n\n        var json = {ATT_FILE_NAME:file.name, UPLOAD_INDEX:i, UPLOAD_MSG:'{#att_attrManage_ready_upload#}'};\n        attrManagerUtil.flagxwl.attrGrid.store.insert(attrManagerUtil.flagxwl.attrGrid.store.getCount(), json);\n        attrManagerUtil.flagxwl.attrGrid.store.commitChanges();\n      }\n\n      document.getElementById('fileList').innerHTML = html;\n\n      attrManagerUtil.barList = document.getElementsByName('bar');\n\n      attrManagerUtil.startUpload();\n    },\n\n    fileSelected: function() {\n      var fs = document.getElementById('fileToUpload').files;\n      attrManagerUtil.fireUpload(fs);\n    },\n\n    //文件拖动上传\n    handleDragOver: function(event) {\n      event.stopPropagation();\n      event.preventDefault();\n    },\n\n    handleDrop: function(event) {\n      event.stopPropagation();\n      event.preventDefault();\n      attrManagerUtil.fireUpload(event.dataTransfer.files);\n    }\n  };\n\n  attrManagerUtil.init();\n\n<\/script> \n","itemId":"clientscript1"},"children":[],"expanded":false,"type":"clientscript"},{"configs":{"layout":"border","itemId":"container1"},"children":[{"configs":{"region":"center","columnLines":"true","multiSelect":"true","selType":"checkboxmodel","normalName":"attrGrid","itemId":"attrGrid"},"events":{"afterrender":"var dropArea = document.getElementById(app.attrGrid.getId());\n\ntry{\n  dropArea.addEventListener('drop', handleDrop, false);\n  dropArea.addEventListener('dragover', handleDragOver, false);\n}catch(e){\n\n}","tagEvents":"cellclick :function (Table ,  td,  cellIndex, record,  tr,  rowIndex, e,  eOpts ){\nif(cellIndex==5){\n  var id = record.data.ATT_ID;\n  window.location.href='{#contextPath#}'+\"/xipAttMrgAction.do?method=down&att_id=\"+id.toString();\n}else if(cellIndex==6){\n  var id = record.data.ATT_ID;\n  //  window.location.href=contextPath+\"/platform/attachment/attachmentView.jsp?att_id=\"+id.toString();\n  window.open ('{#contextPath#}'+\"/xipAttMrgAction.do?method=down&view=1&att_id=\"+id.toString(),'newwindow','height=768,width=1024,top=0,left=0,toolbar=no,menubar=no,scrollbars=yes, resizable=no,location=no, status=no');\n}\n}"},"children":[{"configs":{"params":"{src_id:'{#srcId#}'}","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/att/attrManage/data/getAttrs"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#att_attrManage_upload#}","itemId":"btn_upload","disabled":"'{#canUp#}'=='N'?true:false","iconCls":"upward_icon"},"events":{"click":"if(attrManagerUtil.isSupportHtml5){\n  document.getElementById('fileToUpload').click();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#att_attrManage_download#}","itemId":"btn_batch_download","disabled":"'{#canDown#}'=='N'?true:false","iconCls":"open_icon"},"events":{"click":"var rows = app.attrGrid.getSelectionModel().getSelection();\nif(rows.length==0){\n  Ext.Msg.alert('{#att_attrManage_prompt#}','{#att_attrManage_select_record#}');\n}else{\n  var p = new Array();\n  for(var i=0; i<rows.length; i++){\n    var id = rows[i].data.ATT_ID;\n    p.push(id);\n  }\n  window.location.href = attrManagerUtil.contextPath+\"/xipAttMrgAction.do?method=down&selectedIds=\"+p.toString();\t\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#att_attrManage_delete#}","itemId":"deleteBtn","disabled":"'{#canDel#}'=='N'?true:false","iconCls":"application_delete_icon"},"events":{"click":"var rows = app.attrGrid.getSelectionModel().getSelection();\n\nif(rows.length==0){\n  \n  Ext.Msg.alert('{#att_attrManage_prompt#}','{#att_attrManage_select_record#}');\n}else{\n  var p = new Array();\n  for(var i=0; i<rows.length; i++){\n    var id = rows[i].data.ATT_ID;\n    p.push(id);\n  }\n  \n  Ext.Msg.wait('{#att_attrManage_in_delete#}');\n  Ext.Ajax.request({\n    url : attrManagerUtil.contextPath+ '/xipAttMrgAction.do?method=del',\n    method: 'POST',\n    timeout: 6000000,\n    params:{ids : p.toString()},\n    success: function(response,options){\n      Ext.Msg.hide();\n      var json = Ext.JSON.decode(response.responseText);\n      Ext.Msg.alert('{#att_attrManage_prompt#}',json.msg,function(){app.attrGrid.store.load({params:{src_id: attrManagerUtil.srcId }});});\n    },\n    failure: function(response,options){\n      Ext.Msg.alert('{#att_attrManage_prompt#}','{#att_attrManage_prompt_msg1#}');\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"hidden":"true","html":"<font color='red' style=\"font-weight:bold;\">&nbsp;&nbsp;可以直接将文件拖拽到表格进行上传<\/font>","itemId":"msglabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#att_attrManage_rowNum#}","width":"60","xtype":"rownumberer","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrManage_enclosure_name#}","width":"200","dataIndex":"ATT_FILE_NAME","itemId":"COLUMN_ATT_FILE_NAME","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrManage_upload_time#}","width":"120","dataIndex":"CREATION_DATE","itemId":"COLUMN_CREATION_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrManage_upload_message#}","width":"100","dataIndex":"UPLOAD_MSG","itemId":"COLUMN_UPLOAD_MSG"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrManage_download_1#}","align":"center","width":"50","itemId":"COLUMN_DOWNLOAD","renderer":"var returnValue = '';\nvar imgUrl = '{#contextPath#}' + '/xip/images/icon_down.gif';\nreturnValue = \"<img src='\" + imgUrl + \"' style='width:10px;height:10px'/>\"; \nreturn returnValue;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#att_attrManage_preview#}","align":"center","width":"50","itemId":"COLUMN_VIEW","renderer":"var returnValue = '';\nvar imgUrl = '{#contextPath#}' + '/xip/images/owc_view.bmp';\nreturnValue = \"<img src='\"+imgUrl+\"' style='width:12px;height:12px'/>\"; \nreturn returnValue;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ATT_ID","hidden":"true","dataIndex":"ATT_ID","itemId":"COLUMN_ATT_ID"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"east","frame":"true","hidden":"true","width":"200","split":"true","html":"<div class=\"container span7 offset3 well\">\n    <form id=\"uploadForm\" class=\"form-horizontal\" enctype=\"multipart/form-data\" method=\"post\">\n        <fieldset>\n            <legend>最近文件上传信息<\/legend>\n            <div class=\"control-group\">\n                <label class=\"control-label\" for=\"fileToUpload\" style=\"display: none;\">选择文件(支持多选):<\/label>\n                <div class=\"controls\">\n                    <input type=\"file\" name=\"fileToUpload\" id=\"fileToUpload\" multiple=\"multiple\" onchange=\"attrManagerUtil.fileSelected();\" style=\"display: none;\"/>\n                <\/div>\n            <\/div>\n            <div class=\"form-actions text-left\" >\n                <button type=\"button\" class=\"btn btn-primary\" id=\"subBtn\" onClick=\"attrManagerUtil.startUpload();\" style=\"display: none;\">立即上传<\/button>\n            <\/div>\n            <hr style=\"height:1px;border:none;border-top:1px solid #555555;\"/>\n            <div class=\"file-list\" id=\"fileList\"><\/div>\n          <input  type=\"submit\" id=\"submit\" value=\"submit\"/>\n        <\/fieldset>\n    <\/form>\n<\/div>","border":"false","itemId":"viewUploadPanel"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"container"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}