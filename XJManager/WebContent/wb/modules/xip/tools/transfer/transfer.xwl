{"inframe":false,"title":"平台数据移植","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userName = request.getSession().getAttribute(\"XzSessionVars\").get('userName');\nrequest.setAttribute(\"userName\",userName);\n\ncom.xzsoft.xip.platform.util.XipUtil.checkUserFunSec(request,response);","loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/tools/transfer/json/transfer\");","itemId":"module"},"children":[{"configs":{"autoLoad":"false","itemId":"checkStore","url":"m?xwl=xip/tools/transfer/DATA/check"},"children":[],"expanded":false,"type":"store"},{"configs":{"title":"{#xip_tools_transfer_import#}","height":"450","layout":"border","width":"630","closeAction":"hide","resizable":"false","itemId":"importWin","dialog":"false","modal":"true"},"events":{"beforeclose":"app.IeGrid.store.load();"},"children":[{"configs":{"region":"north","frame":"true","height":"'15%'","style":"border-width:0px","layout":"form","itemId":"fileForm","border":"false"},"children":[{"configs":{"height":"50","layout":"column","itemId":"fileFS","padding":"10px,0px,0px,0px"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"chooseFile","fieldLabel":"{#xip_tools_transfer_chooseFile#}"},"children":[],"expanded":false,"type":"file"},{"configs":{"text":"{#xip_tools_transfer_import#}","itemId":"submitbtn","iconCls":"import_icon","x":"5"},"events":{"click":"var fileName = app.chooseFile.getValue();\nvar arr = fileName.split('.');\nif(fileName === null || fileName === ''){\n  Ext.Msg.alert('{#xip_tools_transfer_tip#}','{#xip_tools_transfer_chosefile#}');\n}else{\n  if(arr[arr.length-1]!=='txt'){\n      Ext.Msg.alert('{#xip_tools_transfer_tip#}','{#xip_tools_transfer_fileerror#}');\n    }\n  else{\napp.fileForm.getForm().submit({\n  url:'platformAction.do?method=doImp',\n  waitTitle: '{#xip_tools_transfer_tip#}', //标题\n  waitMsg: '{#xip_tools_transfer_wait#}', //提示信息    \n  method : 'POST',\t\t\t\t\t\t\t\n  success : function(from, action) {\n     var temp = action.response.responseText;\n     var dataObj = Ext.JSON.decode(temp);\n     var jsonObj;\n    //==============0表示导入成功=============\n    if(dataObj.flag ==='0'){\n      var _infoArray = dataObj.datas;\n      Ext.each(_infoArray,function(item){\n        jsonObj = {TABLE_NAME:item.IE_CODE,IMPORT_MSG:item.IMP_RESULT};\n        app.infoGrid.store.add(jsonObj);\n      });\n    }else{\n      jsonObj = {TABLE_NAME:'{#xip_tools_transfer_othermsg#}',IMPORT_MSG:dataObj.msg};\n    }\n\n  },\t\t\t\t\t\t\t\n  failure : function(from, action) {\n     var temp = action.response.responseText;\n     var dataObj = Ext.JSON.decode(temp);\n     var jsonObj;\n     var _infoArray = dataObj.datas;\n     Ext.each(_infoArray,function(item){\n        jsonObj = {TABLE_NAME:item.IE_CODE,IMPORT_MSG:item.IMP_RESULT};\n        app.infoGrid.store.add(jsonObj);\n      });\n     Ext.Msg.alert('',dataObj.msg);\n  }\t\t\t\t\t\t\n});\n  }\n}\n\n\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_transfer_close#}","itemId":"closeWin","iconCls":"cancel_icon","x":"10"},"events":{"click":"app.importWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"infoGrid","simpleSelect":"false","viewConfig":" {\n enableTextSelection:true\n }"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_tabName#}","width":"120","dataIndex":"TABLE_NAME","itemId":"TABLE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_log#}","autoWrap":"true","dataIndex":"IMPORT_MSG","itemId":"IMPORT_MSG_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","autoLoad":"false","url":"m?xwl=xip/tools/transfer/DATA/selectIeGrid","fields":"[{name:'TABLE_NAME'},{name:'IMPORT_MSG'}]"},"events":{"load":"app.IeGrid.getSelectionModel().selectAll();","beforeload":"store.getProxy().extraParams.bm = app.bm.getValue();\nstore.getProxy().extraParams.mc = app.mc.getValue();\nstore.getProxy().extraParams.blx = app.blx.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"itemId":"collectWinBtn"},"children":[{"configs":{"text":"{#xip_tools_transfer_close#}","itemId":"colCloseBtn","iconCls":"cancel_icon"},"events":{"click":"app.colName.setValue(\"\");\napp.collectWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"title":"{#xip_tools_transfer_my_favorite#}","height":"480","layout":"border","width":"600","closeAction":"hide","resizable":"false","buttons":"app.collectWinBtn","buttonAlign":"center","itemId":"collectWin","dialog":"false","modal":"true"},"events":{"show":"app.collectGrid.store.load();","cancel":"app.colName.setValue(\"\");\n// var record = app.IeGrid.getSelectionModel().getSelection();\n//     var code = '';\n//     for (var i = 0; i < record.length; i++) {\n//       var ie_code = record[i].get('IE_CODE');\n//       code = code + ',' + ie_code;\n//     }\n//     var _code = code.substring(1, code.length);\n//     Wb.download('platformAction.do?method=doExp', {\n//       expcodes: _code\n//     });\n//     app.checkStore.load({params:{col_code:_code},callback:function(){\n//       if(app.checkStore.getCount()===0){\n//           var json = {\n//             COL_ID : Xip.getId(),\n//             USER_NAME : '{#userName#}',\n//             COL_CODE : _code\n//           };\n//           Wb.request({\n//             url:\"m?xwl=xip/tools/transfer/DATA/saveIeCollect\",\n//             params:json,\n//             success:function(){\n//             },\n//             failure:function(){\n//             }        \n//           });\n//       }\n//     }});\n    ","close":"app.colName.setValue(\"\");\n"},"children":[{"configs":{"region":"north","frame":"true","height":"45","style":"border-width:0px","layout":"form","itemId":"collectForm","border":"false"},"children":[{"configs":{"height":"40","style":"border-width:0px","layout":"column","itemId":"fieldset1","padding":"5px,0px,0px,0px"},"children":[{"configs":{"labelWidth":"130","labelAlign":"right","itemId":"colName","fieldLabel":"{#xip_tools_transfer_favorite_name#}"},"events":{"specialkey":"if(e.getKey() == 13){\n  app.colNameQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#xip_tools_transfer_queryBtn#}","itemId":"colNameQueryBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.collectGrid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","selType":"checkboxmodel","itemId":"collectGrid","simpleSelect":"true","viewConfig":" {\n enableTextSelection:true\n }"},"events":{"itemdblclick":"app.IeGrid.getSelectionModel().deselectAll();\n\nvar tableNames = record.get('COL_CODE');\nif(!Ext.isEmpty(tableNames)){\n  var selRecords = new Array();\n  \n  var tableNamesArray = tableNames.split(',');\n  for(var i=0; i<tableNamesArray.length; i++){\n    var tableName = tableNamesArray[i];\n    var _ieRecord = app.IeGrid.getStore().findRecord('IE_CODE', tableName);\n    selRecords.push(_ieRecord);\n  }\n  \n  app.IeGrid.getSelectionModel().select(selRecords);\n}"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"COL_ID","itemId":"COL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名","hidden":"true","width":"100","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_favorite_name#}","width":"100","dataIndex":"COL_NAME","itemId":"COL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_tabCode#}","width":"150","dataIndex":"COL_CODE","itemId":"COL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_favorite_date#}","width":"130","dataIndex":"CREATION_DATE","itemId":"CREATION_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_tabNum#}","width":"60","align":"center","dataIndex":"COL_CODE","titleAlign":"center","itemId":"COUNT_COL","renderer":"var s = value.split(\",\");\nreturn '<font color=\"red\">'+s.length+'<\/font>';"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/tools/transfer/DATA/selectCollect"},"events":{"beforeload":"store.getProxy().extraParams.colName = app.colName.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#xip_tools_transfer_export#}","itemId":"colExportBtn","iconCls":"export_icon"},"events":{"click":"var record = app.collectGrid.getSelectionModel().getSelection();\nif(record.length==1){\n  var _code = record[0].get('COL_CODE');\nWb.download('platformAction.do?method=doExp', {\n  expcodes: _code\n});\n}else{\n  Ext.Msg.alert(\"提示\",\"请选择一条收藏记录！\");\n}\n   "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_transfer_delete#}","itemId":"colDeleteBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.collectGrid.getSelection();\nif(rows.length===0){\n  Ext.MessageBox.alert('{#xip_tools_transfer_tip#}','{#xip_tools_transfer_delsel#}');\n}\nelse{\n   Ext.Msg.confirm('{#xip_tools_transfer_tip#}','{#xip_tools_transfer_okdel#}',function(a){\n    if(a=='yes'){\n      Wb.request({\n        url: 'm?xwl=xip/tools/transfer/DATA/deleteCollect', \n        params: Wb.apply({\n           destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Ext.Msg.alert('{#xip_tools_transfer_tip#}','{#xip_tools_transfer_delok#}');\n          Wb.remove(app.collectGrid,rows);\n        }\n      });\n    \n    }else{\n      return false ;\n    }\n   \n   });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"title":"{#xip_tools_transfer_favorite#}","height":"150","layout":"border","width":"300","closeAction":"hide","resizable":"false","itemId":"colWin","dialog":"true","modal":"true"},"events":{"ok":"if(Ext.isEmpty(app.col_name.getValue())){\n  Wb.warn(\"{#xip_tools_transfer_favoritename#}\");\n  return;\n}\nvar record = app.IeGrid.getSelectionModel().getSelection();\nvar code = '';\nfor (var i = 0; i < record.length; i++) {\n  var ie_code = record[i].get('IE_CODE');\n  code = code + ',' + ie_code;\n}\nvar _code = code.substring(1, code.length);\n\nvar json = {\n  COL_ID : Xip.getId(),\n  USER_NAME : '{#userName#}',\n  COL_CODE : _code,\n  COL_NAME : app.col_name.getValue()\n};\nWb.request({\n  url:\"m?xwl=xip/tools/transfer/DATA/saveIeCollect\",\n  params:json,\n  success:function(){\n    Wb.info('{#xip_tools_transfer_favoritesuc#}');\n    app.colWin.close();\n  },\n  failure:function(){\n    //Wb.error('收藏失败！');\n  }        \n});","close":"app.col_name.setValue(\"\");"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px;","itemId":"form1","border":"false"},"children":[{"configs":{"labelWidth":"120","style":"margin-top:25px;margin-right:20px","labelAlign":"right","itemId":"col_name","fieldLabel":"{#xip_tools_transfer_favorite_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"app.IeGrid.store.load();"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","itemId":"IeForm","border":"false"},"children":[{"configs":{"title":"{#xip_tools_transfer_fieldset#}","style":"padding-top:8px","layout":"column","itemId":"fieldset"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"bm_","fieldLabel":"{#xip_tools_transfer_tabCode#}"},"events":{"specialkey":"app.IeGrid.store.load();\n"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"mc_","fieldLabel":"{#xip_tools_transfer_tabName#}"},"events":{"specialkey":"app.IeGrid.store.load();"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","pickList":"[['P','{#xip_tools_transfer_sys#}'],['U','{#xip_tools_transfer_def#}']]","itemId":"blx_","fieldLabel":"{#xip_tools_transfer_tabType#}"},"events":{"select":"app.IeGrid.store.load();"},"children":[],"expanded":true,"type":"combo"},{"configs":{"text":"{#xip_tools_transfer_queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.IeGrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_transfer_resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"Wb.reset(app.IeForm);\napp.IeGrid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"IeGrid"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#xip_tools_transfer_export#}","itemId":"exportbtn","iconCls":"export_icon"},"events":{"click":"// app.collectGrid.store.load(function() {\n//   if (app.collectGrid.store.getCount() > 0) {\n//     app.collectWin.show();\n//   } else {\n//     var json = {\n//       COL_ID : Xip.getId(),\n//       USER_NAME : '{#userName#}',\n//       COL_CODE : _code\n//     };\n//     Wb.request({\n//       url:\"m?xwl=xip/tools/transfer/DATA/saveIeCollect\",\n//       params:json,\n//       success:function(){\n//       },\n//       failure:function(){\n//       }        \n//     });\n//   }\n// });\nvar record = app.IeGrid.getSelectionModel().getSelection();\nvar code = '';\nfor (var i = 0; i < record.length; i++) {\n  var ie_code = record[i].get('IE_CODE');\n  code = code + ',' + ie_code;\n}\nvar _code = code.substring(1, code.length);\nWb.download('platformAction.do?method=doExp', {\n  expcodes: _code\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_transfer_import#}","itemId":"importbtn","iconCls":"import_icon"},"events":{"click":"app.importWin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_transfer_favorite#}","itemId":"collectBtn","iconCls":"star_icon"},"events":{"click":"var record = app.IeGrid.getSelectionModel().getSelection();\nvar code = '';\nfor (var i = 0; i < record.length; i++) {\n  var ie_code = record[i].get('IE_CODE');\n  code = code + ',' + ie_code;\n}\nvar _code = code.substring(1, code.length);\n\nvar json = {\n  COL_ID : Xip.getId(),\n  USER_NAME : '{#userName#}',\n  COL_CODE : _code\n};\nif(record.length===0){\n  Wb.warn(\"{#xip_tools_transfer_favoritetab#}\");\n  return;\n}\napp.colWin.show();\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#xip_tools_transfer_view_favorite#}","itemId":"seeCollectBtn","iconCls":"search_icon"},"events":{"click":"app.collectWin.show();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xip/tools/transfer/DATA/selectIeGrid"},"events":{"load":"app.IeGrid.getSelectionModel().selectAll(function(){\n   app.bm_.onBlur();\n});\n","beforeload":"store.getProxy().extraParams.bm = app.bm_.getValue();\nstore.getProxy().extraParams.mc = app.mc_.getValue();\nstore.getProxy().extraParams.blx = app.blx_.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"IE_ID","hidden":"true","dataIndex":"IE_ID","itemId":"IE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_tabCode#}","width":"200","dataIndex":"IE_CODE","itemId":"IE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_tabName#}","width":"200","dataIndex":"IE_NAME","itemId":"IE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#xip_tools_transfer_tabType#}","width":"150","dataIndex":"IE_TYPE","itemId":"IE_TYPE_COL","renderer":"if(value === \"P\"){\n  return \"{#xip_tools_transfer_sys#}\";\n}else if(value === \"U\"){\n  return \"{#xip_tools_transfer_def#}\";\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"主键列","hidden":"true","dataIndex":"PRIMARY_KEY_COLUMN","itemId":"PRIMARY_KEY_COLUMN_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"INSERT_SQL","hidden":"true","dataIndex":"INSERT_SQL","itemId":"INSERT_SQL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"SELECT_SQL","hidden":"true","dataIndex":"SELECT_SQL","itemId":"SELECT_SQL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"UPDATE_SQL","hidden":"true","dataIndex":"UPDATE_SQL","itemId":"UPDATE_SQL_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}