{"inframe":false,"title":"图标属性定义","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","initScript":"var ctxPath = request.getContextPath();\n\nrequest.setAttribute(\"contextPath\",ctxPath);\n\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xip/tools/chart/chatAttdef/charAttdef\");","jsLinks":"[\"xip/js/RowExpander.js\"]","itemId":"module"},"events":{"initialize":"var curIndex = 0;"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"chartTypeStore","url":"m?xwl=xip/tools/chart/chatAttdef/data/chartTypeStore"},"children":[],"expanded":false,"type":"store"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","itemId":"queryform","border":"false"},"children":[{"configs":{"title":"{#conditionQuery#}","style":"padding-top:8px","collapsible":"true","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"80","store":"app.chartTypeStore","queryMode":"local","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"chartType","fieldLabel":"{#chartType#}"},"events":{"select":"app.chartGrid.store.load();","specialkey":"app.chartGrid.store.load();"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"100","width":"250","labelAlign":"right","itemId":"attrCode","fieldLabel":"{#attributeCode#}"},"events":{"specialkey":"app.chartGrid.store.load();"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#query#}","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"app.chartGrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#reset#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"20"},"events":{"click":"app.queryform.getForm().reset();\napp.chartGrid.store.load();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"chartGrid","editable":"true"},"events":{"tagEvents":"cellclick:function( Table ,  td,  cellIndex, record,  tr,  rowIndex, e,  eOpts ){\n \ncurIndex = rowIndex;\n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","autoLoad":"true","url":"m?xwl=xip/tools/chart/chatAttdef/data/chartGridStore"},"events":{"beforesync":"(function(){\n Wb.mask();\n\n} )();","beforeload":"var whereSql='and 1=1';\nif(!Ext.isEmpty(app.chartType.getValue())){\n  whereSql += ' and a.pro_type=\\''+app.chartType.getValue()+'\\'';\n}\nif(!Ext.isEmpty(app.attrCode.getValue())){\n  whereSql += ' and a.pro_code like \\'%'+app.attrCode.getValue()+'%\\'';\n}\n\nstore.getProxy().extraParams.WHERESQL = whereSql;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#add#}","itemId":"addBtn","iconCls":"application_add_icon"},"events":{"click":"// var e=app.chartGrid.plugins[0],index=app.chartGrid.store.getCount()===0?0:app.chartGrid.store.getCount();\n// e.completeEdit();\n\n\n//   app.chartGrid.store.insert(index,{});\n\n//  app.chartGrid.store.getAt(index).set('PRO_ID',Xip.getId());\n\n// e.startEditByPosition({row:index,column:2});\nWb.addEdit(app.chartGrid);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var insertArray = [];\nvar updateArray = [];\n var rec = app.chartGrid.store.getCount();\nif(rec === 0){}\nelse{\nfor (var i = 0; i < rec; i++) {\n          var reco = app.chartGrid.store.getAt(i);\n          var PRO_ID = reco.data.PRO_ID;\n          var PRO_TYPE = reco.data.PRO_TYPE;\n          var PRO_CODE = reco.data.PRO_CODE;\n          var PRO_NAME = reco.data.PRO_NAME;\n          var PRO_DESC = reco.data.PRO_DESC;\n          var PRO_VAL_TYPE = reco.data.PRO_VAL_TYPE;\n          var PRO_VAL = reco.data.PRO_VAL;\n          var PRO_GROUP = reco.data.PRO_GROUP;\n          var SEQ = reco.data.SEQ;\n          var ENABLE = reco.data.ENABLE;\n          if (PRO_ID === null || PRO_ID === '') {\n              var json = {\n                PRO_ID: '',\n                PRO_TYPE: PRO_TYPE,\n                PRO_CODE: PRO_CODE,\n                PRO_NAME: PRO_NAME,\n                PRO_DESC: PRO_DESC,\n                PRO_VAL_TYPE:PRO_VAL_TYPE,\n                PRO_VAL:PRO_VAL,\n                PRO_GROUP:PRO_GROUP,\n                SEQ:SEQ,\n                ENABLE:ENABLE\n              };\n              insertArray.push(json);\n            \n\n          } else {\n            \n            var json2 = {\n               PRO_ID: PRO_ID,\n                PRO_TYPE: PRO_TYPE,\n                PRO_CODE: PRO_CODE,\n                PRO_NAME: PRO_NAME,\n                PRO_DESC: PRO_DESC,\n                PRO_VAL_TYPE:PRO_VAL_TYPE,\n                PRO_VAL:PRO_VAL,\n                PRO_GROUP:PRO_GROUP,\n                SEQ:SEQ,\n                ENABLE:ENABLE\n            };\n            updateArray.push(json2);\n           \n          }\n\n        }\n}\n\n\n //----------------插入或更新值-----------------\n   if(insertArray.length>0){\n     if(updateArray.length>0){\n             //新增参数值\n              Wb.request({\n                url: 'm?xwl=xip/tools/chart/chatAttdef/data/create',\n                params: Wb.apply({insertArray:Wb.encode(insertArray)}),\n                success: function(response) {\n                 //更新参数值\n                      Wb.request({\n                        url: 'm?xwl=xip/tools/chart/chatAttdef/data/update',\n                        params: Wb.apply({updateArray:Wb.encode(updateArray)}),\n                        success: function(response) {\n                         app.chartGrid.store.load();\n                         Wb.info('{#success#}');\n                        }\n                      });\n                }\n              });\n        }else{\n           //新增参数值\n         Wb.request({\n                url: 'm?xwl=xip/tools/chart/chatAttdef/data/create',\n                params: Wb.apply({insertArray:Wb.encode(insertArray)}),\n                success: function(response) {\n                   Wb.info('{#success#}');\n                 app.chartGrid.store.load();\n                }\n              });\n          \n          }\n            \n     }else{\n      //更新参数值\n                      Wb.request({\n                        url: 'm?xwl=xip/tools/chart/chatAttdef/data/update',\n                        params: Wb.apply({updateArray:Wb.encode(updateArray)}),\n                        success: function(response) {\n                         app.chartGrid.store.load();\n                         Wb.info('{#success#}');\n                        }\n                      });\n     \n     }\n// app.chartGrid.plugins[0].completeEdit();\n//               app.chartGrid.store.sync(\n//                   {\n//                     callback :function(){\n\t\t\t\n//                    Wb.unmask();\n//                    Wb.info('数据保存成功！');\n//                    app.chartGrid.store.commitChanges();\n//                         }\n//                   }); "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delete#}","itemId":"deleteBtn","iconCls":"application_delete_icon"},"events":{"click":"var rows = app.chartGrid.getSelection();\n\nif(rows.length === 0){\n   Ext.MessageBox.alert('{#alert#}','{#selRecord#}');\n   return ;\n }\nWb.confirm('{#confirm#}',function(){\n   Wb.request({\n        url: 'm?xwl=xip/tools/chart/chatAttdef/data/destory', \n        params: Wb.apply({\n          destroy: Wb.getData(rows)\n        }),\n        success: function() {\n          Wb.remove(app.chartGrid,rows);\n        }\n      });\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"id","hidden":"true","dataIndex":"PRO_ID","itemId":"PRO_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PRO_TYPE","hidden":"true","width":"150","dataIndex":"PRO_TYPE","itemId":"PRO_TYPE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#chartType#}","width":"150","dataIndex":"PRO_TYPE_NAME","itemId":"PRO_TYPE_NAME"},"children":[{"configs":{"displayField":"VAL_NAME","width":"100","valueField":"VAL_CODE","itemId":"editor","editable":"false"},"events":{"select":"var r = app.chartGrid.store.getAt(curIndex);\ncombo.setValue(records[0].get('VAL_NAME'));\nr.set('PRO_TYPE',records[0].get('VAL_CODE'));\nr.set('PRO_TYPE_NAME',records[0].get('VAL_NAME'));"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/chart/chatAttdef/data/chartTypeStore"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#attributeCode#}","width":"220","dataIndex":"PRO_CODE","itemId":"PRO_CODE"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#attributeName#}","width":"220","dataIndex":"PRO_NAME","itemId":"PRO_NAME"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"{#attributeDesc#}","width":"300","dataIndex":"PRO_DESC","itemId":"PRO_DESC","renderer":"metaData.tdAttr = 'data-qtip=\"'+value+'\"';\nreturn value; "},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#attributeValueType#}","width":"120","dataIndex":"PRO_VAL_TYPE_NAME","itemId":"PRO_VAL_TYPE_NAME"},"children":[{"configs":{"displayField":"VAL_NAME","valueField":"VAL_CODE","itemId":"editor","editable":"false"},"events":{"select":"var r = app.chartGrid.store.getAt(curIndex);\ncombo.setValue(records[0].get('VAL_NAME'));\nr.set('PRO_VAL_TYPE',records[0].get('VAL_CODE'));\nr.set('PRO_VAL_TYPE_NAME',records[0].get('VAL_NAME'));"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/chart/chatAttdef/data/chartProValueStore"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"PRO_VAL_TYPE","hidden":"true","width":"120","dataIndex":"PRO_VAL_TYPE","itemId":"PRO_VAL_TYPE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#attributeValueSource#}","width":"200","dataIndex":"PRO_VAL","itemId":"PRO_VAL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#groupAttribute#}","width":"130","dataIndex":"PRO_GROUP_NAME","itemId":"PRO_GROUP_NAME"},"children":[{"configs":{"displayField":"VAL_NAME","valueField":"VAL_CODE","itemId":"editor","editable":"false"},"events":{"select":"var r = app.chartGrid.store.getAt(curIndex);\ncombo.setValue(records[0].get('VAL_NAME'));\nr.set('PRO_GROUP',records[0].get('VAL_CODE'));\nr.set('PRO_GROUP_NAME',records[0].get('VAL_NAME'));"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xip/tools/chart/chatAttdef/data/chartProGroupStore"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"PRO_GROUP","hidden":"true","dataIndex":"PRO_GROUP","itemId":"PRO_GROUP"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#sort#}","width":"50","dataIndex":"SEQ","itemId":"SEQ"},"children":[{"configs":{"width":"40","minValue":"0","value":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#enable#}","width":"70","dataIndex":"ENABLE","itemId":"ENABLE","renderer":"if(value ==='Y'){\n  return '是';\n}else{\n  return '否';\n}"},"children":[{"configs":{"width":"40","value":"Y","pickList":"[['Y','是'],['N','否']]","itemId":"editor","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}