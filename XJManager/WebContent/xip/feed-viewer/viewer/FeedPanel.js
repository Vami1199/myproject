Ext.define("FeedViewer.FeedPanel",{extend:"Ext.panel.Panel",alias:"widget.feedpanel",animCollapse:true,layout:"fit",title:"Feeds",initComponent:function(){Ext.define("Feed",{extend:"Ext.data.Model",fields:["text","fun_id","url","app_id","fun_code","app_code","in_xip","show_style","icon"]});Ext.apply(this,{items:this.createView()});this.addEvents("feedremove","feedselect");this.callParent(arguments)},createView:function(){this.view=Ext.create("widget.dataview",{store:Ext.create("Ext.data.Store",{model:"Feed",data:this.feeds}),selModel:{mode:"SINGLE",listeners:{scope:this,selectionchange:this.onSelectionChange}},listeners:{scope:this,contextmenu:this.onContextMenu,viewready:this.onViewReady},trackOver:true,cls:"feed-list",itemSelector:".feed-list-item",overItemCls:"feed-list-item-hover",tpl:'<tpl for="."><div class="feed-list-item" style="background:url({icon}) no-repeat 0 2px">{text}</div></tpl>'});return this.view},onViewReady:function(){},createToolbar:function(){this.createActions();this.toolbar=Ext.create("widget.toolbar",{items:[this.addAction,this.removeAction]});return this.toolbar},createActions:function(){this.addAction=Ext.create("Ext.Action",{scope:this,handler:this.onAddFeedClick,text:"Add feed",iconCls:"feed-add"});this.removeAction=Ext.create("Ext.Action",{itemId:"remove",scope:this,handler:this.onRemoveFeedClick,text:"Remove feed",iconCls:"feed-remove"})},createMenu:function(){this.menu=Ext.create("widget.menu",{items:[{scope:this,handler:this.onLoadClick,text:"Load feed",iconCls:"feed-load"},this.removeAction,"-",this.addAction],listeners:{hide:function(a){a.activeFeed=null}}})},onSelectionChange:function(){var a=this.getSelectedItem();this.loadFeed(a)},onLoadClick:function(){this.loadFeed(this.menu.activeFeed)},loadFeed:function(a){if(a){this.fireEvent("feedselect",this,a);this.view.getSelectionModel().deselectAll()}},getSelectedItem:function(){return this.view.getSelectionModel().getSelection()[0]||false},onContextMenu:function(a,b,c,d){var e=this.menu;d.stopEvent();e.activeFeed=a.store.getAt(b);e.showAt(d.getXY())},onRemoveFeedClick:function(){var a=this.menu.activeFeed||this.getSelectedItem();this.animateNode(this.view.getNode(a),1,0,{scope:this,afteranimate:function(){this.view.store.remove(a)}});this.fireEvent("feedremove",this,a.get("title"),a.get("url"))},onAddFeedClick:function(){var a=this.addFeedWindow||(this.addFeedWindow=Ext.create("widget.feedwindow",{listeners:{scope:this,feedvalid:this.onFeedValid}}));a.form.getForm().reset();a.show()},onFeedValid:function(d,f,c){var a=this.view,b=a.store,e;e=b.add({url:c,title:f})[0];this.animateNode(a.getNode(e),0,1)},animateNode:function(c,d,a,b){Ext.create("Ext.fx.Anim",{target:Ext.get(c),duration:500,from:{opacity:d},to:{opacity:a},listeners:b})},onDestroy:function(){this.callParent(arguments)}});