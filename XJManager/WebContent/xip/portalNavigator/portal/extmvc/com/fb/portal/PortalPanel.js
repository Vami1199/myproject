Ext.define("com.fb.portal.PortalPanel",{extend:"Ext.panel.Panel",alias:"myPortalpanel",cls:"x-portal",bodyCls:"x-portal-body",autoScroll:true,manageHeight:false,defaultType:"myPortalcolumn",border:false,autoScroll:true,initData:function(a){this.removeAll(true);this.addPortalColumn(a)},initComponent:function(){var a=this;a.layout={type:"column"};a.callParent();a.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true});a.on("drop",function(c){var f=this;var e=c.column.portalColId;var d=c.panel.portletId;var g=c.position;Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/dragPortletUnit",params:{COMPONENT_ID:e,UNIT_ID:d,UNIT_ORDER:g}})})},setDetailColWidth:function(b){for(var a=0;a<this.getColumns().length;a++){this.getColumns()[a].columnWeight=parseFloat(b[a])}this.doLayout()},setColumnsWidth:function(c){var d=new Array();for(var a=0;a<this.getColumns().length;a++){d[a]=this.getColumns()[a].columnId}var b=d.join("-");if(parseInt(c/10)==2){if(parseInt(c)%10==1){this.getColumns()[0].columnWeight=0.5;this.getColumns()[1].columnWeight=0.5}else{if(parseInt(c)%10==2){this.getColumns()[0].columnWeight=0.333;this.getColumns()[1].columnWeight=0.666}else{this.getColumns()[0].columnWeight=0.666;this.getColumns()[1].columnWeight=0.333}}}else{if(parseInt(parseInt(c)/10)==3){if(parseInt(c)%10==1){this.getColumns()[0].columnWeight=0.333;this.getColumns()[1].columnWeight=0.333;this.getColumns()[2].columnWeight=0.333}else{this.getColumns()[0].columnWeight=0.25;this.getColumns()[1].columnWeight=0.5;this.getColumns()[2].columnWeight=0.25}}else{if(parseInt(parseInt(c)/10)==1){this.getColumns()[0].columnWeight=1}else{this.getColumns()[0].columnWeight=0.25;this.getColumns()[1].columnWeight=0.25;this.getColumns()[2].columnWeight=0.25;this.getColumns()[3].columnWeight=0.25}}}},changeColumns:function(a){var l=this;var o=l.getColumns().length;if(a/10>o){var k=parseInt(a/10)-o;for(var g=0;g<k;g++){var b=Ext.create("myPortalcolumn");b.setHeight("100%");l.add(b)}l.setColumnsWidth(a);l.doLayout()}else{if(parseInt(a/10)==o){l.setColumnsWidth(a);l.doLayout()}else{var e=o-parseInt(a/10);var h=new Array();var m=new Array();for(var g=0;g<e;g++){var d=this.getColumns()[g];m[g]=d.columnId;for(var f=0;f<d.getPortlets().length;f++){var n=d.getPortlets()[f].getData();n.height=d.getPortlets()[f].getHeight();h.push(n)}}for(var c=0;c<e;c++){l.remove(l.getColumns()[0])}for(var c=0;c<h.length;c++){l.addNewWidget(h[c]);l.setColumnsWidth(a)}l.doLayout()}}},addPortalColumn:function(c){var d=this;if(!c||c.length==0){return}for(var b=0;b<c.length;b++){var a=Ext.create("com.fb.portal.PortalColumn");a.setHeight("100%");a.columnWeight=c[b].columnWeight;a.portalColId=c[b].portalColId;a.initPortlet(c[b].portlets);d.add(a)}},addNewWidget:function(g){var d=this;var a=this.getColumns();if(a!=null){for(var b=a.length-1;b>=0;b--){if(b==0||a[b].getPortlets().length<a[b-1].getPortlets().length){g.widgetCompId=a[b].portalColId;var c=g.widgetId;var e=a[b].columnId;var f=g.height;Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/addUnitToPortal",params:g,success:function(i){var h=Wb.decode(i.responseText);g.portletId=h.PORTLET_ID;a[b].addPortlet(g)},failure:function(){Wb.warn(XipLang.chart_add_unit_error)}});break}}}},getPortletsNumber:function(){var a=this.getColumns();var c=0;if(a!=null){for(var b=0;b<=a.length-1;b++){c+=a[b].getPortlets().length}}return c},getColumns:function(){if(this.items){return this.items.items}return null},beforeLayout:function(){var b=this.getColumns(),a=b.length;for(var c=0;c<a;c++){var d=b[c];d.columnWidth=d.columnWeight}return this.callParent(arguments)},initEvents:function(){this.callParent();this.dd=Ext.create("com.fb.portal.PortalDropZone",this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}this.callParent()}});