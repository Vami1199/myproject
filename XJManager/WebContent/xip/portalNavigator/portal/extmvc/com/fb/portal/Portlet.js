Ext.define("com.fb.portal.Portlet",{extend:"Ext.panel.Panel",alias:"myPortlet",layout:"fit",portletId:"0",functionId:"0",frame:true,animCollapse:true,autoDestroy:true,draggable:{moveOnDrag:false},cls:"x-portlet",data:null,initComponent:function(){var A=this;A.callParent(arguments);A.tools=[];A.collapsible=true;A.closable=true,A.on("beforeClose",function(B){if(myHomeId=="1"){Wb.warn(XipLang.portal_home_unit_del)}else{Ext.Msg.confirm(XipLang.portal_sys_confirm,XipLang.portal_unit_del_confirm,function(C){if(C=="yes"){Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/deletePortalUnit",params:{"UNIT_ID":A.portletId},success:function(){B.doClose()}});return true}else{return false}})}return false})},doClose:function(){var A=this;this.el.animate({opacity:0,callback:function(){A.fireEvent("close",A);A[A.closeAction]()},scope:this})},getData:function(){return this.data},initWidget:function(A){var C=this;if(A.widget!=null){C.data=A;var B=Ext.create(A.widget);if(A.widget=="Ext.panel.Panel"||!Ext.isEmpty(A.widgetTarget)){Ext.apply(B,{autoScroll:"auto"});var D=A.height-35;if(A.widgetTarget.indexOf("http:")!=-1){B.html='<iframe onmouseover = window.parent.hideMenus() id ="portletIframe" scrolling="auto" frameborder="0" width="100%" height='+D+' src="'+A.widgetTarget+'"></iframe>'}else{if(Ext.String.startsWith(A.widgetTarget,"/m")||Ext.String.startsWith(A.widgetTarget,"/main")){B.html='<iframe onmouseover = window.parent.hideMenus() id ="portletIframe" scrolling="auto" frameborder="0" width="100%" height= '+D+' src="'+contentPath+A.widgetTarget+'"></iframe>'}else{B.html='<iframe onmouseover = window.parent.hideMenus() id ="portletIframe" scrolling="auto" frameborder="0" width="100%" height= '+D+' src="'+contentPath+"/"+A.widgetTarget+'"></iframe>'}}}C.title=A.widgetTitle;if(A.configWidget!=null&&A.configWidget!=""){C.getSettingTools(A.configWidget);C.tools.push(C.getRefreshTools());C.tools.push(C.getDefaultTools())}else{C.tools.push(C.getRefreshTools());C.tools.push(C.getDefaultTools())}C.getMaxTools();this.add(B)}},getChildItem:function(){if(this.items){return this.items.items[0]}return null},getDefaultTools:function(){var A=this;return{xtype:"tool",type:"gear",tooltip:XipLang.portal_set_heigth,maxWidth:400,handler:function(B,F,E,D){if(myHomeId=="1"){Wb.info(XipLang.portal_modify_height)}else{var C=Ext.create("Ext.window.Window",{layout:"fit",title:XipLang.portal_set_heigth,modal:true,height:140,width:350,frame:true,border:false,closeAction:"destroy",buttonAlign:"center",buttons:[{text:XipLang.config_save_btn,iconCls:"save_icon",handler:function(){var G=Ext.getCmp("newPortletHeight").getValue();if(Ext.isEmpty(G)){Wb.info(XipLang.portal_unit_height)}else{if(G==A.data.height){C.close()}else{Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/updateCompDtl",params:{UNIT_ID:A.portletId,UNIT_HEIGHT:G},success:function(){A.setSize(0,G);A.data.height=G;Wb.info(XipLang.portal_modify_success,function(){C.close()})},failure:function(){Wb.info(XipLang.portal_modify_failure)}})}}}},{text:XipLang.xwf_lang_btn_cancel,iconCls:"delete_icon",handler:function(){C.close()}}],items:{xtype:"panel",frame:true,border:false,padding:"20 38 20 25",items:{xtype:"numberfield",id:"newPortletHeight",width:230,fieldLabel:XipLang.portal_height,labelAlign:"right",labelWidth:50,allowBlank:false,value:parseInt(A.data.height)}}});C.show()}}}},getRefreshTools:function(){return{xtype:"tool",type:"refresh",tooltip:XipLang.portal_refresh_btn,maxWidth:400,hidden:true,handler:function(B,E,D,C){var A=D.ownerCt;A.setLoading(XipLang.xwf_lang_data_loading);Ext.defer(function(){A.setLoading(false)},2000)}}},getSettingTools:function(D){var C=this;var B=Ext.create("Ext.window.Window",{layout:"fit",title:XipLang.portal_attr_set,modal:true,closeAction:"destroy"});var A={xtype:"tool",type:"plus",tooltip:XipLang.portal_attr_set,maxWidth:400,handler:function(G,J,I,H){var E=B.cloneConfig();var F=Ext.create(D,{prePropertyList:C.data.propertyList});E.add(F);E.show()}};C.tools.push(A)},getMaxTools:function(){var B=this;var A={xtype:"tool",type:"maximize",tooltip:XipLang.portal_win_max,maxWidth:400,handler:function(C,G,F,D){if(!Ext.isEmpty(B.data.widgetTarget)&&B.data.widgetTarget!="-1"){var E=B.data.widgetTarget;E+="&userId={#XIP.userId#}&roleId={#XIP.roleId#}&funId="+B.data.functionId+"&userName={#XIP.userName#}&roleCode={#XIP.roleCode#}";if(Ext.String.startsWith(B.data.widgetTarget,"/m")){Xip.open({url:contentPath+E,title:B.title,container:app.funTabPanel})}else{if(Ext.String.startsWith(B.data.widgetTarget,"m")){Xip.open({url:contentPath+"/"+E,title:B.title,container:app.funTabPanel})}else{if(Ext.String.startsWith(B.data.widgetTarget,"http://")){window.open(B.data.widgetTarget)}else{Xip.open({url:B.data.widgetTarget,title:B.title,container:app.funTabPanel})}}}}else{if(B.data.widget=="com.fb.define.XipPortalGrid"){Wb.info(XipLang.portal_no_support)}else{Xip.open({url:"m?xwl=xip/pub/navigator/portalNavigator/portalComponent",title:B.title,container:app.funTabPanel,params:{componentUnit:B.data.widget}})}}}};B.tools.push(A)},setSize:function(E,A){var D=this;if(typeof(D.data)=="undefined"||D.data==null||D.height==A){D.callParent();D.doLayout();D.height=A}else{D.height=A;D.setHeight(A);D.doLayout()}if(typeof(D.data)!="undefined"&&D.data!=null){if(D.data.widget=="Ext.panel.Panel"||!Ext.isEmpty(D.data.widgetTarget)){var B=A-35;var C=D.getWidget();if(D.data.widgetTarget.indexOf("http:")!=-1){C.update('<iframe onmouseover = window.parent.hideMenus() id ="portletIframe" scrolling="auto" frameborder="0" width="100%" height='+B+' src="'+D.data.widgetTarget+'"></iframe>')}else{if(Ext.String.startsWith(D.data.widgetTarget,"/m")||Ext.String.startsWith(D.data.widgetTarget,"/main")){C.update('<iframe onmouseover = window.parent.hideMenus() id ="portletIframe" scrolling="auto" frameborder="0" width="100%" height= '+B+' src="'+contentPath+D.data.widgetTarget+'"></iframe>')}else{C.update('<iframe onmouseover = window.parent.hideMenus() id ="portletIframe" scrolling="auto" frameborder="0" width="100%" height= '+B+' src="'+contentPath+"/"+D.data.widgetTarget+'"></iframe>')}}}}},getWidget:function(){return this.items.items[0]}});