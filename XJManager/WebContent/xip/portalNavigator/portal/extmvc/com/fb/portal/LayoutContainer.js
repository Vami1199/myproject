Ext.require(["com.fb.portal.PortalPanel"]);Ext.require(["com.fb.portal.LayoutStore"]);Ext.require(["com.fb.portal.MyDashboardList"]);Ext.define("com.fb.portal.LayoutContainer",{extend:"Ext.container.Container",border:false,height:"100%",config:{portalPanel:Ext.create("myPortalpanel"),layoutStore:Ext.create("layoutStore"),viewListCombobox:Ext.create("viewListCombobox")},constructor:function(a){this.initConfig(a);return this.callParent()},getToolBar:function(){var a=this;return[{xtype:"toolbar",dock:"top",height:35,items:[a.getViewListCombobox(),{xtype:"button",iconCls:"settings1_icon",text:XipLang.chart_home_default,handler:function(){var c=a.getViewListCombobox().getRawValue();var b=a.getViewListCombobox().getValue();Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/setDefaultHome",params:{HOME_ID:b},success:function(){Wb.info(XipLang.chart_home_set_success);myHomeId=b},failure:function(){Wb.warn(XipLang.xwf_lang_server_no_response)}})}},"-",{xtype:"button",text:XipLang.chart_home_edit_btn,iconCls:"dataview_icon",handler:function(){if(myHomeId=="1"){Wb.info(XipLang.chart_home_readonly);return}var d=a.getViewListCombobox().findRecord("id",a.getViewListCombobox().getValue());var h="";var e="";var c=a.getPortalPanel().getColumns();for(var g=0;g<c.length;g++){if(g==c.length-1){e+=c[g].portalColId;h+=c[g].columnWidth}else{e+=c[g].portalColId+",";h+=c[g].columnWidth+","}}var b=Ext.create("com.fb.portal.PortletViewEdit");b.addListener("changeView",function(k,j,i){a.getViewListCombobox().getStore().load(function(){a.getViewListCombobox().setValue(i);a.getViewListCombobox().setRawValue(j)});a.getPortalPanel().setDetailColWidth(k);f.close()});b.addListener("closeWin",function(){f.close()});var f=Ext.create("Ext.window.Window",{title:XipLang.chart_home_edit_btn,layout:"fit",modal:true,width:400,height:220});f.add(b);f.addListener("show",function(){b.initData({viewName:d.data.viewName,viewDesc:d.data.HOME_DESC,isDefault:d.data.isDefault,columnNum:c.length,columnWeight:h,columnIds:e})});f.show()}},"-",{xtype:"button",iconCls:"delete_icon",text:XipLang.config_source_delete,handler:function(){var b=a.getViewListCombobox().getValue();if(b==1){Wb.warn(XipLang.chart_home_not_delete);return false}Wb.confirm(XipLang.chart_home_del_confirm,function(){Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/deletePortalHome",params:{HOME_ID:b},success:function(){Wb.info(XipLang.config_delete_success);a.getViewListCombobox().load();a.getPortalPanel().doLayout()},failure:function(){Wb.warn(XipLang.upgrade_failure)}})})}},"->","-",{xtype:"button",iconCls:"new_icon",text:XipLang.chart_home_add_home,handler:function(){if(myHomeId=="1"){Wb.warn(XipLang.chart_no_modify_home);return}var b=Ext.create("com.fb.portal.PortalUnitForm");b.addListener("addUnit",function(k,d,h,m,j,e,f){var g=a.getPortalPanel().getPortletsNumber();if(g<20){var i={configWidget:h,height:k,widget:d,widgetId:m,widgetName:j,widgetTarget:e,widgetViewId:a.getViewListCombobox().getValue(),widgetCompId:"",portletId:"",functionId:f};a.getPortalPanel().addNewWidget(i)}else{c.close();Wb.warn(XipLang.chart_max_component)}});var c=Ext.create("Ext.window.Window",{title:XipLang.chart_component_list,layout:"fit",modal:true,width:500,height:260});c.add(b);c.show()}},"-",{xtype:"tool",type:"up",tooltip:"fold up",handler:function(){Ext.getCmp("portalNorthPanel").collapse()}}]}]},refreshPorlet:function(d){var c=this.getPortalPanel().getColumns();if(c!=null){for(var b=0;b<c.length;b++){var a=c[b].getPortlets();if(a!=null){for(l=0;l<a.length;l++){if(!Ext.isEmpty(a[l].data.widgetTarget)&&Ext.String.endsWith(a[l].data.widgetTarget,d)){if(a[l].data.widgetTarget.indexOf("http:")!=-1){a[l].getChildItem().update('<iframe  scrolling="auto" frameborder="0" width="100%" height='+a[l].data.height+' src="'+a[l].data.widgetTarget+'"></iframe>')}else{a[l].getChildItem().update('<iframe  scrolling="auto" frameborder="0" width="100%" height= '+a[l].data.height+' src="'+contentPath+a[l].data.widgetTarget+'"></iframe>')}return}}}}}},initPortalPanel:function(a){this.getPortalPanel().initData(a[0].data.columns);this.getPortalPanel().viewId=a[0].data.viewId},initlayoutStore:function(){me=this;me.getLayoutStore().addListener("load_compelete",function(a,b){if(a){me.initPortalPanel(b)}else{Wb.warn(XipLang.chart_fail_load_data)}})},iniViewListCombobox:function(){me=this;var a=true;me.getViewListCombobox().addListener("change",function(e,d,b){if(d==-1){a=false;me.getViewListCombobox().setValue(b);addNewValue=Ext.create("com.fb.portal.ViewConfig");addNewValue.addListener("closeAddWin",function(){c.close()});addNewValue.addListener("addNewViewSuccess",function(i){var o=i.findField("viewName").getValue();var h=i.findField("viewDesc").getValue();var n=i.findField("columnNum").getGroupValue();var g=i.findField("columnWeight").getValue();var k=0;if(i.findField("isDefault").getValue()){k=1}var m=[];if(g.indexOf(",")==-1){var j={COMPONENT_ID:"",VIEW_ID:"",COMPONENT_NAME:o,COMPONENT_WIDTH:g,COMPONENT_DESC:o};m.push(j)}else{var f=g.split(",");for(var p=0;p<f.length;p++){var j={COMPONENT_ID:"",VIEW_ID:"",COMPONENT_NAME:o,COMPONENT_WIDTH:f[p],COMPONENT_DESC:o};m.push(j)}}Wb.request({url:"m?xwl=xip/pub/navigator/portalNavigator/data/insertPortalInfo",params:{HOME_NAME:o,HOME_DESC:h,HOME_COLUMN:n,IS_DEFAULT:k,NEW_COMP:Wb.encode(m)},success:function(r){c.close();var q=Ext.decode(r.responseText);me.getViewListCombobox().setIsNew(false);me.getViewListCombobox().load();me.getViewListCombobox().setValue(q.viewId);myHomeId=q.viewId;me.getPortalPanel().removeAll(true)}})});var c=Ext.create("Ext.window.Window",{title:XipLang.chart_new_home,layout:"fit",modal:true,width:400,height:220});c.add(addNewValue);c.show()}else{me.getLayoutStore().setViewId(d,a);myHomeId=d;a=true}})},initComponent:function(){var a=this;a.initlayoutStore();a.iniViewListCombobox();Ext.apply(this,{layout:{type:"border"},items:[{region:"north",height:35,id:"portalNorthPanel",items:this.getToolBar(),collapsed:false},{region:"center",layout:"fit",items:a.getPortalPanel()}]});this.callParent()}});