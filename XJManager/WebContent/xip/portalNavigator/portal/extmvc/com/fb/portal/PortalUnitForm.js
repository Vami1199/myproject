Ext.define("com.fb.portal.PortalUnitForm",{extend:"Ext.form.Panel",initComponent:function(){var e=this;var d=Ext.create("com.fb.portal.WidgetStore");var c=Ext.create("com.fb.portal.PortalUnitStore");var b;var a;Ext.apply(this,{width:"100%",height:"100%",padding:"10",border:false,style:"border-width:0px",autoDestroy:true,frame:true,buttonAlign:"center",layout:"form",items:[{xtype:"combobox",id:"d_myUnitCombox",fieldLabel:'<font color="red">*</font>'+XipLang.chart_unit,emptyText:XipLang.chart_unit_select,labelAlign:"right",labelWidth:90,store:d,allowBlank:false,displayField:"widgetName",valueField:"unitId",listeners:{select:function(i,g,h){Ext.getCmp("d_myUnitUrl").setValue("");Ext.getCmp("d_unitType").clearValue();var f=i.getValue();a=i.findRecord("unitId",f);Ext.getCmp("d_myUnitName").setValue(a.data.widgetName);Ext.getCmp("d_myUnitDesc").setValue(a.data.widgetDesc);Ext.getCmp("d_myUnitHeigth").setValue(a.data.height);Ext.getCmp("d_myUnitValue").setValue(a.data.widgetValue);Ext.getCmp("d_myUnitFunId").setValue(a.data.chooseFunId);if(!Ext.isEmpty(a)&&"Ext.panel.Panel"==a.get("widgetValue")){Ext.getCmp("d_myUnitUrl").setValue(a.data.widgetTarget);Ext.getCmp("d_myUnitUrl").setFieldLabel('<font color="red">*</font>URL');if(a.get("unitId")=="2"){Ext.getCmp("d_unitType").show();Ext.getCmp("d_myUnitUrl").setReadOnly(true)}else{if(a.get("unitId")=="6"){Ext.getCmp("d_unitType").hide();Ext.getCmp("d_myUnitUrl").setReadOnly(false)}else{Ext.getCmp("d_unitType").hide();Ext.getCmp("d_myUnitUrl").setReadOnly(true)}}}else{Ext.getCmp("d_unitType").hide();Ext.getCmp("d_myUnitUrl").setReadOnly(true)}}}},{xtype:"panel",border:false,baseCls:"my-panel-no-border",layout:"form",frame:true,items:[{xtype:"textfield",id:"d_myUnitId",hidden:true},{xtype:"textfield",id:"d_myUnitValue",hidden:true},{xtype:"textfield",id:"d_myUnitFunId",hidden:true},{xtype:"textfield",id:"d_myUnitName",allowBlank:false,fieldLabel:'<font color="red">*</font>'+XipLang.chart_unit_name,labelAlign:"right",labelWidth:90},{xtype:"textfield",id:"d_myUnitDesc",fieldLabel:XipLang.chart_unit_desc,labelAlign:"right",labelWidth:90},{xtype:"numberfield",id:"d_myUnitHeigth",allowBlank:false,fieldLabel:'<font color="red">*</font>'+XipLang.chart_unit_height,labelAlign:"right",labelWidth:90,minValue:10},{xtype:"combobox",id:"d_unitType",hidden:true,fieldLabel:'<font color="red">*</font>'+XipLang.chart_system_function,labelAlign:"right",labelWidth:100,store:c,displayField:"urlName",valueField:"funId",listeners:{beforequery:function(i,f){var h=i.combo;if(!i.forceAll){var g=i.query;h.store.filterBy(function(j,l){var k=j.get(h.displayField);return(k.indexOf(g)!=-1)});h.expand();return false}},select:function(i,g,h){var f=g[0];Ext.getCmp("d_myUnitUrl").setValue(f.data.urlId);Ext.getCmp("d_myUnitName").setValue(f.data.urlName);Ext.getCmp("d_myUnitFunId").setValue(f.data.funcId)}}},{xtype:"textfield",id:"d_myUnitUrl",fieldLabel:"URL",labelAlign:"right",labelWidth:90}]}],buttons:[{text:XipLang.system_add_btn,iconCls:"ok_icon",handler:function(){if(e.getForm().isValid()==false){Wb.info(XipLang.system_must_fill_up);return}if(a.data.widgetValue=="Ext.panel.Panel"&&Ext.isEmpty(Ext.getCmp("d_myUnitUrl").getValue())){Wb.info(XipLang.chart_unit_url_empty);return}var l=a;var g=Ext.getCmp("d_myUnitHeigth").getValue()*1;if(g==0||g==null||g.length==0){g=200}var i=l.get("widgetValue");var j="";var f=Ext.getCmp("d_myUnitName").getValue();var h=l.get("configureWidget");var m=Ext.getCmp("d_myUnitUrl").getValue();var k=Ext.getCmp("d_myUnitFunId").getValue();if(Ext.isEmpty(k)){k=""}e.fireEvent("addUnit",g,i,h,j,f,m,k);Wb.info(XipLang.system_add_success)}},{text:XipLang.xwf_lang_btn_cancel,iconCls:"delete_icon",handler:function(){e.up("window").close()}}]});this.callParent()}});