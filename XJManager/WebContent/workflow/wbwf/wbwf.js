var WBWF={getBrowserInfo:function(){var b={};var c=navigator.userAgent.toLowerCase();var d=/(msie|firefox|chrome|opera|version).*?([\d.]+)/;var a=c.match(d);b.browser=a[1].replace(/version/,"'safari");b.ver=a[2];return b},openTaskPage:function(a,b,c){var d=Ext.MessageBox.show({title:(Ext.isEmpty(XipLang)==true?"请等待":XipLang.xwf_lang_wait_tip),msg:(Ext.isEmpty(XipLang)==true?"正在提交请求.......":XipLang.xwf_lang_submit_request),width:300,wait:true,progress:true,closable:false});Ext.Ajax.request({url:a+"/workItemAction.do?method=isCustomTaskByTaskId",params:{taskId:b,taskState:c},method:"post",timeout:3600000,success:function(e,g){d.hide();var e=Ext.JSON.decode(e.responseText);if(e.flag=="0"){var f=e.url;window.open(f+"&taskId="+b+"&taskState="+c,"_blank")}else{if(e.flag=="1"){popTopWin({title:(Ext.isEmpty(XipLang)==true?"审批":XipLang.wf_open_task_audit_title),url:a+"/main?xwl=23VMPVCRPO56&taskId="+b,isMax:true,closeCallback:function(){taskStore.load();hisTaskStore.load();archTaskStore.load()}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),e.msg)}}},failure:function(g,f){d.hide();var e=Ext.util.JSON.decode(e.responseText);Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),e.msg)}})},getGlobalData:function(a,b){var c=[];Ext.Ajax.request({url:a,params:{taskId:b},method:"post",timeout:3600000,async:false,success:function(d,e){c=Ext.JSON.decode(d.responseText)},failure:function(f,e){var d=Ext.JSON.decode(d.responseText);Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),d.msg)}});return c},loadButtons:function(f,m,l){var e=this.getGlobalData(f+"/workItemAction.do?method=getButtonsByTaskId",m);var n=e.data;var g=new Array();var o=new Array();for(var j=0;j<n.length;j++){var k=n[j];var c=k.id;var b=k.code;var a=k.name;var h=k.disable;if(b=="btnConsult"||b=="btnCloseConsult"||b=="btnRevokeConsult"||b=="btnDelegate"||b=="btnBack"){continue}if(h=="N"){var d=new Ext.Button({text:a});if(b=="btnSubmit"){d.setHandler(function(){doSubmit(l,null,"btnSubmit",f)})}else{if(b=="btnCancel"){d.setHandler(function(){Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"您确定要撤回流程吗?":XipLang.process_recall_confirm),function(i){if(i=="yes"){doCancel(l,f)}else{return false}})})}else{if(b=="btnReject"){d.setHandler(function(){var i=Ext.getCmp("textArea1").getValue();doReject(l,i,f)})}else{if(b=="btnCopyTo"){d.setHandler(function(){closeCopyTo(l,f)})}else{o.push(d.getId()+";"+b);d.setHandler(function(r,i){var s="";for(var q=0;q<o.length;q++){var p=o[q].split(";");if(p[0]==r.id){s=p[1];break}}var t=Ext.getCmp("textArea1").getValue();completeTask(l,t,null,s,f)})}}}}g.push(d)}}return g},openBatchTaskPage:function(a,c){var b=Ext.MessageBox.show({title:(Ext.isEmpty(XipLang)==true?"请等待":XipLang.xwf_lang_wait_tip),msg:(Ext.isEmpty(XipLang)==true?"正在提交请求.......":XipLang.xwf_lang_submit_request),width:240,wait:true,progress:true,closable:false});Ext.Ajax.request({url:a+"/workItemAction.do?method=isSameProcess",params:{taskIds:c},method:"post",timeout:3600000,success:function(h,i){b.hide();var h=Ext.JSON.decode(h.responseText);if(h.flag==0){var f=c.split(",");var g=this.WBWF.loadButtons(a,f[0],f);var j=new Ext.form.TextArea({id:"textArea1",width:"100%",height:180,inputType:"text"});var d=new Ext.form.FieldSet({title:(Ext.isEmpty(XipLang)==true?"审批意见":XipLang.wf_open_task_audit_comment),labelAlign:"right",layout:"column",labelWidth:80,height:220,items:[{layout:"form",baseCls:"my-panel-no-border",columnWidth:1,items:[j]}]});var e=new Ext.Panel({baseCls:"my-panel-no-border",items:[d],buttonAlign:"right",buttons:g});new Ext.Window({id:"batchWin",title:"<font color=red><i>【"+(Ext.isEmpty(XipLang)==true?"注意：所选待办信息须为同一流程、同一流程版本、相同节点且下一通知/会签节点无须手动选人":XipLang.wf_batch_audit_notice)+"】</i></font>",bodyStyle:"padding: 10px 0px 0px",width:600,height:300,modal:true,layout:"fit",items:[e]}).show()}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"所选待办信息须为同一流程、同一流程版本、相同节点,请确认！":XipLang.wf_batch_audit_note));return false}},failure:function(f,e){b.hide();var d=Ext.JSON.decode(d.responseText);Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),d.msg)}})}};