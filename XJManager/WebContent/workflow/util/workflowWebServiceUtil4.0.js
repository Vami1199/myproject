var _getContextPath=function(){var c=document.location.pathname;var b=c.substr(1).indexOf("/");var a=c.substr(0,b+1);return a};var contextPath=_getContextPath();var getPlatformPath=function(){var c=document.location.protocol;var d=document.location.hostname;var a=window.location.port;var b=c+"//"+d+":"+a+contextPath;return b};var platformPath=getPlatformPath();var wsdlPath=platformPath+"/services/workflowWS?wsdl";var actionName="/processWebServiceDemo.do";function jsonToAjaxParam(c){var b="";for(var a in c){b+=a+"="+c[a]+"&"}return b}function sendRequest(a,c){var b=Ext.lib.Ajax.getConnectionObject().conn;b.open("post",a,false);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");b.send(jsonToAjaxParam(c));return b.responseText}function sendAjaxRequest(a,b,c){if(!b){b={workflowWS:wsdlPath}}else{b.workflowWS=wsdlPath}Ext.Ajax.request({url:a,timeout:300000,method:"POST",params:b,success:function(d,e){if(c){c(Ext.decode(d.responseText))}},failure:function(d,e){Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请求提交失败，可能是网络或其他原因":XipLang.xwf_lang_request_error))}})}function createInstanceByEntityCode(b,c,a,d){getProcessIdByEntityCode(b,c,a,function(e){if(e.flag!=0){if(d){d(e)}Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),e.msg);return}var f=e.processId;createInstanceByProcessId(f,a,d)})}function createInstanceByProcessId(d,b,e){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"根据流程Id创建流程实例....":XipLang.xwf_lang_id_create));var a=contextPath+actionName+"?method=createInstanceByProcessId";var c={processId:d,loginName:b};sendAjaxRequest(a,c,e)}function createInstanceByProcessCode(d,b,e){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"根据流程Code创建流程实例....":XipLang.xwf_lang_ins_create));var a=contextPath+actionName+"?method=createInstanceByProcessCode";var c={processCode:d,loginName:b};sendAjaxRequest(a,c,e)}function getProcessIdByEntityCode(e,f,d,g){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在根据流程实体编码查询可执行流程....":XipLang.xwf_lang_pro_code_query));var a=contextPath+actionName+"?method=getProcessIdByEntityCode";if(!f){f={}}var b={entityCode:e,entityAttJsonString:f,loginName:d,workflowWS:wsdlPath};var c=Ext.JSON.encode(b);Ext.Ajax.request({url:a,method:"POST",sync:"",scope:this,timeout:300000,headers:{"Content-Type":"application/json"},jsonData:b,success:function(p,j){Ext.Msg.hide();var r=Ext.decode(p.responseText);if(r.flag==0){var q={flag:0,processId:r.processId,processCode:r.processCode,processName:r.processName};if(g){g(q)}return}else{if(r.flag==1){var q={flag:1,msg:r.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),"寻找可执行流程失败："+r.msg,function(){if(g){g(q)}})}else{var o=new Array();for(var l=0;l<r.data.length;l++){var n=r.data[l];var s={processId:n.processId,processCode:n.processCode,processName:n.processName};o[l]=s}var h=Ext.create("Ext.grid.Panel",{store:{data:o,fields:[{name:"processId",type:"string"},{name:"processCode",type:"string"},{name:"processName",type:"string"}]},selModel:{showHeaderCheckbox:false,selType:"checkboxmodel",mode:"SINGLE"},columns:[new Ext.grid.RowNumberer(),{text:"ID",dataIndex:"processId",hidden:true},{text:(Ext.isEmpty(XipLang)==true?"流程编码":XipLang.xwf_lang_process_code),dataIndex:"processCode",width:130},{text:(Ext.isEmpty(XipLang)==true?"流程名称":XipLang.xwf_lang_process_name),dataIndex:"processName",width:180}],height:200,width:400,listeners:{rowdblclick:k}});var m=new Ext.Window({width:440,height:400,layout:"fit",buttonAlign:"center",items:[h],modal:true,closeAction:"close",title:(Ext.isEmpty(XipLang)==true?"找到多个流程,请选择一条":XipLang.wf_util_find_many_pro),buttons:[{text:(Ext.isEmpty(XipLang)==true?"确定":XipLang.xwf_lang_btn_confirm),handler:k},{text:(Ext.isEmpty(XipLang)==true?"取消":XipLang.xwf_lang_btn_cancel),handler:function(){m.close()}}]});Ext.Msg.hide();m.show();function k(){var t=h.getSelectionModel().getSelection();if(t.length==1){var i=t[0];Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"确认流程":XipLang.xwf_lang_confirm_pro),"选择流程:【"+i.get("processName")+"】,确定继续吗？",function(u){if(u=="yes"){var v={flag:0,processId:i.get("processId"),processCode:i.get("processCode"),processName:i.get("processName")};m.close();if(g){g(v)}}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请先选中一条流程！":XipLang.xwf_lang_one_choose))}}}}},failure:function(h,i){xt.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请求提交失败，可能是网络或其他原因":XipLang.xwf_lang_request_error))}})}function submitInstance(c,f,e,g){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"'流程实例提交中....":XipLang.xwf_lang_ins_submit));if(!f){f={}}var a=contextPath+actionName+"?method=submitProcess";var b={instanceCode:c,entityAttJsonString:f,loginName:e,workflowWS:wsdlPath};var d=Ext.JSON.encode(b);Ext.Ajax.request({url:a,method:"POST",sync:"",scope:this,timeout:300000,headers:{"Content-Type":"application/json"},jsonData:b,success:function(r,j){Ext.Msg.hide();var t=Ext.decode(r.responseText);if(t.flag==0){var s={flag:0,instanceCode:c};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"流程实例提交成功":XipLang.wf_global_instance_success),function(){if(g){g(s)}})}else{if(t.flag==1){var s={flag:1,msg:t.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"流程实例提交失败,失败原因:":XipLang.wf_global_instance_failure)+t.msg,function(){if(g){g(s)}})}else{var l=new Array();for(var n=0;n<t.data.length;n++){var p=t.data[n];var u={userId:p.userId,userName:p.userName,empName:p.empName,orgName:p.orgName};l[n]=u}var m=t.multiselect;var q=Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:m=="Y"?true:false,mode:m=="Y"?"MULTI":"SINGLE"});var h=new Ext.grid.GridPanel({selModel:q,store:{data:l,fields:[{name:"userId",type:"string"},{name:"userName",type:"string"},{name:"empName",type:"string"},{name:"orgName",type:"string"}]},columns:[new Ext.grid.RowNumberer(),{text:"ID",dataIndex:"userId",hidden:true},{text:(Ext.isEmpty(XipLang)==true?"用户名":XipLang.xwf_lang_user_name),dataIndex:"userName",width:80},{text:(Ext.isEmpty(XipLang)==true?"员工名":XipLang.xwf_lang_emp_name),dataIndex:"empName",width:100},{text:(Ext.isEmpty(XipLang)==true?"组织名":XipLang.xwf_lang_org_name),dataIndex:"orgName",width:170}],listeners:{rowdblclick:k,afterrender:function(){q.select(h.getStore().first())}}});var o=new Ext.Window({width:440,height:400,layout:"fit",items:[h],buttonAlign:"center",modal:true,closeAction:"close",title:(Ext.isEmpty(XipLang)==true?"请选择节点审批人":XipLang.wf_global_audtior_title),buttons:[{text:(Ext.isEmpty(XipLang)==true?"确定":XipLang.xwf_lang_btn_confirm),handler:k},{text:(Ext.isEmpty(XipLang)==true?"取消":XipLang.xwf_lang_btn_cancel),handler:function(){o.close()}}]});Ext.Msg.hide();o.show();function k(){var w=h.getSelectionModel().getSelection();if(w.length>0){var y="";var z="";for(var x=0;x<w.length;x++){var v=w[x];y+=""+v.get("userId")+",";z+=v.get("empName")+"("+v.get("userName")+"),"}y=y.substring(0,y.length-1);z=z.substring(0,z.length-1);Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"确认选择审批人":XipLang.wf_confirm_sel_auditor)+":【"+z+"】",function(C){if(C=="yes"){o.close();var i=contextPath+actionName+"?method=submitProcess";var A={instanceCode:c,entityAttJsonString:f,loginName:e,workflowWS:wsdlPath,userIds:y};var B=Ext.JSON.encode(A);Ext.Ajax.request({url:i,method:"POST",sync:"",scope:this,timeout:300000,headers:{"Content-Type":"application/json"},jsonData:A,success:function(E,F){var D=Ext.decode(E.responseText);if(D.flag==0){var G={flag:0,instanceCode:c};g(G)}else{if(D.flag==1){var G={flag:1,msg:D.msg};g(G)}}},failure:function(D,E){Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请求提交失败，可能是网络或其他原因":XipLang.xwf_lang_request_error))}})}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请先选择审批人":XipLang.xwf_lang_auditor_choose))}}}}},failure:function(h,i){Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请求提交失败，可能是网络或其他原因":XipLang.xwf_lang_request_error))}})}function startAndSubmitProcess(c,b,a,d){createInstanceByProcessId(c,a,function(f){if(f.flag!=0){if(d){d(f)}return}var e=f.instanceCode;submitInstance(e,b,a,d)})}function revokeByInstanceCode(b,c,e){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"流程撤回中....":XipLang.xwf_lang_pro_recall));var a=contextPath+actionName+"?method=revokeByInsCode";var d={instanceCode:b,loginName:c};sendAjaxRequest(a,d,e)}function restartInstance(b,e,c,f){(Ext.isEmpty(XipLang)==true?"流程重启中....":XipLang.xwf_lang_pro_restart);var a=contextPath+actionName+"?method=restartInstance";var d={instanceCode:b,processId:e,loginName:c};sendAjaxRequest(a,d,f)}function startAndSubmitByEntityCode(b,c,a,d){getProcessIdByEntityCode(b,c,a,function(e){if(e.flag!=0){if(d){d(e)}return}var f=e.processId;startAndSubmitProcess(f,c,a,d)})}function restartInstanceSubmit(a,d,c,b,e){restartInstance(a,d,b,function(f){if(f.flag!=0){Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),f.msg,function(){if(e){e(f)}});return}submitInstance(a,c,b,e)})}function stopProcess(b,c,e){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在终止流程....":XipLang.xwf_lang_pro_stop));var a=contextPath+actionName+"?method=stopProcess";var d={instanceId:b,loginName:c};sendAjaxRequest(a,d,e)}function completeWorkItem(b,e,g,c,f){if(g&&g!=""){g=encodeURI(g)}else{g=""}Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在完成待办....":XipLang.xwf_lang_complete_task));var a=contextPath+actionName+"?method=completeWorkItem";var d={taskId:b,lineCode:e,comment:g,loginName:c};sendAjaxRequest(a,d,function(t){if(t.flag==0){var s={flag:0,taskId:b};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"待办处理成功！":XipLang.wf_util_task_finished),function(){if(f){f(s)}})}else{if(t.flag==1){var s={flag:1,msg:t.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"待办处理失败,失败原因:":XipLang.wf_util_task_failure)+t.msg,function(){if(f){f(s)}})}else{var k=new Array();for(var n=0;n<t.data.length;n++){var p=t.data[n];var u={userId:p.userId,userName:p.userName,empName:p.empName,orgName:p.orgName};k[n]=u}var m=t.multiselect;var q=Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:m=="Y"?true:false,mode:m=="Y"?"MULTI":"SINGLE"});var r=Ext.create("Ext.form.field.Text",{width:300,inputType:"text",labelSeparator:":",fieldLabel:(Ext.isEmpty(XipLang)==true?"姓名":XipLang.wf_global_person_name),labelWidth:50,labelAlign:"right",listeners:{specialkey:function(w,v){if(v.getKey()==v.ENTER){var i=r.getValue();ds.filterBy(function(x,z){var y=x.get("empName");return(y.indexOf(i)!=-1)})}}}});var l=Ext.create("Ext.toolbar.Toolbar",{items:[r]});var h=new Ext.grid.GridPanel({selModel:q,store:{data:k,fields:[{name:"userId",type:"string"},{name:"userName",type:"string"},{name:"empName",type:"string"},{name:"orgName",type:"string"}]},tbar:l,columns:[new Ext.grid.RowNumberer(),{text:"ID",dataIndex:"userId",hidden:true},{header:(Ext.isEmpty(XipLang)==true?"用户名":XipLang.xwf_lang_user_name),width:100,dataIndex:"userName"},{header:(Ext.isEmpty(XipLang)==true?"员工名":XipLang.xwf_lang_emp_name),width:150,dataIndex:"empName"},{header:(Ext.isEmpty(XipLang)==true?"组织名":XipLang.xwf_lang_org_name),width:450,dataIndex:"orgName"}],listeners:{rowdblclick:j,afterrender:function(){q.select(ds.first())}}});var o=new Ext.Window({width:750,height:450,layout:"fit",items:[h],modal:true,closeAction:"close",title:(Ext.isEmpty(XipLang)==true?"请选择审批人":XipLang.task_util_query_auditor),buttonAlign:"right",buttons:[{text:(Ext.isEmpty(XipLang)==true?"选择":XipLang.xwf_lang_selecting),handler:j},{text:(Ext.isEmpty(XipLang)==true?"取消":XipLang.xwf_lang_btn_cancel),handler:function(){o.close()}}]});Ext.Msg.hide();o.show();function j(){var w=h.getSelectionModel().getSelection();if(w.length>0){var y="";var z="";for(var x=0;x<w.length;x++){var v=w[x];y+=""+v.get("userId")+",";z+=v.get("empName")+"("+v.get("userName")+"),"}y=y.substring(0,y.length-1);z=z.substring(0,z.length-1);Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"确认选择审批人":XipLang.wf_confirm_sel_auditor)+":【"+z+"】",function(B){if(B=="yes"){o.close();var A=d;if(!A){A={}}var i=contextPath+actionName+"?method=completeWorkItem";A.approvers=y;sendAjaxRequest(i,A,function(C){if(C.flag==0){var D={flag:0,taskId:b};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"待办处理成功！":XipLang.wf_util_task_finished),function(){if(f){f(D)}})}else{if(C.flag==1){var D={flag:1,msg:C.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"待办处理失败,失败原因:":XipLang.wf_util_task_failure)+C.msg,function(){if(f){f(D)}})}}})}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请先选择审批人":XipLang.xwf_lang_auditor_choose))}}}}})}function doConsult(b,c,f,e){var a=contextPath+actionName+"?method=getUsers";var d={taskId:b,conditionStr:"",start:0,limit:20,loginName:c};Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在提交请求.......":XipLang.xwf_lang_submit_request));sendAjaxRequest(a,d,function(s){if(s.flag==1){var r={flag:1,msg:s.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"查询征询人出错,失败原因:":XipLang.wf_global_consulate_query)+s.msg,function(){if(f){f(r)}})}else{var j=new Array();for(var m=0;m<s.data.length;m++){var o=s.data[m];var t={userId:o.userId,userName:o.userName,empName:o.empName,orgName:o.orgName};j[m]=t}var l=s.multiselect;var p=Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:false,mode:"SINGLE"});var q=Ext.create("Ext.form.field.Text",{width:300,inputType:"text",labelSeparator:":",fieldLabel:(Ext.isEmpty(XipLang)==true?"姓名":XipLang.wf_global_person_name),labelWidth:50,labelAlign:"right",listeners:{specialkey:function(v,u){if(u.getKey()==u.ENTER){var i=q.getValue();ds.filterBy(function(w,y){var x=w.get("empName");return(x.indexOf(i)!=-1)})}}}});var k=Ext.create("Ext.toolbar.Toolbar",{items:[q]});var g=new Ext.grid.GridPanel({selModel:p,store:{data:j,fields:[{name:"userId",type:"string"},{name:"userName",type:"string"},{name:"empName",type:"string"},{name:"orgName",type:"string"}]},tbar:k,columns:[new Ext.grid.RowNumberer(),{text:"ID",dataIndex:"userId",hidden:true},{header:(Ext.isEmpty(XipLang)==true?"用户名":XipLang.xwf_lang_user_name),width:100,dataIndex:"userName"},{header:(Ext.isEmpty(XipLang)==true?"员工":XipLang.xwf_lang_emp_name),width:150,dataIndex:"empName"},{header:(Ext.isEmpty(XipLang)==true?"组织":XipLang.xwf_lang_org_name),width:400,dataIndex:"orgName"}],listeners:{rowdblclick:h,afterrender:function(){p.select(ds.first())}}});var n=new Ext.Window({width:750,height:450,layout:"fit",items:[g],buttonAlign:"center",modal:true,closeAction:"close",title:(Ext.isEmpty(XipLang)==true?"请选择被征询人":XipLang.wf_need_sel_consulate),buttonAlign:"right",buttons:[{text:(Ext.isEmpty(XipLang)==true?"选择":XipLang.xwf_lang_selecting),handler:h},{text:(Ext.isEmpty(XipLang)==true?"取消":XipLang.xwf_lang_btn_cancel),handler:function(){n.close()}}]});Ext.Msg.hide();n.show();function h(){var v=g.getSelectionModel().getSelection();if(v.length>0){var x="";var y="";for(var w=0;w<v.length;w++){var u=v[w];x=u.get("userId");y=u.get("userName")}Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"确定选择征询人":XipLang.wf_confirm_consulate_choose)+":【"+y+"】",function(A){if(A=="yes"){n.close();if(y&&y!=""){y=encodeURI(y)}else{y=""}var z={taskId:b,loginName:c,userName:y,comment:e};var i=contextPath+actionName+"?method=doConsult";sendAjaxRequest(i,z,function(B){if(B.flag==0){var C={flag:"0",msg:""};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"征询成功！":XipLang.wf_ask_suggestion_success),function(){if(f){f(C)}})}else{if(B.flag==1){var C={flag:"1",msg:B.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"征询失败: ":XipLang.wf_ask_suggestion_failure)+B.msg,function(){if(f){f(C)}})}}})}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请先选择审批人":XipLang.xwf_lang_auditor_choose))}}}})}function doDelegate(b,c,f,e){var a=contextPath+actionName+"?method=getUsers";var d={taskId:b,conditionStr:"",start:0,limit:20,loginName:c};Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在提交请求.......":XipLang.xwf_lang_submit_request));sendAjaxRequest(a,d,function(s){if(s.flag==1){var r={flag:1,msg:s.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"查询征询人出错,失败原因:":XipLang.wf_global_consulate_query)+s.msg,function(){if(f){f(r)}})}else{var j=new Array();for(var m=0;m<s.data.length;m++){var o=s.data[m];var t={userId:o.userId,userName:o.userName,empName:o.empName,orgName:o.orgName};j[m]=t}var l=s.multiselect;var p=Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:false,mode:"SINGLE"});var q=Ext.create("Ext.form.field.Text",{width:300,inputType:"text",labelSeparator:":",fieldLabel:(Ext.isEmpty(XipLang)==true?"姓名":XipLang.wf_global_person_name),labelWidth:50,labelAlign:"right",listeners:{specialkey:function(v,u){if(u.getKey()==u.ENTER){var i=q.getValue();ds.filterBy(function(w,y){var x=w.get("empName");return(x.indexOf(i)!=-1)})}}}});var k=Ext.create("Ext.toolbar.Toolbar",{items:[q]});var g=new Ext.grid.GridPanel({selModel:p,store:{data:j,fields:[{name:"userId",type:"string"},{name:"userName",type:"string"},{name:"empName",type:"string"},{name:"orgName",type:"string"}]},tbar:k,columns:[new Ext.grid.RowNumberer(),{text:"ID",dataIndex:"userId",hidden:true},{text:(Ext.isEmpty(XipLang)==true?"用户名":XipLang.xwf_lang_user_name),dataIndex:"userName",width:120},{text:(Ext.isEmpty(XipLang)==true?"员工名":XipLang.xwf_lang_emp_name),dataIndex:"empName",width:150},{text:(Ext.isEmpty(XipLang)==true?"组织名":XipLang.xwf_lang_org_name),dataIndex:"orgName",width:400}],listeners:{rowdblclick:h,afterrender:function(){p.select(ds.first())}}});var n=new Ext.Window({width:750,height:450,layout:"fit",items:[g],buttonAlign:"center",modal:true,closeAction:"close",title:(Ext.isEmpty(XipLang)==true?"请选择委派人":XipLang.xwf_lang_signer),buttonAlign:"right",buttons:[{text:(Ext.isEmpty(XipLang)==true?"选择":XipLang.xwf_lang_selecting),handler:h},{text:(Ext.isEmpty(XipLang)==true?"取消":XipLang.xwf_lang_btn_cancel),handler:function(){n.close()}}]});Ext.Msg.hide();n.show();function h(){var v=g.getSelectionModel().getSelection();if(v.length>0){var x="";var y="";for(var w=0;w<v.length;w++){var u=v[w];x=u.get("userId");y=u.get("userName")}Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"确定选择委派人":XipLang.wf_appiont_confirm_person)+":【"+y+"】",function(A){if(A=="yes"){n.close();if(y&&y!=""){y=encodeURI(y)}else{y=""}var z={taskId:b,loginName:c,userName:y,comment:e};var i=contextPath+actionName+"?method=doDelegate";sendAjaxRequest(i,z,function(B){if(B.flag==0){var D="委派成功！";if(!Ext.isEmpty(XipLang)){D=XipLang.wf_appionter_success}var C={flag:"0",msg:D};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),D,function(){if(f){f(C)}})}else{if(B.flag==1){var D="委派失败";if(!Ext.isEmpty(XipLang)){D=XipLang.wf_appionter_failure}var C={flag:"1",msg:B.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),D+":"+B.msg,function(){if(f){f(C)}})}}})}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请先选择审批人":XipLang.xwf_lang_auditor_choose))}}}})}function doBack(c,a,g,d,f){if(g&&g!=""){g=encodeURI(g)}else{g=""}var b=contextPath+actionName+"?method=getBackActivityList";var e={taskId:c,loginName:d};Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在提交请求.......":XipLang.xwf_lang_submit_request));sendAjaxRequest(b,e,function(r){if(r.flag==1){var q={flag:1,msg:r.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),"查询回退节点出错,失败原因:"+r.msg,function(){if(f){f(q)}})}else{var k=new Array();for(var m=0;m<r.data.length;m++){var o=r.data[m];var s={activityId:o.activityId,activityCode:o.activityCode,activityIdName:o.activityIdName};k[m]=s}var l=r.multiselect;var p=Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:l=="Y"?true:false,mode:"SINGLE"});var h=new Ext.grid.GridPanel({selModel:p,store:{data:k,fields:[{name:"activityId",type:"string"},{name:"activityCode",type:"string"},{name:"activityIdName",type:"string"}]},columns:[new Ext.grid.RowNumberer(),{text:"id",dataIndex:"activityId",hidden:true},{header:(Ext.isEmpty(XipLang)==true?"节点编码":XipLang.xwf_lang_node_code),width:80,dataIndex:"activityCode"},{header:(Ext.isEmpty(XipLang)==true?"节点名称":XipLang.xwf_lang_node_name),width:100,dataIndex:"activityName"}],listeners:{rowdblclick:j}});var n=new Ext.Window({width:440,height:400,layout:"fit",items:[h],buttonAlign:"center",modal:true,closeAction:"close",title:(Ext.isEmpty(XipLang)==true?"节点列表":XipLang.wf_activity_list),buttons:[{text:(Ext.isEmpty(XipLang)==true?"确定":XipLang.xwf_lang_btn_confirm),handler:j},{text:(Ext.isEmpty(XipLang)==true?"取消":XipLang.xwf_lang_btn_cancel),handler:function(){n.close()}}]});Ext.Msg.hide();n.show();function j(){var v=h.getSelectionModel().getSelection();if(v.length>0){var u="";var x="";for(var w=0;w<v.length;w++){var t=v[w];u=t.get("activityId");x=t.get("activityIdName")}Ext.MessageBox.confirm((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"确认选择节点":XipLang.wf_confirm_choose_act)+":【"+x+"】",function(z){if(z=="yes"){n.close();var y={taskId:c,backToActivityId:a,comment:g,loginName:d};var i=contextPath+actionName+"?method=doBack";sendAjaxRequest(i,y,function(A){if(A.flag==0){var B={flag:0,taskId:c};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"退回成功":XipLang.wf_rollback_success),function(){if(f){f(B)}})}else{if(A.flag==1){var B={flag:1,msg:A.msg};Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"退回失败,失败原因:":XipLang.wf_rollback_failure)+A.msg,function(){if(f){f(B)}})}}})}})}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请先选择审批人":XipLang.xwf_lang_auditor_choose))}}}})}function closeConsultTask(b,f,c,e){if(f&&f!=""){f=encodeURI(f)}else{f=""}Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在执行征询反馈....":XipLang.wf_executing_feedback));var a=contextPath+actionName+"?method=closeConsultTask";var d={taskId:b,comment:f,loginName:c};sendAjaxRequest(a,d,e);Ext.Msg.hide()}function revokeConsultTask(b,f,c,e){if(f&&f!=""){f=encodeURI(f)}else{f=""}Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在撤销征询....":XipLang.wf_canceling_consulate));var a=contextPath+actionName+"?method=revokeConsultTask";var d={taskId:b,comment:f,loginName:c};sendAjaxRequest(a,d,e);Ext.Msg.hide()}function doRejectProcess(b,c,d,f){if(c&&c!=""){c=encodeURI(c)}else{c=""}Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在驳回流程....":XipLang.wf_rejecting_process));var a=contextPath+actionName+"?method=doRejectProcess";var e={taskId:b,approverComment:c,loginName:d};sendAjaxRequest(a,e,f);Ext.Msg.hide()}function closeCopyToTask(b,c,e){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在关闭抄送节点....":XipLang.wf_closing_mail_node));var a=contextPath+actionName+"?method=closeCopyToTask";var d={taskId:b,loginName:c};sendAjaxRequest(a,d,e);Ext.Msg.hide()}function showMonitorPage(a,e){if(a==null||a=="undefined"||a==""){Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),(Ext.isEmpty(XipLang)==true?"请指定实例编码！":XipLang.xwf_lang_appoint_code));return}var c="extWin"+new Date().getTime();var b=platformPath+"/workflow/monitor/extMonitorFrame.jsp?insCode="+a+"&extWinId="+c;var d=new Ext.Window({id:c,title:(Ext.isEmpty(XipLang)==true?"流程监控":XipLang.xwf_lang_pro_monitor),height:500,width:770,layout:"fit",modal:true,resizable:false,maximizable:true,html:"<iframe id='extWindowIframe' width='100%' height='100%' frameborder=0 src=\""+b+'"></iframe>',listeners:{show:function(f){},close:function(){if(e){e()}}}});d.show();d.maximize()}function getProcIdByCode(c){Ext.Msg.wait((Ext.isEmpty(XipLang)==true?"正在查询流程信息......":XipLang.wf_querying_process));var a=contextPath+actionName+"?method=getProcIdByCode";var b={processCode:c};var d=function(e){if(e.flag=="0"){return e.msg}else{Ext.Msg.alert((Ext.isEmpty(XipLang)==true?"提示":XipLang.xwf_lang_notice),e.msg)}};sendAjaxRequest(a,b,d);Ext.Msg.hide()};