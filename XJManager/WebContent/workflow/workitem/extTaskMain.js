function init_page(contextPath,taskId,bizId,insCode,taskState,submitCode,cancelCode,consultCode,consultCloseCode,consultRevokeCode,delegateCode,goBackCode,copyToCode,rejectCode){Ext.onReady(function(){var respButtonArray;var buttons;var btnArray=new Array();var lineArray=new Array();if(taskState=="closed"){respButtonArray={};respButtonArray.flag="0";respButtonArray.msg="待办已关闭";buttons=[]}else{respButtonArray=getGlobalData(contextPath+"/workItemAction.do?method=getButtonsByTaskId",taskId);buttons=respButtonArray.data}for(var i=0;i<buttons.length;i++){var button=buttons[i];var id=button.id;var code=button.code;var name=button.name;var disable=button.disable;if(disable=="N"){var btn=new Ext.Button({text:name});if(code==submitCode){btn.setHandler(function(){var json=beforeHandlerEvent(submitCode,insCode,bizId);if(json==null){doSubmit(contextPath,taskId,null,submitCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){doSubmit(contextPath,taskId,null,submitCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==cancelCode){btn.setHandler(function(){Ext.MessageBox.confirm("提示","您确定要撤回流程吗?",function(opt){if(opt=="yes"){var json=beforeHandlerEvent(cancelCode,insCode,bizId);if(json==null){doCancel(contextPath,taskId,cancelCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){doCancel(contextPath,taskId,cancelCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}}else{return false}})})}else{if(code==consultCode){btn.setHandler(function(){var json=beforeHandlerEvent(consultCode,insCode,bizId);var comment=textArea.getValue();if(json==null){chooseAllUsers(contextPath,taskId,consultCode,insCode,bizId,comment)}else{var response=Ext.JSON.decode(json);if(response.flag==0){chooseAllUsers(contextPath,taskId,consultCode,insCode,bizId,comment)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==consultCloseCode){btn.setHandler(function(){var comment=textArea.getValue();var json=beforeHandlerEvent(consultCloseCode,insCode,bizId);if(json==null){closeConsult(contextPath,taskId,comment,consultCloseCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){closeConsult(contextPath,taskId,comment,consultCloseCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==consultRevokeCode){btn.setHandler(function(){var comment=textArea.getValue();var json=beforeHandlerEvent(consultRevokeCode,insCode,bizId);if(json==null){revokeConsult(contextPath,taskId,comment,consultRevokeCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){revokeConsult(contextPath,taskId,comment,consultRevokeCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==delegateCode){btn.setHandler(function(){var json=beforeHandlerEvent(delegateCode,insCode,bizId);var comment=textArea.getValue();if(json==null){chooseAllUsers(contextPath,taskId,delegateCode,insCode,bizId,comment)}else{var response=Ext.JSON.decode(json);if(response.flag==0){chooseAllUsers(contextPath,taskId,delegateCode,insCode,bizId,comment)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==goBackCode){btn.setHandler(function(){var json=beforeHandlerEvent(goBackCode,insCode,bizId);if(json==null){var respActArray=getGlobalData(contextPath+"/workItemAction.do?method=getBackActivityList",taskId);if(respActArray.flag==0){var acts=respActArray.data;var comment=textArea.getValue();chooseBackActivity(contextPath,acts,taskId,comment,goBackCode,insCode,bizId)}else{Ext.Msg.alert("提示",respActArray.msg);return false}}else{var response=Ext.JSON.decode(json);if(response.flag==0){var respActArray=getGlobalData(contextPath+"/workItemAction.do?method=getBackActivityList",taskId);if(respActArray.flag==0){var acts=respActArray.data;var comment=textArea.getValue();chooseBackActivity(contextPath,acts,taskId,comment,goBackCode,insCode,bizId)}else{Ext.Msg.alert("提示",respActArray.msg);return false}}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==rejectCode){btn.setHandler(function(){var comment=textArea.getValue();var json=beforeHandlerEvent(rejectCode,insCode,bizId);if(json==null){doReject(contextPath,taskId,comment,rejectCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){doReject(contextPath,taskId,comment,rejectCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{if(code==copyToCode){btn.setHandler(function(){var json=beforeHandlerEvent(copyToCode,insCode,bizId);if(json==null){closeCopyTo(contextPath,taskId,copyToCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){closeCopyTo(contextPath,taskId,copyToCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}else{lineArray.push(btn.getId()+";"+code);btn.setHandler(function(code){var lineCode="";for(var j=0;j<lineArray.length;j++){var a=lineArray[j].split(";");if(a[0]==code.id){lineCode=a[1];break}}var comment=textArea.getValue();var json=beforeHandlerEvent(lineCode,insCode,bizId);if(json==null){completeTask(contextPath,taskId,comment,null,lineCode,insCode,bizId)}else{var response=Ext.JSON.decode(json);if(response.flag==0){completeTask(contextPath,taskId,comment,null,lineCode,insCode,bizId)}else{Ext.Msg.alert("执行失败","原因："+response.msg);return false}}})}}}}}}}}}btnArray.push(btn)}}if(btnArray.length==0&&taskState=="open"){var _flag=respButtonArray.flag;var _msg=respButtonArray.msg;if(_flag=="0"){_msg='此待办已被<font color="red">关闭/挂起</font>您暂不能执行审批处理,请确认!'}Ext.Msg.alert("提示",_msg,function(){window.parent.close()})}var respFormJson=getGlobalData(contextPath+"/workItemAction.do?method=getTaskBaseInfo",taskId);var formUrl=respFormJson.formUrl;Ext.getDom("bizPanelFrame").src=formUrl;var createType=respFormJson.createType;if(createType=="normal"||createType=="consult"){Ext.getDom("fd_comment_id").style.display=""}else{Ext.getDom("fd_comment_id").style.display="none"}if(taskState=="closed"||createType=="start"){Ext.getDom("fd_buttons_id").style.display="none";Ext.getDom("fd_comment_id").style.display="none"}else{Ext.getDom("fd_buttons_id").style.display="";Ext.getDom("fd_comment_id").style.display=""}var buttonPanel=Ext.create("Ext.panel.Panel",{width:"100%",bodyBorder:false,frame:true,renderTo:"buttonsIframe",buttonAlign:"right",buttons:btnArray});var textArea=Ext.create("Ext.form.field.TextArea",{width:"100%",height:50,inputType:"text"});var commentPanel=Ext.create("Ext.panel.Panel",{width:"100%",height:50,layout:"fit",renderTo:"commentIframe",items:[textArea]})})};